<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"                  
		"http://ibatis.apache.org/dtd/sql-map-2.dtd">                              
                                                                                                                      
<sqlMap namespace="FSMB0010">
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 조회 처리
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH00" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			SELECT   /*FSMB0010.SEARCH00.자산등록 조회 처리*/
                    '' AS CHK
                    , CASE WHEN (A.SLIP_NUMB IS NOT NULL OR A.SLIP_NUMB <> ' ') THEN 1
                        ELSE 0 END AS CHK_GUBN
                    ,A.ASST_NUMB   /*자산번호*/
                    ,A.ASST_NAME   /*자산명*/
                    ,A.ACQS_DATE   /*취득일*/
                    ,A.CLSF_CODE   /*품목분류코드*/
                    ,B.SMAL_NAME AS CLSF_NAME   /*품목분류*/
                    ,B.ASCL_NAME   /* 자산 분류명 */
                    ,B.ASCL_CODE   /* 자산 분류코드*/
                    ,B.ASST_DTLX   /*자산세부유형코드*/
                    ,A.DPCT_METH   /*상각방법[DPCT_METH]*/
                    ,A.DPCT_CMPT   /*상각완료기준[DPCT_CMPT]*/
                    ,A.PRID_DPCT   /*내용년수*/
                    ,A.DPCT_RATE   /*감가상각율*/
                    ,A.DPCT_CYCL   /*상각주기[DPCT_CYCL]*/
                    ,A.ACCT_UNIT   /*회계단위[ACCT_UNIT]*/
                    ,A.UNIT_CODE   /*자산단위코드[UNIT_CODE]*/
                    ,A.ASST_STRD   /*자산규격*/
                    ,A.DETL_STRD   /*세부규격*/
                    ,A.ACQU_NUMB   /*취득수량*/
                    ,A.ACQU_COST   /*취득단가*/
                    ,A.ACQU_PRIC   /*취득금액*/
                    ,NVL(A.VATX_AMNT,0) AS VATX_AMNT   /*부가세*/
                    ,A.DEPT_CODE   /*부서코드*/
                    ,SF_GET_DEPTNAME(A.DEPT_CODE) AS DEPT_NAME /*부서명*/
                    ,A.BUYX_NAME   /*구매처명*/
                    ,A.CUST_CODE   /*구매처*/
                    ,SF_GET_CUSTNAME(A.CUST_CODE) AS CUST_NAME  /*구매처명*/
                    ,A.EMPL_NUMB   /*사원번호*/
                    ,SF_GET_EMPLNAME(A.EMPL_NUMB) AS EMPL_NAME /*사원명*/
                    ,A.MUFT_NAME   /*제조업체*/
                    ,A.BARX_CODE   /*자산바코드*/
                    ,A.DPCT_STAT   /*상각상태[DPCT_STAT]*/
                    ,A.ASST_STAT   /*자산상태[ASST_STAT]*/
                    ,A.ACQU_CHNL   /*취득경로[ACQU_CHNL]*/
                    ,A.PAST_NUMB   /*모자산번호*/
                    ,A.FCHG_DATE   /*최종변동일*/
                    ,A.ASST_CSCD   /*자산비용구분[ASST_CSCD]*/
                    ,A.BEFO_ASST   /*이전자산코드*/
                    ,A.BEFO_DEPT   /*이전부서코드*/
                    ,A.UNDP_BALE   /*미상각잔액*/
                    ,A.SAVG_VALU   /*잔존가액*/
                    ,A.FILE_IDXX   /* 파일ID */
                    ,E.FILE_PATH   /* 저장경로 */
			        ,E.PFIL_NAME   /* 물리파일명 */
			        ,E.LFIL_NAME   /* 논리파일명 */
			        ,E.EXTN_NAME   /* 확장자 */
                    ,A.DESC_REMK   /*비고(100)*/
                    ,A.PRID_LEGL   /*세무년수*/
                    ,NVL(A.IDLE_YSNO, 0) AS IDLE_YSNO    /*유휴여부*/
                    ,A.SLIP_NUMB    /*전표번호*/
                    ,A.SLIP_LINE    /*전표순번*/
                    ,0 AS FCHG_PRIC /*변동금액*/
                    ,C.CARX_NUMB    /*차량번호*/
                    ,C.CARX_NAME    /*차량명*/
                    ,C.CARX_MODL    /*차종*/
                    ,SF_GET_COMMNAME('CARX_MODL',C.CARX_MODL) AS CARX_MODLNAME   /*차종명칭*/
                    ,C.CARX_YEAR     /*년식*/
                    ,C.VHCL_NUMB     /*차대번호*/
                    ,C.CARX_FORM     /*형식*/
                    ,C.CARX_DPCT     /*배기량*/
                    ,C.SYLD_CNTX     /*기통수*/
                    ,C.FACT_CODE     /*설비코드*/
                    ,SF_GET_COMMNAME('FACT_CODE', C.FACT_CODE) AS FACT_NAME    /*설비명칭*/
                    ,C.PFMC_CAPA     /*성능및용량*/
                    ,C.LAND_AREA     /* 토지면적*/   
                    ,A.ACCT_GUBN      /*사업장 */           
               FROM FS_ASSTXM A 
               		INNER JOIN VI_ASSETCLASS B ON A.CLSF_CODE = B.SMAL_CODE
                	LEFT JOIN FS_ASSTXD C ON A.ASST_NUMB = C.ASST_NUMB                
				    LEFT OUTER JOIN TM_AFILED E ON A.FILE_IDXX = E.FILE_IDXX
              WHERE B.ASST_GUBN           = #ASST_GUBN#                              /*고정/부외*/
]]>
            <isNotEmpty prepend="AND" property = "ASCL_CODE">
                  B.ASCL_CODE           = #ASCL_CODE#             /*자산분류*/
            </isNotEmpty>
            <isNotEmpty prepend="AND" property = "CLSF_CODE">
                  A.CLSF_CODE           = #CLSF_CODE#             /*품목분류*/
            </isNotEmpty>         
            <isNotEmpty prepend="AND" property = "ACQU_DAT1">
                  <![CDATA[
                  A.ACQS_DATE          >= #ACQU_DAT1#             /*취득일 - 시작*/
                  ]]>
            </isNotEmpty>   
            <isNotEmpty prepend="AND" property = "ACQU_DAT2">
                  <![CDATA[
                  A.ACQS_DATE          <= #ACQU_DAT2#             /*취득일 - 종료*/
                  ]]>
            </isNotEmpty> 
            <isNotEmpty prepend="AND" property = "ASST_STAT">
                  A.ASST_STAT 			= #ASST_STAT#   /*자산상태*/
            </isNotEmpty>
            <isNotEmpty prepend="AND" property = "DEPT_CODE">
                  A.DEPT_CODE 			= #DEPT_CODE#   /*부서코드*/
            </isNotEmpty>
            <isNotEmpty prepend="AND" property = "EMPL_NUMB">
                  A.EMPL_NUMB 			= #EMPL_NUMB#   /*사원번호*/
            </isNotEmpty> 
            <isNotEmpty prepend="AND" property = "ASST_NUMB">
                  A.ASST_NUMB LIKE '%' ||REPLACE( #ASST_NUMB# , '-' , '')|| '%'                        /*자산명*/
            </isNotEmpty>                                                                        
		<![CDATA[ 
		      ORDER BY A.ACQS_DATE DESC, A.ASST_NUMB DESC
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 저장 처리
********************************************************************************/
 -->
	<insert id="FSMB0010.SAVE00" parameterClass="hashmap">
		<![CDATA[
		DECLARE
	      	/*FSMB0010.SAVE00.자산등록 저장 처리*/
			sASST_NUMB  FS_ASSTXM.ASST_NUMB%TYPE;   /*자산번호 채번*/
	
	    BEGIN

	        /*  --2014.12 NDS 채번로직으로 변경. INBUS원본
	        SELECT NVL(MAX(ASST_NUMB),SUBSTR(iACQS_DATE,1,4)||'00000') + 1 -- 채번
	          INTO sASST_NUMB
	          FROM FS_ASSTXM
	         WHERE ACQS_DATE LIKE  SUBSTR(iACQS_DATE,1,4) || '%';
	        */
	
	        /*             취득년                       품목대.중분류                  MAX(0000)+1 숫자 */
	        SELECT SUBSTR(#ACQS_DATE#, 1, 4) ||  SUBSTR(#CLSF_CODE#,1,4) || LPAD(TO_NUMBER(NVL(SUBSTR(MAX(ASST_NUMB), 9, 4), '0')) + 1, 4, '0')
	        INTO sASST_NUMB
	        FROM FS_ASSTXM
	          WHERE ( ACQS_DATE LIKE  SUBSTR(#ACQS_DATE#,1,4) || '%' or SUBSTR(ASST_NUMB , 1 , 4) LIKE SUBSTR(#ACQS_DATE#,1,4) || '%')
	            AND ( CLSF_CODE LIKE  SUBSTR(#CLSF_CODE#,1,4) || '%' or SUBSTR(ASST_NUMB , 5 , 4) LIKE SUBSTR(#CLSF_CODE#,1,4) || '%') ;
	
	 BEGIN 
	        INSERT INTO FS_ASSTXM (
	               ASST_NUMB   /*자산번호*/
	              ,ASST_NAME   /*자산명*/
	              ,ACQS_DATE   /*취득일*/
	              ,CLSF_CODE   /*품목분류코드*/
	              ,DPCT_METH   /*상각방법[DPCT_METH]*/
	              ,PRID_DPCT   /*내용년수*/
	              ,DPCT_RATE   /*감가상각율*/
	              ,DPCT_CYCL   /*상각주기[DPCT_CYCL]*/
	              ,ACCT_UNIT   /*회계단위[ACCT_UNIT]*/
	              ,ASST_STRD   /*자산규격*/
	              ,DETL_STRD   /*세부규격*/
	              ,ACQU_NUMB   /*취득수량*/
	              ,ACQU_COST   /*취득단가*/
	              ,ACQU_PRIC   /*취득금액*/
	              ,DEPT_CODE   /*부서코드*/
	              ,UNIT_CODE   /*자산단위코드[UNIT_CODE]*/
	              ,EMPL_NUMB   /*사원번호*/
	              ,BUYX_NAME   /*구매처명*/
	              ,MUFT_NAME   /*제조업체*/
	              ,BARX_CODE   /*자산바코드*/
	              ,FILE_IDXX   /* 파일ID */
	              ,DESC_REMK   /*비고(100)*/
	              ,DPCT_STAT   /*상각상태[DPCT_STAT]*/
	              ,ASST_STAT   /*자산상태[ASST_STAT]*/
	              ,UNDP_BALE   /*미상각잔액*/
	              ,SAVG_VALU   /*잔존가액*/
	              ,ACQU_CHNL   /*취득경로[ACQU_CHNL]*/
	              ,PAST_NUMB   /*모자산번호*/
	              ,FCHG_DATE   /*최종변동일*/
	              ,ASST_CSCD   /*자산비용구분[ASST_CSCD]*/
	              ,PRID_LEGL   /*세무년수*/
	              ,IDLE_YSNO   /*유휴여부*/
	              ,INST_DATE   /*등록일시*/
	              ,INST_USID   /*등록자*/
	              ,UPDT_DATE   /*수정일시*/
	              ,UPDT_USID   /*수정자*/
	              ,VATX_AMNT   /*부가세*/
	              ,DPCT_CMPT   /*상각완료기준*/
	              ,CUST_CODE   /*구매처*/
	              ,ACCT_GUBN   /*사업장*/
	              )
	       VALUES (
	               sASST_NUMB  /*자산채번번호*/
	              ,#ASST_NAME#
	              ,#ACQS_DATE#
	              ,#CLSF_CODE#
	              ,#DPCT_METH#
	              ,#PRID_DPCT#
	              ,#DPCT_RATE#
	              ,#DPCT_CYCL#
	              ,#ACCT_UNIT#
	              ,#ASST_STRD#
	              ,#DETL_STRD#
	              ,#ACQU_NUMB#
	              ,#ACQU_COST#
	              ,#ACQU_PRIC#
	              ,#DEPT_CODE#
	              ,#UNIT_CODE#
	              ,#EMPL_NUMB#
	              ,#BUYX_NAME#
	              ,#MUFT_NAME#
	              ,#BARX_CODE#
	              ,#FILE_IDXX#
	              ,#DESC_REMK#
	              ,#DPCT_STAT#
	              ,#ASST_STAT#
	              ,#UNDP_BALE#
	              ,#SAVG_VALU#
	              ,#ACQU_CHNL#
	              ,#PAST_NUMB#
	              ,#FCHG_DATE#
	              ,#ASST_CSCD#
	              ,#PRID_LEGL#
	              ,#IDLE_YSNO#
	              ,SYSDATE
	              ,#UPDT_USID#
	              ,SYSDATE
	              ,#UPDT_USID#
	              ,#VATX_AMNT#
	              ,#DPCT_CMPT#
	              ,#CUST_CODE#
	              ,#ACCT_GUBN#
	              );       
	              
	              EXCEPTION 
	                WHEN OTHERS THEN
	                 RAISE_APPLICATION_ERROR(-20000, sASST_NUMB || '에러'||chr(13)||chr(10)||SQLERRM);
	                END;  
	
	        /*신규취득으로 자산변동 테이블에 INSERT*/
	        INSERT INTO FS_ASCHXM (
	               CHNG_DATE   /*변동일*/
	              ,ASST_NUMB   /*자산번호*/
	              ,SEQN_NUMB   /*일련번호*/
	              ,ASCH_GUBN   /*변동구분[ASCH_GUBN]*/
	              ,ASST_STAT   /*자산상태[ASST_STAT]*/
	              ,CHBF_DEPT   /*변경전부서코드*/
	              ,CHBF_EMPL   /*변경전사원번호*/
	              ,DEPT_CODE   /*부서코드*/
	              ,EMPL_NUMB   /*사원번호*/
	              ,ACQU_ENDX   /*취득가_기말잔액*/
	              ,DPCT_ENDX   /*충당금_기말잔액*/
	              ,UNDP_BALE   /*미상각잔액*/
	              ,CHNG_AMOT   /*변동금액*/
	              ,DSPS_AMOT   /*처분가액*/
	              ,DSPS_GILS   /*처분손익*/
	              ,DPCT_GRDC   /*충당금가감액*/
	              ,ACCT_INTL   /*계정과목코드*/
	              ,CUST_CODE   /*거래처코드*/
	              ,RCGN_YSNO   /*승인여부*/
	              ,APPV_DATE   /*승인일시*/
	              ,APPR_EMPL   /*승인자*/
	              ,SLIP_NUMB   /*전표번호*/
	              ,DESC_REMK   /*비고(100)*/
	              ,INST_DATE   /*등록일시*/
	              ,INST_USID   /*등록자*/
	              ,UPDT_DATE   /*수정일시*/
	              ,UPDT_USID   /*수정자*/
	              ,ACCT_UNIT   /*회계단위*/
	              ,ACCT_GUBN   /*사업장*/
	              )
	       VALUES (
	               #ACQS_DATE# /*취득일*/
	              ,sASST_NUMB  /*자산채번번호*/
	              ,1           /*신규 자산으로 언제나 1*/
	              ,'ACQU'      /*변동구분(신규취득:10)*/
	              ,#ASST_STAT#  /*자산상태(사용중:USIG_원래는 자산변동관리FSMB0030에서 신규취득시 사용중으로 변동 처리해야하나 자산등록시 직접 처리함)*/
	              ,#DEPT_CODE#  /*변경전부서*/
	              ,#EMPL_NUMB#  /*변경전사원*/
	              ,#DEPT_CODE#  /*현부서*/
	              ,#EMPL_NUMB#  /*현사원*/
	              ,#ACQU_PRIC#  /*취득가_기말잔액*/
	              ,0           /*충당금_기말잔액*/
	              ,#UNDP_BALE#  /*미상각잔액*/
	              ,#ACQU_PRIC#  /*변동금액*/
	              ,0           /*처분가액*/
	              ,0           /*처분손익*/
	              ,0           /*충당금가감액*/
	              ,(SELECT DPCT_ACT1 FROM VI_ASSETCLASS WHERE SMAL_CODE = #CLSF_CODE#)        /*계정과목코드*/
	              ,#CUST_CODE#  /* 구매처  */        /*거래처코드*/
	              ,'1'         /*승인여부(승인)*/
	              ,SYSDATE  /*승인자*/
	              ,#UPDT_USID#  /*승인일시*/
	              /*,'0'         승인여부*/
	              /*,''          승인일시*/
	              /*,''          승인자*/
	              ,''          /*전표번호*/
	              ,#ASST_NAME#||'(신규취득)'          /*비고*/
	              ,SYSDATE  /*등록일시*/
	              ,#UPDT_USID#  /*등록자*/
	              ,SYSDATE  /*수정일시*/
	              ,#UPDT_USID#  /*수정자*/
	              ,#ACCT_UNIT#  /*회계단위*/
	              ,#ACCT_GUBN#  /*사업장*/
	              );         
	
	          /* 자산세부유형 저장 (차량,기계, 토지) */
	          IF (#ASST_DTLX# = 'CARX' OR #ASST_DTLX# = 'PLAT' OR #ASST_DTLX# = 'LAND') THEN
	
	            INSERT INTO FS_ASSTXD(
	                        ASST_NUMB    /*자산등록번호*/
	                        ,CARX_NUMB   /*차량번호*/
	                        ,CARX_NAME   /*차량명*/
	                        ,CARX_MODL   /*차종*/
	                        ,CARX_YEAR   /*년식*/
	                        ,VHCL_NUMB   /*차대번호*/
	                        ,CARX_FORM   /*형식*/
	                        ,CARX_DPCT   /*배기량*/
	                        ,SYLD_CNTX   /*기통수*/
	                        ,FACT_CODE   /*설비코드*/
	                        ,PFMC_CAPA   /*성능및용량*/
	                        ,LAND_AREA   /* 토지면적*/
	                        ,INST_DATE   /*등록일시*/
	                        ,INST_USID   /*등록자*/
	                        ,UPDT_DATE   /*수정일시*/
	                        ,UPDT_USID   /*수정자*/
	                          )
	                   VALUES (
	                         sASST_NUMB
	                        ,#CARX_NUMB#
	                        ,#CARX_NAME#
	                        ,#CARX_MODL#
	                        ,#CARX_YEAR#
	                        ,#VHCL_NUMB#
	                        ,#CARX_FORM#
	                        ,#CARX_DPCT#
	                        ,#SYLD_CNTX#
	                        ,#FACT_CODE#
	                        ,#PFMC_CAPA#
	                        ,#LAND_AREA#
	                        ,SYSDATE
	                        ,#UPDT_USID#
	                        ,SYSDATE
	                        ,#UPDT_USID#
	                        );         
	          END IF;
		END;
		]]>
	</insert>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 수정 처리
********************************************************************************/
 -->
	<update id="FSMB0010.UPDATE00" parameterClass="hashmap">
		<![CDATA[
		DECLARE
		      /*FSMB0010.UPDATE00.자산등록 수정 처리*/
			sASST_STAT           FS_ASSTXM.ASST_STAT%TYPE; /*자산상태[ASST_STAT]*/
	
	    BEGIN
	
			/*PARAM*/
			/*
	        *화면에서 필수값은 수정안되게 되어있기때문에 pkg에서는 수정가능하도록 변경 자산상태 체크
	        *SELECT ASST_STAT INTO sASST_STAT FROM FS_ASSTXM WHERE ASST_NUMB = iASST_NUMB;
	        *IF (sASST_STAT <> 'WAIT') THEN
	        *   RAISE_APPLICATION_ERROR(-20000, iASST_NUMB || ':' || iASST_NAME || '은 대기상태가 아닙니다.\n\n수정이 불가 합니다!');
	        *END IF;
			*/
	
	        UPDATE FS_ASSTXM
	           SET  ASST_NAME = #ASST_NAME#   /*자산명*/
	               ,ACQS_DATE = #ACQS_DATE#   /*취득일*/
	               ,CLSF_CODE = #CLSF_CODE#   /*품목분류코드*/
	               ,DPCT_METH = #DPCT_METH#   /*상각방법[DPCT_METH]*/
	               ,PRID_DPCT = #PRID_DPCT#   /*내용년수*/
	               ,DPCT_RATE = #DPCT_RATE#   /*감가상각율*/
	               ,DPCT_CYCL = #DPCT_CYCL#   /*상각주기[DPCT_CYCL]*/
	               ,ACCT_UNIT = #ACCT_UNIT#   /*회계단위[ACCT_UNIT]*/
	               ,ASST_STRD = #ASST_STRD#   /*자산규격*/
	               ,DETL_STRD = #DETL_STRD#   /*세부규격*/
	               ,ACQU_NUMB = #ACQU_NUMB#   /*취득수량*/
	               ,ACQU_COST = #ACQU_COST#   /*취득단가*/
	               ,ACQU_PRIC = #ACQU_PRIC#   /*취득금액*/
	               ,DEPT_CODE = #DEPT_CODE#   /*부서코드*/
	               ,UNIT_CODE = #UNIT_CODE#   /*자산단위코드[UNIT_CODE]*/
	               ,EMPL_NUMB = #EMPL_NUMB#   /*사원번호*/
	               ,BUYX_NAME = #BUYX_NAME#   /*구매처명*/
	               ,MUFT_NAME = #MUFT_NAME#   /*제조업체*/
	               ,BARX_CODE = #BARX_CODE#   /*자산바코드*/
	               ,FILE_IDXX = #FILE_IDXX#   /* 파일ID */
	               ,DESC_REMK = #DESC_REMK#   /*비고(100)*/
	               ,DPCT_STAT = #DPCT_STAT#   /*상각상태[DPCT_STAT]*/
	               ,ASST_STAT = #ASST_STAT#   /*자산상태[ASST_STAT]*/
	               ,UNDP_BALE = #UNDP_BALE#   /*미상각잔액*/
	               ,SAVG_VALU = #SAVG_VALU#   /*잔존가액*/
	               ,ACQU_CHNL = #ACQU_CHNL#   /*취득경로[ACQU_CHNL]*/
	               ,PAST_NUMB = #PAST_NUMB#   /*모자산번호*/
	               ,FCHG_DATE = #FCHG_DATE#   /*최종변동일*/
	               ,ASST_CSCD = #ASST_CSCD#   /*자산비용구분[ASST_CSCD]*/
	               ,UPDT_DATE = SYSDATE   /*수정일시*/
	               ,UPDT_USID = #UPDT_USID#   /*수정자*/
	               ,PRID_LEGL = #PRID_LEGL#   /*세무년수*/
	               ,IDLE_YSNO = #IDLE_YSNO#   /*유휴여부*/
	               ,VATX_AMNT = #VATX_AMNT#   /*부가세*/
	               ,DPCT_CMPT = #DPCT_CMPT#   /*상각완료기준*/
	               ,CUST_CODE = #CUST_CODE#   /*구매처*/
	         WHERE ASST_NUMB  = #ASST_NUMB#   /*자산번호*/
	           ;                        
	
	        UPDATE  FS_ASCHXM
	           SET  CHBF_DEPT = #DEPT_CODE#  /*변경전부서*/
	               ,CHBF_EMPL = #EMPL_NUMB#  /*변경전사원*/
	               ,DEPT_CODE = #DEPT_CODE#  /*현부서*/
	               ,EMPL_NUMB = #EMPL_NUMB#  /*현사원*/
	               ,ACQU_ENDX = #ACQU_PRIC#  /*취득가_기말잔액*/
	               ,UNDP_BALE = #UNDP_BALE#  /*미상각잔액*/
	               ,CHNG_AMOT = #ACQU_PRIC#  /*변동금액*/
	          WHERE CHNG_DATE = #ACQS_DATE#  /*취득일*/
	            AND ASST_NUMB = #ASST_NUMB#  /*자산채번번호*/
	            AND SEQN_NUMB = 1            /*신규 자산으로 언제나 1*/
	            ;
	
	          /* 자산세부유형 저장 (차량,기계, 토지) */
	          IF (#ASST_DTLX# = 'CARX' OR #ASST_DTLX# = 'PLAT' OR #ASST_DTLX# = 'LAND') THEN
	
	            MERGE INTO FS_ASSTXD A
	            USING DUAL B
	              ON (A.ASST_NUMB = #ASST_NUMB#)
	            WHEN MATCHED THEN
	            UPDATE SET
		               A.CARX_NUMB = #CARX_NUMB#   /*차량번호*/
		              ,A.CARX_NAME = #CARX_NAME#   /*차량명*/
		              ,A.CARX_MODL = #CARX_MODL#   /*차종*/
		              ,A.CARX_YEAR = #CARX_YEAR#   /*년식*/
		              ,A.VHCL_NUMB = #VHCL_NUMB#   /*차대번호*/
		              ,A.CARX_FORM = #CARX_FORM#   /*형식*/
		              ,A.CARX_DPCT = #CARX_DPCT#   /*배기량*/
		              ,A.SYLD_CNTX = #SYLD_CNTX#   /*기통수*/
		              ,A.FACT_CODE = #FACT_CODE#   /*설비코드*/
		              ,A.PFMC_CAPA = #PFMC_CAPA#   /*성능및용량*/
		              ,A.LAND_AREA = #LAND_AREA#   /* 토지면적*/
		              ,A.UPDT_DATE = SYSDATE   /*수정일시*/
		              ,A.UPDT_USID = #UPDT_USID#   /*수정자*/
	            WHEN NOT MATCHED THEN      
	            INSERT (
		                 A.ASST_NUMB   /*자산등록번호*/
		                ,A.CARX_NUMB   /*차량번호*/
		                ,A.CARX_NAME   /*차량명*/
		                ,A.CARX_MODL   /*차종*/
		                ,A.CARX_YEAR   /*년식*/
		                ,A.VHCL_NUMB   /*차대번호*/
		                ,A.CARX_FORM   /*형식*/
		                ,A.CARX_DPCT   /*배기량*/
		                ,A.SYLD_CNTX   /*기통수*/
		                ,A.FACT_CODE   /*설비코드*/
		                ,A.PFMC_CAPA   /*성능및용량*/
		                ,A.LAND_AREA   /* 토지면적*/
		                ,A.INST_DATE   /*등록일시*/
		                ,A.INST_USID   /*등록자*/
		                ,A.UPDT_DATE   /*수정일시*/
		                ,A.UPDT_USID   /*수정자*/
	                  )
	            VALUES (
		                 #ASST_NUMB#
		                ,#CARX_NUMB#
		                ,#CARX_NAME#
		                ,#CARX_MODL#
		                ,#CARX_YEAR#
		                ,#VHCL_NUMB#
		                ,#CARX_FORM#
		                ,#CARX_DPCT#
		                ,#SYLD_CNTX#
		                ,#FACT_CODE#
		                ,#PFMC_CAPA#
		                ,#LAND_AREA#
		                ,SYSDATE
		                ,#UPDT_USID#
		                ,SYSDATE
		                ,#UPDT_USID#
	                );         
	
	          END IF;
	     END;
		]]>
	</update>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 삭제 처리
********************************************************************************/
 -->
	<delete id="FSMB0010.DELETE00" parameterClass="hashmap" >
		<![CDATA[
		DECLARE
		      /*FSMB0010.DELETE00.자산등록 삭제 처리*/
			#CNT#                DECIMAL(15,0);
	    	sASST_STAT           FS_ASSTXM.ASST_STAT%TYPE; /*자산상태[ASST_STAT]*/
	
	    BEGIN
	
	        /*자산상태 체크*/
	        SELECT ASST_STAT INTO sASST_STAT FROM FS_ASSTXM WHERE ASST_NUMB = #ASST_NUMB#;
	        IF (sASST_STAT <> 'WAIT') THEN
	           RAISE_APPLICATION_ERROR(-20000, #ASST_NUMB# || ':' || #ASST_NAME# || '은 대기상태가 아닙니다.\n\n삭제가 불가 합니다!');
	        END IF;
	
	        /*변동 이력 존재 유무 체크*/
	        SELECT COUNT(ASST_NUMB) INTO #CNT# FROM FS_ASCHXM WHERE ASST_NUMB = #ASST_NUMB# AND RCGN_YSNO = '1';
	        IF (#CNT# > 0) THEN
	           RAISE_APPLICATION_ERROR(-20000, #ASST_NUMB# || ':' || #ASST_NAME# || '의 확정된 변동이력이 있습니다.\n\n삭제가 불가 합니다!');
	        END IF;
	
	        /*수리이력 존재 유무 체크*/
	        SELECT COUNT(ASST_NUMB) INTO #CNT# FROM FS_ASRPXM WHERE ASST_NUMB = #ASST_NUMB# AND REPR_YSNO = '1';
	        IF (#CNT# > 0) THEN
	           RAISE_APPLICATION_ERROR(-20000, #ASST_NUMB# || ':' || #ASST_NAME# || '의 확정된 수리이력이 있습니다.\n\n삭제가 불가 합니다!');
	        END IF;
	
	        /*분할이력 존재 유무 체크*/
	        SELECT COUNT(ASST_NUMB) INTO #CNT# FROM FS_ASSPXM WHERE ASST_NUMB = #ASST_NUMB# AND RCGN_YSNO = '1';
	        IF (#CNT# > 0) THEN
	           RAISE_APPLICATION_ERROR(-20000, #ASST_NUMB# || ':' || #ASST_NAME# || '의 확정된 분할이력이 있습니다.\n\n삭제가 불가 합니다!');
	        END IF;
	
	        /*자료 삭제 처리*/
	        DELETE FROM FS_ASCHXM WHERE ASST_NUMB = #ASST_NUMB#;   /*변동이력 삭제*/
	        DELETE FROM FS_ASRPXM WHERE ASST_NUMB = #ASST_NUMB#;   /*수리이력 삭제*/
	        DELETE FROM FS_ASSPXD WHERE ASST_NUMB = #ASST_NUMB#;   /*분할이력 디테일삭제*/
	        DELETE FROM FS_ASSPXM WHERE ASST_NUMB = #ASST_NUMB#;   /*분할이력 헤더삭제*/
	        DELETE FROM FS_ASSTXD WHERE ASST_NUMB = #ASST_NUMB#;   /*자산세부유형 삭제*/
	        DELETE FROM FS_ASSTXM WHERE ASST_NUMB = #ASST_NUMB#;   /*마스터 삭제*/
	     END;                                               
		]]>
	</delete>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 변동이력 탭 조회
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH01" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
		 	 SELECT  /*FSMB0010.SEARCH01.자산등록 변동이력 탭 조회*/
		 	         CHNG_DATE   /*변동일*/
                    ,ASCH_GUBN   /*변동구분[ASCH_GUBN]*/
                    ,RCGN_YSNO   /*승인상*/
                    ,CHNG_AMOT   /*변동금액*/
                    ,SLIP_NUMB   /*전표번호*/
                    ,DESC_REMK   /*비고(100)*/
                    ,SF_GET_DEPTNAME(DEPT_CODE) AS DEPT_NAME /*부서명*/
               FROM FS_ASCHXM
              WHERE ASST_NUMB = #ASST_NUMB# /*자산번호*/
                AND ASCH_GUBN IN (SELECT COMD_CODE FROM TM_CODEXD WHERE COMM_CODE = 'ASCH_GUBN' AND REF1_FILD <> 'MOVE') /* 자산이 이동이 아닌 코드*/
           ORDER BY CHNG_DATE DESC, SEQN_NUMB DESC
           
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 이동이력 탭 조회
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH02" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			 SELECT  /*FSMB0010.SEARCH02.자산등록 이동이력 탭 조회*/
			         CHNG_DATE   /*이동일*/
                    ,SF_GET_DEPTNAME(CHBF_DEPT) AS BFDE_NAME /*변경전부서명*/
                    ,SF_GET_EMPLNAME(CHBF_EMPL) AS BFEM_NAME /*변경전사원명*/
                    ,SF_GET_DEPTNAME(DEPT_CODE) AS DEPT_NAME /*부서명*/
                    ,SF_GET_EMPLNAME(EMPL_NUMB) AS EMPL_NAME /*사원명*/
                    ,APPV_DATE   /*승인일시*/
                    ,SF_GET_EMPLNAME(APPR_EMPL) AS APEM_NAME /*승인자*/
                    ,DESC_REMK   /*비고(100)*/
               FROM FS_ASCHXM
              WHERE ASST_NUMB = #ASST_NUMB#/*자산번호*/
                AND ASCH_GUBN IN (SELECT COMD_CODE FROM TM_CODEXD WHERE COMM_CODE = 'ASCH_GUBN' AND REF1_FILD = 'MOVE') /* 자산이 이동인것만 조회*/
           ORDER BY CHNG_DATE DESC, SEQN_NUMB DESC
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 수리이력 탭 조회
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH03" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			 SELECT  /*FSMB0010.SEARCH03.자산등록 수리이력 탭 조회*/
			         RPRQ_DATE   /*수리의뢰일*/
                    ,RPRQ_DESC   /*수리의뢰내역*/
                    ,REPR_DATE   /*수리완료일*/
                    ,REPR_AMOT   /*수리금액*/
                    ,REPR_VDER   /*수리업체*/
                    ,RPAR_DESC   /*수리내역*/
               FROM FS_ASRPXM
              WHERE ASST_NUMB = #ASST_NUMB#/*자산번호*/
              ORDER BY RPRQ_DATE DESC, SEQN_NUMB DESC
		]]>
	</select>

<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 상각이력 탭 조회
********************************************************************************/
 -->	
	<select id="FSMB0010.SEARCH04" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			 SELECT  /*FSMB0010.SEARCH04.자산등록 상각이력 탭 조회*/
			         STDS_YMTH                                 /*기준년월*/
                    ,DEPT_CODE                                 /*부서코드*/
                    ,SF_GET_DEPTNAME(DEPT_CODE) AS DEPT_NAME   /*부서명*/
                    ,ACQU_BEGN                                 /*취득가_전기이월*/
                    ,ACQU_GROW                                 /*취득가_당기증가*/
                    ,ACQU_DCRS                                 /*취득가_당기감소*/
                    ,ACQU_ENDX                                 /*취득가_기말잔액*/
                    ,MONT_DPCT                                 /*당월상각액*/
                    ,CRNT_DPCT                                 /*당기상각누적액*/
                    ,(NVL(CRNT_DPCT, 0) - NVL(MONT_DPCT, 0)) AS BRNT_DPCT        /*전월상각누적액*/
                    ,DPTC_BEGN                                 /*충당금_전기이월*/
                    ,DPCT_GROW                                 /*충당금_당기증가*/
                    ,DPCT_DCRS                                 /*충당금_당기감소*/
                    ,DPCT_ENDX                                 /*충당금_기말잔액*/
                    ,UNDP_BALE                                 /*미상각잔액*/
               FROM FS_DPCTXM
              WHERE ASST_NUMB = #ASST_NUMB#   /*자산번호*/
              ORDER BY STDS_YMTH DESC
		
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 분할내역 탭 조회
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH05" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			 SELECT  /*FSMB0010.SEARCH05.자산등록 분할내역 탭 조회*/
			         A.SPLT_DATE   /*분할일*/
                    ,A.SPLT_NUMB   /*분할수량*/
                    ,A.SPLT_PRIC   /*분할금액*/
                    ,A.SPLT_ASST   /*분할자산번호*/
                    ,A.SPLT_NAME   /*분할자산명*/
                    ,B.APPV_DATE   /*승인일시*/
                    ,SF_GET_EMPLNAME(B.APPR_EMPL) AS APPV_EMNM   /*승인자*/
                    ,A.DESC_REMK   /*비고(100)*/
               FROM FS_ASSPXD A LEFT JOIN FS_ASSPXM B
                                       ON A.SPLT_DATE = B.SPLT_DATE
                                      AND A.ASST_NUMB = B.ASST_NUMB
              WHERE A.ASST_NUMB = #ASST_NUMB# /*자산번호*/
              ORDER BY A.SPLT_DATE DESC
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 화면의 상각율조회
********************************************************************************/
 -->
	<select id="FSMB0010.SEARCH10" parameterClass="hashmap" resultClass="hashmap">
		<![CDATA[
			SELECT /*FSMB0010.SEARCH10.화면의 상각율조회*/
		           STDS_YEAR   /*기준년도*/
		          ,PRID_DPCT   /*내용년수*/
		          ,AMOT_RT01 * 100 AS AMOT_RT01  /*정액상각율*/
		          ,AMOT_RT02 * 100 AS AMOT_RT02 /*정률상각율*/
	         FROM FS_AMRATE
	        WHERE STDS_YEAR = (
	                SELECT MAX(STDS_YEAR) FROM FS_AMRATE
	                 WHERE STDS_YEAR <= #STDS_YEAR#
	        )
	         AND PRID_DPCT = #PRID_DPCT#
	       ORDER BY PRID_DPCT
		
		]]>
	</select>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 전표 헤더처리
********************************************************************************/
 -->	
	<insert id="FSMB0010.PROC00" parameterClass="hashmap" >
		<![CDATA[
		DECLARE
		    /* FSMB0010.PROC00.자산등록 전표 헤더처리 */
	        
	        CURSOR CUR_FS_ASSTXM (
	             P_ACCT_UNIT  IN FS_ASSTXM.ACCT_UNIT%TYPE   /*회계단위*/
	            ,P_ASST_NUMB  IN FS_ASSTXM.ASST_NUMB%TYPE   /*자산번호*/
	        ) IS
	        
	             SELECT A.ASST_NUMB     /*자산번호*/
	                   ,A.ACQS_DATE     /*부가매입세액-공급일자*/
	                   ,A.CUST_CODE     /*구매처코드*/
	                   ,A.DEPT_CODE     /*부서코드*/
	                   ,DE.ACCT_GUBN    /* 사업장*/
	                   ,B.DPCT_ACT1     /*관리계정과목(기타의유형자산)*/
	                   /* 등록화면에 계정설정 필드가 없어서 고정설정, */
	                   ,'3221300' AS VATX_ACCT      /*부가세예수금-매입세액*//*cic 임시 */
	                   ,'3141100' AS PRIC_ACCT      /*미지급금-고정자산*//*cic 임시 */
	                   ,NVL(A.ACQU_PRIC, 0) AS ACQU_PRIC     /*취득금액, 부가매입세액-과표*/
	                   ,NVL(A.VATX_AMNT, 0) AS VATX_AMNT     /*부가세액*/
	                   ,A.ASST_NAME     /*자산명[대표적요]*/
	                   ,A.SLIP_NUMB     /*전표번호*/
	                   ,SUBSTR(B.DPCT_ACT1,1,4) AS SUBJ_CODE /* 부가매입세액-관련과목*/
	              FROM FS_ASSTXM A
	             INNER JOIN VI_ASSETCLASS B
	                ON A.CLSF_CODE = B.SMAL_CODE
	              LEFT JOIN VI_DEPTXM DE
	                ON DE.DEPT_CODE = A.DEPT_CODE
	             WHERE A.ACCT_UNIT = P_ACCT_UNIT           /*회계단위*/
	               AND A.ASST_NUMB = P_ASST_NUMB           /*자산번호*/
	        ;
	
	        rFS_ASSTXM      CUR_FS_ASSTXM%ROWTYPE;          /*[자산정보]*/
	
	        sSLIP_DATE      TA_SLIPXM.SLIP_DATE%TYPE;   /*발의일자*/
	        sEMPL_NUMB      TA_SLIPXM.EMPL_NUMB%TYPE;   /*입력자*/
	        sDEPT_CODE      TA_SLIPXM.DEPT_CODE%TYPE;   /*입력부서*/
	        sACCT_GUBN      TA_SLIPXM.ACCT_GUBN%TYPE;   /*사업장*/
	        sTITL_NAME      TA_SLIPXM.TITL_NAME%TYPE;   /*대표적요*/
	        nSLIP_LINE      TA_SLIPNT.SLIP_LINE%TYPE;   /*전표순번*/
	
	        nCURS_SEQN      TA_SLIPNT.SLIP_LINE%TYPE;   /*커서SEQ*/
			
	        sSLIP_NUMB      TA_SLIPXM.SLIP_NUMB%TYPE;   /*전표번호*/
	        
	        
	        sCOND_CODE      TA_ACCTXD.COND_CODE%TYPE;	
	        sCOND_VACD      FS_ASSTXM.CUST_CODE%TYPE;		
	
	
	
	
	
	    BEGIN
	    
	     /*======================================================================================
            STEP 1. 자산등록 전표 생성 여부 체크
        ======================================================================================*/
	        BEGIN
	            /*[자산등록정보]*/
	            OPEN CUR_FS_ASSTXM( #ACCT_UNIT#     /*회계단위*/
	                               ,#ASST_NUMB#     /*자산번호*/
	                               );
	            FETCH CUR_FS_ASSTXM INTO rFS_ASSTXM;
	            CLOSE CUR_FS_ASSTXM;
	
	            EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, '자산등록 전표 생성 여부 체크 중 오류가 발생하였습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	
	        IF rFS_ASSTXM.SLIP_NUMB IS NOT NULL THEN
	            RAISE_APPLICATION_ERROR(-20000, '이미 생성 된 자산등록 전표(' || rFS_ASSTXM.SLIP_NUMB || ')가 존재 합니다.');
	        END IF;
	        
	
	        
	        
	        /* 사용자 정보 조회
	        BEGIN
	            SELECT U.EMPL_NUMB, U.DEPT_CODE, D.ACCT_GUBN
	              INTO   sEMPL_NUMB, sDEPT_CODE, sACCT_GUBN   
	              FROM   VI_USERINFO U
	              LEFT JOIN VI_DEPTXM D
	                ON  D.DEPT_CODE = U.DEPT_CODE
	             WHERE  USER_IDXX = UPDT_USID; 
	
	            EXCEPTION
	                WHEN NO_DATA_FOUND THEN
	                    RAISE_APPLICATION_ERROR(-20000, '입력자에 대한 정보를 찾을 수 없습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	         */
	         
	         sTITL_NAME := '[자산등록] ' || rFS_ASSTXM.ASST_NAME;
	         
	         BEGIN
	           
	           	SELECT TO_CHAR(SYSDATE, 'YYYYMMDD')
	           	INTO  sSLIP_DATE
	           	FROM DUAL; 
	         
	         EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, '날자 파라메터 에러 '||chr(13)||chr(10)||SQLERRM);
	         
	         END;
	         
	        
		 /* PARAM -----------------------------------------------------
	            2-0.자산등록 전표 > HEADER 추가 
	      --------------------------------------------------------------*/
	      
	    BEGIN
	        
		PKG_FAMIFSLIP.SP_MASTER_SAVE(#SYST_LNCD#,      /* ●시스템언어코드*/
									 #UPDT_USID#,      /* ●수정작업자 */
									 #ACCT_UNIT#,      /* ●회계단위 */
									 #ACCT_GUBN#,      /* ●회계구분_사업장 */
									 sSLIP_DATE,       /* ●전표일자(회계일자) */ 
									 #SLIP_GUBN#,      /* ●전표유형구분 */
									 sTITL_NAME,       /* ●제목 */
									 #EMPL_NUMB#,      /* ●사원번호 */
									 rFS_ASSTXM.DEPT_CODE,	   /* ●부서코드 */ 						 
									 #ASST_NUMB#,              /* ●출처연결키 */
									 NULL,
									 NULL,
									 NULL,
									 NULL,
									 NULL,
									 sSLIP_NUMB);      /* ●전표번호(생성된 전표번호 반환) */


            EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, 'HEADER 추가 에러'||chr(13)||chr(10)||SQLERRM);
	        END;									 
	
	       /*--------------------------------------------------------------
	            2-1.자산등록 전표 > LINE 추가[차>대>차변 순서대로 SLIP_LINE저장요망]
	        --------------------------------------------------------------*/
	            nSLIP_LINE := 0; 
	
	        /*--------------------------------------------------------------
	            2-1-1. 자산등록 전표 > LINE 추가 > 관리계정과목(차변)
	        --------------------------------------------------------------*/
	        IF rFS_ASSTXM.ACQU_PRIC > 0 THEN
	            /*nSLIP_LINE := SLIP_LINE;*/        /*JAVA 에서 받아옴 nSLIP_LINE + 1;*/
	            nSLIP_LINE := nSLIP_LINE + 1;
	
	            BEGIN 
	            
	            PKG_FAMIFSLIP.SP_LINE_SAVE(
	                                        #SYST_LNCD#,
	                                        #UPDT_USID#,
	                                        sSLIP_NUMB,
	                                        lpad(nSLIP_LINE , '4', '0'),
	                                        #ACCT_UNIT#,
	                                        #ACCT_GUBN#,
	                                        rFS_ASSTXM.DPCT_ACT1,
	                                        rFS_ASSTXM.DEPT_CODE,
	                                        '',
	                                        'D',
	                                        'KRW',
	                                        1,
	                                        rFS_ASSTXM.ACQU_PRIC,
	                                        rFS_ASSTXM.ACQU_PRIC,
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        sTITL_NAME,
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        lpad(nSLIP_LINE , '4', '0'),
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '');
	                                        
                    EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, 'LINE 추가 에러 차변'||chr(13)||chr(10)||SQLERRM);
 	                END;	                                        
	            
	          END IF;
	          
	          
	         
	          
	          
	        
	          
	        /*=============================================================
	            2-1-2. 자산등록 전표 > LINE 추가 > 미지급금고정자산(대변)
	        ===============================================================*/
	        IF rFS_ASSTXM.ACQU_PRIC > 0 THEN		        
	            nSLIP_LINE := nSLIP_LINE + 1;
	            
	                 BEGIN
	
	                 PKG_FAMIFSLIP.SP_LINE_SAVE(
	                                        #SYST_LNCD#,
	                                        #UPDT_USID#,
	                                        sSLIP_NUMB,
	                                        lpad(nSLIP_LINE , '4', '0'),
	                                        #ACCT_UNIT#,
	                                        #ACCT_GUBN#,	                                        
	                                        rFS_ASSTXM.PRIC_ACCT,
	                                        rFS_ASSTXM.DEPT_CODE,
	                                        '',
	                                        'C',
	                                        'KRW',
	                                        1,
	                                        rFS_ASSTXM.ACQU_PRIC + rFS_ASSTXM.VATX_AMNT,
	                                        rFS_ASSTXM.ACQU_PRIC + rFS_ASSTXM.VATX_AMNT,
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        sTITL_NAME,
	                                        '',  /*cic 임시 증빙종류인데 부가세 라인 생성시 필요함 */
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                       lpad(nSLIP_LINE , '4', '0'),
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '');
	                                        
	                                        
	                EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, 'LINE 추가 에러 대변 미지급금'||chr(13)||chr(10)||SQLERRM);
 	                END;
 	                
 	                 /*관리항목 저장*/
	          BEGIN 
	          
				    SELECT B.COND_CODE	                      
	                      ,DECODE( B.COND_CODE , '0002' ,rFS_ASSTXM.CUST_CODE, '') AS COND_VACD	                      
                   INTO 	sCOND_CODE , sCOND_VACD														
	                 FROM   TA_ACCTXM A,
	                        TA_ACCTXD B
	                WHERE B.ACCT_INTL = rFS_ASSTXM.PRIC_ACCT	
	                  AND A.ACCT_INTL = B.ACCT_INTL;
            
    						EXCEPTION 				
    						WHEN OTHERS THEN	 
								 sCOND_CODE := NULL;
								 sCOND_VACD := NULL;		
    						
    						END;
	
	          
					IF sCOND_VACD IS NOT NULL THEN
	            
	                BEGIN
	                
	                PKG_FAMIFSLIP.SP_LINERF_SAVE(
	                                        #SYST_LNCD#,
	                                        #UPDT_USID#,
	                                        sSLIP_NUMB,
	                                        lpad(nSLIP_LINE , '4', '0'),
						                    '0002',   /*관리항목코드 : 재무>기본정보>관리항목 참조*/
						                    rFS_ASSTXM.CUST_CODE,   /*항목값*/
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    ''
	                );
	                
	                 EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000,  rFS_ASSTXM.PRIC_ACCT ||' '|| sCOND_VACD||' '  || sCOND_CODE||'관리항목입력에러'||chr(13)||chr(10)||SQLERRM);
 	                END;	 
	
	              END IF;
	
	
	       END IF;
	       
	    /*=============================================================
            2-1-3. 자산등록 전표 > LINE 추가 > 부가가치세매입세액(차변)
        ===============================================================*/
	        IF rFS_ASSTXM.VATX_AMNT > 0 THEN
	            nSLIP_LINE := nSLIP_LINE + 1;
	            sTITL_NAME := rFS_ASSTXM.ASST_NAME || 'VAT';
	            
	              BEGIN
	              
	              PKG_FAMIFSLIP.SP_LINE_SAVE(
	                                        #SYST_LNCD#,
	                                        #UPDT_USID#,
	                                        sSLIP_NUMB,
	                                        lpad(nSLIP_LINE , '4', '0'),
	                                        #ACCT_UNIT#,
	                                        #ACCT_GUBN#,
	                                        rFS_ASSTXM.VATX_ACCT,
	                                        rFS_ASSTXM.DEPT_CODE,
	                                        '',
	                                        'D',
	                                        'KRW',
	                                        1,
	                                        rFS_ASSTXM.VATX_AMNT,
	                                        rFS_ASSTXM.VATX_AMNT,
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        sTITL_NAME,
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        lpad(nSLIP_LINE , '4', '0'),
	                                        '',
	                                        '',
	                                        '',
	                                        '',
	                                        '');
	                                        
	                                        
                    EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, 'LINE 추가 에러 VAT'||chr(13)||chr(10)||SQLERRM);
 	                END;	     
 	                
 	                BEGIN
 	                    SELECT B.COND_CODE	                      
	                      ,DECODE( B.COND_CODE , '0002' ,rFS_ASSTXM.CUST_CODE, '') AS COND_VACD	                      
                   INTO 	sCOND_CODE , sCOND_VACD														
	                 FROM   TA_ACCTXM A,
	                        TA_ACCTXD B
	                WHERE B.ACCT_INTL = rFS_ASSTXM.PRIC_ACCT	
	                  AND A.ACCT_INTL = B.ACCT_INTL;
            
    						EXCEPTION 				
    						WHEN OTHERS THEN	 
								 sCOND_CODE := NULL;
								 sCOND_VACD := NULL;		
    						
    						END;
	
	          
					IF sCOND_VACD IS NOT NULL THEN
	            
	                BEGIN
	                
	                PKG_FAMIFSLIP.SP_LINERF_SAVE(
	                                        #SYST_LNCD#,
	                                        #UPDT_USID#,
	                                        sSLIP_NUMB,
	                                         lpad(nSLIP_LINE , '4', '0'),
						                    '0002',   /*관리항목코드 : 재무>기본정보>관리항목 참조*/
						                    rFS_ASSTXM.CUST_CODE,   /*항목값*/
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    '',
						                    '', 
						                    ''
	                );
	                
	                 EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000,  rFS_ASSTXM.PRIC_ACCT ||' '|| sCOND_VACD||' '  || sCOND_CODE||'관리항목입력에러'||chr(13)||chr(10)||SQLERRM);
 	                END;	 
	
	              END IF;
	                                   
	
	       END IF;
	       
	       
		  
	       
	       /*=============================================================
		       2-1-5. FINISH 
		    ===============================================================*/
		  IF rFS_ASSTXM.ACQU_PRIC > 0 THEN
		     
				   BEGIN
				    
			         PKG_FAMIFSLIP.SP_FINISH(
					        #SYST_LNCD# /* ●시스템언어코드*/
					       ,#UPDT_USID#   /* ●수정작업자*/
						   ,sSLIP_NUMB   /* ●전표번호 */
					    );
					    
				   EXCEPTION
	               WHEN OTHERS THEN
	                   RAISE_APPLICATION_ERROR(-20000, 'FINISH 에러'||chr(13)||chr(10)||SQLERRM);
 	               END;
	       
	       END IF;
    
    
	        /*======================================================================================
	                STEP 3. 자산등록 전표번호 업데이트[
	                     	   전표 마지막행에 TB 업데이트
            ======================================================================================*/
	          
	          
	                UPDATE FS_ASSTXM                /*[자산등록내역]*/
	                   SET  SLIP_NUMB = sSLIP_NUMB  /*전표번호*/
	                       ,SLIP_LINE = lpad(nSLIP_LINE , '4', '0')  /*전표순번*/
	                       ,UPDT_DATE = SYSDATE  /*수정일시*/
	                       ,UPDT_USID = #UPDT_USID#  /*수정자*/
	                 WHERE ACCT_UNIT  = #ACCT_UNIT#  /*회계단위[ACCT_UNIT]*/
	                   AND ASST_NUMB  = #ASST_NUMB#  /*자산번호*/
	                   ;                        
	
	                UPDATE FS_ASCHXM                /*[자산변동이력]*/
	                   SET  SLIP_NUMB = sSLIP_NUMB  /*전표번호*/
	                       ,SLIP_LINE = lpad(nSLIP_LINE , '4', '0')  /*전표순번*/
	                       ,UPDT_DATE = SYSDATE  /*수정일시*/
	                       ,UPDT_USID = #UPDT_USID#  /*수정자*/
	                 WHERE ASST_NUMB  = #ASST_NUMB#  /*자산번호*/
	                   AND ASCH_GUBN  = 'ACQU'      /*변동구분(신규취득)*/
	                   ;
	                   
	                   
	          
	             
	        EXCEPTION
	             WHEN OTHERS THEN
	                RAISE;
	    END;
		]]>
	</insert>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 전표 처리 차변
********************************************************************************/
 -->
	<insert id="FSMB0010.PROC01" parameterClass="hashmap" >
		<![CDATA[
		DECLARE
	       /*FSMB0010.PROC01.자산등록 전표 처리 차변*/
			CURSOR CUR_FS_ASSTXM (
	             P_ACCT_UNIT  IN FS_ASSTXM.ACCT_UNIT%TYPE   /*회계단위*/
	            ,P_ASST_NUMB  IN FS_ASSTXM.ASST_NUMB%TYPE   /*자산번호*/
	        ) IS
	        
	             SELECT A.ASST_NUMB     /*자산번호*/
	                   ,A.ACQS_DATE     /*부가매입세액-공급일자*/
	                   ,A.CUST_CODE     /*구매처코드*/
	                   ,A.DEPT_CODE     /*부서코드*/
	                   ,DE.ACCT_GUBN    /* 사업장*/
	                   ,B.DPCT_ACT1     /*관리계정과목(기타의유형자산)*/
	                   /* 등록화면에 계정설정 필드가 없어서 고정설정, */
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3122022','3164002') AS VATX_ACCT      /*부가세예수금-매입세액*/
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3115115','3121002') AS PRIC_ACCT      /*미지급금-고정자산*/
	                   ,NVL(A.ACQU_PRIC, 0) AS ACQU_PRIC     /*취득금액, 부가매입세액-과표*/
	                   ,NVL(A.VATX_AMNT, 0) AS VATX_AMNT     /*부가세액*/
	                   ,A.ASST_NAME     /*자산명[대표적요]*/
	                   ,A.SLIP_NUMB     /*전표번호*/
	                   ,SUBSTR(B.DPCT_ACT1,1,4) AS SUBJ_CODE /* 부가매입세액-관련과목*/
	              FROM FS_ASSTXM A
	             INNER JOIN VI_ASSETCLASS B
	                ON A.CLSF_CODE = B.SMAL_CODE
	              LEFT JOIN VI_DEPTXM DE
	                ON DE.DEPT_CODE = A.DEPT_CODE
	             WHERE A.ACCT_UNIT = P_ACCT_UNIT           /*회계단위*/
	               AND A.ASST_NUMB = P_ASST_NUMB           /*자산번호*/
	        ;
	
	        rFS_ASSTXM      CUR_FS_ASSTXM%ROWTYPE;          /*[자산정보]*/
	
	        sSLIP_DATE      TA_SLIPXM.SLIP_DATE%TYPE;   /*발의일자*/
	        sEMPL_NUMB      TA_SLIPXM.EMPL_NUMB%TYPE;   /*입력자*/
	        sDEPT_CODE      TA_SLIPXM.DEPT_CODE%TYPE;   /*입력부서*/
	        sACCT_GUBN      TA_SLIPXM.ACCT_GUBN%TYPE;   /*사업장*/
	        sTITL_NAME      TA_SLIPXM.TITL_NAME%TYPE;   /*대표적요*/
	        nSLIP_LINE      TA_SLIPNT.SLIP_LINE%TYPE;   /*전표순번*/
	
	        nCURS_SEQN      TA_SLIPNT.SLIP_LINE%TYPE;   /*커서SEQ*/
	
	
	    BEGIN
	
        /*======================================================================================
            STEP 1. 자산등록 전표 생성 여부 체크
        ======================================================================================*/
	        BEGIN
	            /*[자산등록정보]*/
	            OPEN CUR_FS_ASSTXM( #ACCT_UNIT#     /*회계단위*/
	                               ,#ASST_NUMB#     /*자산번호*/
	                               );
	            FETCH CUR_FS_ASSTXM INTO rFS_ASSTXM;
	            CLOSE CUR_FS_ASSTXM;
	
	            EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, '자산등록 전표 생성 여부 체크 중 오류가 발생하였습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	
	        IF rFS_ASSTXM.SLIP_NUMB IS NOT NULL THEN
	            RAISE_APPLICATION_ERROR(-20000, '이미 생성 된 자산등록 전표(' || rFS_ASSTXM.SLIP_NUMB || ')가 존재 합니다.');
	        END IF;
	
        /*======================================================================================
            STEP 2. 자산등록 전표 생성
        ======================================================================================*/
	
	        /* 발의일자 :  자산등록일*/
	        sSLIP_DATE := #SLIP_DATE#;
	
	        /* 사용자 정보 조회*/
	        /*
	        BEGIN
	            SELECT U.EMPL_NUMB, U.DEPT_CODE, D.ACCT_GUBN
	              INTO   sEMPL_NUMB, sDEPT_CODE, sACCT_GUBN     
	              FROM   VI_USERINFO U
	              LEFT JOIN VI_DEPTXM D
	                ON  D.DEPT_CODE = U.DEPT_CODE
	             WHERE  USER_IDXX = UPDT_USID;
	
	            EXCEPTION
	                WHEN NO_DATA_FOUND THEN
	                    RAISE_APPLICATION_ERROR(-20000, '입력자에 대한 정보를 찾을 수 없습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	        */
	
	        /* 대표적요 구성 */
	        sTITL_NAME := '[자산등록] ' || rFS_ASSTXM.ASST_NAME;
	
	
	        /* PARAM -----------------------------------------------------
	            2-0.자산등록 전표 > HEADER 추가
	        --------------------------------------------------------------
	        SP_SLIP_INSERT_M(
	             iUPDT_DATE   --등록일시
	            ,iUPDT_USID   --등록자
	            ,iSLIP_NUMB   --전표번호
	            ,sSLIP_DATE   --전표일자
	            ,sACCT_GUBN   --사업장
	            ,''           --품의번호
	            ,'FA160030'   -- 전표구분 : 일반전표(FA160010), 연동전표(FA160030)
	            ,''           -- 전표처리구분 : 농심에선 사용하지 않음
	            ,iACCT_UNIT   -- 회계단위
	            ,sTITL_NAME   --제목
	            ,sEMPL_NUMB   --발행자
	            ,sDEPT_CODE   --발행부서
	            ,'U'          --전표발생테이블타입(삭제시 해당 테이블 적용 이벤트 해당테이블에 전표에 해당하는 데이터를 삭제시:D,전표번호만 있을때:U, 전표순번이 있을때 : S)
	            ,'FS_ASSTXM'  --전표발생테이블명(발생된 테이블 명
	            ,'1'          --자동전표여부 1: 자동전표
	        );
	        */
	
	        /*--------------------------------------------------------------
	            2-1.자산등록 전표 > LINE 추가[차>대>차변 순서대로 SLIP_LINE저장요망]
	        --------------------------------------------------------------*/
	        /*nSLIP_LINE := 0; */
	
	        /*--------------------------------------------------------------
	            2-1-1. 자산등록 전표 > LINE 추가 > 관리계정과목(차변)
	        --------------------------------------------------------------*/
	        IF rFS_ASSTXM.ACQU_PRIC > 0 THEN
	            nSLIP_LINE := #SLIP_LINE#;        /*JAVA 에서 받아옴 nSLIP_LINE + 1;*/
	
	            SP_SLIP_INSERT_D(
	                 SYSDATE   /*등록일시*/
	                ,#UPDT_USID#   /*등록자*/
	                ,#SLIP_NUMB#               /* 전표번호*/
	                ,LPad(nSLIP_LINE,4,'0')   /* 전표순번*/
	                ,rFS_ASSTXM.ACCT_GUBN     /* 사업장*/
	                ,''   /* 브랜드 : 농심 사용안함 */
	                ,''   /*예산구분*/
	                ,''   /*프로젝트코드*/
	                ,''   /*예산품의번호*/
	                ,''   /*상대전표일자*/
	                ,''   /*상대전표번호*/
	                ,''   /*상대전표순번*/
	                ,rFS_ASSTXM.DPCT_ACT1                                       /*계정코드       >> 관리계정과목  */
	                /*,CASE WHEN rFS_ASSTXM.DEPO_AMOT > 0 THEN 'D' ELSE 'C' END   차대구분      >> 입금:차변 D, 출금:대변 C */
	                ,'D'
	                ,'KRW'   /*통화구분*/
	                ,0   /*환율*/
	                ,rFS_ASSTXM.ACQU_PRIC  /*취득금액*/
	                ,0   /*외화금액*/
	                ,rFS_ASSTXM.DEPT_CODE   /*사용부서*/
	                ,''   /*예산부서 : 농심 사용안함*/
	                ,rFS_ASSTXM.ASST_NAME   /*적요1*/
	                ,'FA180090'   /*증빙종류 : 해당사항 없음
	                ,''   /*매입매출구분*/
	                ,''   /*부가세종류*/
	                ,''   /*매입구분*/
	                ,''   /*불공제구분*/
	                ,''   /*전자발행여부*/
	                ,''   /*발행일자*/
	                ,''   /*공급가액*/
	                ,''   /*세액*/
	                ,''   /*품목*/
	                ,''   /*적요*/
	                ,rFS_ASSTXM.CUST_CODE   /*구매처*/
	                ,''   /*출납처리여부*/
	                ,''   /*지출일자*/
	                ,''   /*출납방법*/
	                ,''   /*입출구분*/
	                ,''   /*카드번호*/
	                ,''   /*카드승인번호*/
	                ,''   /*사업자번호*/
	            );
	
	            /* PARAM 
	            --관리항목 저장//기타의무형,유형, 차량운반구 필수값 없음. SP_SLIP_INSERT_S 호출 안함
	            FOR CUR IN (
	                SELECT B.COND_CODE
	                      -- 관리항목 확정후 다시 정리 필요
	                      ,CASE WHEN B.COND_CODE = '0002' THEN rFS_ASSTXM.CUST_CODE --거래처
	                            ELSE '' END AS COND_VACD
	                      ,CASE WHEN B.COND_CODE = '0002' THEN SF_GET_CUSTNAME(rFS_ASSTXM.CUST_CODE) --거래처
	                            ELSE '' END AS COND_VANM
	                FROM   TA_ACCTXM A
	                    JOIN TA_ACCTXD B
	                        ON  A.ACCT_YEAR = B.ACCT_YEAR
	                        AND A.ACCT_INTL = B.ACCT_INTL
	                WHERE B.ACCT_INTL = rFS_ASSTXM.DPCT_ACT1
	                AND   A.ACCT_YEAR = SubStr(iSLIP_NUMB,3,4)
	
	          ) LOOP
	
	              SP_SLIP_INSERT_S(
	                   iUPDT_DATE   --수정일시
	                  ,iUPDT_USID   --수정자
	                  ,iSLIP_NUMB   --전표번호
	                  ,LPad(nSLIP_LINE,4,'0')   --전표순번
	                  ,CUR.COND_CODE   --관리항목코드 : 재무>기본정보>관리항목 참조
	                  ,CUR.COND_VACD   --항목값
	                  ,CUR.COND_VANM   --항목명
	              );
	
	          END LOOP;
	          */
	          /* 전표 라인별 정합성 체크 */
	          SP_SLIP_INSERT_CHECK(iSLIP_NUMB,LPad(nSLIP_LINE,4,'0'));
	
	
	        END IF;
	
	
	        EXCEPTION
	             WHEN OTHERS THEN
	                RAISE;
	    END;
		]]>
	</insert>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 전표 처리 대변
********************************************************************************/
 -->
	<insert id="FSMB0010.PROC02" parameterClass="hashmap" >
		<![CDATA[
		DECLARE
			/*FSMB0010.PROC02.자산등록 전표 처리 대변*/
			CURSOR CUR_FS_ASSTXM (
	             P_ACCT_UNIT  IN FS_ASSTXM.ACCT_UNIT%TYPE   /*회계단위*/
	            ,P_ASST_NUMB  IN FS_ASSTXM.ASST_NUMB%TYPE   /*자산번호*/
	        ) IS
	            SELECT  A.ASST_NUMB     /*자산번호*/
	                   ,A.ACQS_DATE     /*부가매입세액-공급일자*/
	                   ,A.CUST_CODE     /*구매처코드*/
	                   ,A.DEPT_CODE     /*부서코드*/
	                   ,DE.ACCT_GUBN    /* 사업장*/
	                   ,B.DPCT_ACT1     /*관리계정과목(기타의유형자산)*/
	                   /* 등록화면에 계정설정 필드가 없어서 고정설정,*/
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3122022','3164002') AS VATX_ACCT      /*부가세예수금-매입세액*/
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3115115','3121002') AS PRIC_ACCT      /*미지급금-고정자산*/
	                   ,NVL(A.ACQU_PRIC, 0) AS ACQU_PRIC     /*취득금액, 부가매입세액-과표*/
	                   ,NVL(A.VATX_AMNT, 0) AS VATX_AMNT     /*부가세액*/
	                   ,A.ASST_NAME     /*자산명[대표적요]*/
	                   ,A.SLIP_NUMB     /*전표번호*/
	                   ,SUBSTR(B.DPCT_ACT1,1,4) AS SUBJ_CODE /* 부가매입세액-관련과목*/
	              FROM FS_ASSTXM A
	                   INNER JOIN VI_ASSETCLASS B
	                      ON A.CLSF_CODE = B.SMAL_CODE
	                    LEFT JOIN VI_DEPTXM DE
	                      ON  DE.DEPT_CODE = A.DEPT_CODE
	             WHERE A.ACCT_UNIT = P_ACCT_UNIT           /*회계단위*/
	               AND A.ASST_NUMB = P_ASST_NUMB           /*자산번호*/
	        ;
	
	        rFS_ASSTXM      CUR_FS_ASSTXM%ROWTYPE;          /*[자산정보]*/
	        nSLIP_LINE      TA_SLIPNT.SLIP_LINE%TYPE;       /*전표순번*/
	
	    BEGIN
	
        /*======================================================================================
            STEP 1. 자산등록 전표 생성 여부 체크
        ======================================================================================*/
	        BEGIN
	            /*[자산등록정보]*/
	            OPEN CUR_FS_ASSTXM( #ACCT_UNIT#     /*회계단위*/
	                               ,#ASST_NUMB#     /*자산번호*/
	                               );         
	            FETCH CUR_FS_ASSTXM INTO rFS_ASSTXM;
	            CLOSE CUR_FS_ASSTXM;
	
	            EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, '자산등록 정보 조회 중 오류가 발생하였습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	
	        IF rFS_ASSTXM.SLIP_NUMB IS NOT NULL THEN
	            RAISE_APPLICATION_ERROR(-20000, '이미 생성 된 자산등록 전표(' || rFS_ASSTXM.SLIP_NUMB || ')가 존재 합니다.');
	        END IF;
	
	
	        /*=============================================================
	            2-1-2. 자산등록 전표 > LINE 추가 > 미지급금고정자산(대변)
	        ===============================================================*/
	        IF rFS_ASSTXM.ACQU_PRIC > 0 THEN
	
	            nSLIP_LINE := #SLIP_LINE#;        /*JAVA 에서 받아옴 nSLIP_LINE + 1;*/
	
	            SP_SLIP_INSERT_D(
	                 SYSDATE   /*등록일시*/
	                ,#UPDT_USID#   /*등록자*/
	                ,#SLIP_NUMB#               /* 전표번호*/
	                ,LPad(nSLIP_LINE,4,'0')   /* 전표순번*/
	                ,rFS_ASSTXM.ACCT_GUBN     /* 사업장*/
	                ,''   /* 브랜드 : 농심 사용안함*/
	                ,''   /*예산구분*/
	                ,''   /*프로젝트코드*/
	                ,''   /*예산품의번호*/
	                ,''   /*상대전표일자*/
	                ,''   /*상대전표번호*/
	                ,''   /*상대전표순번*/
	                ,rFS_ASSTXM.PRIC_ACCT                                       /*계정코드      >> 미지급금 고정자산*/
	                ,'C'   /*차대구분      >> 대변*/
	                ,'KRW'   /*통화구분*/
	                ,0   /*환율*/
	                ,rFS_ASSTXM.ACQU_PRIC + rFS_ASSTXM.VATX_AMNT                /*미지급금=취득금액+부가세액*/
	                ,0   /*외화금액*/
	                ,rFS_ASSTXM.DEPT_CODE   /*사용부서*/
	                ,''   /*예산부서 : 농심 사용안함*/
	                ,rFS_ASSTXM.ASST_NAME   /*적요1*/
	                ,'FA180090'   /*증빙종류 : 해당사항 없음*/
	                ,''   /*매입매출구분*/
	                ,''   /*부가세종류*/
	                ,''   /*매입구분*/
	                ,''   /*불공제구분*/
	                ,''   /*전자발행여부*/
	                ,''   /*발행일자*/
	                ,''   /*공급가액*/
	                ,''   /*세액*/
	                ,''   /*품목*/
	                ,''   /*적요*/
	                ,rFS_ASSTXM.CUST_CODE   /*거래처*/
	                ,''   /*출납처리여부*/
	                ,''   /*지출일자*/
	                ,''   /*출납방법*/
	                ,''   /*입출구분*/
	                ,''   /*카드번호*/
	                ,''   /*카드승인번호*/
	                ,''   /*사업자번호*/
	            );
	
	
	            /*관리항목 저장*/
	            FOR CUR IN (
	                SELECT B.COND_CODE
	                      /* 관리항목 확정후 다시 정리 필요*/
	                      ,CASE WHEN B.COND_CODE = '0002' THEN rFS_ASSTXM.CUST_CODE /*거래처*/
	                            ELSE '' END AS COND_VACD
	                      ,CASE WHEN B.COND_CODE = '0002' THEN SF_GET_CUSTNAME(rFS_ASSTXM.CUST_CODE) /*거래처*/
	                            ELSE '' END AS COND_VANM
	                 FROM   TA_ACCTXM A
	                 JOIN TA_ACCTXD B
	                   ON  A.ACCT_YEAR = B.ACCT_YEAR
	                  AND A.ACCT_INTL = B.ACCT_INTL
	                WHERE B.ACCT_INTL = rFS_ASSTXM.PRIC_ACCT
	                  AND A.ACCT_YEAR = SubStr(#SLIP_NUMB#,3,4)
	
	            ) LOOP
	
	                SP_SLIP_INSERT_S(
	                     SYSDATE   /*수정일시*/
	                    ,#UPDT_USID#   /*수정자*/
	                    ,#SLIP_NUMB#   /*전표번호*/
	                    ,LPad(nSLIP_LINE,4,'0')   /*전표순번*/
	                    ,CUR.COND_CODE   /*관리항목코드 : 재무>기본정보>관리항목 참조*/
	                    ,CUR.COND_VACD   /*항목값*/
	                    ,CUR.COND_VANM   /*항목명*/
	                );
	
	            END LOOP;
	
	
	            /* 전표 라인별 정합성 체크*/
	            SP_SLIP_INSERT_CHECK(#SLIP_NUMB#,LPad(nSLIP_LINE,4,'0'));
	
            /*======================================================================================
	                STEP 3. 자산등록 전표번호 업데이트[
	                     	   전표 마지막행에 TB 업데이트
            ======================================================================================*/
	          /* IF (#MAX_COUNT# = 'LAST') THEN*/
	               /*RAISE_APPLICATION_ERROR(-20000, 'LAST UPDATE ' || #MAX_COUNT#);*/
	                UPDATE FS_ASSTXM                /*[자산등록내역]*/
	                   SET  SLIP_NUMB = #SLIP_NUMB#  /*전표번호*/
	                       ,SLIP_LINE = #SLIP_LINE#  /*전표순번*/
	                       ,UPDT_DATE = SYSDATE  /*수정일시*/
	                       ,UPDT_USID = #UPDT_USID#  /*수정자*/
	                 WHERE ACCT_UNIT  = #ACCT_UNIT#  /*회계단위[ACCT_UNIT]*/
	                   AND ASST_NUMB  = #ASST_NUMB#  /*자산번호*/
	                   ;                        
	
	                UPDATE FS_ASCHXM                /*[자산변동이력]*/
	                   SET  SLIP_NUMB = #SLIP_NUMB#  /*전표번호*/
	                       ,SLIP_LINE = #SLIP_LINE#  /*전표순번*/
	                       ,UPDT_DATE = SYSDATE  /*수정일시*/
	                       ,UPDT_USID = #UPDT_USID#  /*수정자*/
	                 WHERE ASST_NUMB  = #ASST_NUMB#  /*자산번호*/
	                   AND ASCH_GUBN  = 'ACQU'      /*변동구분(신규취득)*/
	                   ;
	          /* END IF;*/
	
	        END IF;
	
	
		        EXCEPTION
		             WHEN OTHERS THEN
		                RAISE;
	    END;
		]]>
	</insert>
<!-- 
/*******************************************************************************
     작  성  자 : 황치웅
     작  성  일 : 2016. 07. 26
     내      용 : 자산등록 전표 처리 차변[부가가치세 매입세액]
********************************************************************************/
 -->	
	<insert id="FSMB0010.PROC03" parameterClass="hashmap" >
		<![CDATA[
		DECLARE
		      /*FSMB0010.PROC03.자산등록 전표 처리 차변[부가가치세 매입세액]*/
			CURSOR CUR_FS_ASSTXM (
	             P_ACCT_UNIT  IN FS_ASSTXM.ACCT_UNIT%TYPE   /*회계단위*/
	            ,P_ASST_NUMB  IN FS_ASSTXM.ASST_NUMB%TYPE   /*자산번호*/
	        ) IS
	            SELECT  A.ASST_NUMB     /*자산번호*/
	                   ,A.ACQS_DATE     /*부가매입세액-공급일자*/
	                   ,A.CUST_CODE     /*구매처코드*/
	                   ,A.DEPT_CODE     /*부서코드*/
	                   ,DE.ACCT_GUBN    /* 사업장*/
	                   ,B.DPCT_ACT1     /*관리계정과목(기타의유형자산)*/
	                   /* 등록화면에 계정설정 필드가 없어서 고정설정,*/
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3122022','3164002') AS VATX_ACCT      /*부가세예수금-매입세액*/
	                   ,DECODE(SUBSTR(#SLIP_DATE#,1,4),'2014','3115115','3121002') AS PRIC_ACCT      /*미지급금-고정자산*/
	                   ,NVL(A.ACQU_PRIC, 0) AS ACQU_PRIC     /*취득금액, 부가매입세액-과표*/
	                   ,NVL(A.VATX_AMNT, 0) AS VATX_AMNT     /*부가세액*/
	                   ,A.ASST_NAME     /*자산명[대표적요]*/
	                   ,A.SLIP_NUMB     /*전표번호*/
	                   ,SUBSTR(B.DPCT_ACT1,1,4) AS SUBJ_CODE /* 부가매입세액-관련과목*/
	                   ,B.ASCL_CODE     /*자산분류코드*/
	              FROM FS_ASSTXM A
	                  INNER JOIN VI_ASSETCLASS B
	                     ON A.CLSF_CODE = B.SMAL_CODE
	                   LEFT JOIN VI_DEPTXM DE
	                     ON  DE.DEPT_CODE = A.DEPT_CODE
	             WHERE A.ACCT_UNIT = P_ACCT_UNIT           /*회계단위*/
	               AND A.ASST_NUMB = P_ASST_NUMB           /*자산번호*/
	        ;
	
	        rFS_ASSTXM      CUR_FS_ASSTXM%ROWTYPE;          /*[자산정보]*/
	        nSLIP_LINE      TA_SLIPNT.SLIP_LINE%TYPE;       /*전표순번*/
	
	    BEGIN
	
        /*======================================================================================
            STEP 1. 자산등록 전표 생성 여부 체크
        ======================================================================================*/
	        BEGIN
	            /*[자산등록정보]*/
	            OPEN CUR_FS_ASSTXM( #ACCT_UNIT#     /*회계단위*/
	                               ,#ASST_NUMB#     /*자산번호*/
	                               );         
	            FETCH CUR_FS_ASSTXM INTO rFS_ASSTXM;
	            CLOSE CUR_FS_ASSTXM;
	
	            EXCEPTION
	                WHEN OTHERS THEN
	                    RAISE_APPLICATION_ERROR(-20000, '자산등록 정보 조회 중 오류가 발생하였습니다.'||chr(13)||chr(10)||SQLERRM);
	        END;
	
	        IF rFS_ASSTXM.SLIP_NUMB IS NOT NULL THEN
	            RAISE_APPLICATION_ERROR(-20000, '이미 생성 된 자산등록 전표(' || rFS_ASSTXM.SLIP_NUMB || ')가 존재 합니다.');
	        END IF;
	
        /*=============================================================
            2-1-3. 자산등록 전표 > LINE 추가 > 부가가치세매입세액(차변)
        ===============================================================*/
	        IF rFS_ASSTXM.VATX_AMNT > 0 THEN
	
	            nSLIP_LINE := #SLIP_LINE#;        /*JAVA 에서 받아옴 nSLIP_LINE + 1;*/
	
	            SP_SLIP_INSERT_D(
	                 SYSDATE   /*등록일시*/
	                ,#UPDT_USID#   /*등록자*/
	                ,#SLIP_NUMB#               /* 전표번호*/
	                ,LPad(nSLIP_LINE,4,'0')   /* 전표순번*/
	                ,rFS_ASSTXM.ACCT_GUBN     /* 사업장*/
	                ,''   /* 브랜드 : 농심 사용안함*/
	                ,''   /*예산구분*/
	                ,''   /*프로젝트코드*/
	                ,''   /*예산품의번호*/
	                ,''   /*상대전표일자*/
	                ,''   /*상대전표번호*/
	                ,''   /*상대전표순번*/
	                ,rFS_ASSTXM.VATX_ACCT                                       /*부가가치세매입세액*/
	                ,'D'   /*차대구분      >> 차변*/
	                ,'KRW'   /*통화구분*/
	                ,0   /*환율*/
	                ,rFS_ASSTXM.VATX_AMNT                                       /*부가세액*/
	                ,0   /*외화금액*/
	                ,rFS_ASSTXM.DEPT_CODE   /*사용부서*/
	                ,''   /*예산부서 : 농심 사용안함*/
	                ,rFS_ASSTXM.ASST_NAME   /*적요1*/
	                ,'FA180010'   /*증빙종류 : 세금계산서  ====== 부가세 추가 입력 필드 시작====== */
	                ,'FA200010'   /*매입매출구분 : 매입*/
	                ,'FA210010'   /*부가세종류   : 과세*/
	                /*20150723 김남호 : 자산등록전표처리시 자산분류에따라 부가세유형이 자동으로 지정 적용*/
	                /*,'FA220010'   /*매입구분     : 일반매입*/
	                ,CASE WHEN rFS_ASSTXM.ASCL_CODE = '20' THEN 'FA220021'  /*건물->건물,구축물*/
	                      WHEN rFS_ASSTXM.ASCL_CODE = '30' THEN 'FA220021'  /*구축물->건물,구축물*/
	                      WHEN rFS_ASSTXM.ASCL_CODE = '40' THEN 'FA220023'  /*차량운반구->차량운반구*/
	                      WHEN rFS_ASSTXM.ASCL_CODE = '50' THEN 'FA220022'  /*기계장치->기계장치*/
	                      WHEN rFS_ASSTXM.ASCL_CODE = '60' THEN 'FA220022'  /*공기구->기계장치*/
	                      WHEN rFS_ASSTXM.ASCL_CODE = '70' THEN 'FA220020'  /*기타유형자산->그밖의감가상각자산*/
	                      ELSE 'FA220020'                                   /*토지, 무형자산 등은 그밖의감가상각자산으로 처리 (20160205 김남호)*/
	                END   /*매입구분*/
	                ,''   /*불공제구분*/
	                ,'0'   /*전자발행여부         :미발행*/
	                ,rFS_ASSTXM.ACQS_DATE   /*발행일자*/
	                ,rFS_ASSTXM.ACQU_PRIC   /*공급가액*/
	                ,rFS_ASSTXM.VATX_AMNT   /*세액*/
	                ,rFS_ASSTXM.ASST_NAME   /*품목*/
	                ,rFS_ASSTXM.ASST_NAME   /*적요                          ====== 부가세 추가 입력 필드 끝 ======*/
	                ,rFS_ASSTXM.CUST_CODE   /*거래처*/
	                ,''   /*출납처리여부*/
	                ,''   /*지출일자*/
	                ,''   /*출납방법*/
	                ,''   /*입출구분*/
	                ,''   /*카드번호*/
	                ,''   /*카드승인번호*/
	                ,''   /*사업자번호*/
	            );
	
	
	            /*관리항목 저장(조회시 5개. 필수입력은 4개. 1개는 NULL 저장_0011:사업자(주민)번호)*/
	            FOR CUR IN (
	                SELECT B.COND_CODE
	                      ,CASE WHEN B.COND_CODE = '0002' THEN rFS_ASSTXM.CUST_CODE          /*거래처*/
	                            WHEN B.COND_CODE = '0049' THEN TO_CHAR(rFS_ASSTXM.ACQU_PRIC) /*과세표준*/
	                            WHEN B.COND_CODE = '0045' THEN rFS_ASSTXM.ACQS_DATE          /*공급일자*/
	                            WHEN B.COND_CODE = '0065' THEN rFS_ASSTXM.DPCT_ACT1          /*발생계정과목*/
	                            WHEN B.COND_CODE = '0056' THEN rFS_ASSTXM.SUBJ_CODE          /*관련과목*/
	                            ELSE '' END AS COND_VACD
	                      ,CASE WHEN B.COND_CODE = '0002' THEN SF_GET_CUSTNAME(rFS_ASSTXM.CUST_CODE) /*거래처*/
	                            WHEN B.COND_CODE = '0049' THEN TO_CHAR(rFS_ASSTXM.ACQU_PRIC)         /*과세표준*/
	                            WHEN B.COND_CODE = '0045' THEN rFS_ASSTXM.ACQS_DATE                  /*공급일자*/
	                            WHEN B.COND_CODE = '0065' THEN rFS_ASSTXM.DPCT_ACT1                  /*발생계정과목*/
	                            WHEN B.COND_CODE = '0056' THEN rFS_ASSTXM.SUBJ_CODE                  /*관련과목*/
	                            ELSE '' END AS COND_VANM
	                 FROM TA_ACCTXM A
	                 JOIN TA_ACCTXD B
	                   ON A.ACCT_YEAR = B.ACCT_YEAR
	                  AND A.ACCT_INTL = B.ACCT_INTL
	                WHERE B.ACCT_INTL = rFS_ASSTXM.VATX_ACCT
	                  AND A.ACCT_YEAR = SubStr(#SLIP_NUMB#,3,4)
	
	            ) LOOP
	
	                SP_SLIP_INSERT_S(
	                     SYSDATE   /*수정일시*/
	                    ,#UPDT_USID#   /*수정자*/
	                    ,#SLIP_NUMB#   /*전표번호*/
	                    ,LPad(nSLIP_LINE,4,'0')   /*전표순번*/
	                    ,CUR.COND_CODE   /*관리항목코드 : 재무>기본정보>관리항목 참조*/
	                    ,CUR.COND_VACD   /*항목값*/
	                    ,CUR.COND_VANM   /*항목명*/
	                );
	
	            END LOOP;
	
	
	            /* 전표 라인별 정합성 체크*/
	            SP_SLIP_INSERT_CHECK(#SLIP_NUMB#,LPad(nSLIP_LINE,4,'0'));
	
	        END IF;
	
	
		        EXCEPTION
		             WHEN OTHERS THEN
		                RAISE;
	    END;
		
		]]>
	</insert>
</sqlMap>
