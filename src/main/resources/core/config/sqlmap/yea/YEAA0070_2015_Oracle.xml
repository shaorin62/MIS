<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
		"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="YEAA0070_2015">
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH00" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT /* YEAA0070_2015.SEARCH00.연말정산처리 조회 */
                  '0'                         AS YEA_CHK
                 , #YEA_STD_YY#               AS YEA_STD_YY    	 /*YEA_기준년도*/
                 , A.YEA_EMP_NO           						 /*YEA_사원번호*/
                 , A.YEA_EMP_NM            						 /*YEA_사원명*/
                 , A.YEA_EMP_CD            		 				 /*YEA_직원구분코드*/
                 , A.YEA_DEPT_CD        		  				 /*YEA_부서코드*/
                 , A.YEA_INOFFICE_YN    	 				     /*YEA_재직여부*/
                 , A.YEA_INOFFICE_CD    					     /*YEA_재직구분코드*/
                 , A.YEA_POST_CD        	  					 /*YEA_직위코드*/
                 , A.YEA_RANK_CD          		  				 /*YEA_직급코드*/
                 , B.YEA_DEPT_NM        	 				     /*YEA_부서명*/
                 , B.YEA_SECTOR_NM        						 /*YEA_소속명*/
                 , B.YEA_DEPT_FULL_NM      		 				 /*YEA_부서전체명*/
                 , B.YEA_BRANCH_CD         		 				 /*YEA_사업장코드*/
                 , DECODE(C.YEA_COMD_NM,NULL,SF_GET_COMMNAME('OPOS_CODE', A.YEA_POST_CD),C.YEA_COMD_NM)       AS YEA_POST_NM  	 /*YEA_직위명*/
                 , DECODE(D.YEA_COMD_NM,NULL,SF_GET_COMMNAME('CPOS_CODE', A.YEA_RANK_CD),D.YEA_COMD_NM)       AS YEA_RANK_NM 	 /*YEA_직급명*/
                 , DECODE(E.YEA_COMD_NM,NULL,SF_GET_COMMNAME('WODN_CODE', A.YEA_INOFFICE_CD),E.YEA_COMD_NM)   AS YEA_INOFFICE_NM /*YEA_재직구분명*/ 
                 , NVL(F.YEA_PRC_STR001, '0') AS YEA_PRC_STR001  /*확정여부*/
                 , #YEA_PRC_STR002#           AS YEA_PRC_STR002  /*정산구분*/
                 , NVL(G.YEA_INC_STR025, '0') AS YEA_INC_STR025  /*입력마감여부*/
              FROM TABLE(SF_YEA_MASTXD(#YEA_STD_YY# || '1231')) A
         LEFT JOIN VI_YEA_DEPTXM B
                ON A.YEA_DEPT_CD = B.YEA_DEPT_CD
         LEFT JOIN VI_YEA_CODEXD C
                ON C.YEA_COMM_CD = 'YEA_90026'  /*직위*/
               AND A.YEA_POST_CD = C.YEA_COMD_CD
         LEFT JOIN VI_YEA_CODEXD D
                ON D.YEA_COMM_CD = 'YEA_90025'  /*직급*/
               AND A.YEA_RANK_CD = D.YEA_COMD_CD
         LEFT JOIN VI_YEA_CODEXD E
                ON D.YEA_COMM_CD = 'YEA_90006'  /*재직구분*/
               AND A.YEA_INOFFICE_CD = E.YEA_COMD_CD
         LEFT JOIN YEA_YEPROC F
                ON A.YEA_EMP_NO = F.YEA_EMP_NO
               AND F.YEA_STD_YY = #YEA_STD_YY#
         LEFT JOIN YEA_INCDEC G
                ON A.YEA_EMP_NO = G.YEA_EMP_NO
               AND G.YEA_STD_YY = #YEA_STD_YY#
         LEFT JOIN VI_YEA_DEPTXM Z
                ON #YEA_DEPT_CD# = Z.YEA_DEPT_CD
             WHERE (A.YEA_HIRE_YMD <= #YEA_STD_YY# || '1231' AND NVL(A.YEA_QUIT_YMD, '29991231') >= SUBSTR(#YEA_STD_YY#, 1, 4) || '0101')
	]]>
	<isNotEmpty prepend="AND" property="YEA_DEPT_CD">	
	<![CDATA[		 
                   B.YEA_DEPT_FULL_CD LIKE Z.YEA_DEPT_FULL_CD || '%'
	]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="YEA_EMP_NO">		
	<![CDATA[	 
                   A.YEA_EMP_NO = #YEA_EMP_NO#
	]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="YEA_EMP_CD">	
	<![CDATA[		 	        
                   A.YEA_EMP_CD = #YEA_EMP_CD#
	]]>
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="YEA_INOFFICE_CD">	
	<![CDATA[		 
                   (
                      (#YEA_INOFFICE_CD# = '1' AND A.YEA_HIRE_YMD <= #YEA_STD_YY# || '1231' AND NVL(A.YEA_QUIT_YMD, '29991231') >= #YEA_STD_YY# || '121231')
                   OR (#YEA_INOFFICE_CD# = '2' AND NVL(A.YEA_QUIT_YMD, '29991231') <= #YEA_STD_YY# || '1231')
                   )
	]]>
	</isNotEmpty>
	<isEqual property="YEA_INOFFICE_CD" compareValue="2">
	<isNotEmpty prepend="AND" property="YEA_BGIN_DATE">
		<![CDATA[
			A.YEA_QUIT_YMD >= #YEA_BGIN_DATE# /* 퇴사일 */
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="YEA_ENDX_DATE">
		<![CDATA[
			A.YEA_QUIT_YMD <= #YEA_ENDX_DATE# /* 퇴사일 */
		]]>
		</isNotEmpty>
	</isEqual>	
	<![CDATA[
          ORDER BY A.YEA_INOFFICE_CD, B.YEA_DEPT_FULL_CD, C.YEA_SORT_ORD, D.YEA_SORT_ORD, A.YEA_PROMOTE_YMD, A.YEA_HIRE_YMD
    ]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 가족사항 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH01" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH01.연말정산처리 가족사항 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_FAMI_SEQ     /*가족순번*/
                 , A.YEA_FAM_STR001   /*가족관계신고코드*/
                 , A.YEA_FAM_STR002   /*내외국인구분*/
                 , A.YEA_FAM_STR003   /*성명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004) AS YEA_FAM_STR004   /*주민등록번호*/
                 , A.YEA_FAM_STR005   /*기본공제여부*/
                 , A.YEA_FAM_STR006   /*경로자여부*/
                 , A.YEA_FAM_STR007   /*부녀자여부*/
                 , A.YEA_FAM_STR008   /*한부모여부*/
                 , A.YEA_FAM_STR009   /*장애자여부*/
                 , A.YEA_FAM_STR010   /*교육비구분코드*/
                 , A.YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                 , A.YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                 , A.YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                 , A.YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                 , A.YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                 , A.YEA_FAM_NUM004   /*보험료_보장성_기타*/
                 , A.YEA_FAM_NUM005   /*의료비_국세청*/
                 , A.YEA_FAM_NUM006   /*의료비_기타*/
                 , A.YEA_FAM_NUM007   /*교육비_국세청*/
                 , A.YEA_FAM_NUM008   /*교육비_기타*/
                 , A.YEA_FAM_NUM009   /*신용카드_국세청*/
                 , A.YEA_FAM_NUM010   /*신용카드_기타*/
                 , A.YEA_FAM_NUM011   /*직불카드_국세청*/
                 , A.YEA_FAM_NUM012   /*직불카드_기타*/
                 , A.YEA_FAM_NUM013   /*현금영수증_국세청*/
                 , A.YEA_FAM_NUM014   /*전통시장_국세청*/
                 , A.YEA_FAM_NUM015   /*전통시장_기타*/
                 , A.YEA_FAM_NUM016   /*대중교통_국세청*/
                 , A.YEA_FAM_NUM017   /*대중교통_기타*/
                 , A.YEA_FAM_NUM018   /*기부금_국세청*/
                 , A.YEA_FAM_NUM019   /*기부금_기타*/
                 , A.YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                 , A.YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                 , A.YEA_FAM_NUM022	  /*[2015귀속]난임시술비_국세청*/
                 , A.YEA_FAM_NUM023	  /*[2015귀속]난임시술비_기타*/                 
                 , '/images/yea/dataN.gif' AS NTS
                 , '/images/yea/dataE.gif' AS ETC
              FROM YEA_YEFAMI A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_FAMI_SEQ
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 근로소득지급명세 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH02" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH02.연말정산처리 근로소득지급명세 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_PAY_YYMM     /*지급년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_PAY_STR001   /*국외근로지급연월*/
                 , A.YEA_PAY_STR002   /*비과세내용*/
                 , A.YEA_PAY_NUM001   /*급여액*/
                 , A.YEA_PAY_NUM002   /*기타소득*/
                 , A.YEA_PAY_NUM003   /*상여금액*/
                 , A.YEA_PAY_NUM004   /*인정상여*/
                 , A.YEA_PAY_NUM005   /*주식매수선택권행사이익*/
                 , A.YEA_PAY_NUM006   /*우리사주조합인출금*/
                 , A.YEA_PAY_NUM007   /*임원 퇴직소득금액 한도초과액*/
                 , A.YEA_PAY_NUM008   /*국외근로외화금액*/
                 , A.YEA_PAY_NUM009   /*국외근로원화금액*/
                 , A.YEA_PAY_NUM010   /*야간근로비과세*/
                 , A.YEA_PAY_NUM011   /*출산보육비과세*/
                 , A.YEA_PAY_NUM012   /*연구활동비과세*/
                 , A.YEA_PAY_NUM013   /*비과세액*/
                 , A.YEA_PAY_NUM014   /*감면세액*/
                 , A.YEA_PAY_NUM015   /*소득세*/
                 , A.YEA_PAY_NUM016   /*주민세*/
                 , A.YEA_PAY_NUM017   /*농특세*/
                 , A.YEA_PAY_NUM018   /*납부특례세액_소득세*/
                 , A.YEA_PAY_NUM019   /*납부특례세액_지방소득세*/
                 , A.YEA_PAY_NUM020   /*납부특례세액_농특세*/
                 , A.YEA_PAY_NUM021   /*국민연금*/
                 , A.YEA_PAY_NUM022   /*건강보험*/
                 , A.YEA_PAY_NUM023   /*고용보험*/
                 , A.YEA_PAY_NUM024   /*노동조합비*/
                 , A.YEA_PAY_NUM025   /*기부금*/
                 , A.YEA_PAY_NUM026   /*비과세학자금*/
              FROM YEA_PAYDTL A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_PAY_YYMM
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지1 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH03" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH03.연말정산처리 종근무지1 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_EMP_NO       /*직원번호*/
                 , A.YEA_BIZ_NO       /*사업자번호*/
                 , A.YEA_BFW_STR001   /*종근무지여부*/
                 , A.YEA_BFW_STR002   /*상호*/
                 , A.YEA_BFW_STR003   /*근무시작일*/
                 , A.YEA_BFW_STR004   /*근무종료일*/
                 , A.YEA_BFW_STR005   /*감면기간시작일*/
                 , A.YEA_BFW_STR006   /*감면기간종료일*/
                 , A.YEA_BFW_NUM001   /*급여총액*/
                 , A.YEA_BFW_NUM002   /*상여총액*/
                 , A.YEA_BFW_NUM003   /*인정상여*/
                 , A.YEA_BFW_NUM004   /*주식매수선택권행사이익*/
                 , A.YEA_BFW_NUM005   /*우리사주조합인출금*/
                 , A.YEA_BFW_NUM006   /*임원 퇴직소득금액 한도초과액*/
                 , A.YEA_BFW_NUM007   /*국민연금*/
                 , A.YEA_BFW_NUM008   /*건강보험*/
                 , A.YEA_BFW_NUM009   /*고용보험*/
                 , A.YEA_BFW_NUM010   /*소득세*/
                 , A.YEA_BFW_NUM011   /*주민세*/
                 , A.YEA_BFW_NUM012   /*농특세*/
              FROM YEA_BFWORK A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_BFW_STR003
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지2 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH04" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH04.연말정산처리 종근무지2 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_EMP_NO       /*직원번호*/
                 , A.YEA_BIZ_NO       /*사업자번호*/
                 , A.YEA_NON_TAX_CD   /*비과세코드*/
                 , A.YEA_BFN_NUM001   /*비과세액*/
              FROM YEA_BFNTAX A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_NON_TAX_CD
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연금저축명세서 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH05" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH05.연말정산처리 연금저축명세서 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_PENS_SEQ     /*연금명세서순번*/
                 , A.YEA_PEN_STR001   /*연금소득공제구분*/
                 , A.YEA_PEN_STR002   /*금융기관코드*/
                 , SF_YEA_DECRYPT_ACCT_NO(A.YEA_PEN_STR003) AS YEA_PEN_STR003   /*계좌번호*/
                 , A.YEA_PEN_STR004   /*장기저축납입연차*/
                 , A.YEA_PEN_NUM001   /*불입금액*/
                 , A.YEA_PEN_NUM002   /*연금및저축공제액*/
                 , SF_GET_COMMNAME('BANK_CODE', A.YEA_PEN_STR002) AS YEA_PEN_FINA_NAME    /*금융기관명SF_YEA_COMMNAME('YEA_90001',*/
                 , A.YEA_PEN_STR005	  /*[2015귀속]2015.01.01 이후 가입여부*/
              FROM YEA_PENSAV A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PEN_STR001 LIKE #YEA_PEN_STR001# || '%'
          ORDER BY A.YEA_PENS_SEQ
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금1 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH06" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH06.연말정산처리 월세주택임차차입금1 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_RENT_SEQ1    /*월세주택임차차입금1_순번*/
                 , A.YEA_RT1_STR001   /*임대인성명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_RT1_STR002) AS YEA_RT1_STR002   /*임대인주민등록번호*/
                 , A.YEA_RT1_STR003   /*주택유형구분코드*/
                 , A.YEA_RT1_STR004   /*계약서상주소지*/
                 , A.YEA_RT1_STR005   /*계약시작일*/
                 , A.YEA_RT1_STR006   /*계약종료일*/
                 , A.YEA_RT1_NUM001   /*월세액*/
                 , A.YEA_RT1_NUM002   /*공제액*/
                 , A.YEA_RT1_NUM003   /*주택계약면적*/
              FROM YEA_RENTA1 A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_RENT_SEQ1
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금2 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH07" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH07.연말정산처리 월세주택임차차입금2 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_RENT_SEQ2    /*월세주택임차차입금2_순번*/
                 , A.YEA_RT2_STR001   /*대주성명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_RT2_STR002) AS YEA_RT2_STR002   /*대주주민등록번호*/
                 , A.YEA_RT2_STR003   /*금전소비대차계약시작일*/
                 , A.YEA_RT2_STR004   /*금전소비대차계약종료일*/
                 , A.YEA_RT2_STR005   /*임대인성명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_RT2_STR006) AS YEA_RT2_STR006   /*임대인주민등록번호*/
                 , A.YEA_RT2_STR007   /*주택유형구분코드*/
                 , A.YEA_RT2_STR008   /*계약서상주소지*/
                 , A.YEA_RT2_STR009   /*계약시작일*/
                 , A.YEA_RT2_STR010   /*계약종료일*/
                 , A.YEA_RT2_NUM001   /*차입금이자율*/
                 , A.YEA_RT2_NUM002   /*주택차입이자상환액*/
                 , A.YEA_RT2_NUM003   /*원리금상환액*/
                 , A.YEA_RT2_NUM004   /*이자액*/
                 , A.YEA_RT2_NUM005   /*공제액*/
                 , A.YEA_RT2_NUM006   /*주택계약면적*/
                 , A.YEA_RT2_NUM007   /*보증금액*/
              FROM YEA_RENTA2 A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_RENT_SEQ2
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 의료비명세서 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH08" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH08.연말정산처리 의료비명세서 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_FAMI_SEQ     /*가족순번*/
                 , A.YEA_MEDI_SEQ     /*일련번호*/
                 , A.YEA_MES_STR001   /*의료증빙코드*/
                 , A.YEA_MES_STR002   /*가족성명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_MES_STR003) AS YEA_MES_STR003   /*주민등록번호*/
                 , A.YEA_MES_STR004   /*내외국인구분*/
                 , A.YEA_MES_STR005   /*본인등해당여부*/
                 , A.YEA_MES_STR006   /*사업자상호*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_MES_STR007) AS YEA_MES_STR007   /*사업자번호*/
                 , A.YEA_MES_STR008   /*사업자번호*/
                 , A.YEA_MES_NUM001   /*지급건수*/
                 , A.YEA_MES_NUM002   /*지급금액*/
                 , A.YEA_MES_STR008	  /*[2015귀속]난임시술비여부*/
              FROM YEA_MEDISP A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_FAMI_SEQ
                 , A.YEA_MEDI_SEQ
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세서1 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH09" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH09.연말정산처리 기부금명세서1 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_FAMI_SEQ     /*가족순번*/
                 , A.YEA_DONA_SEQ     /*일련번호*/
                 , A.YEA_DOS_STR001   /*자료구분*/
                 , A.YEA_DOS_STR002   /*기부자명*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR003) AS YEA_DOS_STR003   /*주민등록번호*/
                 , A.YEA_DOS_STR004   /*내외국인구분코드*/
                 , A.YEA_DOS_STR005   /*기부자관계코드*/
                 , A.YEA_DOS_STR006   /*기부유형코드*/
                 , A.YEA_DOS_STR007   /*사업자상호*/
                 , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR008) AS YEA_DOS_STR008   /*사업자번호*/
                 , A.YEA_DOS_STR009   /*기부내용*/
                 , A.YEA_DOS_NUM001   /*기부건수*/
                 , A.YEA_DOS_NUM002   /*기부액*/
              FROM YEA_DONASP A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_FAMI_SEQ
                 , A.YEA_DONA_SEQ
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세서2 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH10" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH10.연말정산처리 기부금명세서2 조회  */
                   A.YEA_STD_YY       /*기준년월*/
                 , A.YEA_EMP_NO       /*사원번호*/
                 , A.YEA_DONA_SEQ     /*기부금순번*/
                 , A.YEA_DOA_STR001   /*기부유형코드*/
                 , A.YEA_DOA_STR002   /*기부년도*/
                 , A.YEA_DOA_NUM001   /*기부금*/
                 , A.YEA_DOA_NUM002   /*기부금기공제액*/
                 , A.YEA_DOA_NUM003   /*기부금공제대상액*/
                 , A.YEA_DOA_NUM004   /*기부금공제액*/
                 , A.YEA_DOA_NUM005   /*기부금소멸액*/
                 , A.YEA_DOA_NUM006   /*기부금이월액*/
              FROM YEA_DONAAD A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
          ORDER BY A.YEA_DOA_STR001
                 , A.YEA_DOA_STR002
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 소득공제 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH11" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH11.연말정산처리 소득공제 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_EMP_NO       /*직원번호*/
                 , A.YEA_INC_NUM001   /*국민연금전근무지*/
                 , A.YEA_INC_NUM002   /*국민연금현근무지*/
                 , A.YEA_INC_NUM003   /*공무원연금전근무지*/
                 , A.YEA_INC_NUM004   /*공무원연금현근무지*/
                 , A.YEA_INC_NUM005   /*군인연금전근무지*/
                 , A.YEA_INC_NUM006   /*군인연금현근무지*/
                 , A.YEA_INC_NUM007   /*사립학교교직원연금전근무지*/
                 , A.YEA_INC_NUM008   /*사립학교교직원연금현근무지*/
                 , A.YEA_INC_NUM009   /*별정우체국연금전근무지*/
                 , A.YEA_INC_NUM010   /*별정우체국연금현근무지*/
                 , A.YEA_INC_NUM011   /*국민건강보험전근무지*/
                 , A.YEA_INC_NUM012   /*국민건강보험현근무지*/
                 , A.YEA_INC_NUM013   /*고용보험전근무지*/
                 , A.YEA_INC_NUM014   /*고용보험현근무지*/
                 , A.YEA_INC_NUM015   /*주택임차차입금_대출기관차입*/
                 , A.YEA_INC_NUM016   /*주택임차차입금_거주자차입*/
                 , A.YEA_INC_NUM017   /*장기주택저당차입금_2011년이전(15년미만)*/
                 , A.YEA_INC_NUM018   /*장기주택저당차입금 _2011년이전(15년~29년)*/
                 , A.YEA_INC_NUM019   /*장기주택저당차입금_2011년이전(30년이상)*/
                 , A.YEA_INC_NUM020   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                 , A.YEA_INC_NUM021   /*장기주택저당차입금_2012년이후(기타대출)*/
                 , A.YEA_INC_NUM022   /*개인연금저축(2000년 이전 가입)*/
                 , A.YEA_INC_NUM023   /*소기업·소상공인 공제부금*/
                 , A.YEA_INC_NUM024   /*[2015귀속]_변경 청약저축(2014.12.31 이전 가입분)*/
                 , A.YEA_INC_NUM025   /*근로자주택마련저축*/
                 , A.YEA_INC_NUM026   /*[2015귀속]_변경 주택청약종합저축(2014.12.31 이전 가입분)*/
                 , A.YEA_INC_NUM027   /*[2015귀속]_변경 투자조합출자등_2015년 출자·투자분(10%)*/
                 , A.YEA_INC_NUM028   /*[2015귀속]_변경 투자조합출자등_2015년 출자·투자분(100%)*/
                 , A.YEA_INC_NUM029   /*투자조합출자등_2013년 출자·투자분(10%)*/
                 , A.YEA_INC_NUM030   /*투자조합출자등_2013년 출자·투자분(20%)*/
                 , A.YEA_INC_NUM031   /*투자조합출자등_2014년 이후 출자·투자분(10%)*/
                 , A.YEA_INC_NUM032   /*투자조합출자등_2014년 이후 출자·투자분(50%)*/
                 , A.YEA_INC_NUM033   /*투자조합출자등_2014년 이후 출자·투자분(30%)*/
                 , A.YEA_INC_NUM034   /*신용카드*/
                 , A.YEA_INC_NUM035   /*직불·선불카드*/
                 , A.YEA_INC_NUM036   /*현금영수증*/
                 , A.YEA_INC_NUM037   /*전통시장사용분*/
                 , A.YEA_INC_NUM038   /*대중교통이용분*/
                 , A.YEA_INC_NUM039   /*본인 신용카드등 사용액(2013년)*/
                 , A.YEA_INC_NUM040   /*본인 신용카드등 사용액(2014년)*/
                 , A.YEA_INC_NUM041   /*본인 추가공제율 사용분(2013년)*/
                 , A.YEA_INC_NUM042   /*[2015귀속]_변경 본인 추가공제율 사용분(2015년상반기)*/
                 , A.YEA_INC_NUM043   /*우리사주조합 출연금*/
                 , A.YEA_INC_NUM044   /*우리사주조합 기부금*/
                 , A.YEA_INC_NUM045   /*고용유지중소기업 근로자*/
                 , A.YEA_INC_NUM046   /*목돈 안드는 전세 이자상환액*/
                 , A.YEA_INC_NUM047   /*장기집합투자증권저축*/
                 , A.YEA_INC_NUM048   /*자녀 수*/
                 , A.YEA_INC_NUM049   /*과학기술인공제*/
                 , A.YEA_INC_NUM050   /*「근로자퇴직급여 보장법」에 따른 퇴직연금*/
                 , A.YEA_INC_NUM051   /*연금저축*/
                 , A.YEA_INC_NUM052   /*보험료_보장성*/
                 , A.YEA_INC_NUM053   /*보험료_장애인전용보장성*/
                 , A.YEA_INC_NUM054   /*[2015귀속]_변경 의료비_본인ㆍ65세 이상자ㆍ장애인ㆍ난임시술비*/
                 , A.YEA_INC_NUM055   /*의료비_그 밖의 공제대상자*/
                 , A.YEA_INC_NUM056   /*교육비_소득자본인*/
                 , A.YEA_INC_NUM057   /*교육비_취학전 아동 수*/
                 , A.YEA_INC_NUM058   /*교육비_취학전 아동*/
                 , A.YEA_INC_NUM059   /*교육비_초·중·고등학교 학생 수*/
                 , A.YEA_INC_NUM060   /*교육비_초·중·고등학교*/
                 , A.YEA_INC_NUM061   /*교육비_대학생 수*/
                 , A.YEA_INC_NUM062   /*교육비_대학생*/
                 , A.YEA_INC_NUM063   /*교육비_장애인 수*/
                 , A.YEA_INC_NUM064   /*교육비_장애인*/
                 , A.YEA_INC_NUM065   /*정치자금기부금(10만원이하)*/
                 , A.YEA_INC_NUM066   /*정치자금기부금(10만원초과)*/
                 , A.YEA_INC_NUM067   /*법정기부금(당해)*/
                 , A.YEA_INC_NUM068   /*지정기부금(당해)*/
                 , A.YEA_INC_NUM069   /*종교단체지정기부금(당해)*/
                 , A.YEA_INC_NUM070   /*외국납부세액_국외원천소득*/
                 , A.YEA_INC_NUM071   /*외국납부세액_납세액(외화)*/
                 , A.YEA_INC_NUM072   /*외국납부세액_납세액(원화)*/
                 , A.YEA_INC_NUM073   /*주택자금차입금이자세액공제*/
                 , A.YEA_INC_NUM074   /*월세세액공제*/
                 , A.YEA_INC_NUM075   /*종근무지급여총액*/
                 , A.YEA_INC_NUM076   /*종근무지소득세*/
                 , A.YEA_INC_STR001   /*입국목적*/
                 , A.YEA_INC_STR002   /*기술도입계약 또는 근로제공일*/
                 , A.YEA_INC_STR003   /*기술도입계약_감면기간 만료일*/
                 , A.YEA_INC_STR004   /*외국인 근로소득에 대한 감면 접수일*/
                 , A.YEA_INC_STR005   /*외국인 근로소득에 대한 감면 제출일*/
                 , A.YEA_INC_STR006   /*근로소득에 대한 조세조약 상 면제 접수일*/
                 , A.YEA_INC_STR007   /*근로소득에 대한 조세조약 상 면제 제출일*/
                 , A.YEA_INC_STR008   /*중소기업 취업자 감면_취업일*/
                 , A.YEA_INC_STR009   /*중소기업 취업자 감면기간_종료일*/
                 , A.YEA_INC_STR010   /*외국납부세액_납세국명*/
                 , A.YEA_INC_STR011   /*외국납부세액_납부일*/
                 , A.YEA_INC_STR012   /*외국납부세액_신청서제출일*/
                 , A.YEA_INC_STR013   /*외국납부세액_국외근무처*/
                 , A.YEA_INC_STR014   /*외국납부세액_근무기간*/
                 , A.YEA_INC_STR015   /*외국납부세액_직책*/
                 , A.YEA_INC_STR016   /*종근무지명종근무지*/
                 , A.YEA_INC_STR017   /*종근무지사업자번호*/
                 , A.YEA_INC_STR018   /*종근무지영수증제출여부*/
                 , A.YEA_INC_STR019   /*소득공제명세서제출여부*/
                 , A.YEA_INC_STR020   /*연금저축명세서제출여부*/
                 , A.YEA_INC_STR021   /*월세액명세서제출여부*/
                 , A.YEA_INC_STR022   /*의료비명세서제출여부*/
                 , A.YEA_INC_STR023   /*기부금명세서제출여부*/
                 , A.YEA_INC_STR024   /*세대주여부*/
                 , A.YEA_INC_STR025   /*입력마감여부*/
                 , A.YEA_INC_STR026   /*FILE 경로*/
                 , A.YEA_INC_STR048   /*PDF파일 물리파일명*/
                 , A.YEA_INC_STR049   /*PDF파일 파일경로*/
                 , A.YEA_INC_STR050   /*PDF파일 논리파일명*/
                 , SUBSTR(B.YEA_EMP_SSN, 7) AS YEA_EMP_SSN  /*PDF 비밀번호 추가*/
                 , A.YEA_INC_NUM077   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(고정금리이면서,비거치)*/
                 , A.YEA_INC_NUM078   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(고정금리이거나,비거치)*/
                 , A.YEA_INC_NUM079   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(기타대출)*/
                 , A.YEA_INC_NUM080   /*[2015귀속] 장기주택저당차입금_2015년이후,10~15년(고정금리이거나,비거치)*/
                 , A.YEA_INC_NUM081   /*[2015귀속] 청약저축(2015.01.01 이후 가입분)*/
                 , A.YEA_INC_NUM082   /*[2015귀속] 주택청약종합저축(2015.01.01 이후 가입분)*/
                 , A.YEA_INC_NUM083   /*[2015귀속] 투자조합출자등_2015년 출자·투자분(50%)*/
                 , A.YEA_INC_NUM084   /*[2015귀속] 투자조합출자등_2015년 출자·투자분(30%)*/
                 , A.YEA_INC_NUM085   /*[2015귀속] 본인 신용카드등 사용액(2015년)*/
                 , A.YEA_INC_NUM086   /*[2015귀속] 본인 추가공제율 사용분(2014년)*/
                 , A.YEA_INC_NUM087   /*[2015귀속] 본인 추가공제율 사용분(2015년 하반기)*/
                 , A.YEA_INC_NUM088   /*[2015귀속] 6세이하자녀수*/
                 , A.YEA_INC_NUM089   /*[2015귀속] 출산입양수*/                 
              FROM YEA_INCDEC A
         LEFT JOIN TABLE(SF_YEA_MASTXD(#YEA_STD_YY# || '1231')) B
                ON A.YEA_EMP_NO = B.YEA_EMP_NO
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연말정산 조회
********************************************************************************/
-->
	<select id="YEAA0070_2015.SEARCH12" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
           SELECT  /* YEAA0070_2015.SEARCH12.연말정산처리 연말정산 조회  */
                   A.YEA_STD_YY       /*정산년월*/
                 , A.YEA_EMP_NO       /*직원번호*/
                 , A.YEA_PRC_STR001   /*확정여부*/
                 , A.YEA_PRC_STR002   /*정산구분*/
                 , A.YEA_PRC_STR003   /*신고년월*/
                 , A.YEA_PRC_STR004   /*급여집계구분*/
                 , A.YEA_PRC_NUM001   /*총급여*/
                 , A.YEA_PRC_NUM002   /*근로소득공제*/
                 , A.YEA_PRC_NUM003   /*근로소득금액*/
                 , A.YEA_PRC_NUM004   /*기본공제_본인*/
                 , A.YEA_PRC_NUM005   /*기본공제_배우자*/
                 , A.YEA_PRC_NUM006   /*기본공제_부양가족 수*/
                 , A.YEA_PRC_NUM007   /*기본공제_부양가족*/
                 , A.YEA_PRC_NUM008   /*추가공제_경로우대 수*/
                 , A.YEA_PRC_NUM009   /*추가공제_경로우대*/
                 , A.YEA_PRC_NUM010   /*추가공제_장애인 수*/
                 , A.YEA_PRC_NUM011   /*추가공제_장애인*/
                 , A.YEA_PRC_NUM012   /*추가공제_부녀자*/
                 , A.YEA_PRC_NUM013   /*추가공제_한부모*/
                 , A.YEA_PRC_NUM014   /*국민연금보험료*/
                 , A.YEA_PRC_NUM015   /*공무원연금*/
                 , A.YEA_PRC_NUM016   /*군인연금*/
                 , A.YEA_PRC_NUM017   /*사립학교교직원연금*/
                 , A.YEA_PRC_NUM018   /*별정우체국연금*/
                 , A.YEA_PRC_NUM019   /*건강보험료*/
                 , A.YEA_PRC_NUM020   /*고용보험료*/
                 , A.YEA_PRC_NUM021   /*주택임차차입금_대출기관*/
                 , A.YEA_PRC_NUM022   /*주택임차차입금_거주자*/
                 , A.YEA_PRC_NUM023   /*장기주택저당차입금_2011년이전(15년미만)*/
                 , A.YEA_PRC_NUM024   /*장기주택저당차입금 _2011년이전(15년~29년)*/
                 , A.YEA_PRC_NUM025   /*장기주택저당차입금_2011년이전(30년이상)*/
                 , A.YEA_PRC_NUM026   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                 , A.YEA_PRC_NUM027   /*장기주택저당차입금_2012년이후(기타대출)*/
                 , A.YEA_PRC_NUM028   /*기부금(이월분)*/
                 , A.YEA_PRC_NUM029   /*특별소득공제 계*/
                 , A.YEA_PRC_NUM030   /*차감소득금액*/
                 , A.YEA_PRC_NUM031   /*개인연금저축*/
                 , A.YEA_PRC_NUM032   /*소기업·소상공인 공제부금*/
                 , A.YEA_PRC_NUM033   /*청약저축*/
                 , A.YEA_PRC_NUM034   /*주택청약종합저축*/
                 , A.YEA_PRC_NUM035   /*근로자주택마련저축*/
                 , A.YEA_PRC_NUM036   /*투자조합출자 등*/
                 , A.YEA_PRC_NUM037   /*신용카드 등 사용액*/
                 , A.YEA_PRC_NUM038   /*우리사주조합 출연금*/
                 , A.YEA_PRC_NUM039   /*[2015귀속]_변경 우리사주조합기부금_공제대상금액*/
                 , A.YEA_PRC_NUM040   /*고용유지 중소기업 근로자*/
                 , A.YEA_PRC_NUM041   /*목돈 안 드는 전세 이자상환액*/
                 , A.YEA_PRC_NUM042   /*장기집합투자증권저축*/
                 , A.YEA_PRC_NUM043   /*그 박의 소득공제 계*/
                 , A.YEA_PRC_NUM044   /*소득공제 종합한도 초과액*/
                 , A.YEA_PRC_NUM045   /*종합소득 과세표준*/
                 , A.YEA_PRC_NUM046   /*산출세액*/
                 , A.YEA_PRC_NUM047   /*세액감면_소득세법*/
                 , A.YEA_PRC_NUM048   /*세액감면_조세특례제한법*/
                 , A.YEA_PRC_NUM049   /*세액감면_조세특례제한법 제30조*/
                 , A.YEA_PRC_NUM050   /*조세조약*/
                 , A.YEA_PRC_NUM051   /*세액감면 계*/
                 , A.YEA_PRC_NUM052   /*세액공제_근로소득*/
                 , A.YEA_PRC_NUM053   /*세액공제_자녀 수*/
                 , A.YEA_PRC_NUM054   /*세액공제_자녀*/
                 , A.YEA_PRC_NUM055   /*과학기술인공제_공제대상금액*/
                 , A.YEA_PRC_NUM056   /*과학기술인공제_세액공제액*/
                 , A.YEA_PRC_NUM057   /*근로자퇴직급여보장법_공제대상금액*/
                 , A.YEA_PRC_NUM058   /*근로자퇴직급여보장법_세액공제액*/
                 , A.YEA_PRC_NUM059   /*연금저축_공제대상금액*/
                 , A.YEA_PRC_NUM060   /*연금저축_세액공제액*/
                 , A.YEA_PRC_NUM061   /*보장성보험료_공제대상금액*/
                 , A.YEA_PRC_NUM062   /*보장성보험료_세액공제액*/
                 , A.YEA_PRC_NUM063   /*의료비_공제대상금액*/
                 , A.YEA_PRC_NUM064   /*의료비_세액공제액*/
                 , A.YEA_PRC_NUM065   /*교육비_공제대상금액*/
                 , A.YEA_PRC_NUM066   /*교육비_세액공제액*/
                 , A.YEA_PRC_NUM067   /*정치자금기부금_10만원이하_공제대상금액*/
                 , A.YEA_PRC_NUM068   /*정치자금기부금_10만원이하_세액공제액*/
                 , A.YEA_PRC_NUM069   /*정치자금기부금_10만원초과_공제대상금액*/
                 , A.YEA_PRC_NUM070   /*정치자금기부금_10만원초과_세액공제액*/
                 , A.YEA_PRC_NUM071   /*법정기부금_공제대상금액*/
                 , A.YEA_PRC_NUM072   /*법정기부금_세액공제액*/
                 , A.YEA_PRC_NUM073   /*지정기부금_공제대상금액*/
                 , A.YEA_PRC_NUM074   /*지정기부금_세액공제액*/
                 , A.YEA_PRC_NUM075   /*특별세액공제 계*/
                 , A.YEA_PRC_NUM076   /*표준세액공제*/
                 , A.YEA_PRC_NUM077   /*납세조합공제*/
                 , A.YEA_PRC_NUM078   /*주택차입금*/
                 , A.YEA_PRC_NUM079   /*외국납부*/
                 , A.YEA_PRC_NUM080   /*월세세액공제_공제대상금액*/
                 , A.YEA_PRC_NUM081   /*월세세액공제_세액공제액*/
                 , A.YEA_PRC_NUM082   /*세액공제 계*/
                 , A.YEA_PRC_NUM083   /*결정세액 소득세*/
                 , A.YEA_PRC_NUM084   /*결정세액 주민세*/
                 , A.YEA_PRC_NUM085   /*결정세액 농특세*/
                 , A.YEA_PRC_NUM086   /*종근무지소득세*/
                 , A.YEA_PRC_NUM087   /*종근무지주민세*/
                 , A.YEA_PRC_NUM088   /*종근무지농특세*/
                 , A.YEA_PRC_NUM089   /*주근무지소득세*/
                 , A.YEA_PRC_NUM090   /*주근무지주민세*/
                 , A.YEA_PRC_NUM091   /*주근무지농특세*/
                 , A.YEA_PRC_NUM092   /*차감징수소득세*/
                 , A.YEA_PRC_NUM093   /*차감징수주민세*/
                 , A.YEA_PRC_NUM094   /*차감징수농특세*/
                 , A.YEA_PRC_NUM095   /*납부특례소득세*/
                 , A.YEA_PRC_NUM096   /*납부특례주민세*/
                 , A.YEA_PRC_NUM097   /*납부특례농특세*/
                 , A.YEA_PRC_NUM098   /*세액공제6세이하 수 귀속년도2014년 연말정산 재정산(소급)*/
                 , A.YEA_PRC_NUM099   /*세액공제6세이하*/
                 , A.YEA_PRC_NUM100   /*세액공제출산입양 수*/
                 , A.YEA_PRC_NUM101   /*세액공제출산입양*/
                 , A.YEA_PRC_NUM102   /*장애인전용보험료_공제대상금액*/
                 , A.YEA_PRC_NUM103   /*장애인전용보험료_세액공제액*/
                 , A.YEA_PRC_NUM104	  /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이면서 비거치)*/
                 , A.YEA_PRC_NUM105	  /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이거나 비거치)*/
                 , A.YEA_PRC_NUM106	  /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(기타대출)*/
                 , A.YEA_PRC_NUM107	  /*[2015귀속] 장기주택저당차입금_2015년이후, 10~15년(고정금리이거나 비거치)*/
                 , A.YEA_PRC_NUM108	  /*[2015귀속] 우리사주조합기부금_세액공제액*/                 
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT01" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
       SELECT  /* YEAA0070_2015.PRINT01.연말정산처리  */
               A.YEA_STD_YY          /* 정산년월 */
             , A.YEA_EMP_NO          /* 사원번호 */
             , B.YEA_EMP_NM          /* 성명 */
             , B.YEA_EMP_SSN         /* 주민등록번호 */
             , CASE WHEN B.YEA_HIRE_YMD < A.YEA_STD_YY || '0101' THEN TO_CHAR(A.YEA_STD_YY || '0101') ELSE TO_CHAR(B.YEA_HIRE_YMD) END                 AS YEA_HIRE_YMD   /* 입사일 */
             , CASE WHEN NVL(B.YEA_QUIT_YMD,'29991231') > A.YEA_STD_YY || '1231' THEN TO_CHAR(A.YEA_STD_YY || '1231') ELSE TO_CHAR(B.YEA_QUIT_YMD) END AS YEA_QUIT_YMD   /* 퇴사일 */
             , A.YEA_INC_NUM001      /* 국민연금전근무지 */
             , A.YEA_INC_NUM002      /* 국민연금현근무지 */
             , NVL(A.YEA_INC_NUM003,0) + NVL(YEA_INC_NUM005,0) + NVL(YEA_INC_NUM007,0) + NVL(YEA_INC_NUM009,0) AS YEA_INC_SUM001 /* 국민연금보혐료외의 연금보험료(종) */
             , NVL(A.YEA_INC_NUM004,0) + NVL(YEA_INC_NUM006,0) + NVL(YEA_INC_NUM008,0) + NVL(YEA_INC_NUM010,0) AS YEA_INC_SUM002 /* 국민연금보혐료외의 연금보험료(현) */
             , NVL(A.YEA_INC_NUM001,0) + NVL(A.YEA_INC_NUM002,0) + NVL(YEA_INC_NUM003,0) + NVL(YEA_INC_NUM004,0) + NVL(YEA_INC_NUM005,0)
               + NVL(A.YEA_INC_NUM006,0) + NVL(A.YEA_INC_NUM007,0) + NVL(YEA_INC_NUM008,0) + NVL(YEA_INC_NUM009,0) + NVL(YEA_INC_NUM010,0) AS YEA_INC_SUM003  /* 연금보혐료계 */
             , A.YEA_INC_NUM011      /* 건강보험전근무지 */
             , A.YEA_INC_NUM012      /* 건강보험현근무지 */
             , A.YEA_INC_NUM013      /* 고용보험전근무지 */
             , A.YEA_INC_NUM014      /* 고용보험현근무지 */
             , NVL(A.YEA_INC_NUM011,0) + NVL(A.YEA_INC_NUM012,0) + NVL(A.YEA_INC_NUM013,0) + NVL(A.YEA_INC_NUM014,0) AS YEA_INC_SUM004  /* 건강+고용 보험료계 */
             , A.YEA_INC_NUM015      /* 주택임차원리금상환액(대출기관) */
             , A.YEA_INC_NUM016      /* 주택임차원리금상환액(거주자) */
             , A.YEA_INC_NUM017      /* 장기주택저당차입금_2011년이전(15년미만) */
             , A.YEA_INC_NUM018      /* 장기주택저당차입금 _2011년이전(15년~29년) */
             , A.YEA_INC_NUM019      /* 장기주택저당차입금_2011년이전(30년이상) */
             , A.YEA_INC_NUM020      /* 장기주택저당차입금_2012년이후(고정금리,비거치상환대출) */
             , A.YEA_INC_NUM021      /* 장기주택저당차입금_2012년이후(기타대출) */
             , A.YEA_INC_NUM077      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(고정금리이면서,비거치)*/
             , A.YEA_INC_NUM078      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(고정금리이거나,비거치)*/
             , A.YEA_INC_NUM079      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(기타대출)*/
             , A.YEA_INC_NUM080      /*[2015귀속]_장기주택임차저당차입금_2015년이후_10~15년(고정금리이거나,비거치)*/
             , NVL(A.YEA_INC_NUM015,0) + NVL(A.YEA_INC_NUM016,0) + NVL(A.YEA_INC_NUM017,0) + NVL(A.YEA_INC_NUM018,0) + NVL(A.YEA_INC_NUM019,0)
               + NVL(A.YEA_INC_NUM020,0) + NVL(A.YEA_INC_NUM021,0)
               + NVL(A.YEA_INC_NUM077,0) + NVL(A.YEA_INC_NUM078,0) + NVL(A.YEA_INC_NUM079,0) + NVL(A.YEA_INC_NUM080,0) AS YEA_INC_SUM005 /* 장기주택저당차입금계 [2015귀속]_추가 장기주택임차차입금2015년이후*/
             , Nvl(C.DONA10,0) AS YEA_INC_SUM017 /*[2015귀속]_법정기부금(이월분)*/
             , Nvl(C1.DONA41,0) AS YEA_INC_SUM018 /*[2015귀속]_지정기부금_종교단체외(이월분)*/
             , Nvl(C2.DONA40,0) AS YEA_INC_SUM019 /*[2015귀속]_지정기부금_종교단체(이월분)*/
             , Nvl(C.DONA10,0) + Nvl(C1.DONA41,0) + Nvl(C2.DONA40,0) AS YEA_INC_SUM020 /*[2015귀속]기부금이월분합계*/
             , A.YEA_INC_NUM022      /* 개인연금저축 */
             , A.YEA_INC_NUM023      /* 소기업·소상공인 공제부금 */
             , NVL(A.YEA_INC_NUM024,0) + NVL(A.YEA_INC_NUM081,0) AS YEA_INC_NUM024      /* 주택마련저축_청약저축 [2015귀속]_추가 청약저축2015.01.01이후가입분*/
             , A.YEA_INC_NUM025      /* 주택마련저축_근로자주택마련 */
             , NVL(A.YEA_INC_NUM026,0) + NVL(A.YEA_INC_NUM082,0) AS YEA_INC_NUM026      /* 주택마련저축_주택청약종합 [2015귀속]_추가 주택청약종합2015.01.01이후가입분*/
             , NVL(A.YEA_INC_NUM024,0) + NVL(A.YEA_INC_NUM025,0) + NVL(A.YEA_INC_NUM026,0) + NVL(A.YEA_INC_NUM081,0) + NVL(A.YEA_INC_NUM082,0) AS YEA_INC_SUM006    /* 주택마련저축소득공제계 [2015귀속]_추가 청약저축,주택청약종합(2015.01.01이후가입분)*/
             , NVL(A.YEA_INC_NUM029,0) AS YEA_INC_NUM029     /*[2015귀속]_변경 2013년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM030,0) AS YEA_INC_NUM030     /*[2015귀속]_변경 2013년 출자·투자분 벤처등 */
             , NVL(A.YEA_INC_NUM031,0) AS YEA_INC_NUM031     /*[2015귀속]_변경 2014년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM032,0) + NVL(A.YEA_INC_NUM033,0) AS YEA_INC_SUM009 /*[2015귀속]_변경 2014년 출자·투자분 벤처등 */
             , NVL(A.YEA_INC_NUM027,0) AS YEA_INC_NUM027         /*[2015귀속]_변경 2015년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM028,0) + NVL(A.YEA_INC_NUM083,0) + NVL(A.YEA_INC_NUM084,0) AS YEA_INC_SUM007  /*[2015귀속]_추가 투자조합출자등_2015년 이후 출자·투자분 벤처등*/
             , NVL(A.YEA_INC_NUM027,0) + NVL(A.YEA_INC_NUM028,0) + NVL(A.YEA_INC_NUM029,0) + NVL(A.YEA_INC_NUM030,0) + NVL(A.YEA_INC_NUM031,0)
               + NVL(A.YEA_INC_NUM032,0) + NVL(A.YEA_INC_NUM033,0) + NVL(A.YEA_INC_NUM083,0) + NVL(A.YEA_INC_NUM084,0) AS YEA_INC_SUM010 /* 투자조합출자액 합계    [2015귀속]_추가 투자조합출자등_2015년 이후 출자·투자분*/
             , A.YEA_INC_NUM034      /* 신용카드 */
             , A.YEA_INC_NUM035      /* 직불카드등 */
             , A.YEA_INC_NUM036      /* 현금영수증 */
             , A.YEA_INC_NUM037      /* 전통시장사용금액 2012.12.26 추가 */
             , A.YEA_INC_NUM038      /* 대중교통사용금액 [2013귀속] 추가 */
             , NVL(A.YEA_INC_NUM034,0) + NVL(A.YEA_INC_NUM035,0) + NVL(A.YEA_INC_NUM036,0) + NVL(A.YEA_INC_NUM037,0) + Nvl(A.YEA_INC_NUM038,0) AS YEA_INC_SUM011    /* [2013귀속] 신용카드등사용액소득공제계 */
             , A.YEA_INC_NUM039      /* 본인 신용카드등 사용액(2013년) */
             , A.YEA_INC_NUM040      /* 본인 신용카드등 사용액(2014년) */
             , A.YEA_INC_NUM041      /* 본인 추가공제율 사용분(2013년) */
             , A.YEA_INC_NUM042      /*[2015년귀속]_변경 본인 추가공제율 사용분(2015년상반기)*/
             , A.YEA_INC_NUM085      /*[2015년귀속]_추가 본인 신용카드등 사용액(2015년)*/
             , A.YEA_INC_NUM086      /*[2015년귀속]_추가 본인 추가공제율 사용분(2014년)*/
             , A.YEA_INC_NUM087      /*[2015년귀속]_추가 본인 추가공제율 사용분(2015년하반기)*/
             , A.YEA_INC_NUM043      /* 우리사주조합 출연금 */
             , A.YEA_INC_NUM045      /* 고용유지중소기업 근로자 */
             , A.YEA_INC_NUM046      /* 목돈안드는전세이자상환액 */
             , A.YEA_INC_NUM047      /* 장기집합투자증권저축 */
             , A.YEA_INC_NUM048      /* 자녀수 */
             , A.YEA_INC_STR001      /* 입국목적 */
             , A.YEA_INC_STR002      /* 기술도입계약 또는 근로제공일 */
             , A.YEA_INC_STR003      /* 외국인근로자_감면기간 만료일 */
             , A.YEA_INC_STR004      /* 외국인 근로소득에 대한 감면 접수일 */
             , A.YEA_INC_STR005      /* 외국인 근로소득에 대한 감면 제출일 */
             , A.YEA_INC_STR006      /* 근로소득에 대한 조세조약 상 면제 접수일 */
             , A.YEA_INC_STR007      /* 근로소득에 대한 조세조약 상 면제 제출일 */
             , A.YEA_INC_STR008      /* 중소기업 취업자 감면_취업일 */
             , A.YEA_INC_STR009      /* 중소기업 취업자 감면기간_종료일 */
             , A.YEA_INC_NUM049      /* 과학기술인공제 */
             , A.YEA_INC_NUM050      /* 「근로자퇴직급여 보장법」에 따른 퇴직연금 */
             , A.YEA_INC_NUM051      /* 연금저축 */
             , NVL(A.YEA_INC_NUM049,0) + NVL(A.YEA_INC_NUM050,0) + Nvl(A.YEA_INC_NUM051,0) AS YEA_INC_SUM012       /* 연금계좌계 */
             , A.YEA_INC_NUM052      /* 일반보장성보험 */
             , A.YEA_INC_NUM053      /* 장애인보장성보험 */
             , NVL(A.YEA_INC_NUM052,0) + NVL(A.YEA_INC_NUM053,0) AS YEA_INC_SUM013   /* 보험료 계 */
             , A.YEA_INC_NUM054      /* 의료비_본인ㆍ65세 이상자ㆍ장애인 */
             , A.YEA_INC_NUM055      /* 의료비_그 밖의 공제대상자 */
             , NVL(A.YEA_INC_NUM054,0) + NVL(A.YEA_INC_NUM055,0) AS YEA_INC_SUM014  /* 의료비계 */
             , A.YEA_INC_NUM056      /* 본인교육비 */
             , A.YEA_INC_NUM057      /* 취학전아동수 */
             , A.YEA_INC_NUM058      /* 취학전아동교육비 */
             , A.YEA_INC_NUM059      /* 초중고학생수 */
             , A.YEA_INC_NUM060      /* 초중고교육비 */
             , A.YEA_INC_NUM061      /* 대학생수 */
             , A.YEA_INC_NUM062      /* 대학생교육비 */
             , A.YEA_INC_NUM063      /* 장애인수 */
             , A.YEA_INC_NUM064      /* 장애인교육비 */
             , NVL(A.YEA_INC_NUM056,0) + NVL(A.YEA_INC_NUM058,0) + NVL(A.YEA_INC_NUM060,0) + NVL(A.YEA_INC_NUM062,0) + NVL(A.YEA_INC_NUM064,0) AS YEA_INC_SUM015  /* 교육비계 */
             , A.YEA_INC_NUM065      /* 정치자금기부금(10만원이하) */
             , A.YEA_INC_NUM066      /* 정치자금기부금(10만원초과) */
             , A.YEA_INC_NUM067      /* 법정기부금(당해) */
             , A.YEA_INC_NUM044      /*[2015귀속]_이동 우리사주조합기부금*/
             , Nvl(C3.YEA_DOS_NUM002,0) AS YEA_INC_SUM021    /*[2015귀속]_변경 지정기부금(종교단체외)*/
             , Nvl(A.YEA_INC_NUM068,0) - Nvl(C3.YEA_DOS_NUM002,0) AS YEA_INC_NUM068     /*[2015귀속]_변경 지정기부금(종교단체)*/
             , NVL(A.YEA_INC_NUM065,0) + NVL(A.YEA_INC_NUM066,0) + NVL(A.YEA_INC_NUM067,0) + NVL(A.YEA_INC_NUM068,0) + NVL(A.YEA_INC_NUM044,0) AS YEA_INC_SUM016  /* 기부금 계 /*[2015귀속]_추가 우리사주조합기부금*/
             , A.YEA_INC_NUM070      /* 외국납부세액_국외원천소득 */
             , A.YEA_INC_NUM071      /* 외국납부세액_납세액(외화) */
             , A.YEA_INC_NUM072      /* 외국납부세액_납세액(원화) */
             , A.YEA_INC_STR010      /* 외국납부세액_납세국명 */
             , A.YEA_INC_STR011      /* 외국납부세액_납부일 */
             , A.YEA_INC_STR012      /* 외국납부세액_신청서제출일 */
             , A.YEA_INC_STR013      /* 외국납부세액_국외근무처 */
             , A.YEA_INC_STR014      /* 외국납부세액_근무기간 */
             , A.YEA_INC_STR015      /* 외국납부세액_직책 */
             , A.YEA_INC_NUM073      /* 주택자금차입금이자세액공제 */
             , A.YEA_INC_NUM074      /* 월세세액공제 */
             , B.YEA_RATE_YN         /* 단일세율적용여부 */
             , A.YEA_INC_STR016      /* 종근무지명 */
             , A.YEA_INC_STR017      /* 종근무지사업자번호 */
             , A.YEA_INC_NUM075      /* 종근무지급여총액 */
             , A.YEA_INC_NUM076      /* 종근무지소득세 */
             , A.YEA_INC_STR018      /* 종근무지영수증제출여부 */
             , A.YEA_INC_STR019      /* 소득공제명세서제출여부 */
             , A.YEA_INC_STR020      /* 연금저축명세서제출여부 */
             , A.YEA_INC_STR021      /* 월세액명세서제출여부 */
             , A.YEA_INC_STR022      /* 의료비명세서제출여부 */
             , A.YEA_INC_STR023      /* 기부금명세서제출여부 */
             , A.YEA_INC_STR024      /*  세대주여부 */
             , B.YEA_HOME_ADDRESS1 || ' ' || B.YEA_HOME_ADDRESS2 AS YEA_HOME_ADDRESS /* 사원주소 */
             , B.YEA_HOME_TEL_NO  /* 전화번호 */
             , OFFI.YEA_BRANCH_NM  /* 회사명 */
             , OFFI.YEA_BIZ_NO   /* 사업자번호 */
             , OFFI.YEA_CORP_NO   /* 법인번호 */
             , OFFI.YEA_ADDRESS1 || ' ' || OFFI.YEA_ADDRESS2 AS YEA_ADDRESS /* 회사주소 */
             , OFFI.YEA_TEL_NO   /* 회사전화번호 */
             , SF_YEA_COMMNAME('YEA_90002', OFFI.YEA_TAXOFFIC_CD) AS YEA_TAXOFFIC_NM         /* 세무서명 */
             , B.YEA_LIVE_CD     /* 거주자구분 */
             , B.YEA_NATION_CD     /* 거주지국코드 */
             , SF_YEA_COMMNAME('YEA_90003',B.YEA_NATION_CD) AS YEA_NATION_NM     /* 거주지국명 */
             , D.YEA_FAM_STR005 AS YEA_FAM_CNT001   /* 기본공제자 수 */
             , D.YEA_FAM_STR006 AS YEA_FAM_CNT002   /* 경로우대자 수 */
             , D.YEA_FAM_STR007 AS YEA_FAM_CNT003   /* 부녀자 수 */
             , D.YEA_FAM_STR008 AS YEA_FAM_CNT004   /* 한부모 수 */
             , D.YEA_FAM_STR009 AS YEA_FAM_CNT005   /* 장애인 수 */
             , D.YEA_FAM_STR011 AS YEA_FAM_CNT006   /* 6세이하 수 */
             , D.YEA_FAM_STR012 AS YEA_FAM_CNT007   /* 출산입양 수 */
             , D.YEA_FAM_NUM001 AS YEA_FAM_SUM001   /* 보험료_건강고용_국세청 */
             , D.YEA_FAM_NUM002 AS YEA_FAM_SUM002   /* 보험료_건강고용_기타 */
             , D.YEA_FAM_NUM003 AS YEA_FAM_SUM003   /* 보험료_보장성_국세청 */
             , D.YEA_FAM_NUM004 AS YEA_FAM_SUM004   /* 보험료_보장성_기타 */
             , D.YEA_FAM_NUM020 AS YEA_FAM_SUM020   /*보험료_장애인_국세청*/
             , D.YEA_FAM_NUM021 AS YEA_FAM_SUM021   /*보험료_장애인_기타*/
             , D.YEA_FAM_NUM005 AS YEA_FAM_SUM005   /* 의료비_국세청 */
             , D.YEA_FAM_NUM006 AS YEA_FAM_SUM006   /* 의료비_기타 */
             , D.YEA_FAM_NUM007 AS YEA_FAM_SUM007   /* 교육비_국세청 */
             , D.YEA_FAM_NUM008 AS YEA_FAM_SUM008   /* 교육비_기타 */
             , D.YEA_FAM_NUM009 AS YEA_FAM_SUM009   /* 신용카드_국세청 */
             , D.YEA_FAM_NUM010 AS YEA_FAM_SUM010   /* 신용카드_기타 */
             , D.YEA_FAM_NUM011 AS YEA_FAM_SUM011   /* 직불카드_국세청 */
             , D.YEA_FAM_NUM012 AS YEA_FAM_SUM012   /* 직불카드_기타 */
             , D.YEA_FAM_NUM013 AS YEA_FAM_SUM013   /* 현금영수증_국세청 */
             , D.YEA_FAM_NUM014 AS YEA_FAM_SUM014   /* 전통시장_국세청 */
             , D.YEA_FAM_NUM015 AS YEA_FAM_SUM015   /* 전통시장_기타 */
             , D.YEA_FAM_NUM016 AS YEA_FAM_SUM016   /* 대중교통_국세청 */
             , D.YEA_FAM_NUM017 AS YEA_FAM_SUM017   /* 대중교통_기타 */
             , D.YEA_FAM_NUM018 AS YEA_FAM_SUM018   /* 기부금_국세청 */
             , D.YEA_FAM_NUM019 AS YEA_FAM_SUM019   /* 기부금_기타 */
          FROM YEA_INCDEC A                          /* 소득공제신고 테이블 */
     LEFT JOIN TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) B
            ON B.YEA_EMP_NO = A.YEA_EMP_NO
          LEFT OUTER JOIN VI_YEA_BRCHXM OFFI
            ON YEA_BRANCH_CD = '100'
          /*[2015귀속]_추가 법정기부금(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, Nvl(Sum(YEA_DOA_NUM003),0) AS DONA10
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '10'            /*법정기부금*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) C
                       ON A.YEA_STD_YY = C.YEA_STD_YY
                      AND A.YEA_EMP_NO = C.YEA_EMP_NO
          /*[2015귀속]_추가 법정기부금(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금_종교단체외(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, Nvl(Sum(YEA_DOA_NUM003),0) AS DONA41
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '41'            /*지정기부금(종교단체외)*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) C1
                       ON A.YEA_STD_YY = C1.YEA_STD_YY
                      AND A.YEA_EMP_NO = C1.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금_종교단체외(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금_종교단체(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, Nvl(Sum(YEA_DOA_NUM003),0) AS DONA40
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '40'            /*지정기부금(종교단체)*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) C2
                       ON A.YEA_STD_YY = C2.YEA_STD_YY
                      AND A.YEA_EMP_NO = C2.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금_종교단체(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금(종교단체외)분리*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, Nvl(Sum(YEA_DOS_NUM002),0) AS YEA_DOS_NUM002
                             FROM YEA_DONASP
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOS_STR006 = '40'
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) C3
                       ON A.YEA_STD_YY = C3.YEA_STD_YY
                      AND A.YEA_EMP_NO = C3.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금(종교단체외)분리끝*/
          LEFT OUTER JOIN                           /* 소득공제신고의 인적공제 합계 */
               (
                SELECT
                       YEA_EMP_NO
                     , SUM(CASE WHEN YEA_FAM_STR005 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR005   /* 기본공제자 수 */
                     , SUM(CASE WHEN YEA_FAM_STR006 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR006   /* 경로우대자 수 */
                     , SUM(CASE WHEN YEA_FAM_STR007 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR007   /* 부녀자 수 */
                     , SUM(CASE WHEN YEA_FAM_STR008 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR008   /* 한부모 수 */
                     , SUM(CASE WHEN NVL(YEA_FAM_STR009,'0') <> '0' THEN 1 ELSE 0 END) AS YEA_FAM_STR009   /* 장애인 수 */
                     , SUM(CASE WHEN YEA_FAM_STR011 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR011   /* 6세이하 수 */
                     , SUM(CASE WHEN YEA_FAM_STR012 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR012   /* 출산입양 수 */
                     , SUM(YEA_FAM_NUM001) AS YEA_FAM_NUM001   /* 보험료_건강고용_국세청 */
                     , SUM(YEA_FAM_NUM002) AS YEA_FAM_NUM002   /* 보험료_건강고용_기타 */
                     , SUM(YEA_FAM_NUM003) AS YEA_FAM_NUM003   /* 보험료_보장성_국세청 */
                     , SUM(YEA_FAM_NUM004) AS YEA_FAM_NUM004   /* 보험료_보장성_기타 */
                     , SUM(YEA_FAM_NUM020) AS YEA_FAM_NUM020   /* 보험료_장애인_국세청 */
                     , SUM(YEA_FAM_NUM021) AS YEA_FAM_NUM021   /* 보험료_장애인_기타 */
                     , SUM(YEA_FAM_NUM005)+SUM(YEA_FAM_NUM022) AS YEA_FAM_NUM005   /* 의료비_국세청  [2015귀속]_난임시술비 추가 */
                     , SUM(YEA_FAM_NUM006)+SUM(YEA_FAM_NUM023) AS YEA_FAM_NUM006   /* 의료비_기타    [2015귀속]_난임시술비 추가 */
                     , SUM(YEA_FAM_NUM007) AS YEA_FAM_NUM007   /* 교육비_국세청 */
                     , SUM(YEA_FAM_NUM008) AS YEA_FAM_NUM008   /* 교육비_기타 */
                     , SUM(YEA_FAM_NUM009) AS YEA_FAM_NUM009   /* 신용카드_국세청 */
                     , SUM(YEA_FAM_NUM010) AS YEA_FAM_NUM010   /* 신용카드_기타 */
                     , SUM(YEA_FAM_NUM011) AS YEA_FAM_NUM011   /* 직불카드_국세청 */
                     , SUM(YEA_FAM_NUM012) AS YEA_FAM_NUM012   /* 직불카드_기타 */
                     , SUM(YEA_FAM_NUM013) AS YEA_FAM_NUM013   /* 현금영수증_국세청 */
                     , SUM(YEA_FAM_NUM014) AS YEA_FAM_NUM014   /* 전통시장_국세청 */
                     , SUM(YEA_FAM_NUM015) AS YEA_FAM_NUM015   /* 전통시장_기타 */
                     , SUM(YEA_FAM_NUM016) AS YEA_FAM_NUM016   /* 대중교통_국세청 */
                     , SUM(YEA_FAM_NUM017) AS YEA_FAM_NUM017   /* 대중교통_기타 */
                     , SUM(YEA_FAM_NUM018) AS YEA_FAM_NUM018   /* 기부금_국세청 */
                     , SUM(YEA_FAM_NUM019) AS YEA_FAM_NUM019   /* 기부금_기타 */
                  FROM YEA_YEFAMI                    /* 연말정산가족사항 테이블 */
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
                 GROUP BY YEA_EMP_NO
               ) D
            ON A.YEA_EMP_NO = D.YEA_EMP_NO
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#;
	]]>
	</select>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT02" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
          SELECT /* YEAA0070_2015.PRINT02.연말정산처리  */
		         A.YEA_FAM_STR001    /* 가족관계 신고코드 */
		        ,NVL(A.YEA_FAM_STR002,'1') AS YEA_FAM_STR002    /* 내외국인구분 */
		        ,A.YEA_FAM_STR003    /* 가족성명 */
		        ,CASE WHEN A.YEA_FAM_STR001 = '0' THEN '(근로자 본인)' ELSE SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004) END AS YEA_FAM_STR004    /* 주민등록번호 */
		        ,CASE WHEN A.YEA_FAM_STR005 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR005    /* 기본공제여부 */
		        ,CASE WHEN A.YEA_FAM_STR006 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR006    /* 경로우대여부 */
		        ,CASE WHEN A.YEA_FAM_STR007 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR007    /* 부녀자여부 */
		        ,CASE WHEN A.YEA_FAM_STR008 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR008    /* 한부모여부 */
		        ,CASE WHEN NVL(A.YEA_FAM_STR009,'0') <> '0' THEN TO_CHAR(A.YEA_FAM_STR009) ELSE '' END AS YEA_FAM_STR009    /* 장애인여부 */
		        ,CASE WHEN A.YEA_FAM_STR011 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR011    /* 6세이하여부 */
		        ,CASE WHEN A.YEA_FAM_STR012 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR012    /* 출산입양여부 */
		        ,A.YEA_FAM_NUM001    /* 보험료_건강고용_국세청 */
		        ,A.YEA_FAM_NUM002    /* 보험료_건강고용_기타 */
		        ,A.YEA_FAM_NUM003    /* 보험료_보장성_국세청 */
		        ,A.YEA_FAM_NUM004    /* 보험료_보장성_기타 */
		        ,NVL(A.YEA_FAM_NUM005,0) + NVL(A.YEA_FAM_NUM022,0) AS YEA_FAM_NUM005  /* 의료비_국세청   [2015귀속]_난임시술비 추가 */
		        ,NVL(A.YEA_FAM_NUM006,0) + NVL(A.YEA_FAM_NUM023,0) AS YEA_FAM_NUM006  /* 의료비_기타     [2015귀속]_난임시술비 추가 */
		        ,A.YEA_FAM_NUM007    /* 교육비_국세청 */
		        ,A.YEA_FAM_NUM008    /* 교육비_기타 */
		        ,A.YEA_FAM_NUM009    /* 신용카드_국세청 */
		        ,A.YEA_FAM_NUM010    /* 신용카드_기타 */
		        ,A.YEA_FAM_NUM011    /* 직불카드_국세청 */
		        ,A.YEA_FAM_NUM012    /* 직불카드_기타 */
		        ,A.YEA_FAM_NUM013    /* 현금영수증_국세청 */
		        ,A.YEA_FAM_NUM014    /* 전통시장_국세청 */
		        ,A.YEA_FAM_NUM015    /* 전통시장_기타 */
		        ,A.YEA_FAM_NUM016    /* 대중교통_국세청 */
		        ,A.YEA_FAM_NUM017    /* 대중교통_기타 */
		        ,A.YEA_FAM_NUM018    /* 기부금_국세청 */
		        ,A.YEA_FAM_NUM019    /* 기부금_기타 */
            FROM YEA_YEFAMI A
           WHERE A.YEA_STD_YY = #YEA_STD_YY#
             AND A.YEA_EMP_NO = #YEA_EMP_NO#
           ORDER BY A.YEA_FAMI_SEQ       
	]]>
	</select> 
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT03" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT03.연말정산처리  */   
               A.YEA_PENS_SEQ  /* 연금명세서순번 */
             , A.YEA_PEN_STR001  /* 연금소득공제구분 */
             , A.YEA_PEN_STR002  /* 금융기관코드 */
             , SF_YEA_DECRYPT_ACCT_NO(A.YEA_PEN_STR003) AS YEA_PEN_STR003  /* 계좌번호 */
             , A.YEA_PEN_NUM001  /* 불입금액 */
             , A.YEA_PEN_NUM002  /* 연금및저축공제액 */
             , SF_GET_COMMNAME('BANK_CODE', A.YEA_PEN_STR002) AS YEA_PEN_FINA_NAME /* 금융기관명 */
             , B.COMD_CDNM AS YEA_PEN_NAME /* 연금소득공제구분명 */
             , B.REF2_FILD AS YEA_PEN_TYPE /* 공제구분 */
          FROM YEA_PENSAV A
     LEFT JOIN TM_CODEXD  B
            ON B.COMM_CODE = 'PIDD_CODE'
           AND B.COMD_CODE = A.YEA_PEN_STR001
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_PEN_STR001 LIKE #YEA_PEN_STR001# || '%'
         ORDER BY A.YEA_PENS_SEQ;
	]]>
	</select> 		
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT04" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT04.연말정산처리  */   
     		   YEA_MES_STR005               /* 본인등해당여부 */
             , YEA_MES_STR006               /* 상호 */
             , SF_YEA_DECRYPT_SSN(YEA_MES_STR007) AS YEA_MES_STR007               /* 사업자번호 */
             , YEA_MES_NUM001               /* 지급건수 */
             , YEA_MES_NUM002               /* 지급액 */
             , YEA_MES_STR001               /* 의료증빙코드 */
             , YEA_MES_STR002               /* 성명 */
             , SF_YEA_DECRYPT_SSN(YEA_MES_STR003) AS YEA_MES_STR003               /* 주민등록번호 */
             , YEA_MES_STR004               /* 내외국인구분코드 */
             , Nvl(YEA_MES_STR008, '0') AS YEA_MES_STR008               /*[2015귀속]_추가 난임시술비*/
          FROM YEA_MEDISP
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
         ORDER BY YEA_FAMI_SEQ,YEA_MEDI_SEQ;
	]]>
	</select>             
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT05" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT05.연말정산처리  */
               B.COMD_CDNM AS YEA_DOS_NAME      /* 기부유형명 */
             , A.YEA_DOS_STR006                 /* 기부유형코드 */
             , A.YEA_DOS_STR009                 /* 기부내용 */
             , A.YEA_DOS_STR007                 /* 상호 */
             , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR008) AS YEA_DOS_STR008  /* 사업자번호 */
             , A.YEA_DOS_STR005                 /* 기부자관계코드 */
             , A.YEA_DOS_STR002                 /* 기부자명 */
             , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR003) AS YEA_DOS_STR003  /* 주민등록번호 */
             , A.YEA_DOS_NUM001                 /* 기부건수 */
             , A.YEA_DOS_NUM002                 /* 기부액 */
          FROM YEA_DONASP A
     LEFT JOIN TM_CODEXD  B
            ON B.COMM_CODE = 'DOTE_CODE'
           AND B.COMD_CODE = A.YEA_DOS_STR006
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
         ORDER BY YEA_FAMI_SEQ,YEA_DONA_SEQ;
	]]>
	</select>  
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT06" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT06.연말정산처리  */
               '합 계'                                                        AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
        UNION ALL
        SELECT '본 인'                                                        AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '1'
        UNION ALL
        SELECT '배우자'                                                       AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '2'
        UNION ALL
        SELECT '직계비속'                                                      AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '3'
        UNION ALL
        SELECT '직계존속'                                                      AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '4'
        UNION ALL
        SELECT '형제자매'                                                      AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '5'
        UNION ALL
        SELECT '그 외'                                                        AS YEA_DOS_STR005
              ,SUM(YEA_DOS_NUM002)                                          AS YEA_DOS_SUM
              ,SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_10
              ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_20
              ,SUM(CASE WHEN YEA_DOS_STR006 = '40' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_40
              ,SUM(CASE WHEN YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_41
              ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_42
              ,SUM(CASE WHEN YEA_DOS_STR006 = '50' THEN YEA_DOS_NUM002 END) AS YEA_DOS_SUM_50
          FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
          AND YEA_DOS_STR005 = '6';                    
	]]>
	</select>                          
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT07" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT07.연말정산처리  */
               YEA_DONA_SEQ     /* 기부금순번 */
              ,YEA_DOA_STR001   /* 기부유형코드 */
              ,YEA_DOA_STR002   /* 기부년도 */
              ,YEA_DOA_NUM001   /* 기부금 */
              ,YEA_DOA_NUM002   /* 기부금기공제액 */
              ,YEA_DOA_NUM003   /* 기부금공제대상액 */
              ,YEA_DOA_NUM004   /* 기부금공제액 */
              ,YEA_DOA_NUM005   /* 기부금소멸액 */
              ,YEA_DOA_NUM006   /* 기부금이월액 */
         FROM YEA_DONAAD
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
        ORDER BY YEA_DOA_STR001,YEA_DOA_STR002                        
	]]>
	</select>                               
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT08" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        SELECT /* YEAA0070_2015.PRINT08.연말정산처리  */
               #YEA_STD_YY#                                                  AS YEA_STD_YY        /* 귀속년도 */
              ,A.YEA_EMP_NO                                                                       /* 사번 */
              ,B.YEA_BRANCH_NM                                                                    /* 사업장명 */
              ,B.YEA_BIZ_NO                                                                       /* 사업자번호 */
              ,A.YEA_EMP_NM                                                                       /* 사원명 */
              ,SUBSTR(A.YEA_EMP_SSN,1,6) || '-' || SUBSTR(A.YEA_EMP_SSN,7,7) AS YEA_EMP_SSN       /* 주민등혹번호 */
              ,TO_CHAR(C.YEA_FAMI_CNT) || ' 명'                               AS YEA_FAMI_CNT
              ,B.YEA_CORP_MASTER                                                                  /* 대표자명 */
              ,B.YEA_ADDRESS1 || B.YEA_ADDRESS2                              AS YEA_ADDRESS       /* 근무처주소 */
              ,A.YEA_HIRE_YMD                                                                     /* 입사일 */
              ,A.YEA_QUIT_YMD                                                                     /* 퇴사일 */
              ,NVL(A.YEA_LOFO_CD, '1')                                       AS YEA_LOFO_CD       /* 내외국인구분 */
              ,NVL(SF_YEA_COMMNAME('YEA_90003', A.YEA_NATION_CD), '대한민국')   AS YEA_NATION_NM     /* 국적 */
              ,NVL(A.YEA_NATION_CD, 'KR')                                    AS YEA_NATION_CD     /* 국적코드 */
              ,TO_CHAR(C.YEA_CHILD_CNT) || ' 명'                              AS YEA_CHILD_CNT     /* 20세이하 자녀의 수 */
              ,'2'                                                           AS YEA_EXEMPT_CD     /* 감면적용여부 */
              ,''                                                            AS YEA_EXEMPT_RULE   /* 감면규정 */
              ,''                                                            AS YEA_EXEMPT_SDATE  /* 감면시작일 */
              ,''                                                            AS YEA_EXEMPT_EDATE  /* 감면종료일 */
          FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) A
     LEFT JOIN VI_YEA_DEPTXM D
            ON A.YEA_DEPT_CD = D.YEA_DEPT_CD
    INNER JOIN (SELECT *
                  FROM VI_YEA_BRCHXM A
                 WHERE A.YEA_BRANCH_YMD = (SELECT MAX(YEA_BRANCH_YMD)
                                             FROM VI_YEA_BRCHXM
                                            WHERE YEA_BRANCH_CD = A.YEA_BRANCH_CD
                                              AND YEA_BRANCH_YMD <= #YEA_STD_YY# || '1231'
                                           )
               ) B
            ON D.YEA_BRANCH_CD = B.YEA_BRANCH_CD
    LEFT JOIN (SELECT YEA_EMP_NO
                     ,COUNT(YEA_FAMI_SEQ) AS YEA_FAMI_CNT
                     ,SUM(CASE WHEN YEA_FAM_STR005 ='1' AND YEA_FAM_STR001 IN ('4', '8') THEN 1 ELSE 0 END) AS YEA_CHILD_CNT
                 FROM YEA_YEFAMI
                WHERE YEA_STD_YY = #YEA_STD_YY#
             GROUP BY YEA_EMP_NO
              ) C
           ON A.YEA_EMP_NO = C.YEA_EMP_NO
        WHERE A.YEA_EMP_NO = #YEA_EMP_NO#
	]]>
	</select>                         
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT09" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
          SELECT /* YEAA0070_2015.PRINT09.연말정산처리  */
                 A.YEA_EMP_NO
                ,B.YEA_PAY_YYMM                                                          /* 지급년월 */
                ,B.YEA_PAY_NUM001 + B.YEA_PAY_NUM002                 AS YEA_PAY_SUM001   /* 지급금액 */
                ,B.YEA_PAY_NUM003                                                        /* 상여금액 */
                ,B.YEA_PAY_NUM004                                                        /* 인정상 */
                ,B.YEA_PAY_NUM005                                                        /* 주식매수선택권행사이익 */
                ,B.YEA_PAY_NUM006                                                        /* 우리사주조합인출금 */
                ,B.YEA_PAY_NUM007                                                        /* 임원 퇴직소득금액 한도초과액 */
                ,NVL(B.YEA_PAY_NUM001,0) + NVL(B.YEA_PAY_NUM002,0) + NVL(B.YEA_PAY_NUM003,0)
                 + NVL(B.YEA_PAY_NUM004,0) + NVL(B.YEA_PAY_NUM005,0) + NVL(B.YEA_PAY_NUM006,0)
                 + NVL(B.YEA_PAY_NUM007,0)                           AS YEA_PAY_SUM002   /* 총지급액 */
                ,B.YEA_PAY_NUM015                                                        /* 소득세 */
                ,NVL(B.YEA_PAY_STR001,'')                            AS YEA_PAY_STR001   /* 국외근로지급연월 */
                ,B.YEA_PAY_NUM008                                                        /* 국외근로외화금액 */
                ,B.YEA_PAY_NUM009                                                        /* 국외근로원화금액 */
                ,B.YEA_PAY_NUM010                                                        /* 야간근로비과세 */
                ,B.YEA_PAY_NUM011                                                        /* 출산보육비과세 */
                ,B.YEA_PAY_NUM012                                                        /* 연구활동비과세 */
                ,B.YEA_PAY_NUM013                                                        /* 기타비과세액 */
                ,NVL(B.YEA_PAY_NUM009,0) + NVL(B.YEA_PAY_NUM010,0) + NVL(B.YEA_PAY_NUM011,0)
                 + NVL(B.YEA_PAY_NUM012,0)                           AS YEA_PAY_SUM003   /* 비과세합계 */
                ,B.YEA_PAY_NUM014                                                        /* 감면세액 */
                ,B.YEA_PAY_NUM016                                                        /* 주민세 */
                ,B.YEA_PAY_NUM017                                                        /* 농특세 */
                ,B.YEA_PAY_NUM018                                                        /* 납부특례세액_소득세 */
                ,B.YEA_PAY_NUM019                                                        /* 납부특례세액_지방소득세 */
                ,B.YEA_PAY_NUM020                                                        /* 납부특례세액_농특세 */
                ,B.YEA_PAY_NUM021                                                        /* 국민연금 */
                ,B.YEA_PAY_NUM022                                                        /* 건강보험 */
                ,B.YEA_PAY_NUM023                                                        /* 고용보험 */
                ,NVL(B.YEA_PAY_NUM024,0) + NVL(B.YEA_PAY_NUM025,0)   AS YEA_PAY_SUM004   /* 기부금합 */
                ,B.YEA_PAY_STR002                                                        /* 비과세내용 */
            FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) A
            INNER JOIN YEA_PAYDTL B
              ON A.YEA_EMP_NO = B.YEA_EMP_NO
           WHERE B.YEA_STD_YY = #YEA_STD_YY#
             AND A.YEA_EMP_NO = #YEA_EMP_NO#
        ORDER BY B.YEA_PAY_YYMM ASC 
	]]>
	</select>        
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT10" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
            SELECT /* YEAA0070_2015.PRINT10.연말정산처리  */
                   B.YEA_EMP_NO
                  ,NVL(B.YEA_LIVE_CD, '1') AS YEA_LIVE_CD  /* 거주구분 */
                  ,B.YEA_LOFO_CD        /* 내외국인 */
                  ,SF_YEA_COMMNAME('YEA_90003',B.YEA_LIVE_NATION_CD) AS YEA_LIVE_NATION_NM  /* 거주지국명 */
                  ,B.YEA_LIVE_NATION_CD /*  거주지국코드 */
                  ,DECODE(B.YEA_RATE_YN,'1','1','0','2','') AS YEA_RATE_YN  /* 단일세율 */
                  ,SF_YEA_COMMNAME('YEA_90003',YEA_NATION_CD) AS YEA_NATION_NM  /* 국적명 */
                  ,B.YEA_NATION_CD      /* 국적코드 */
                  ,C.YEA_INC_STR024     /* 세대주여부 */
                  ,A.YEA_PRC_STR002     /* 정산구분 */
                  ,D.YEA_BRANCH_NM      /* YEA_사업장명 */
                  ,D.YEA_CORP_MASTER    /* YEA_사업장대표 */
                  ,D.YEA_BIZ_NO         /* YEA_사업자번호 */
                  ,D.YEA_CORP_NO        /* YEA_법인번호 */
                  ,D.YEA_ADDRESS1 || ' ' || D.YEA_ADDRESS2 AS YEA_ADDRESS   /* YEA_주소 */
                  ,B.YEA_EMP_NM         /* 사원명 */
                  ,B.YEA_EMP_SSN        /* 주민번호 */
                  ,B.YEA_HOME_ADDRESS1 || ' ' || B.YEA_HOME_ADDRESS2 AS YEA_HOME_ADDRESS   /* 집주소 */
                  ,SF_YEA_COMMNAME('YEA_90002', D.YEA_TAXOFFIC_CD) AS YEA_TAXOFFIC_NAME    /* 관할세무서명 */
                  ,CASE WHEN B.YEA_HIRE_YMD < A.YEA_STD_YY || '0101' THEN TO_CHAR(A.YEA_STD_YY || '0101') ELSE TO_CHAR(YEA_HIRE_YMD) END AS YEA_HIRE_YMD   /* 입사일 */
                  ,CASE WHEN NVL(B.YEA_QUIT_YMD,'29991231') > A.YEA_STD_YY || '1231' THEN TO_CHAR(#YEA_STD_YY# || '1231') ELSE  TO_CHAR(B.YEA_QUIT_YMD) END AS YEA_QUIT_YMD   /* 퇴사일 */
                  ,C.YEA_INC_STR002     /* 감면기간시작일 */
                  ,C.YEA_INC_STR003     /* 감면기간종료일 */
                  ,E.YEA_PAY_SUM001     /* (현)지급액 합계 */
                  ,E.YEA_PAY_NUM003     /* (현)상여금 */
                  ,E.YEA_PAY_NUM004     /* (현)인정상여 */
                  ,E.YEA_PAY_NUM005     /* (현)주식매수선택권행사이 */
                  ,E.YEA_PAY_NUM006     /* (현)우리사주조합인출금 */
                  ,E.YEA_PAY_NUM007     /* (현)임원 퇴직소득금액 한도초과액 */
                  ,E.YEA_PAY_SUM002     /* (현)총지급액합계 */
                  ,E.YEA_PAY_NUM009     /* (현)국외근로원화금 */
                  ,E.YEA_PAY_NUM010     /* (현)야간근로비과세 */
                  ,E.YEA_PAY_NUM011     /* (현)출산보육비과세 */
                  ,E.YEA_PAY_NUM012     /* (현)연구활동비과세 */
                  ,E.YEA_PAY_NUM026     /* (현)교육수당[교류재단] */
                  ,E.YEA_PAY_NUM013     /* (현)기타비과세액 */
                  ,E.YEA_PAY_NUM014     /* (현)감면세액 */
                  ,E.YEA_PAY_SUM003     /* (현)비과세합계 */
                  ,F.YEA_BFW_STR002_1   /* (종)사업자상호_1 */
                  ,F.YEA_BIZ_NO_1       /* (종)사업자번호_1 */
                  ,F.YEA_BFW_STR003_1   /* (종)입사일_1 */
                  ,F.YEA_BFW_STR004_1   /* (종)퇴사일_1 */
                  ,F.YEA_BFW_STR005_1   /* (종)감면기간시작일_1 */
                  ,F.YEA_BFW_STR006_1   /* (종)감면기간종료일_1 */
                  ,F.YEA_BFW_NUM001_1   /* (종)지급금액_1 */
                  ,F.YEA_BFW_NUM002_1   /* (종)상여금액_1 */
                  ,F.YEA_BFW_NUM003_1   /* (종)인정상여_1 */
                  ,F.YEA_BFW_NUM004_1   /* (종)주식매수선택권행사이익_1 */
                  ,F.YEA_BFW_NUM005_1   /* (종)우리사주조합인출금_1 */
                  ,F.YEA_BFW_NUM006_1   /* (종)임원 퇴직소득금액 한도초과액_1 */
                  ,F.YEA_BFW_SUM001_1   /* (종)총지급액_1 */
                  ,F.YEA_FORE_AMT1      /* (종)국외근로1 */
                  ,F.YEA_NIGH_NTAX1     /* (종)야간근로수당1 */
                  ,F.YEA_REAR_NTAX1     /* (종)출산보육수당1 */
                  ,F.YEA_NTAX_18_41     /* (종)연구보조비1 */
                  ,F.YEA_NTAX_18_51     /* (종)학자금1 */
                  ,F.YEA_NTAX_18_61     /* (종)취재수당1 */
                  ,F.YEA_NTAX_18_71     /* (종)그외비과세1 */
                  ,F.YEA_NTAX_18_251    /* (종)조세조약교직자소득세감면1 */
                  ,F.YEA_NTAX_19_1      /* (종)수련보조수당1 */
                  ,F.YEA_REDU_TOT1      /* (종)감면소득계1 */
                  ,F.YEA_NTAX_TOT1      /* (종)비과세계1 */
                  ,F.YEA_BFW_STR002_2   /* (종)사업자상호_2 */
                  ,F.YEA_BIZ_NO_2       /* (종)사업자번호_2 */
                  ,F.YEA_BFW_STR003_2   /* (종)입사일_2 */
                  ,F.YEA_BFW_STR004_2   /* (종)퇴사일_2 */
                  ,F.YEA_BFW_STR005_2   /* (종)감면기간시작일_2 */
                  ,F.YEA_BFW_STR006_2   /* (종)감면기간종료일_2 */
                  ,F.YEA_BFW_NUM001_2   /* (종)지급금액_2 */
                  ,F.YEA_BFW_NUM002_2   /* (종)상여금액_2 */
                  ,F.YEA_BFW_NUM003_2   /* (종)인정상여_2 */
                  ,F.YEA_BFW_NUM004_2   /* (종)주식매수선택권행사이익_2 */
                  ,F.YEA_BFW_NUM005_2   /* (종)우리사주조합인출금_2 */
                  ,F.YEA_BFW_NUM006_2   /* (종)임원 퇴직소득금액 한도초과액_2 [2013귀속] */
                  ,F.YEA_BFW_SUM001_2   /* (종)총지급액_2 */
                  ,F.YEA_FORE_AMT2      /* (종)국외근로2 */
                  ,F.YEA_NIGH_NTAX2     /* (종)야간근로수당2 */
                  ,F.YEA_REAR_NTAX2     /* (종)출산보육수당2 */
                  ,F.YEA_NTAX_18_42     /* (종)연구보조비2 */
                  ,F.YEA_NTAX_18_52     /* (종)학자금2 */
                  ,F.YEA_NTAX_18_62     /* (종)취재수당2 */
                  ,F.YEA_NTAX_18_72     /* (종)그외비과세2 */
                  ,F.YEA_NTAX_18_252    /* (종)조세조약교직자소득세감면2 */
                  ,F.YEA_NTAX_19_2      /* (종)수련보조수당2 */
                  ,F.YEA_REDU_TOT2      /* (종)감면소득계2 */
                  ,F.YEA_NTAX_TOT2      /* (종)비과세계2 */
                  ,F.YEA_BFW_STR002_3   /* (종)사업자상호_3 */
                  ,F.YEA_BIZ_NO_3       /* (종)사업자번호_3 */
                  ,F.YEA_BFW_STR003_3   /* (종)입사일_3 */
                  ,F.YEA_BFW_STR004_3   /* (종)퇴사일_3 */
                  ,F.YEA_BFW_STR005_3   /* (종)감면기간시작일_3 */
                  ,F.YEA_BFW_STR006_3   /* (종)감면기간종료일_3 */
                  ,F.YEA_BFW_NUM001_3   /* (종)지급금액_3 */
                  ,F.YEA_BFW_NUM002_3   /* (종)상여금액_3 */
                  ,F.YEA_BFW_NUM003_3   /* (종)인정상여_3 */
                  ,F.YEA_BFW_NUM004_3   /* (종)주식매수선택권행사이익_3 */
                  ,F.YEA_BFW_NUM005_3   /* (종)우리사주조합인출금_3 */
                  ,F.YEA_BFW_NUM006_3   /* (종)임원 퇴직소득금액 한도초과액_3 */
                  ,F.YEA_BFW_SUM001_3   /* (종)총지급액_3 */
                  ,F.YEA_FORE_AMT3      /* (종)국외근로3 */
                  ,F.YEA_NIGH_NTAX3     /* (종)야간근로수당3 */
                  ,F.YEA_REAR_NTAX3     /* (종)출산보육수당3 */
                  ,F.YEA_NTAX_18_43     /* (종)연구보조비3 */
                  ,F.YEA_NTAX_18_53     /* (종)학자금3 */
                  ,F.YEA_NTAX_18_63     /* (종)취재수당3 */
                  ,F.YEA_NTAX_18_73     /* (종)그외비과세3 */
                  ,F.YEA_NTAX_18_253    /* (종)조세조약교직자소득세감면3 */
                  ,F.YEA_NTAX_19_3      /* (종)수련보조수당3 */
                  ,F.YEA_REDU_TOT3      /* (종)감면소득계3 */
                  ,F.YEA_NTAX_TOT3      /* (종)비과세계3 */
                  ,A.YEA_PRC_NUM083     /* 결정세액_소득세 */
                  ,A.YEA_PRC_NUM084     /* 결정세액_주민세 */
                  ,A.YEA_PRC_NUM085     /* 결정세액_농특세 */
                  ,F.YEA_INCO_AMT1      /* (종)기납부세액소득세1 */
                  ,F.YEA_JUMI_AMT1      /* (종)기납부세액주민세1 */
                  ,F.YEA_FARM_AMT1      /* (종)기납부세액농특세1 */
                  ,F.YEA_INCO_AMT2      /* (종)기납부세액소득세2 */
                  ,F.YEA_JUMI_AMT2      /* (종)기납부세액주민세2 */
                  ,F.YEA_FARM_AMT2      /* (종)기납부세액농특세2 */
                  ,F.YEA_INCO_AMT3      /* (종)기납부세액소득세3 */
                  ,F.YEA_JUMI_AMT3      /* (종)기납부세액주민세3 */
                  ,F.YEA_FARM_AMT3      /* (종)기납부세액농특세3 */
                  ,A.YEA_PRC_NUM089     /* 주근무지소득세 */
                  ,A.YEA_PRC_NUM090     /* 주근무지주민세 */
                  ,A.YEA_PRC_NUM091     /* 주근무지농특세 */
                  ,A.YEA_PRC_NUM095     /* 납부특례소득세 */
                  ,A.YEA_PRC_NUM096     /* 납부특례주민세 */
                  ,A.YEA_PRC_NUM097     /* 납부특례농특세 */
                  ,A.YEA_PRC_NUM092     /* 차감징수소득세 */
                  ,A.YEA_PRC_NUM093     /* 차감징수주민세 */
                  ,A.YEA_PRC_NUM094     /* 차감징수농특세 */
                  ,A.YEA_PRC_NUM001     /* 총급여 */
                  ,A.YEA_PRC_NUM002     /* 근로소득공제 */
                  ,A.YEA_PRC_NUM003     /* 근로소득금액 */
                  ,A.YEA_PRC_NUM004     /* 기본공제_본인 */
                  ,A.YEA_PRC_NUM005     /* 기본공제_배우자 */
                  ,A.YEA_PRC_NUM006     /* 기본공제_부양가족 수 */
                  ,A.YEA_PRC_NUM007     /* 기본공제_부양가족 */
                  ,A.YEA_PRC_NUM008     /* 추가공제_경로우대 수 */
                  ,A.YEA_PRC_NUM009     /* 추가공제_경로우대 */
                  ,A.YEA_PRC_NUM010     /* 추가공제_장애인 수 */
                  ,A.YEA_PRC_NUM011     /* 추가공제_장애인 */
                  ,A.YEA_PRC_NUM012     /* 추가공제_부녀자 */
                  ,A.YEA_PRC_NUM013     /* 추가공제_한부모 */
                  ,A.YEA_PRC_NUM014     /* 국민연금보험료공제 */
                  ,A.YEA_PRC_NUM015     /* 기타연금보험료공제(공무원연금) */
                  ,A.YEA_PRC_NUM016     /* 기타연금보험료공제(군인연금) */
                  ,A.YEA_PRC_NUM017     /* 기타연금보험료공제(사립학교) */
                  ,A.YEA_PRC_NUM018     /* 기타연금보험료공제(별정우체국) */
                  ,A.YEA_PRC_NUM019     /* 보험료(건강보험료) */
                  ,A.YEA_PRC_NUM020     /* 보험료(고용보험료) */
                  ,A.YEA_PRC_NUM021     /* 주택임차차입금상환(대출기관) */
                  ,A.YEA_PRC_NUM022     /* 주택임차차입금상환(거주자) */
                  ,A.YEA_PRC_NUM023     /* 장기주택저당차입금_2011년이전(15년미만) */
                  ,A.YEA_PRC_NUM024     /* 장기주택저당차입금 _2011년이전(15년~29년) */
                  ,A.YEA_PRC_NUM025     /* 장기주택저당차입금_2011년이전(30년이상) */
                  ,A.YEA_PRC_NUM026     /* 장기주택저당차입금_2012년이후(고정금리,비거치상환대출) */
                  ,A.YEA_PRC_NUM027     /* 장기주택저당차입금_2012년이후(기타대출) */
                  ,A.YEA_PRC_NUM104     /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이면서,비거치)*/
                  ,A.YEA_PRC_NUM105     /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이거나,비거치)*/
                  ,A.YEA_PRC_NUM106     /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(기타대출)*/
                  ,A.YEA_PRC_NUM107     /*[2015귀속]_추가 장기주택저당차입금_2015년이후_10~15년 (고정금리이거나,비거치)*/
                  ,A.YEA_PRC_NUM028     /* 기부금(이월분) */
                  ,A.YEA_PRC_NUM029     /* 특별공제계 */
                  ,A.YEA_PRC_NUM030     /* 차감소득금액 */
                  ,A.YEA_PRC_NUM031     /* 개인연금저축 */
                  ,A.YEA_PRC_NUM032     /* 소기업·소상공인 공제부금 */
                  ,A.YEA_PRC_NUM033     /* 청약저축 */
                  ,A.YEA_PRC_NUM034     /* 주택청약종합저축 */
                  ,A.YEA_PRC_NUM035     /* 근로자주택마련저축 */
                  ,A.YEA_PRC_NUM036     /* 투자조합출자 등 */
                  ,A.YEA_PRC_NUM037     /* 신용카드 등 사용액 */
                  ,A.YEA_PRC_NUM038     /* 우리사주조합 출연금 */
                  ,A.YEA_PRC_NUM040     /* 고용유지 중소기업 근로자 */
                  ,A.YEA_PRC_NUM041     /* 목돈 안 드는 전세 이자상환액 */
                  ,A.YEA_PRC_NUM042     /* 장기집합투자증권저축 */
                  ,A.YEA_PRC_NUM043     /* 그 박의 소득공제 계 */
                  ,A.YEA_PRC_NUM044     /* 소득공제 종합한도 초과액 */
                  ,A.YEA_PRC_NUM045     /* 종합소득 과세표준 */
                  ,A.YEA_PRC_NUM046     /* 산출세액 */
                  ,A.YEA_PRC_NUM047     /* 세액감면_소득세법 */
                  ,A.YEA_PRC_NUM048     /* 세액감면_조세특례제한법 */
                  ,A.YEA_PRC_NUM049     /* 세액감면_조세특례제한법 제30조 */
                  ,A.YEA_PRC_NUM050     /* 조세조약 */
                  ,A.YEA_PRC_NUM051     /* 세액감면 계 */
                  ,A.YEA_PRC_NUM052     /* 세액공제_근로소득 */
                  ,A.YEA_PRC_NUM053     /* 자녀수 */
                  ,A.YEA_PRC_NUM054     /* 세액공제_자녀 */
                  ,A.YEA_PRC_NUM055     /* 과학기술인공제_공제대상금액 */
                  ,A.YEA_PRC_NUM056     /* 과학기술인공제_세액공제액 */
                  ,A.YEA_PRC_NUM057     /* 근로자퇴직급여보장법_공제대상금액 */
                  ,A.YEA_PRC_NUM058     /* 근로자퇴직급여보장법_세액공제액 */
                  ,A.YEA_PRC_NUM059     /* 연금저축_공제대상금액 */
                  ,A.YEA_PRC_NUM060     /* 연금저축_세액공제액 */
                  ,A.YEA_PRC_NUM061     /* 보장성보험료_공제대상금액 */
                  ,A.YEA_PRC_NUM062     /* 보장성보험료_세액공제액 */
                  ,A.YEA_PRC_NUM063     /* 의료비_공제대상금액 */
                  ,A.YEA_PRC_NUM064     /* 의료비_세액공제액 */
                  ,A.YEA_PRC_NUM065     /* 교육비_공제대상금액 */
                  ,A.YEA_PRC_NUM066     /* 교육비_세액공제액 */
                  ,A.YEA_PRC_NUM067     /* 정치자금기부금_10만원이하_공제대상금액 */
                  ,A.YEA_PRC_NUM068     /* 정치자금기부금_10만원이하_세액공제액 */
                  ,A.YEA_PRC_NUM069     /* 정치자금기부금_10만원초과_공제대상금액 */
                  ,A.YEA_PRC_NUM070     /* 정치자금기부금_10만원초과_세액공제액 */
                  ,A.YEA_PRC_NUM071     /* 법정기부금_공제대상금액 */
                  ,A.YEA_PRC_NUM072     /* 법정기부금_세액공제액 */
                  ,A.YEA_PRC_NUM039     /* [2015귀속]_이동 우리사주조합기부금_공제대상금액 */
                  ,A.YEA_PRC_NUM108     /* [2015귀속]_추가 우리사주조합기부금_세액공제액 */
                  ,A.YEA_PRC_NUM073     /* 지정기부금_공제대상금액 */
                  ,A.YEA_PRC_NUM074     /* 지정기부금_세액공제액 */
                  ,A.YEA_PRC_NUM075     /* 특별세액공제 계 */
                  ,A.YEA_PRC_NUM076     /* 표준세액공제 */
                  ,A.YEA_PRC_NUM077     /* 납세조합공제 */
                  ,A.YEA_PRC_NUM078     /* 주택차입금 */
                  ,A.YEA_PRC_NUM079     /* 외국납부 */
                  ,A.YEA_PRC_NUM080     /* 월세세액공제_공제대상금액 */
                  ,A.YEA_PRC_NUM081     /* 월세세액공제_세액공제액 */
                  ,A.YEA_PRC_NUM082     /* 세액공제 계 */
                  ,G.YEA_FAM_CNT001     /* 기본공제여부 */
                  ,G.YEA_FAM_CNT002     /* 부녀자여부 */
                  ,G.YEA_FAM_CNT003     /* 한부모여부 */
                  ,G.YEA_FAM_CNT004     /* 경로자여부 */
                  ,G.YEA_FAM_CNT005     /* 장애자여부 */
                  ,G.YEA_FAM_SUM001     /* 보험료_건강고용_국세청 */
                  ,G.YEA_FAM_SUM002     /* 보험료_건강고용_기타 */
                  ,G.YEA_FAM_SUM003     /* 보험료_보장성_국세청 */
                  ,G.YEA_FAM_SUM004     /* 보험료_보장성_기타 */
                  ,G.YEA_FAM_SUM005     /* 의료비_국세청 */
                  ,G.YEA_FAM_SUM006     /* 의료비_기타 */
                  ,G.YEA_FAM_SUM007     /* 교육비_국세청 */
                  ,G.YEA_FAM_SUM008     /* 교육비_기타 */
                  ,G.YEA_FAM_SUM009     /* 신용카드_국세청 */
                  ,G.YEA_FAM_SUM010     /* 신용카드_기타 */
                  ,G.YEA_FAM_SUM011     /* 직불카드_국세청 */
                  ,G.YEA_FAM_SUM012     /* 직불카드_기타 */
                  ,G.YEA_FAM_SUM013     /* 현금영수증_국세청 */
                  ,G.YEA_FAM_SUM014     /* 전통시장_국세청 */
                  ,G.YEA_FAM_SUM015     /* 전통시장_기타 */
                  ,G.YEA_FAM_SUM016     /* 대중교통_국세청 */
                  ,G.YEA_FAM_SUM017     /* 대중교통_기타 */
                  ,G.YEA_FAM_SUM018     /* 기부금_국세청 */
                  ,G.YEA_FAM_SUM019     /* 기부금_기타 */
                  /* 귀속년도2014년 연말정산 재정산(소급) */
                  ,G.YEA_FAM_CNT011     /* 6세이하 합계 */
                  ,G.YEA_FAM_CNT012     /* 출산입양 합계 */
                  ,G.YEA_FAM_SUM020     /* 보험료_장애인전용_국세청 합계 */
                  ,G.YEA_FAM_SUM021     /* 보험료 장애인전용_기타 합계 */
                  ,A.YEA_PRC_NUM098     /* 세액공제_6세이하 수 */
                  ,A.YEA_PRC_NUM099     /* 세액공제_6세이하 */
                  ,A.YEA_PRC_NUM100     /* 세액공제_출산 입양 수 */
                  ,A.YEA_PRC_NUM101     /* 세액공제_출산 입양 */
                  ,A.YEA_PRC_NUM102     /* 장애인전용보험료_공제대상금액 */
                  ,A.YEA_PRC_NUM103     /* 장애인전용보험료_세액공제액 */
                  ,E.YEA_PAY_SUM022     /* 건강보험료 합 */
                  ,E.YEA_PAY_SUM021     /* 국민연금 합 */
                  ,E.YEA_PAY_SUM023     /* 고용보험료 합 */
                FROM YEA_YEPROC A
          INNER JOIN TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) B
                  ON A.YEA_EMP_NO = B.YEA_EMP_NO
          INNER JOIN YEA_INCDEC C
                  ON A.YEA_STD_YY = C.YEA_STD_YY
                 AND A.YEA_EMP_NO = C.YEA_EMP_NO
          INNER JOIN VI_YEA_BRCHXM D
                  ON YEA_BRANCH_CD = '100'
           LEFT JOIN
                   (
                    SELECT YEA_EMP_NO
                          ,SUM(YEA_PAY_NUM001) + SUM(YEA_PAY_NUM002) AS YEA_PAY_SUM001   /* (현)지급액합계 */
                          ,SUM(YEA_PAY_NUM003) AS YEA_PAY_NUM003                         /* (현)상여금액 */
                          ,SUM(YEA_PAY_NUM004) AS YEA_PAY_NUM004                         /* (현)인정상여 */
                          ,SUM(YEA_PAY_NUM005) AS YEA_PAY_NUM005                         /* (현)주식매수선택권행사이익 */
                          ,SUM(YEA_PAY_NUM006) AS YEA_PAY_NUM006                         /* (현)우리사주조합인출금 */
                          ,SUM(YEA_PAY_NUM007) AS YEA_PAY_NUM007                         /* (현)임원 퇴직소득금액 한도초과액 */
                          ,SUM(NVL(YEA_PAY_NUM001,0) + NVL(YEA_PAY_NUM002,0) + NVL(YEA_PAY_NUM003,0)
                           + NVL(YEA_PAY_NUM004,0) + NVL(YEA_PAY_NUM005,0) + NVL(YEA_PAY_NUM006,0)
                           + NVL(YEA_PAY_NUM007,0)) AS YEA_PAY_SUM002                    /* (현)총지급액합계 */
                          ,SUM(YEA_PAY_NUM009) AS YEA_PAY_NUM009                         /* (현)국외근로원화금 */
                          ,SUM(YEA_PAY_NUM010) AS YEA_PAY_NUM010                         /* (현)야간근로비과세 */
                          ,SUM(YEA_PAY_NUM011) AS YEA_PAY_NUM011                         /* (현)출산보육비과세 */
                          ,SUM(YEA_PAY_NUM012) AS YEA_PAY_NUM012                         /* (현)연구활동비과세 */
                          ,SUM(YEA_PAY_NUM026) AS YEA_PAY_NUM026                         /* (현)교육수당[교류재단] */
                          ,0 AS YEA_PAY_NUM013                                           /* (현)기타비과세액 */
                          ,SUM(YEA_PAY_NUM014) AS YEA_PAY_NUM014                         /* (현)감면세액 */
                          ,SUM(NVL(YEA_PAY_NUM009,0) + NVL(YEA_PAY_NUM010,0) + NVL(YEA_PAY_NUM011,0)
                           + NVL(YEA_PAY_NUM012,0) + NVL(YEA_PAY_NUM026,0) + NVL(YEA_PAY_NUM027,0)) AS YEA_PAY_SUM003   /* (현)비과세합계 */
                           /* 귀속년도2014년 연말정산 재정산(소급) */
                           ,SUM(NVL(YEA_PAY_NUM022,0)) AS YEA_PAY_SUM022                 /* 건강보험료 합 */
                           ,SUM(NVL(YEA_PAY_NUM021,0)) AS YEA_PAY_SUM021                 /* 국민연금 합 */
                           ,SUM(NVL(YEA_PAY_NUM023,0)) AS YEA_PAY_SUM023                 /* 고용보험료 합 */
                      FROM YEA_PAYDTL
                     WHERE YEA_STD_YY = #YEA_STD_YY#
                  GROUP BY YEA_EMP_NO
                    ) E
                  ON A.YEA_EMP_NO = E.YEA_EMP_NO
           LEFT JOIN
                   (
                    SELECT A.YEA_EMP_NO
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_1                 /* (종)사업자상호_1 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_1                         /* (종)사업자번호_1 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_1                 /* (종)입사일_1 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_1                 /* (종)퇴사일_1 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_1                 /* (종)감면기간시작일_1 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_1                 /* (종)감면기간종료일_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_1   /* (종)지급금액_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_1   /* (종)상여금액_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_1   /* (종)인정상여_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_1   /* (종)주식매수선택권행사이익_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_1   /* (종)우리사주조합인출금_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_1   /* (종)임원 퇴직소득금액 한도초과액_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                          + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                          + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_1                                                          /* (종)총지급액_1 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_41
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_51
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_61
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_71
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_251    /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_1         /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT1
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_2                 /* (종)사업자상호_2 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_2                         /* (종)사업자번호_2 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_2                 /* (종)입사일_2 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_2                 /* (종)퇴사일_2 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_2                 /* (종)감면기간시작일_2 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_2                 /* (종)감면기간종료일_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_2   /* (종)지급금액_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_2   /* (종)상여금액_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_2   /* (종)인정상여_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_2   /* (종)주식매수선택권행사이익_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_2   /* (종)우리사주조합인출금_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_2   /* (종)임원 퇴직소득금액 한도초과액_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                           + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                           + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_2                                                         /* (종)총지급액_2 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_42
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_52
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_62
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_72
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_252    /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_2         /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT2
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_3                 /* (종)사업자상호_3 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_3                         /* (종)사업자번호_3 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_3                 /* (종)입사일_3 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_3                 /* (종)퇴사일_3 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_3                 /* (종)감면기간시작일_3 */
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_3                 /* (종)감면기간종료일_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_3   /* (종)지급금액_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_3   /* (종)상여금액_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_3   /* (종)인정상여_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_3   /* (종)주식매수선택권행사이익_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_3   /* (종)우리사주조합인출금_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_3   /* (종)임원 퇴직소득금액 한도초과액_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                           + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                           + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_3                                                         /* (종)총지급액_3 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_43
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_53
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_63
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_73
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_253    /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_3         /* 2012.12.26 추가 */
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT3
                      FROM (
                            SELECT A.*
                                  ,ROW_NUMBER() OVER (PARTITION BY YEA_BFW_STR001 ORDER BY YEA_BIZ_NO) AS ROW_NUM
                              FROM YEA_BFWORK A
                             WHERE A.YEA_STD_YY = #YEA_STD_YY#
                               AND A.YEA_EMP_NO = #YEA_EMP_NO#
                           ) A
                 LEFT JOIN (
                            SELECT YEA_BIZ_NO
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('M01','M02','M03') THEN YEA_BFN_NUM001 END) AS YEA_FORE_AMT
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'O01' THEN YEA_BFN_NUM001 END) AS YEA_NIGH_NTAX
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'Q01' THEN YEA_BFN_NUM001 END) AS YEA_REAR_NTAX
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('H06','H07','H08','H09','H10') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_4
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'G01' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_5
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'H11' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_6
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('H01','H05','H14','H15','H12','H13','I01','K01','R10','S01','Y02','Y03','Y21','T01','Z01') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_7 /* 2012.12.26 변경 */
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'T20' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_25                           /* 2012.12.26 추가 */
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'Y22' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_19                              /* 2012.12.26 변경 */
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('M01','M02','M03','O01','Q01','H06','H07','H08','H09','H10','G01','H11','H01','H05','H14','H15','H12','H13','I01','K01','R10','S01','Y02','Y03','Y21','Y22') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_TOT /* 2012.12.26 변경 */
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('T01','T10','T20','Z01') THEN YEA_BFN_NUM001 END) AS YEA_REDU_TOT        /* 2012.12.26 추가 */
                              FROM YEA_BFNTAX
                             WHERE YEA_STD_YY = #YEA_STD_YY#
                               AND YEA_EMP_NO = #YEA_EMP_NO#
                          GROUP BY YEA_BIZ_NO
                            ) B
                        ON A.YEA_BIZ_NO = B.YEA_BIZ_NO
                  GROUP BY YEA_EMP_NO
                   ) F
                  ON A.YEA_EMP_NO = F.YEA_EMP_NO
           LEFT JOIN
                   (
                    SELECT YEA_EMP_NO
                          ,SUM(CASE WHEN YEA_FAM_STR005 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT001              /* 기본공제여부 */
                          ,SUM(CASE WHEN YEA_FAM_STR007 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT002              /* 부녀자여부 */
                          ,SUM(CASE WHEN YEA_FAM_STR008 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT003              /* 한부모여부 */
                          ,SUM(CASE WHEN YEA_FAM_STR006 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT004              /* 경로자여부 */
                          ,SUM(CASE WHEN NVL(YEA_FAM_STR009, '0') <> '0' THEN 1 ELSE 0 END) AS YEA_FAM_CNT005   /* 장애자여부 */
                          /* 귀속년도2014년 연말정산 재정산(소급) */
                          ,SUM(CASE WHEN YEA_FAM_STR011 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT011              /* 6세이하여부 */
                          ,SUM(CASE WHEN YEA_FAM_STR012 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT012              /* 출산입양여부 */
                          ,SUM(YEA_FAM_NUM001) AS YEA_FAM_SUM001                                                /* 보험료_건강고용_국세청 */
                          ,SUM(YEA_FAM_NUM002) AS YEA_FAM_SUM002                                                /* 보험료_건강고용_기타 */
                          ,SUM(YEA_FAM_NUM003) AS YEA_FAM_SUM003                                                /* 보험료_보장성_국세청 */
                          ,SUM(YEA_FAM_NUM004) AS YEA_FAM_SUM004                                                /* 보험료_보장성_기타 */
                          /* 귀속년도2014년 연말정산 재정산(소급) */
                          ,SUM(YEA_FAM_NUM020) AS YEA_FAM_SUM020                                                /* 보험료_장애인전용_국세청 */
                          ,SUM(YEA_FAM_NUM021) AS YEA_FAM_SUM021                                                /* 보험료_장애인전용_기타 */
                          ,SUM(YEA_FAM_NUM005) + SUM(YEA_FAM_NUM022) AS YEA_FAM_SUM005                          /* 의료비_국세청   [2015귀속] 난임시술비 추가 */
                          ,SUM(YEA_FAM_NUM006) + SUM(YEA_FAM_NUM023) AS YEA_FAM_SUM006                          /* 의료비_기타     [2015귀속] 난임시술비 추가 */
                          ,SUM(YEA_FAM_NUM007) AS YEA_FAM_SUM007                                                /* 교육비_국세청 */
                          ,SUM(YEA_FAM_NUM008) AS YEA_FAM_SUM008                                                /* 교육비_기타 */
                          ,SUM(YEA_FAM_NUM009) AS YEA_FAM_SUM009                                                /* 신용카드_국세청 */
                          ,SUM(YEA_FAM_NUM010) AS YEA_FAM_SUM010                                                /* 신용카드_기타 */
                          ,SUM(YEA_FAM_NUM011) AS YEA_FAM_SUM011                                                /* 직불카드_국세청 */
                          ,SUM(YEA_FAM_NUM012) AS YEA_FAM_SUM012                                                /* 직불카드_기타 */
                          ,SUM(YEA_FAM_NUM013) AS YEA_FAM_SUM013                                                /* 현금영수증_국세청 */
                          ,SUM(YEA_FAM_NUM014) AS YEA_FAM_SUM014                                                /* 전통시장_국세청 */
                          ,SUM(YEA_FAM_NUM015) AS YEA_FAM_SUM015                                                /* 전통시장_기타 */
                          ,SUM(YEA_FAM_NUM016) AS YEA_FAM_SUM016                                                /* 대중교통_국세청 */
                          ,SUM(YEA_FAM_NUM017) AS YEA_FAM_SUM017                                                /* 대중교통_기타 */
                          ,SUM(YEA_FAM_NUM018) AS YEA_FAM_SUM018                                                /* 기부금_국세청 */
                          ,SUM(YEA_FAM_NUM019) AS YEA_FAM_SUM019                                                /* 기부금_기타 */
                      FROM YEA_YEFAMI
                     WHERE YEA_STD_YY = #YEA_STD_YY#
                  GROUP BY YEA_EMP_NO
                    ) G
                  ON A.YEA_EMP_NO = G.YEA_EMP_NO
                WHERE A.YEA_STD_YY = #YEA_STD_YY#
                  AND A.YEA_EMP_NO = #YEA_EMP_NO#                    
	]]>
	</select>                         
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리
********************************************************************************/
-->
	<select id="YEAA0070_2015.PRINT11" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
            SELECT /* YEAA0070_2015.PRINT11.연말정산처리  */
                   B.YEA_FAM_STR001                                                                                                   /* 가족관계신고코드 */
                  ,B.YEA_FAM_STR002                                                                                                   /* 내외국인구분 */
                  ,B.YEA_FAM_STR003                                                                                                   /* 가족성명 */
                  ,CASE WHEN B.YEA_FAM_STR001 = '0' THEN '(근로자 본인)' ELSE SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004) END AS YEA_FAM_STR004  /* 주민등록번 */
                  ,CASE WHEN B.YEA_FAM_STR005 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR005                                            /* 기본공제여부 */
                  ,CASE WHEN B.YEA_FAM_STR007 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR007                                            /* 부녀자여부 */
                  ,CASE WHEN B.YEA_FAM_STR008 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR008                                            /* 한부모여부 */
                  ,CASE WHEN B.YEA_FAM_STR006 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR006                                            /* 경로자여부 */
                  /* 귀속년도2014년 연말정산 재정산(소급) */
                  ,CASE WHEN B.YEA_FAM_STR011 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR011                                            /* 6세이하 */
                  ,CASE WHEN B.YEA_FAM_STR012 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR012                                            /* 출산입양 */
                  ,CASE WHEN NVL(B.YEA_FAM_STR009, '0') <> '0' THEN B.YEA_FAM_STR009 END AS YEA_FAM_STR009                            /* 장애인코드 */
                  ,B.YEA_FAM_NUM001                                                                                                   /* 보험료_건강고용_국세청 */
                  ,B.YEA_FAM_NUM002                                                                                                   /* 보험료_건강고용_기타 */
                  ,B.YEA_FAM_NUM003                                                                                                   /* 보험료_보장성_국세청 */
                  ,B.YEA_FAM_NUM004                                                                                                   /* 보험료_보장성_기타 */
                  /* 귀속년도2014년 연말정산 재정산(소급) */
                  ,B.YEA_FAM_NUM020                                                                                                   /* 보험료_장애인전용_국세청 */
                  ,B.YEA_FAM_NUM021                                                                                                   /* 보험료_장애인전용_기타 */
                  ,NVL(B.YEA_FAM_NUM005,0) + NVL(B.YEA_FAM_NUM022,0) AS YEA_FAM_NUM005                                                /* 의료비_국세청 [2015귀속] 난임시술비 추가 */
                  ,NVL(B.YEA_FAM_NUM006,0) + NVL(B.YEA_FAM_NUM023,0) AS YEA_FAM_NUM006                                                /* 의료비_기타   [2015귀속] 난임시술비 추가 */
                  ,B.YEA_FAM_NUM007                                                                                                   /* 교육비_국세청 */
                  ,B.YEA_FAM_NUM008                                                                                                   /* 교육비_기타 */
                  ,B.YEA_FAM_NUM009                                                                                                   /* 신용카드_국세청 */
                  ,B.YEA_FAM_NUM010                                                                                                   /* 신용카드_기타 */
                  ,B.YEA_FAM_NUM011                                                                                                   /* 직불카드_국세청 */
                  ,B.YEA_FAM_NUM012                                                                                                   /* 직불카드_기타 */
                  ,B.YEA_FAM_NUM013                                                                                                   /* 현금영수증_국세청 */
                  ,B.YEA_FAM_NUM014                                                                                                   /* 전통시장_국세청 */
                  ,B.YEA_FAM_NUM015                                                                                                   /* 전통시장_기타 */
                  ,B.YEA_FAM_NUM016                                                                                                   /* 대중교통_국세청 */
                  ,B.YEA_FAM_NUM017                                                                                                   /* 대중교통_기타 */
                  ,B.YEA_FAM_NUM018                                                                                                   /* 기부금_국세청 */
                  ,B.YEA_FAM_NUM019                                                                                                   /* 기부금_기타 */
                FROM YEA_INCDEC A
          INNER JOIN YEA_YEFAMI B
                  ON A.YEA_STD_YY = B.YEA_STD_YY
                 AND A.YEA_EMP_NO = B.YEA_EMP_NO
               WHERE A.YEA_STD_YY = #YEA_STD_YY#
                 AND A.YEA_EMP_NO = #YEA_EMP_NO#
            ORDER BY B.YEA_FAMI_SEQ;             
                                 
	]]>
	</select>       
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 부양가족 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE00" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE00.연말정산처리 부양가족 저장 [YEA_가족사항] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*부양가족 저장*/
            INSERT INTO YEA_YEFAMI (
                   YEA_STD_YY
                 , YEA_EMP_NO
                 , YEA_FAMI_SEQ
                 , YEA_FAM_STR001   /*가족관계신고코드*/
                 , YEA_FAM_STR002   /*내외국인구분*/
                 , YEA_FAM_STR003   /*성명*/
                 , YEA_FAM_STR004   /*주민등록번호*/
                 , YEA_FAM_STR005   /*기본공제여부*/
                 , YEA_FAM_STR006   /*경로자여부*/
                 , YEA_FAM_STR007   /*부녀자여부*/
                 , YEA_FAM_STR008   /*한부모여부*/
                 , YEA_FAM_STR009   /*장애자여부*/
                 , YEA_FAM_STR010   /*교육비구분코드*/
                 , YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
               	 , YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                 , YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                 , YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                 , YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                 , YEA_FAM_NUM004   /*보험료_보장성_기타*/
                 , YEA_FAM_NUM005   /*의료비_국세청*/
                 , YEA_FAM_NUM006   /*의료비_기타*/
                 , YEA_FAM_NUM007   /*교육비_국세청*/
                 , YEA_FAM_NUM008   /*교육비_기타*/
                 , YEA_FAM_NUM009   /*신용카드_국세청*/
                 , YEA_FAM_NUM010   /*신용카드_기타*/
                 , YEA_FAM_NUM011   /*직불카드_국세청*/
                 , YEA_FAM_NUM012   /*직불카드_기타*/
                 , YEA_FAM_NUM013   /*현금영수증_국세청*/
                 , YEA_FAM_NUM014   /*전통시장_국세청*/
                 , YEA_FAM_NUM015   /*전통시장_기타*/
                 , YEA_FAM_NUM016   /*대중교통_국세청*/
                 , YEA_FAM_NUM017   /*대중교통_기타*/
                 , YEA_FAM_NUM018   /*기부금_국세청*/
                 , YEA_FAM_NUM019   /*기부금_기타*/
                 , YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                 , YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                 , YEA_FAM_NUM022	/*[2015귀속] 난임시술비_국세청*/
               	 , YEA_FAM_NUM023	/*[2015귀속] 난임시술비_기타*/                 
                 , YEA_INS_DATE
                 , YEA_INS_USER_ID
                 , YEA_UPD_DATE
                 , YEA_UPD_USER_ID
            )
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                 , NVL(MAX(YEA_FAMI_SEQ), 0) + 1  /* 150123 A.YEA_FAMI_SEQ 에서 A. 삭제 */ 
                 , #YEA_FAM_STR001#  /*가족관계신고코드*/
                 , #YEA_FAM_STR002#  /*내외국인구분*/
                 , #YEA_FAM_STR003#  /*성명*/
                 , SF_YEA_ENCRYPT_SSN(#YEA_FAM_STR004#)  /*주민등록번호*/              
                 , #YEA_FAM_STR005#  /*기본공제여부*/
                 , #YEA_FAM_STR006#  /*경로자여부*/
                 , #YEA_FAM_STR007#  /*부녀자여부*/
                 , #YEA_FAM_STR008#  /*한부모여부*/
                 , #YEA_FAM_STR009#  /*장애자여부*/
                 , #YEA_FAM_STR010#  /*교육비구분코드*/
                 , #YEA_FAM_STR011#  /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
              	 , #YEA_FAM_STR012#  /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                 , NVL(#YEA_FAM_NUM001#, 0)   /*보험료_건강고용_국세청*/
                 , NVL(#YEA_FAM_NUM002#, 0)   /*보험료_건강고용_기타*/
                 , NVL(#YEA_FAM_NUM003#, 0)   /*보험료_보장성_국세청*/
                 , NVL(#YEA_FAM_NUM004#, 0)   /*보험료_보장성_기타*/
                 , NVL(#YEA_FAM_NUM005#, 0)   /*의료비_국세청*/
                 , NVL(#YEA_FAM_NUM006#, 0)   /*의료비_기타*/
                 , NVL(#YEA_FAM_NUM007#, 0)   /*교육비_국세청*/
                 , NVL(#YEA_FAM_NUM008#, 0)   /*교육비_기타*/
                 , NVL(#YEA_FAM_NUM009#, 0)   /*신용카드_국세청*/
                 , NVL(#YEA_FAM_NUM010#, 0)   /*신용카드_기타*/
                 , NVL(#YEA_FAM_NUM011#, 0)   /*직불카드_국세청*/
                 , NVL(#YEA_FAM_NUM012#, 0)   /*직불카드_기타*/
                 , NVL(#YEA_FAM_NUM013#, 0)   /*현금영수증_국세청*/
                 , NVL(#YEA_FAM_NUM014#, 0)   /*전통시장_국세청*/
                 , NVL(#YEA_FAM_NUM015#, 0)   /*전통시장_기타*/
                 , NVL(#YEA_FAM_NUM016#, 0)   /*대중교통_국세청*/
                 , NVL(#YEA_FAM_NUM017#, 0)   /*대중교통_기타*/
                 , NVL(#YEA_FAM_NUM018#, 0)   /*기부금_국세청*/
                 , NVL(#YEA_FAM_NUM019#, 0)   /*기부금_기타*/
                 , NVL(#YEA_FAM_NUM020#, 0)   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
              	 , NVL(#YEA_FAM_NUM021#, 0)   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
              	 , NVL(#YEA_FAM_NUM022#, 0)   /*[2015귀속] 난임시술비_국세청*/
                 , NVL(#YEA_FAM_NUM023#, 0)   /*[2015귀속] 난임시술비_기타*/              	 
                 , SYSDATE
                 , #UPDT_USID#
                 , SYSDATE
                 , #UPDT_USID#
              FROM YEA_YEFAMI
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
             ;
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE01" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE01.연말정산처리 종근무지 저장 [YEA_종근무지] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지 저장*/
            INSERT INTO YEA_BFWORK (
                    YEA_STD_YY       /*정산년월*/
                  , YEA_EMP_NO       /*직원번호*/
                  , YEA_BIZ_NO       /*사업자번호*/
                  , YEA_BFW_STR001   /*종근무지여부*/
                  , YEA_BFW_STR002   /*상호*/
                  , YEA_BFW_STR003   /*근무시작일*/
                  , YEA_BFW_STR004   /*근무종료일*/
                  , YEA_BFW_STR005   /*감면기간시작일*/
                  , YEA_BFW_STR006   /*감면기간종료일*/
                  , YEA_BFW_NUM001   /*급여총액*/
                  , YEA_BFW_NUM002   /*상여총액*/
                  , YEA_BFW_NUM003   /*인정상여*/
                  , YEA_BFW_NUM004   /*주식매수선택권행사이익*/
                  , YEA_BFW_NUM005   /*우리사주조합인출금*/
                  , YEA_BFW_NUM006   /*임원 퇴직소득금액 한도초과액*/
                  , YEA_BFW_NUM007   /*국민연금*/
                  , YEA_BFW_NUM008   /*건강보험*/
                  , YEA_BFW_NUM009   /*고용보험*/
                  , YEA_BFW_NUM010   /*소득세*/
                  , YEA_BFW_NUM011   /*주민세*/
                  , YEA_BFW_NUM012   /*농특세*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            ) VALUES (
                    #YEA_STD_YY#      /*정산년월*/
                  , #YEA_EMP_NO#      /*직원번호*/
                  , #YEA_BIZ_NO#      /*사업자번호*/
                  , #YEA_BFW_STR001#  /*종근무지여부*/
                  , #YEA_BFW_STR002#  /*상호*/
                  , #YEA_BFW_STR003#  /*근무시작일*/
                  , #YEA_BFW_STR004#  /*근무종료일*/
                  , #YEA_BFW_STR005#  /*감면기간시작일*/
                  , #YEA_BFW_STR006#  /*감면기간종료일*/
                  , #YEA_BFW_NUM001#  /*급여총액*/
                  , #YEA_BFW_NUM002#  /*상여총액*/
                  , #YEA_BFW_NUM003#  /*인정상여*/
                  , #YEA_BFW_NUM004#  /*주식매수선택권행사이익*/
                  , #YEA_BFW_NUM005#  /*우리사주조합인출금*/
                  , #YEA_BFW_NUM006#  /*임원 퇴직소득금액 한도초과액*/
                  , #YEA_BFW_NUM007#  /*국민연금*/
                  , #YEA_BFW_NUM008#  /*건강보험*/
                  , #YEA_BFW_NUM009#  /*고용보험*/
                  , #YEA_BFW_NUM010#  /*소득세*/
                  , #YEA_BFW_NUM011#  /*주민세*/
                  , #YEA_BFW_NUM012#  /*농특세*/
                  , SYSDATE           /*입력일시*/
                  , #UPDT_USID#       /*입력작업자*/
                  , SYSDATE           /*수정일시*/
                  , #UPDT_USID#       /*수정작업자*/
            );
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지비과세 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE02" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE02.연말정산처리 종근무지비과세 저장 [YEA_종근무지비과세] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지비과세 저장*/
            INSERT INTO YEA_BFNTAX (
                    YEA_STD_YY       /*정산년월*/
                  , YEA_EMP_NO       /*직원번호*/
                  , YEA_BIZ_NO       /*사업자번호*/
                  , YEA_NON_TAX_CD   /*비과세코드*/
                  , YEA_BFN_NUM001   /*비과세액*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/

            ) VALUES (
                    #YEA_STD_YY#      /*정산년월*/
                  , #YEA_EMP_NO#      /*직원번호*/
                  , #YEA_BIZ_NO#      /*사업자번호*/
                  , #YEA_NON_TAX_CD#  /*비과세코드*/
                  , #YEA_BFN_NUM001#  /*비과세액*/
                  , SYSDATE           /*입력일시*/
                  , #UPDT_USID#       /*입력작업자*/
                  , SYSDATE           /*수정일시*/
                  , #UPDT_USID#       /*수정작업자*/
            );
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 의료비명세서 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE03" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE03.연말정산처리 의료비명세서 저장 [YEA_의료비명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*의료비명세서 저장*/
            INSERT INTO YEA_MEDISP (
                    YEA_STD_YY       /*정산년월*/
                  , YEA_EMP_NO       /*사원번호*/
                  , YEA_FAMI_SEQ     /*가족순번*/
                  , YEA_MEDI_SEQ     /*일련번호*/
                  , YEA_MES_STR001   /*의료비증빙코드*/
                  , YEA_MES_STR002   /*성명*/
                  , YEA_MES_STR003   /*주민등록번호*/
                  , YEA_MES_STR004   /*내외국인구분*/
                  , YEA_MES_STR005   /*본인해당여부*/
                  , YEA_MES_STR006   /*상호*/
                  , YEA_MES_STR007   /*사업자번호*/
                  , YEA_MES_NUM001   /*지급건수*/
                  , YEA_MES_NUM002   /*지급액*/
                  , YEA_MES_STR008	 /*[2015귀속] 난임시술비 여부*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            ) 
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                , A.YEA_FAMI_SEQ
                , NVL(MAX(B.YEA_MEDI_SEQ), 0) + 1
                , #YEA_MES_STR001#
                , A.YEA_FAM_STR003
                , A.YEA_FAM_STR004
                , A.YEA_FAM_STR002
                , CASE WHEN A.YEA_FAM_STR001 = '0' OR NVL(A.YEA_FAM_STR009, '0') >= '1' OR
                  CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004), 7, 1) IN ('1','2','5','6') THEN '19' ELSE '20' END
                  || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004), 1, 6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#, 1, 4)) - 65) || '1231' THEN '1' ELSE '2' END   /*★체크해야함★*/
                , #YEA_MES_STR006#
                , SF_YEA_ENCRYPT_SSN(#YEA_MES_STR007#)
                , #YEA_MES_NUM001#
                , #YEA_MES_NUM002#
                , NVL(#YEA_MES_STR008#,0)	/*[2015귀속] 난임시술비 여부*/
                , SYSDATE
                , #UPDT_USID#
                , SYSDATE
                , #UPDT_USID#
             FROM YEA_YEFAMI A
        LEFT JOIN YEA_MEDISP B
               ON A.YEA_STD_YY = B.YEA_STD_YY
              AND A.YEA_EMP_NO = B.YEA_EMP_NO
              AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
            WHERE A.YEA_STD_YY = #YEA_STD_YY#
              AND A.YEA_EMP_NO = #YEA_EMP_NO#
              AND SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004) = #YEA_MES_STR003#
         GROUP BY A.YEA_STD_YY
                , A.YEA_EMP_NO
                , A.YEA_FAMI_SEQ
                , A.YEA_FAM_STR001
                , A.YEA_FAM_STR009
                , A.YEA_FAM_STR003
                , A.YEA_FAM_STR004
                , A.YEA_FAM_STR002
            ;
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세서 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE04" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE04.연말정산처리 기부금명세서 저장 [YEA_기부금명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금명세서 저장*/
            INSERT INTO YEA_DONASP (
                    YEA_STD_YY       /*정산년월*/
                  , YEA_EMP_NO       /*사원번호*/
                  , YEA_FAMI_SEQ     /*가족순번*/
                  , YEA_DONA_SEQ     /*일련번호*/
                  , YEA_DOS_STR001   /*국세청자료구분*/
                  , YEA_DOS_STR002   /*기부자명*/
                  , YEA_DOS_STR003   /*주민등록번호*/
                  , YEA_DOS_STR004   /*내외국인구분코드*/
                  , YEA_DOS_STR005   /*기부자관계코드*/
                  , YEA_DOS_STR006   /*기부유형코드*/
                  , YEA_DOS_STR007   /*상호*/
                  , YEA_DOS_STR008   /*사업자번호*/
                  , YEA_DOS_STR009   /*기부내용*/
                  , YEA_DOS_NUM001   /*기부건수*/
                  , YEA_DOS_NUM002   /*기부액*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            )
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                 , A.YEA_FAMI_SEQ
                 , NVL(MAX(B.YEA_DONA_SEQ),0) + 1
                 , #YEA_DOS_STR001#
                 , A.YEA_FAM_STR003
                 , A.YEA_FAM_STR004
                 , A.YEA_FAM_STR002
                 , CASE WHEN A.YEA_FAM_STR001 = '0' THEN '1'
                        WHEN A.YEA_FAM_STR001 = '3' THEN '2'
                        WHEN A.YEA_FAM_STR001 IN ('4','5') THEN '3'
                        WHEN A.YEA_FAM_STR001 IN ('1','2') THEN '4'
                        WHEN A.YEA_FAM_STR001 = '6' THEN '5'
                        ELSE '6'
                   END
                 , #YEA_DOS_STR006#
                 , #YEA_DOS_STR007#
                 , SF_YEA_ENCRYPT_SSN(#YEA_DOS_STR008#)
                 , #YEA_DOS_STR009#
                 , #YEA_DOS_NUM001#
                 , #YEA_DOS_NUM002#
                 , SYSDATE
                 , #UPDT_USID#
                 , SYSDATE
                 , #UPDT_USID#
              FROM YEA_YEFAMI A
         LEFT JOIN YEA_DONASP B
                ON A.YEA_STD_YY = B.YEA_STD_YY
               AND A.YEA_EMP_NO = B.YEA_EMP_NO
               AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004) = #YEA_DOS_STR003#
          GROUP BY A.YEA_FAMI_SEQ
                 , A.YEA_FAM_STR003
                 , A.YEA_FAM_STR004
                 , A.YEA_FAM_STR002
                 , A.YEA_FAM_STR001
            ;
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연금저축명세서 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE05" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE05.연말정산처리 연금저축명세서 저장 [YEA_연금저축명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*연금저축명세서 저장*/
            INSERT INTO YEA_PENSAV (
                    YEA_STD_YY   /*기준년월*/
                  , YEA_EMP_NO   /*사원번호*/
                  , YEA_PENS_SEQ   /*연금명세서순번*/
                  , YEA_PEN_STR001   /*연금소득공제구분*/
                  , YEA_PEN_STR002   /*금융기관코드*/
                  , YEA_PEN_STR003   /*계좌번호*/
                  , YEA_PEN_NUM001   /*불입금액*/
                  , YEA_PEN_STR005	 /*[2015귀속] 2015.01.01 이후 가입여부*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            )
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                 , NVL(MAX(A.YEA_PENS_SEQ), 0) + 1
                 , #YEA_PEN_STR001#
                 , #YEA_PEN_STR002#
                 , SF_YEA_ENCRYPT_ACCT_NO(#YEA_PEN_STR003#)
                 , #YEA_PEN_NUM001#
                 , NVL(#YEA_PEN_STR005#,0)	 /*[2015귀속] 2015.01.01 이후 가입여부*/
                 , SYSDATE
                 , #UPDT_USID#
                 , SYSDATE
                 , #UPDT_USID#
              FROM YEA_PENSAV A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#;

            /*SP_YEAA0070_PROC05(##YEA_STD_YY##, ##YEA_EMP_NO##);*/      /*★체크해야함★*/
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금조정명세서 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE06" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE06.연말정산처리 기부금조정명세서 저장 [YEA_기부금조정명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금조정명세서 저장*/
            INSERT INTO YEA_DONAAD (
                    YEA_STD_YY       /*기준년월*/
                  , YEA_EMP_NO       /*사원번호*/
                  , YEA_DONA_SEQ     /*기부금순번*/
                  , YEA_DOA_STR001   /*기부유형코드*/
                  , YEA_DOA_STR002   /*기부년도*/
                  , YEA_DOA_NUM001   /*기부금*/
                  , YEA_DOA_NUM002   /*기부금기공제액*/
                  , YEA_DOA_NUM003   /*기부금공제대상액*/
                  , YEA_DOA_NUM004   /*기부금공제액*/
                  , YEA_DOA_NUM005   /*기부금소멸액*/
                  , YEA_DOA_NUM006   /*기부금이월액*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            )
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                 , NVL(MAX(A.YEA_DONA_SEQ), 0) + 1
                 , #YEA_DOA_STR001#
                 , #YEA_DOA_STR002#
                 , #YEA_DOA_NUM001#
                 , #YEA_DOA_NUM002#
                 , #YEA_DOA_NUM003#
                 , #YEA_DOA_NUM004#
                 , #YEA_DOA_NUM005#
                 , #YEA_DOA_NUM006#
                 , SYSDATE
                 , #UPDT_USID#
                 , SYSDATE
                 , #UPDT_USID#
              FROM YEA_DONAAD A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#;
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연말정산공제자료PDF 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE07" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE07.연말정산처리 연말정산공제자료PDF 저장 [YEA_] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            INSERT INTO YEA_YEYSOM ( /*[연말정산공제자료]*/
               YEA_STD_YY        /*기준년월*/
              ,YEA_EMP_NO        /*사원번호*/
              ,YEA_FORM_SEQ1     /*공제서식번호*/
              ,YEA_FM1_STR001    /*귀속년도*/
              ,YEA_FM1_STR002    /*서식코드[FRMT_CODE]*/
              ,YEA_FM1_STR003    /*주민등록번호*/
              ,YEA_FM1_STR004    /*가족성명*/
              ,YEA_FM1_STR005    /*데이터코드*/
              ,YEA_FM1_STR006    /*사업자번호*/
              ,YEA_FM1_STR007    /*상호*/
              ,YEA_FM1_NUM001    /*납입금액합계*/
              ,YEA_FM1_NUM002    /*납입금액합계*/
              ,YEA_FM1_NUM003    /*납입금액합계*/
              ,YEA_FM1_NUM004    /*납입금액합계*/
              ,YEA_FM1_NUM005    /*[2015귀속]_납입금액합계*/
              ,YEA_FM1_NUM006    /*[2015귀속]_납입금액합계*/
              ,YEA_FM1_NUM007    /*[2015귀속]_납입금액합계*/
              ,YEA_INS_USER_ID   /*등록일시*/
              ,YEA_INS_DATE      /*등록자*/
              ,YEA_UPD_USER_ID   /*수정일시*/
              ,YEA_UPD_DATE      /*수정자*/
              )
       VALUES (
               #YEA_STD_YY#       /*기준년월*/
              ,#YEA_EMP_NO#       /*사원번호*/
              ,#YEA_FORM_SEQ1#    /*공제서식번호*/
              ,#YEA_FM1_STR001#   /*귀속년도*/
              ,#YEA_FM1_STR002#   /*서식코드[FRMT_CODE]*/
              ,SF_YEA_ENCRYPT_SSN(#YEA_FM1_STR003#)   /*주민등록번호*/
              ,#YEA_FM1_STR004#   /*가족성명*/
              ,#YEA_FM1_STR005#   /*데이터코드*/
              ,#YEA_FM1_STR006#   /*사업자번호*/
              ,#YEA_FM1_STR007#   /*상호*/
              ,#YEA_FM1_NUM001#   /*납입금액합계*/
              ,#YEA_FM1_NUM002#   /*납입금액합계*/
              ,#YEA_FM1_NUM003#   /*납입금액합계*/
              ,#YEA_FM1_NUM004#   /*납입금액합계*/
              ,#YEA_FM1_NUM005#   /*[2015귀속]_납입금액합계*/
              ,#YEA_FM1_NUM006#   /*[2015귀속]_납입금액합계*/
              ,#YEA_FM1_NUM007#   /*[2015귀속]_납입금액합계*/
              ,#UPDT_USID#        /*등록자*/
              ,SYSDATE            /*등록일시*/
              ,#UPDT_USID#        /*수정자*/
              ,SYSDATE            /*수정일시*/
       		 );
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연말정산공제자료서식1PDF 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE08" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE08.연말정산처리 연말정산공제자료서식1PDF 저장 [YEA_연말정산공제자료서식1] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            INSERT INTO YEA_YEYSOS ( /*[연말정산공제자료서식1]*/
               YEA_STD_YY        /*기준년월*/
              ,YEA_EMP_NO        /*사원번호*/
              ,YEA_FORM_SEQ1     /*공제서식번호*/
              ,YEA_FORM_SEQ2     /*공제서식세부순번*/
              ,YEA_FM2_STR001    /*공세속성명*/
              ,YEA_FM2_STR002    /*공제속성내용*/
              ,YEA_INS_USER_ID   /*등록일시*/
              ,YEA_INS_DATE      /*등록자*/
              ,YEA_UPD_USER_ID   /*수정일시*/
              ,YEA_UPD_DATE      /*수정자*/
              )
       VALUES (
               #YEA_STD_YY#       /*기준년월*/
              ,#YEA_EMP_NO#       /*사원번호*/
              ,#YEA_FORM_SEQ1#    /*공제서식번호*/
              ,(SELECT NVL(MAX(TO_NUMBER(YEA_FORM_SEQ2)),0)+1 FROM YEA_YEYSOS WHERE YEA_STD_YY = #YEA_STD_YY# AND YEA_EMP_NO = #YEA_EMP_NO#)   /*공제서식세부순번*/
              ,#YEA_FM2_STR001#   /*공세속성명*/
              ,#YEA_FM2_STR002#   /*공제속성내용*/
              ,#UPDT_USID#        /*등록자*/
              ,SYSDATE            /*등록일시*/
              ,#UPDT_USID#        /*수정자*/
              ,SYSDATE            /*수정일시*/
      		 );
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 개인공제자료PY_YEYSON  저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE09" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE09.연말정산처리 개인공제자료PY_YEYSON  저장 [YEA_연말정산공제자료서식21] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            INSERT INTO YEA_YEYSON ( /*[연말정산공제자료서식2]*/
               YEA_STD_YY        /*기준년월*/
              ,YEA_EMP_NO        /*사원번호*/
              ,YEA_FORM_SEQ1     /*공제서식번호*/
              ,YEA_FORM_SEQ2     /*공제서식세부순번*/
              ,YEA_FM3_STR001    /*공세속성명*/
              ,YEA_FM3_NUM001    /*공제속성금액*/
              ,YEA_INS_USER_ID   /*등록일시*/
              ,YEA_INS_DATE      /*등록자*/
              ,YEA_UPD_USER_ID   /*수정일시*/
              ,YEA_UPD_DATE      /*수정자*/
              )
       VALUES (
               #YEA_STD_YY#       /*기준년월*/
              ,#YEA_EMP_NO#       /*사원번호*/
              ,#YEA_FORM_SEQ1#    /*공제서식번호*/
              ,(SELECT NVL(MAX(TO_NUMBER(YEA_FORM_SEQ2)),0) + 1 FROM YEA_YEYSON WHERE YEA_STD_YY = #YEA_STD_YY# AND YEA_EMP_NO = #YEA_EMP_NO#)       /*공제서식세부순번*/
              ,#YEA_FM3_STR001#   /*공세속성명*/
              ,#YEA_FM3_NUM001#   /*공제속성금액*/
              ,#UPDT_USID#        /*등록자*/
              ,SYSDATE            /*등록일시*/
              ,#UPDT_USID#        /*수정자*/
              ,SYSDATE            /*수정일시*/
             );
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금1 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE10" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE10.연말정산처리 월세주택임차차입금1 저장 [YEA_월세주택임차차입금1] */
            v_ROWCNT INT;            
        BEGIN                
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
                            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금1 저장*/
            INSERT INTO YEA_RENTA1 (
                    YEA_STD_YY       /*기준년월*/
                  , YEA_EMP_NO       /*사원번호*/
                  , YEA_RENT_SEQ1    /*월세주택임차차입금1_순번*/
                  , YEA_RT1_STR001   /*임대인성명*/
                  , YEA_RT1_STR002   /*임대인주민등록번호*/
                  , YEA_RT1_STR003   /*주택유형구분코드*/
                  , YEA_RT1_STR004   /*계약서상주소지*/
                  , YEA_RT1_STR005   /*계약시작일*/
                  , YEA_RT1_STR006   /*계약종료일*/
                  , YEA_RT1_NUM001   /*월세액*/
                  , YEA_RT1_NUM002   /*공제액*/
                  , YEA_RT1_NUM003   /*주택계약면적*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            )
            SELECT #YEA_STD_YY#
                 , #YEA_EMP_NO#
                 , NVL(MAX(TO_NUMBER(A.YEA_RENT_SEQ1)), 0) + 1
                 , #YEA_RT1_STR001#
                 , SF_YEA_ENCRYPT_SSN(#YEA_RT1_STR002#)
                 , #YEA_RT1_STR003#
                 , #YEA_RT1_STR004#
                 , #YEA_RT1_STR005#
                 , #YEA_RT1_STR006#
                 , #YEA_RT1_NUM001#
                 , #YEA_RT1_NUM002#
                 , #YEA_RT1_NUM003#
                 , SYSDATE
                 , #UPDT_USID#
                 , SYSDATE
                 , #UPDT_USID#
             FROM YEA_RENTA1 A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#;

            /*월세주택임차차입금->>소득공제신고서에 반영*/
            /*SP_YEAA0070_PROC08(##YEA_STD_YY##, ##YEA_EMP_NO##);*/     /*★체크해야함★*/
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지 저장
********************************************************************************/
-->
	<insert id="YEAA0070_2015.SAVE11" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.SAVE11.연말정산처리 종근무지 저장 [YEA_종근무지] */
            v_ROWCNT INT;            
        BEGIN            
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금2 저장*/
            INSERT INTO YEA_RENTA2 (
                    YEA_STD_YY       /*기준년월*/
                  , YEA_EMP_NO       /*사원번호*/
                  , YEA_RENT_SEQ2    /*월세주택임차차입금2_순번*/
                  , YEA_RT2_STR001   /*대주성명*/
                  , YEA_RT2_STR002   /*대주주민등록번호*/
                  , YEA_RT2_STR003   /*금전소비대차계약시작일*/
                  , YEA_RT2_STR004   /*금전소비대차계약종료일*/
                  , YEA_RT2_STR005   /*임대인성명*/
                  , YEA_RT2_STR006   /*임대인주민등록번호*/
                  , YEA_RT2_STR007   /*주택유형구분코드*/
                  , YEA_RT2_STR008   /*계약서상주소지*/
                  , YEA_RT2_STR009   /*계약시작일*/
                  , YEA_RT2_STR010   /*계약종료일*/
                  , YEA_RT2_NUM001   /*차입금이자율*/
                  , YEA_RT2_NUM002   /*주택차입이자상환액*/
                  , YEA_RT2_NUM003   /*원리금상환액*/
                  , YEA_RT2_NUM004   /*이자액*/
                  , YEA_RT2_NUM005   /*공제액*/
                  , YEA_RT2_NUM006   /*주택계약면적*/
                  , YEA_RT2_NUM007   /*보증금액*/
                  , YEA_INS_DATE     /*입력일*/
                  , YEA_INS_USER_ID  /*입력자*/
                  , YEA_UPD_DATE     /*수정일*/
                  , YEA_UPD_USER_ID  /*수정자*/
            )
            SELECT  #YEA_STD_YY#
                  , #YEA_EMP_NO#
                  , NVL(MAX(TO_NUMBER(A.YEA_RENT_SEQ2)), 0) + 1
                  , #YEA_RT2_STR001#
                  , SF_YEA_ENCRYPT_SSN(#YEA_RT2_STR002#)
                  , #YEA_RT2_STR003#
                  , #YEA_RT2_STR004#
                  , #YEA_RT2_STR005#
                  , SF_YEA_ENCRYPT_SSN(#YEA_RT2_STR006#)
                  , #YEA_RT2_STR007#
                  , #YEA_RT2_STR008#
                  , #YEA_RT2_STR009#
                  , #YEA_RT2_STR010#
                  , #YEA_RT2_NUM001#
                  , #YEA_RT2_NUM002#
                  , #YEA_RT2_NUM003#
                  , #YEA_RT2_NUM004#
                  , #YEA_RT2_NUM005#
                  , #YEA_RT2_NUM006#
                  , #YEA_RT2_NUM007#
                  , SYSDATE
                  , #UPDT_USID#
                  , SYSDATE
                  , #UPDT_USID#
               FROM YEA_RENTA2 A
              WHERE YEA_STD_YY = #YEA_STD_YY#
                AND YEA_EMP_NO = #YEA_EMP_NO#;
       
            /*월세주택임차차입금->>소득공제신고서에 반영*/
            /*SP_YEAA0070_PROC08(##YEA_STD_YY##, ##YEA_EMP_NO##);*/	  /*★체크해야함★*/
        END;
	]]>
	</insert>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 가족사항 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE00" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE00.연말정산처리 가족사항 수정 [YEA_가족사항] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
			/*부양가족 저장*/
            UPDATE YEA_YEFAMI
               SET YEA_FAM_STR001  = #YEA_FAM_STR001#                        /* 가족관계신고코드 */
                 , YEA_FAM_STR002  = #YEA_FAM_STR002#                        /* 내외국인구분 */
                 , YEA_FAM_STR003  = #YEA_FAM_STR003#                        /* 성명 */
                 , YEA_FAM_STR004  = SF_YEA_ENCRYPT_SSN(#YEA_FAM_STR004#)    /* 주민등록번호 */
                 , YEA_FAM_STR005  = #YEA_FAM_STR005#                        /* 기본공제여부 */
                 , YEA_FAM_STR006  = #YEA_FAM_STR006#                        /* 경로자여부 */
                 , YEA_FAM_STR007  = #YEA_FAM_STR007#                        /* 부녀자여부 */
                 , YEA_FAM_STR008  = #YEA_FAM_STR008#                        /* 한부모여부 */
                 , YEA_FAM_STR009  = #YEA_FAM_STR009#                        /* 장애자여부 */
                 , YEA_FAM_STR010  = #YEA_FAM_STR010#                        /* 교육비구분코드 */
                 , YEA_FAM_STR011  = #YEA_FAM_STR011#                        /* 6세이하여부 귀속년도2014년 연말정산 재정산(소급) */
                 , YEA_FAM_STR012  = #YEA_FAM_STR012#                        /* 출산입양여부 귀속년도2014년 연말정산 재정산(소급) */
                 , YEA_FAM_NUM001  = #YEA_FAM_NUM001#                        /* 보험료_건강고용_국세청 */
                 , YEA_FAM_NUM002  = #YEA_FAM_NUM002#                        /* 보험료_건강고용_기타 */
                 , YEA_FAM_NUM003  = #YEA_FAM_NUM003#                        /* 보험료_보장성_국세청 */
                 , YEA_FAM_NUM004  = #YEA_FAM_NUM004#                        /* 보험료_보장성_기타 */
                 , YEA_FAM_NUM005  = #YEA_FAM_NUM005#                        /* 의료비_국세청 */
                 , YEA_FAM_NUM006  = #YEA_FAM_NUM006#                        /* 의료비_기타 */
                 , YEA_FAM_NUM007  = #YEA_FAM_NUM007#                        /* 교육비_국세청 */
                 , YEA_FAM_NUM008  = #YEA_FAM_NUM008#                        /* 교육비_기타 */
                 , YEA_FAM_NUM009  = #YEA_FAM_NUM009#                        /* 신용카드_국세청 */
                 , YEA_FAM_NUM010  = #YEA_FAM_NUM010#                        /* 신용카드_기타 */
                 , YEA_FAM_NUM011  = #YEA_FAM_NUM011#                        /* 직불카드_국세청 */
                 , YEA_FAM_NUM012  = #YEA_FAM_NUM012#                        /* 직불카드_기타 */
                 , YEA_FAM_NUM013  = #YEA_FAM_NUM013#                        /* 현금영수증_국세청 */
                 , YEA_FAM_NUM014  = #YEA_FAM_NUM014#                        /* 전통시장_국세청 */
                 , YEA_FAM_NUM015  = #YEA_FAM_NUM015#                        /* 전통시장_기타 */
                 , YEA_FAM_NUM016  = #YEA_FAM_NUM016#                        /* 대중교통_국세청 */
                 , YEA_FAM_NUM017  = #YEA_FAM_NUM017#                        /* 대중교통_기타 */
                 , YEA_FAM_NUM018  = #YEA_FAM_NUM018#                        /* 기부금_국세청 */
                 , YEA_FAM_NUM019  = #YEA_FAM_NUM019#                        /* 기부금_기타 */
                 , YEA_FAM_NUM020  = #YEA_FAM_NUM020#                        /* 장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급) */
                 , YEA_FAM_NUM021  = #YEA_FAM_NUM021#                        /* 장애인전용_기타 귀속년도2014년 연말정산 재정산(소급) */
                 , YEA_FAM_NUM022  = #YEA_FAM_NUM022#                        /* [2015귀속] 난임시술비_국세청 */
              	 , YEA_FAM_NUM023  = #YEA_FAM_NUM023#                        /* [2015귀속] 난임시술비_기타 */                 
                 , YEA_UPD_DATE    = SYSDATE                                 /* 수정일시 */
                 , YEA_UPD_USER_ID = #UPDT_USID#                             /* 수정자 */
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#;
    
			/*의료비명세서 수정*/
            UPDATE YEA_MEDISP A
               SET (YEA_MES_STR005, YEA_MES_STR002, YEA_MES_STR003, YEA_MES_STR004)
                 = (SELECT CASE WHEN YEA_FAM_STR001 = '0' OR NVL(YEA_FAM_STR009, '0') >= '1' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004), 7, 1) IN ('1','2','5','6') THEN '19' ELSE '20' END
                                     || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004), 1, 6) <= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#, 1, 4) || '1231','YYYYMMDD'), -780), 'YYYYMMDD') 
                                THEN '1' 
                                ELSE '2' 
                            END AS YEA_MES_STR005   /* 본인해당여부 */
                          ,YEA_FAM_STR003           /* 성명 */
                          ,YEA_FAM_STR004           /* 주민번호 */
                          ,YEA_FAM_STR002           /* 내외국인구분 */
                      FROM YEA_YEFAMI B
                     WHERE A.YEA_STD_YY   = B.YEA_STD_YY
                       AND A.YEA_EMP_NO   = B.YEA_EMP_NO
                       AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
                   )
             WHERE YEA_STD_YY   = #YEA_STD_YY#
               AND YEA_EMP_NO   = #YEA_EMP_NO#
               AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#;    
    
			/*기부금명세서 수정*/
            UPDATE YEA_DONASP A
               SET (YEA_DOS_STR005, YEA_DOS_STR002, YEA_DOS_STR003, YEA_DOS_STR004)
                 = (SELECT CASE WHEN YEA_FAM_STR001 = '0'        THEN '1' 
                                WHEN YEA_FAM_STR001 = '3'        THEN '2' 
                                WHEN YEA_FAM_STR001 IN ('4','5') THEN '3'
                                WHEN YEA_FAM_STR001 IN ('1','2') THEN '4' 
                                WHEN YEA_FAM_STR001 = '6'        THEN '5' ELSE '6' 
                            END AS YEA_DOS_STR005   /* 기부자관계코드 */
                          ,YEA_FAM_STR003           /* 성명 */
                          ,YEA_FAM_STR004           /* 주민번호 */
                          ,YEA_FAM_STR002           /* 내외국인구분 */
                      FROM YEA_YEFAMI B
                     WHERE A.YEA_STD_YY   = B.YEA_STD_YY
                       AND A.YEA_EMP_NO   = B.YEA_EMP_NO
                       AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
                   )
             WHERE YEA_STD_YY   = #YEA_STD_YY#
               AND YEA_EMP_NO   = #YEA_EMP_NO#
               AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#;            

        END;
	]]>
	</update>	
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 근로소득지급명세 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE01" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE01.연말정산처리 근로소득지급명세 수정 [YEA_근로소득지급명세] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*근로소득지급명세 저장*/
            UPDATE YEA_PAYDTL
               SET YEA_PAY_STR001  = #YEA_PAY_STR001#   /*국외근로지급연월*/
                 , YEA_PAY_STR002  = #YEA_PAY_STR002#   /*비과세내용*/
                 , YEA_PAY_NUM001  = #YEA_PAY_NUM001#   /*급여액*/
                 , YEA_PAY_NUM002  = #YEA_PAY_NUM002#   /*기타소득*/
                 , YEA_PAY_NUM003  = #YEA_PAY_NUM003#   /*상여액*/
                 , YEA_PAY_NUM004  = #YEA_PAY_NUM004#   /*인정상여*/
                 , YEA_PAY_NUM005  = #YEA_PAY_NUM005#   /*주식매수선택권행사이익*/
                 , YEA_PAY_NUM006  = #YEA_PAY_NUM006#   /*우리사주조합인출금*/
                 , YEA_PAY_NUM007  = #YEA_PAY_NUM007#   /*임원 퇴직소득금액 한도초과액*/
                 , YEA_PAY_NUM008  = #YEA_PAY_NUM008#   /*국외근로외화금액*/
                 , YEA_PAY_NUM009  = #YEA_PAY_NUM009#   /*국외근로원화금액*/
                 , YEA_PAY_NUM010  = #YEA_PAY_NUM010#   /*야간근로비과세*/
                 , YEA_PAY_NUM011  = #YEA_PAY_NUM011#   /*출산보육비과세*/
                 , YEA_PAY_NUM012  = #YEA_PAY_NUM012#   /*연구활동비과세*/
                 , YEA_PAY_NUM013  = #YEA_PAY_NUM013#   /*비과세액*/
                 , YEA_PAY_NUM014  = #YEA_PAY_NUM014#   /*감면세액*/
                 , YEA_PAY_NUM015  = #YEA_PAY_NUM015#   /*소득세*/
                 , YEA_PAY_NUM016  = #YEA_PAY_NUM016#   /*주민세*/
                 , YEA_PAY_NUM017  = #YEA_PAY_NUM017#   /*농특세*/
                 , YEA_PAY_NUM018  = #YEA_PAY_NUM018#   /*납부특례세액_소득세*/
                 , YEA_PAY_NUM019  = #YEA_PAY_NUM019#   /*납부특례세액_지방소득세*/
                 , YEA_PAY_NUM020  = #YEA_PAY_NUM020#   /*납부특례세액_농특세*/
                 , YEA_PAY_NUM021  = #YEA_PAY_NUM021#   /*국민연금납부액*/
                 , YEA_PAY_NUM022  = #YEA_PAY_NUM022#   /*건강보험납부액*/
                 , YEA_PAY_NUM023  = #YEA_PAY_NUM023#   /*고용보험납부액*/
                 , YEA_PAY_NUM024  = #YEA_PAY_NUM024#   /*노동조합비*/
                 , YEA_PAY_NUM025  = #YEA_PAY_NUM025#   /*기부금*/
                 , YEA_PAY_NUM026  = #YEA_PAY_NUM026#   /*비과세학자금*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_PAY_YYMM = #YEA_PAY_YYMM#               
            ;
        END;
	]]>
	</update>		
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE02" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE02.연말정산처리 종근무지 수정 [YEA_종근무지] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지 저장*/
            UPDATE YEA_BFWORK
               SET YEA_BFW_STR001 = #YEA_BFW_STR001#   /*종근무지여부*/
                 , YEA_BFW_STR002 = #YEA_BFW_STR002#   /*상호*/
                 , YEA_BFW_STR003 = #YEA_BFW_STR003#   /*근무시작일*/
                 , YEA_BFW_STR004 = #YEA_BFW_STR004#   /*근무종료일*/
                 , YEA_BFW_STR005 = #YEA_BFW_STR005#   /*감면기간시작일*/
                 , YEA_BFW_STR006 = #YEA_BFW_STR006#   /*감면기간종료일*/
                 , YEA_BFW_NUM001 = #YEA_BFW_NUM001#   /*급여총액*/
                 , YEA_BFW_NUM002 = #YEA_BFW_NUM002#   /*상여총액*/
                 , YEA_BFW_NUM003 = #YEA_BFW_NUM003#   /*인정상여*/
                 , YEA_BFW_NUM004 = #YEA_BFW_NUM004#   /*주식매수선택권행사이익*/
                 , YEA_BFW_NUM005 = #YEA_BFW_NUM005#   /*우리사주조합인출금*/
                 , YEA_BFW_NUM006 = #YEA_BFW_NUM006#   /*임원 퇴직소득금액 한도초과액*/
                 , YEA_BFW_NUM007 = #YEA_BFW_NUM007#   /*국민연금*/
                 , YEA_BFW_NUM008 = #YEA_BFW_NUM008#   /*건강보험*/
                 , YEA_BFW_NUM009 = #YEA_BFW_NUM009#   /*고용보험*/
                 , YEA_BFW_NUM010 = #YEA_BFW_NUM010#   /*소득세*/
                 , YEA_BFW_NUM011 = #YEA_BFW_NUM011#   /*주민세*/
                 , YEA_BFW_NUM012 = #YEA_BFW_NUM012#   /*농특세*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_BIZ_NO = #YEA_BIZ_NO#
             ;
        END;
	]]>
	</update>			
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 소득공제신고1 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE03" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE03.연말정산처리 소득공제신고1 수정 [YEA_소득공제신고] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*소득공제신고서 저장*/
            UPDATE YEA_INCDEC
               SET YEA_INC_NUM001 = NVL(#YEA_INC_NUM001#, 0)   /*국민연금전근무지*/
                 , YEA_INC_NUM002 = NVL(#YEA_INC_NUM002#, 0)   /*국민연금현근무지*/
                 , YEA_INC_NUM003 = NVL(#YEA_INC_NUM003#, 0)   /*연금보험료전근무지(공무원)*/
                 , YEA_INC_NUM004 = NVL(#YEA_INC_NUM004#, 0)   /*연금보험료현근무지(공무원)*/
                 , YEA_INC_NUM005 = NVL(#YEA_INC_NUM005#, 0)   /*연금보험료전근무지(군인)*/
                 , YEA_INC_NUM006 = NVL(#YEA_INC_NUM006#, 0)   /*연금보험료현근무지(군인)*/
                 , YEA_INC_NUM007 = NVL(#YEA_INC_NUM007#, 0)   /*연금보험료전근무지(교직원)*/
                 , YEA_INC_NUM008 = NVL(#YEA_INC_NUM008#, 0)   /*연금보험료현근무지(교직원)*/
                 , YEA_INC_NUM009 = NVL(#YEA_INC_NUM009#, 0)   /*연금보험료전근무지(우체국)*/
                 , YEA_INC_NUM010 = NVL(#YEA_INC_NUM010#, 0)   /*연금보험료현근무지(우체국)*/
                 /*1*******************************************************************************************************/
                 , YEA_INC_NUM011 = NVL(#YEA_INC_NUM011#, 0)   /*건강보험전근무지*/
                 , YEA_INC_NUM012 = NVL(#YEA_INC_NUM012#, 0)   /*건강보험현근무지*/
                 , YEA_INC_NUM013 = NVL(#YEA_INC_NUM013#, 0)   /*고용보험전근무지*/
                 , YEA_INC_NUM014 = NVL(#YEA_INC_NUM014#, 0)   /*고용보험현근무지*/
                 , YEA_INC_NUM015 = NVL(#YEA_INC_NUM015#, 0)   /*주택임차원리금상환액(주택기관)*/
                 , YEA_INC_NUM016 = NVL(#YEA_INC_NUM016#, 0)   /*주택임차원리금상환액(거주자)*/
                 , YEA_INC_NUM017 = NVL(#YEA_INC_NUM017#, 0)   /*장기주택저당차입금_2011년이전(15년미만)*/
                 , YEA_INC_NUM018 = NVL(#YEA_INC_NUM018#, 0)   /*장기주택저당차입금 _2011년이전(15년~29년)*/
                 , YEA_INC_NUM019 = NVL(#YEA_INC_NUM019#, 0)   /*장기주택저당차입금_2011년이전(30년이상)*/
                 , YEA_INC_NUM020 = NVL(#YEA_INC_NUM020#, 0)   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                 , YEA_INC_NUM021 = NVL(#YEA_INC_NUM021#, 0)   /*장기주택저당차입금_2012년이후(기타대출)*/
                 , YEA_INC_NUM077 = NVL(#YEA_INC_NUM077#, 0)   /*[2015귀속]장기주택저당차입금 _2015년이후_15년이상(고정금리이면서,비거치)*/
                 , YEA_INC_NUM078 = NVL(#YEA_INC_NUM078#, 0)   /*[2015귀속]장기주택저당차입금 _2015년이후_15년이상(고정금리이거나,비거치)*/
                 , YEA_INC_NUM079 = NVL(#YEA_INC_NUM079#, 0)   /*[2015귀속]장기주택저당차입금 _2015년이후_15년이상(기타대출)*/
                 , YEA_INC_NUM080 = NVL(#YEA_INC_NUM080#, 0)   /*[2015귀속]장기주택저당차입금 _2015년이후_10~15년(고정금리이거나,비거치)*/
                 /*2*******************************************************************************************************/
                 , YEA_INC_NUM022 = NVL(#YEA_INC_NUM022#, 0)   /*개인연금저축(2000년 이전 가입)*/
                 , YEA_INC_NUM023 = NVL(#YEA_INC_NUM023#, 0)   /*소기업·소상공인 공제부금*/
                 , YEA_INC_NUM024 = NVL(#YEA_INC_NUM024#, 0)   /*[2015귀속]_변경 청약저축(2014.12.31 이전 가입분)*/
                 , YEA_INC_NUM025 = NVL(#YEA_INC_NUM025#, 0)   /*근로자주택마련저축*/
                 , YEA_INC_NUM026 = NVL(#YEA_INC_NUM026#, 0)   /*[2015귀속]_변경 주택청약종합저축(2014.12.31 이전 가입분)*/ 
                 , YEA_INC_NUM027 = NVL(#YEA_INC_NUM027#, 0)   /*[2015귀속]_변경 투자조합출자등_2015년 출자·투자분(10%)*/   
                 , YEA_INC_NUM028 = NVL(#YEA_INC_NUM028#, 0)   /*[2015귀속]_변경 투자조합출자등_2012년 출자·투자분(100%)*/  
                 , YEA_INC_NUM029 = NVL(#YEA_INC_NUM029#, 0)   /*투자조합출자등_2013년 출자·투자분(10%)*/
                 , YEA_INC_NUM030 = NVL(#YEA_INC_NUM030#, 0)   /*투자조합출자등_2013년 출자·투자분(20%)*/
                 , YEA_INC_NUM031 = NVL(#YEA_INC_NUM031#, 0)   /*투자조합출자등_2014년 이후 출자·투자분(10%)*/
                 , YEA_INC_NUM032 = NVL(#YEA_INC_NUM032#, 0)   /*투자조합출자등_2014년 이후 출자·투자분(50%)*/
                 , YEA_INC_NUM033 = NVL(#YEA_INC_NUM033#, 0)   /*투자조합출자등_2014년 이후 출자·투자분(30%)*/
                 , YEA_INC_NUM034 = NVL(#YEA_INC_NUM034#, 0)   /*신용카드*/
                 , YEA_INC_NUM035 = NVL(#YEA_INC_NUM035#, 0)   /*직불·선불카드*/
                 , YEA_INC_NUM036 = NVL(#YEA_INC_NUM036#, 0)   /*현금영수증*/
                 , YEA_INC_NUM037 = NVL(#YEA_INC_NUM037#, 0)   /*전통시장사용분*/
                 , YEA_INC_NUM038 = NVL(#YEA_INC_NUM038#, 0)   /*대중교통이용분*/
                 , YEA_INC_NUM039 = NVL(#YEA_INC_NUM039#, 0)   /*본인 신용카드등 사용액(2013년)*/
                 , YEA_INC_NUM040 = NVL(#YEA_INC_NUM040#, 0)   /*본인 신용카드등 사용액(2014년)*/
                 , YEA_INC_NUM041 = NVL(#YEA_INC_NUM041#, 0)   /*본인 추가공제율 사용분(2013년)*/
                 , YEA_INC_NUM042 = NVL(#YEA_INC_NUM042#, 0)   /*[2015귀속]_변경 본인 추가공제율 사용분(2015년상반기)*/
                 , YEA_INC_NUM043 = NVL(#YEA_INC_NUM043#, 0)   /*우리사주조합 출연금*/                 
                 , YEA_INC_NUM045 = NVL(#YEA_INC_NUM045#, 0)   /*고용유지중소기업 근로자*/
                 , YEA_INC_NUM046 = NVL(#YEA_INC_NUM046#, 0)   /*목돈 안드는 전세 이자상환액*/
                 , YEA_INC_NUM047 = NVL(#YEA_INC_NUM047#, 0)   /*장기집합투자증권저축*/
                 , YEA_INC_NUM081 = NVL(#YEA_INC_NUM081#, 0)   /*[2015귀속] 청약저축(2015.01.01 이후 가입분)*/
                 , YEA_INC_NUM082 = NVL(#YEA_INC_NUM082#, 0)   /*[2015귀속] 주택청약종합저축(2015.01.01 이후 가입분)*/                 
                 , YEA_INC_NUM083 = NVL(#YEA_INC_NUM083#, 0)   /*[2015귀속] 투자조합출자등_2015년 출자·투자분(50%)*/
                 , YEA_INC_NUM084 = NVL(#YEA_INC_NUM084#, 0)   /*[2015귀속] 투자조합출자등_2012년 출자·투자분(30%)*/
                 , YEA_INC_NUM085 = NVL(#YEA_INC_NUM085#, 0)   /*[2015귀속] 본인 신용카드등 사용액(2015년)*/
                 , YEA_INC_NUM086 = NVL(#YEA_INC_NUM086#, 0)   /*[2015귀속] 본인 추가공제율 사용분(2014년)*/
                 , YEA_INC_NUM087 = NVL(#YEA_INC_NUM087#, 0)   /*[2015귀속] 본인 추가공제율 사용분(2015년하반기)*/  
                 /*3*******************************************************************************************************/
                 , YEA_INC_STR001 = #YEA_INC_STR001#   /*입국목적*/
                 , YEA_INC_STR002 = #YEA_INC_STR002#   /*기술도입계약 또는 근로제공일*/
                 , YEA_INC_STR003 = #YEA_INC_STR003#   /*기술도입계약_감면기간 만료일*/
                 , YEA_INC_STR004 = #YEA_INC_STR004#   /*외국인 근로소득에 대한 감면 접수일*/
                 , YEA_INC_STR005 = #YEA_INC_STR005#   /*외국인 근로소득에 대한 감면 제출일*/
                 , YEA_INC_STR006 = #YEA_INC_STR006#   /*근로소득에 대한 조세조약 상 면제 접수일*/
                 , YEA_INC_STR007 = #YEA_INC_STR007#   /*근로소득에 대한 조세조약 상 면제 제출일*/
                 , YEA_INC_STR008 = #YEA_INC_STR008#   /*중소기업 취업자 감면_취업일*/
                 , YEA_INC_STR009 = #YEA_INC_STR009#   /*중소기업 취업자 감면기간_종료일*/
                 , YEA_INC_STR010 = #YEA_INC_STR010#   /*외국납부세액_납세국명*/
                 , YEA_INC_STR011 = #YEA_INC_STR011#   /*외국납부세액_납부일*/
                 , YEA_INC_STR012 = #YEA_INC_STR012#   /*외국납부세액_신청서제출일*/
                 , YEA_INC_STR013 = #YEA_INC_STR013#   /*외국납부세액_국외근무처*/
                 , YEA_INC_STR014 = #YEA_INC_STR014#   /*외국납부세액_근무기간*/
                 , YEA_INC_STR015 = #YEA_INC_STR015#   /*외국납부세액_직책*/
                 , YEA_INC_STR016 = #YEA_INC_STR016#   /*종근무지명종근무지*/
                 , YEA_INC_STR017 = #YEA_INC_STR017#   /*종근무지사업자번호*/
                 , YEA_INC_STR018 = #YEA_INC_STR018#   /*종근무지영수증제출여부*/
                 , YEA_INC_STR019 = #YEA_INC_STR019#   /*소득공제명세서제출여부*/
                 , YEA_INC_STR020 = #YEA_INC_STR020#   /*연금저축명세서제출여부*/
                 , YEA_INC_STR021 = #YEA_INC_STR021#   /*월세액명세서제출여부*/
                 , YEA_INC_STR022 = #YEA_INC_STR022#   /*의료비명세서제출여부*/
                 , YEA_INC_STR023 = #YEA_INC_STR023#   /*기부금명세서제출여부*/
                 , YEA_INC_STR024 = #YEA_INC_STR024#   /*세대주여부*/
                 , YEA_INC_STR025 = #YEA_INC_STR025#   /*입력마감여부*/
                 , YEA_INC_NUM048 = NVL(#YEA_INC_NUM048#, 0)   /*자녀 수*/
                 , YEA_INC_NUM049 = NVL(#YEA_INC_NUM049#, 0)   /*과학기술인공제*/
                 , YEA_INC_NUM050 = NVL(#YEA_INC_NUM050#, 0)   /*「근로자퇴직급여 보장법」에 따른 퇴직연금*/
                 , YEA_INC_NUM051 = NVL(#YEA_INC_NUM051#, 0)   /*연금저축*/
                 , YEA_INC_NUM052 = NVL(#YEA_INC_NUM052#, 0)   /*보험료_보장성*/
                 , YEA_INC_NUM053 = NVL(#YEA_INC_NUM053#, 0)   /*보험료_장애인전용보장성*/
                 , YEA_INC_NUM054 = NVL(#YEA_INC_NUM054#, 0)   /*[2015귀속]_변경 의료비_본인ㆍ65세 이상자ㆍ장애인ㆍ난임시술비*/
                 , YEA_INC_NUM055 = NVL(#YEA_INC_NUM055#, 0)   /*의료비_그 밖의 공제대상자*/
                 , YEA_INC_NUM056 = NVL(#YEA_INC_NUM056#, 0)   /*교육비_소득자본인*/
                 , YEA_INC_NUM057 = NVL(#YEA_INC_NUM057#, 0)   /*교육비_취학전 아동 수*/
                 , YEA_INC_NUM058 = NVL(#YEA_INC_NUM058#, 0)   /*교육비_취학전 아동*/
                 , YEA_INC_NUM059 = NVL(#YEA_INC_NUM059#, 0)   /*교육비_초·중·고등학교 학생 수*/
                 , YEA_INC_NUM060 = NVL(#YEA_INC_NUM060#, 0)   /*교육비_초·중·고등학교*/
                 , YEA_INC_NUM061 = NVL(#YEA_INC_NUM061#, 0)   /*교육비_대학생 수*/
                 , YEA_INC_NUM062 = NVL(#YEA_INC_NUM062#, 0)   /*교육비_대학생*/
                 , YEA_INC_NUM063 = NVL(#YEA_INC_NUM063#, 0)   /*교육비_장애인 수*/
                 , YEA_INC_NUM064 = NVL(#YEA_INC_NUM064#, 0)   /*교육비_장애인*/
                 , YEA_INC_NUM065 = NVL(#YEA_INC_NUM065#, 0)   /*정치자금기부금(10만원이하)*/
                 , YEA_INC_NUM066 = NVL(#YEA_INC_NUM066#, 0)   /*정치자금기부금(10만원초과)*/
                 , YEA_INC_NUM067 = NVL(#YEA_INC_NUM067#, 0)   /*법정기부금(당해)*/                 
                 , YEA_INC_NUM068 = NVL(#YEA_INC_NUM068#, 0)   /*지정기부금(당해)*/
                 , YEA_INC_NUM069 = NVL(#YEA_INC_NUM069#, 0)   /*종교단체지정기부금(당해)*/
                 , YEA_INC_NUM070 = NVL(#YEA_INC_NUM070#, 0)   /*외국납부세액_국외원천소득*/
                 , YEA_INC_NUM071 = NVL(#YEA_INC_NUM071#, 0)   /*외국납부세액_납세액(외화)*/
                 , YEA_INC_NUM072 = NVL(#YEA_INC_NUM072#, 0)   /*외국납부세액_납세액(원화)*/
                 , YEA_INC_NUM073 = NVL(#YEA_INC_NUM073#, 0)   /*주택자금차입금이자세액공제*/
                 , YEA_INC_NUM074 = NVL(#YEA_INC_NUM074#, 0)   /*월세세액공제*/
                 , YEA_INC_NUM075 = NVL(#YEA_INC_NUM075#, 0)   /*종근무지급여총액*/
                 , YEA_INC_NUM076 = NVL(#YEA_INC_NUM076#, 0)   /*종근무지소득세*/
                 , YEA_INC_NUM044 = NVL(#YEA_INC_NUM044#, 0)   /*[2015귀속]_이동 우리사주조합기부금*/
                 , YEA_INC_NUM088 = NVL(#YEA_INC_NUM088#, 0)   /*[2015귀속] 6세이하자녀수*/	
                 , YEA_INC_NUM089 = NVL(#YEA_INC_NUM089#, 0)   /*[2015귀속] 출산입양수*/ 
                 /*4*******************************************************************************************************/  
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
            ;
        END;
	]]>
	</update>			
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지비과세 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE04" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE04.연말정산처리 종근무지비과세 수정 [YEA_종근무지비과세] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지 비과세 저장*/
            UPDATE YEA_BFNTAX
               SET YEA_BFN_NUM001  = #YEA_BFN_NUM001#   /*종근무지여부*/
                 , YEA_UPD_DATE    = SYSDATE            /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#        /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_BIZ_NO = #YEA_BIZ_NO#
               AND YEA_NON_TAX_CD = #YEA_NON_TAX_CD#
             ;
        END;
	]]>
	</update>				
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 의료비명세서 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE05" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE05.연말정산처리 의료비명세서 수정 [YEA_의료비명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*의료비명세서 저장*/
            UPDATE YEA_MEDISP
               SET YEA_MES_STR001 = #YEA_MES_STR001#    /*의료증빙코드*/
                 , YEA_MES_STR006 = #YEA_MES_STR006#    /*상호*/
                 , YEA_MES_STR007 = SF_YEA_ENCRYPT_SSN(#YEA_MES_STR007#)    /*사업자번호*/
                 , YEA_MES_NUM001 = #YEA_MES_NUM001#    /*지급건수*/
                 , YEA_MES_NUM002 = #YEA_MES_NUM002#    /*지급액*/
                 , YEA_MES_STR008 = NVL(#YEA_MES_STR008#,0)    /*[2015귀속] 난임시술비여부*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#
               AND YEA_MEDI_SEQ = #YEA_MEDI_SEQ#
            ;
        END;
	]]>
	</update>				
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세서 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE06" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE06.연말정산처리 기부금명세서 수정 [YEA_기부금명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금명세서 저장*/
            UPDATE YEA_DONASP
               SET YEA_DOS_STR001 = #YEA_DOS_STR001#   /*국세청자료구분*/
                 , YEA_DOS_STR006 = #YEA_DOS_STR006#   /*기부유형코드*/
                 , YEA_DOS_STR007 = #YEA_DOS_STR007#   /*상호*/
                 , YEA_DOS_STR008 = SF_YEA_ENCRYPT_SSN(#YEA_DOS_STR008#)   /*사업자번호*/
                 , YEA_DOS_STR009 = #YEA_DOS_STR009#   /*기부내용*/
                 , YEA_DOS_NUM001 = #YEA_DOS_NUM001#   /*기부건수*/
                 , YEA_DOS_NUM002 = #YEA_DOS_NUM002#   /*기부액*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#
               AND YEA_DONA_SEQ = #YEA_DONA_SEQ#
            ; 	
        END;
	]]>
	</update>			
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연금저축명세서 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE07" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE07.연말정산처리 연금저축명세서 수정 [YEA_연금저축명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*연금저축명세서 저장*/
            UPDATE YEA_PENSAV
               SET YEA_PEN_STR001 = #YEA_PEN_STR001#   /*연금소득공제구분*/
                 , YEA_PEN_STR002 = #YEA_PEN_STR002#   /*금융기관코드*/
                 , YEA_PEN_STR003 = SF_YEA_ENCRYPT_ACCT_NO(#YEA_PEN_STR003#)   /*계좌번호*/
                 , YEA_PEN_NUM001 = #YEA_PEN_NUM001#   /*불입금액*/
                 , YEA_PEN_STR005 = NVL(#YEA_PEN_STR005#,0)   /*[2015귀속] 2015.01.01 이후 가입여부*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_PENS_SEQ  = #YEA_PENS_SEQ#   /*연금명세서순번*/
           ;

           /*SP_YEAA0070_PROC05(##YEA_STD_YY##, ##YEA_EMP_NO##);*/
        END;
	]]>
	</update>			
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금조정명세서 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE08" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE08.연말정산처리 기부금조정명세서 수정 [YEA_기부금조정명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금조정명세서 저장*/
            UPDATE YEA_DONAAD
               SET YEA_DOA_STR001 = #YEA_DOA_STR001#   /*기부유형코드*/
                 , YEA_DOA_STR002 = #YEA_DOA_STR002#   /*기부년도*/
                 , YEA_DOA_NUM001 = #YEA_DOA_NUM001#   /*기부금*/
                 , YEA_DOA_NUM002 = #YEA_DOA_NUM002#   /*기부금기공제액*/
                 , YEA_DOA_NUM003 = #YEA_DOA_NUM003#   /*기부금공제대상액*/
                 , YEA_DOA_NUM004 = #YEA_DOA_NUM004#   /*기부금공제액*/
                 , YEA_DOA_NUM005 = #YEA_DOA_NUM005#   /*기부금소멸액*/
                 , YEA_DOA_NUM006 = #YEA_DOA_NUM006#   /*기부금이월액*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_DONA_SEQ = #YEA_DONA_SEQ#
            ;

           /*SP_YEAA0070_PROC05(##YEA_STD_YY##, ##YEA_EMP_NO##);*/
        END;
	]]>
	</update>			
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금1 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE09" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE09.연말정산처리 월세주택임차차입금1 수정 [YEA_월세주택임차차입금1] */
            v_ROWCNT INT;            
        BEGIN    
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
                    
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금1 저장*/
            UPDATE YEA_RENTA1
               SET YEA_RT1_STR001 = #YEA_RT1_STR001#   /*임대인성명*/
                 , YEA_RT1_STR002 = SF_YEA_ENCRYPT_SSN(#YEA_RT1_STR002#)   /*임대인주민등록번호*/
                 , YEA_RT1_STR003 = #YEA_RT1_STR003#   /*주택유형구분코드*/
                 , YEA_RT1_STR004 = #YEA_RT1_STR004#   /*계약서상주소지*/
                 , YEA_RT1_STR005 = #YEA_RT1_STR005#   /*계약시작일*/
                 , YEA_RT1_STR006 = #YEA_RT1_STR006#   /*계약종료일*/
                 , YEA_RT1_NUM001 = #YEA_RT1_NUM001#   /*월세액*/
                 , YEA_RT1_NUM002 = #YEA_RT1_NUM002#   /*공제액*/
                 , YEA_RT1_NUM003 = #YEA_RT1_NUM003#   /*주택계약면적*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_RENT_SEQ1  = #YEA_RENT_SEQ1#;     /*월세주택임차차입금1_순번*/    
    
            /*월세주택임차차입금->>소득공제신고서에 반영*/
            /*SP_YEAA0070_PROC08(##YEA_STD_YY##, ##YEA_EMP_NO##);*/
        END;
	]]>
	</update>				
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금2 수정
********************************************************************************/
-->
	<update id="YEAA0070_2015.UPDATE10" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.UPDATE10.연말정산처리 월세주택임차차입금2 수정 [YEA_월세주택임차차입금2] */
            v_ROWCNT INT;            
        BEGIN    
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
                    
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금2 저장*/
            UPDATE YEA_RENTA2
               SET YEA_RT2_STR001 = #YEA_RT2_STR001#   /*대주성명*/
                 , YEA_RT2_STR002 = SF_YEA_ENCRYPT_SSN(#YEA_RT2_STR002#)   /*대주주민등록번호*/
                 , YEA_RT2_STR003 = #YEA_RT2_STR003#   /*금전소비대차계약시작일*/
                 , YEA_RT2_STR004 = #YEA_RT2_STR004#   /*금전소비대차계약종료일*/
                 , YEA_RT2_STR005 = #YEA_RT2_STR005#   /*임대인성명*/
                 , YEA_RT2_STR006 = SF_YEA_ENCRYPT_SSN(#YEA_RT2_STR006#)   /*임대인주민등록번호*/
                 , YEA_RT2_STR007 = #YEA_RT2_STR007#   /*주택유형구분코드*/
                 , YEA_RT2_STR008 = #YEA_RT2_STR008#   /*계약서상주소지*/
                 , YEA_RT2_STR009 = #YEA_RT2_STR009#   /*계약시작일*/
                 , YEA_RT2_STR010 = #YEA_RT2_STR010#   /*계약종료일*/
                 , YEA_RT2_NUM001 = #YEA_RT2_NUM001#   /*차입금이자율*/
                 , YEA_RT2_NUM002 = #YEA_RT2_NUM002#   /*주택차입이자상환액*/
                 , YEA_RT2_NUM003 = #YEA_RT2_NUM003#   /*원리금상환액*/
                 , YEA_RT2_NUM004 = #YEA_RT2_NUM004#   /*이자액*/
                 , YEA_RT2_NUM005 = #YEA_RT2_NUM005#   /*공제액*/
                 , YEA_RT2_NUM006 = #YEA_RT2_NUM006#   /*주택계약면적*/
                 , YEA_RT2_NUM007 = #YEA_RT2_NUM007#   /*보증금액*/
                 , YEA_UPD_DATE    = SYSDATE       /*수정일시*/
                 , YEA_UPD_USER_ID = #UPDT_USID#   /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_RENT_SEQ2  = #YEA_RENT_SEQ2#;     /*월세주택임차차입금2_순번*/
        
            /*월세주택임차차입금->>소득공제신고서에 반영*/
            /*SP_YEAA0070_PROC08(##YEA_STD_YY##, ##YEA_EMP_NO##);*/
        END;
	]]>
	</update>	
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 부양가족 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE01" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE01.연말정산처리 부양가족 삭제 [YEA_가족사항] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*의료비명세서 삭제*/
			DELETE FROM YEA_MEDISP    
             WHERE YEA_STD_YY   = #YEA_STD_YY#
               AND YEA_EMP_NO   = #YEA_EMP_NO#  
	           AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#
			;
			   
			/*기부금명세서 삭제*/
			DELETE FROM YEA_DONASP    
             WHERE YEA_STD_YY   = #YEA_STD_YY#
               AND YEA_EMP_NO   = #YEA_EMP_NO# 
	           AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#
			;
				
				   
			/*부양가족 삭제*/
	        DELETE FROM YEA_YEFAMI
             WHERE YEA_STD_YY   = #YEA_STD_YY#
               AND YEA_EMP_NO   = #YEA_EMP_NO#
	           AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#
	        ;
	           			
			/*기부금명세서 -> 소득공제신고서에 반영*/

        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE02" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE02.연말정산처리 종근무지 삭제 [YEA_종근무지] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지비과세 삭제*/
			DELETE FROM YEA_BFNTAX    
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#      
			   AND YEA_BIZ_NO = #YEA_BIZ_NO#
			   ;
			   
			/*종근무지 삭제*/
	        DELETE FROM YEA_BFWORK
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_BIZ_NO = #YEA_BIZ_NO#   /*사업자번호*/
	         ;  		
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 종근무지비과세 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE03" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE03.연말정산처리 종근무지비과세  삭제 [YEA_종근무지비과세] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*종근무지비과세 삭제*/
            DELETE FROM YEA_BFNTAX
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_BIZ_NO = #YEA_BIZ_NO#   /*사업자번호*/
               AND YEA_NON_TAX_CD = #YEA_NON_TAX_CD#   /*비과세코드*/
            ;
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 의료비명세서 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE04" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE04.연말정산처리 의료비명세서  삭제 [YEA_의료비명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*의료비명세서 삭제*/
            DELETE FROM YEA_MEDISP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#   /*가족일련번호*/
	           AND YEA_MEDI_SEQ = #YEA_MEDI_SEQ#   /*의료비일련번호*/
            ;         
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세서 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE05" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE05.연말정산처리 기부금명세서  삭제 [YEA_기부금명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금명세서 삭제*/
            DELETE FROM YEA_DONASP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_FAMI_SEQ = #YEA_FAMI_SEQ#   /*가족일련번호*/
	           AND YEA_DONA_SEQ = #YEA_DONA_SEQ#   /*기부금일련번호*/
            ;      
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연금저축 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE07" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE07.연말정산처리 연금저축  삭제 [YEA_연금저축] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*연금저축명세서 삭제*/
            DELETE FROM YEA_PENSAV
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_PENS_SEQ = #YEA_PENS_SEQ#   /*비과세코드*/
            ; 
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금조정명세서 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE08" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE08.연말정산처리 기부금조정명세서  삭제 [YEA_기부금조정명세서] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*기부금조정명세서 삭제*/
	        DELETE FROM YEA_DONAAD
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_DONA_SEQ = #YEA_DONA_SEQ#   /*기부금일련번호*/
            ;
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연말정산공제자료(PDF) 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE09" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE09.연말정산처리 연말정산공제자료(PDF)  삭제 [YEA_연말정산공제자료(PDF)] */
            v_ROWCNT INT;            
        BEGIN            
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*연말정산공제자료서식1 삭제*/
	        DELETE FROM YEA_YEYSOS           /*[연말정산공제자료서식1]*/
	         WHERE YEA_STD_YY = #YEA_STD_YY#
	           AND YEA_EMP_NO = #YEA_EMP_NO#;
	
	        /*연말정산공제자료서식2 삭제*/
	        DELETE FROM YEA_YEYSON           /*[연말정산공제자료서식2]*/
	         WHERE YEA_STD_YY = #YEA_STD_YY#
	           AND YEA_EMP_NO = #YEA_EMP_NO#;
	
	        /*연말정산공제자료 삭제*/
	        DELETE FROM YEA_YEYSOM           /*[연말정산공제자료]*/
	         WHERE YEA_STD_YY = #YEA_STD_YY#
	           AND YEA_EMP_NO = #YEA_EMP_NO#;
	
	      EXCEPTION
	         WHEN OTHERS THEN
	            RAISE;
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 월세주택임차차입금1 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE10" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE10.연말정산처리 월세주택임차차입금1 삭제 [YEA_월세주택임차차입금1] */
            v_ROWCNT INT;            
        BEGIN     
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
                  
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금1 삭제*/
	        DELETE FROM YEA_RENTA1
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_RENT_SEQ1 = #YEA_RENT_SEQ1#   /*월세주택임차차입금1_순번*/
            ;
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리  월세주택임차차입금 삭제
********************************************************************************/
-->
	<delete id="YEAA0070_2015.DELETE11" parameterClass="hashmap">
	<![CDATA[
        DECLARE           /* YEAA0070_2015.DELETE11.연말정산처리  월세주택임차차입금 삭제 [YEA_월세주택임차차입금] */
            v_ROWCNT INT;            
        BEGIN     
            /*마감여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_INC_STR025 = '1';
            
            /*마감되었다면 입력불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 마감되었습니다. 입력, 수정, 삭제가 불가 합니다! */      
            END IF;
                  
            /*확정여부 체크*/
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_YEPROC A
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#
               AND A.YEA_PRC_STR001 = '1';
            
            /*확정되었다면 삭제불가*/
            IF v_ROWCNT > 0 THEN
                RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
            END IF;
            
            /*월세주택임차차입금2 삭제*/
	        DELETE FROM YEA_RENTA2
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_RENT_SEQ2 = #YEA_RENT_SEQ2#   /*월세주택임차차입금2_순번*/
            ;
        END;
	]]>
	</delete>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리  부양가족 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC00" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC00.연말정산처리 부양가족 처리 */
        v_ROWCNT INT;
        v_ROWCNT1 INT;
        v_ROWCNT2 INT;
        v_ROWCNT3 INT;
    BEGIN             
        /*확정여부 체크*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_YEPROC A
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_PRC_STR001 = '1';
        
        /*확정되었다면 삭제불가*/
        IF v_ROWCNT > 0 THEN
            RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
        END IF;
 
        /*마감여부 체크*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_INCDEC A
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_INC_STR025 = '1';
        
        /*마감되었다면 삭제불가*/
        IF v_ROWCNT > 0 THEN
            RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 이미 마감되었습니다. 변경/삭제 할 수 없습니다. */  
        END IF;
         
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        
        /*임시 데이터가 있는경우는*/
        SELECT COUNT(*)
          INTO v_ROWCNT1
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = 'Y'||SUBSTR(#YEA_STD_YY#,2,3)
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*출산입양, 6세이하 업데이트*/
        IF V_ROWCNT != 0 AND v_ROWCNT1 != 0 THEN
           UPDATE YEA_YEFAMI A 
              SET (A.YEA_FAM_STR011, A.YEA_FAM_STR012) = ( SELECT CASE WHEN B.YEA_FAM_STR001 IN ('4','8') AND YEA_FAM_STR005 = '1' AND CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004),1,6) >= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#,1,4) || '0101','YYYYMMDD'), -72),'YYYYMMDD') THEN '1' ELSE '0' END   /*6세이하 6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
												                 ,CASE WHEN B.YEA_FAM_STR001 = '4' AND YEA_FAM_STR005 = '1' AND SUBSTR(CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004),1,6),1 ,4) = #YEA_STD_YY# THEN '1' ELSE '0' END   /*출산입양 출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
												             FROM YEA_YEFAMI B
												            WHERE A.YEA_STD_YY = B.YEA_STD_YY
												              AND A.YEA_EMP_NO = B.YEA_EMP_NO
												              AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
												         )
           WHERE A.YEA_EMP_NO = #YEA_EMP_NO#
             AND A.YEA_STD_YY = #YEA_STD_YY#;
        END IF;
        
        IF v_ROWCNT = 0 THEN

            SELECT COUNT(*)
              INTO v_ROWCNT1
              FROM YEA_INCDEC
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;

            IF v_ROWCNT1 = 0 THEN
            
                /*입력*/
                INSERT INTO YEA_INCDEC (
                       YEA_STD_YY
                      ,YEA_EMP_NO
                      ,YEA_INC_STR001   /*입국목적*/
                      ,YEA_INC_STR002   /*기술도입계약 또는 근로제공일*/
                      ,YEA_INC_STR003   /*기술도입계약_감면기간 만료일*/
                      ,YEA_INC_STR004   /*외국인 근로소득에 대한 감면 접수일*/
                      ,YEA_INC_STR005   /*외국인 근로소득에 대한 감면 제출일*/
                      ,YEA_INC_STR006   /*근로소득에 대한 조세조약 상 면제 접수일*/
                      ,YEA_INC_STR007   /*근로소득에 대한 조세조약 상 면제 제출일*/
                      ,YEA_INC_STR008   /*중소기업 취업자 감면_취업일*/
                      ,YEA_INC_STR009   /*중소기업 취업자 감면기간_종료일*/
                      ,YEA_INC_STR010   /*외국납부세액_납세국명*/
                      ,YEA_INC_STR011   /*외국납부세액_납부일*/
                      ,YEA_INC_STR012   /*외국납부세액_신청서제출일*/
                      ,YEA_INC_STR013   /*외국납부세액_국외근무처*/
                      ,YEA_INC_STR014   /*외국납부세액_근무기간*/
                      ,YEA_INC_STR015   /*외국납부세액_직책*/
                      ,YEA_INC_STR016   /*종근무지명종근무지*/
                      ,YEA_INC_STR017   /*종근무지사업자번호*/
                      ,YEA_INC_STR018   /*종근무지영수증제출여부*/
                      ,YEA_INC_STR019   /*소득공제명세서제출여부*/
                      ,YEA_INC_STR020   /*연금저축명세서제출여부*/
                      ,YEA_INC_STR021   /*월세액명세서제출여부*/
                      ,YEA_INC_STR022   /*의료비명세서제출여부*/
                      ,YEA_INC_STR023   /*기부금명세서제출여부*/
                      ,YEA_INC_STR024   /*세대주여부*/
                      ,YEA_INC_STR025   /*입력마감여부*/
                      ,YEA_INC_NUM001   /*국민연금전근무지*/
                      ,YEA_INC_NUM002   /*국민연금현근무지*/
                      ,YEA_INC_NUM003   /*연금보험료전근무지(공무원)*/
                      ,YEA_INC_NUM004   /*연금보험료현근무지(공무원)*/
                      ,YEA_INC_NUM005   /*연금보험료전근무지(군인)*/
                      ,YEA_INC_NUM006   /*연금보험료현근무지(군인)*/
                      ,YEA_INC_NUM007   /*연금보험료전근무지(교직원)*/
                      ,YEA_INC_NUM008   /*연금보험료현근무지(교직원)*/
                      ,YEA_INC_NUM009   /*연금보험료전근무지(우체국)*/
                      ,YEA_INC_NUM010   /*연금보험료현근무지(우체국)*/
                      ,YEA_INC_NUM011   /*건강보험전근무지*/
                      ,YEA_INC_NUM012   /*건강보험현근무지*/
                      ,YEA_INC_NUM013   /*고용보험전근무지*/
                      ,YEA_INC_NUM014   /*고용보험현근무지*/
                      ,YEA_INC_NUM015   /*주택임차원리금상환액(주택기관)*/
                      ,YEA_INC_NUM016   /*주택임차원리금상환액(거주자)*/
                      ,YEA_INC_NUM017   /*장기주택저당차입금_2011년이전(15년미만)*/
                      ,YEA_INC_NUM018   /*장기주택저당차입금 _2011년이전(15년~29년)*/
                      ,YEA_INC_NUM019   /*장기주택저당차입금_2011년이전(30년이상)*/
                      ,YEA_INC_NUM020   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                      ,YEA_INC_NUM021   /*장기주택저당차입금_2012년이후(기타대출)*/
                      ,YEA_INC_NUM022   /*개인연금저축(2000년 이전 가입)*/
                      ,YEA_INC_NUM023   /*소기업·소상공인 공제부금*/
                      ,YEA_INC_NUM024   /*청약저축*/
                      ,YEA_INC_NUM025   /*근로자주택마련저축*/
                      ,YEA_INC_NUM026   /*주택청약종합저축*/
                      ,YEA_INC_NUM027   /*투자조합출자등_2012년 출자·투자분(10%)*/
                      ,YEA_INC_NUM028   /*투자조합출자등_2012년 출자·투자분(20%)*/
                      ,YEA_INC_NUM029   /*투자조합출자등_2013년 출자·투자분(10%)*/
                      ,YEA_INC_NUM030   /*투자조합출자등_2013년 출자·투자분(20%)*/
                      ,YEA_INC_NUM031   /*투자조합출자등_2014년 이후 출자·투자분(10%)*/
                      ,YEA_INC_NUM032   /*투자조합출자등_2014년 이후 출자·투자분(50%)*/
                      ,YEA_INC_NUM033   /*투자조합출자등_2014년 이후 출자·투자분(30%)*/
                      ,YEA_INC_NUM034   /*신용카드*/
                      ,YEA_INC_NUM035   /*직불·선불카드*/
                      ,YEA_INC_NUM036   /*현금영수증*/
                      ,YEA_INC_NUM037   /*전통시장사용분*/
                      ,YEA_INC_NUM038   /*대중교통이용분*/
                      ,YEA_INC_NUM039   /*본인 신용카드등 사용액(2013년)*/
                      ,YEA_INC_NUM040   /*본인 신용카드등 사용액(2014년)*/
                      ,YEA_INC_NUM041   /*본인 추가공제율 사용분(2013년)*/
                      ,YEA_INC_NUM042   /*본인 추가공제율 사용분(2014년하반기)*/
                      ,YEA_INC_NUM043   /*우리사주조합 출연금*/
                      ,YEA_INC_NUM044   /*우리사주조합 기부금*/
                      ,YEA_INC_NUM045   /*고용유지중소기업 근로자*/
                      ,YEA_INC_NUM046   /*목돈 안드는 전세 이자상환액*/
                      ,YEA_INC_NUM047   /*장기집합투자증권저축*/
                      ,YEA_INC_NUM048   /*자녀 수*/
                      ,YEA_INC_NUM049   /*과학기술인공제*/
                      ,YEA_INC_NUM050   /*「근로자퇴직급여 보장법」에 따른 퇴직연금*/
                      ,YEA_INC_NUM051   /*연금저축*/
                      ,YEA_INC_NUM052   /*보험료_보장성*/
                      ,YEA_INC_NUM053   /*보험료_장애인전용보장성*/
                      ,YEA_INC_NUM054   /*의료비_본인ㆍ65세 이상자ㆍ장애인*/
                      ,YEA_INC_NUM055   /*의료비_그 밖의 공제대상자*/
                      ,YEA_INC_NUM056   /*교육비_소득자본인*/
                      ,YEA_INC_NUM057   /*교육비_취학전 아동 수*/
                      ,YEA_INC_NUM058   /*교육비_취학전 아동*/
                      ,YEA_INC_NUM059   /*교육비_초·중·고등학교 학생 수*/
                      ,YEA_INC_NUM060   /*교육비_초·중·고등학교*/
                      ,YEA_INC_NUM061   /*교육비_대학생 수*/
                      ,YEA_INC_NUM062   /*교육비_대학생*/
                      ,YEA_INC_NUM063   /*교육비_장애인 수*/
                      ,YEA_INC_NUM064   /*교육비_장애인*/
                      ,YEA_INC_NUM065   /*정치자금기부금(10만원이하)*/
                      ,YEA_INC_NUM066   /*정치자금기부금(10만원초과)*/
                      ,YEA_INC_NUM067   /*법정기부금(당해)*/
                      ,YEA_INC_NUM068   /*지정기부금(당해)*/
                      ,YEA_INC_NUM069   /*종교단체지정기부금(당해)*/
                      ,YEA_INC_NUM070   /*외국납부세액_국외원천소득*/
                      ,YEA_INC_NUM071   /*외국납부세액_납세액(외화)*/
                      ,YEA_INC_NUM072   /*외국납부세액_납세액(원화)*/
                      ,YEA_INC_NUM073   /*주택자금차입금이자세액공제*/
                      ,YEA_INC_NUM074   /*월세세액공제*/
                      ,YEA_INC_NUM075   /*종근무지급여총액*/
                      ,YEA_INC_NUM076   /*종근무지소득세*/
                      ,YEA_INC_NUM077   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(고정금리이면서,비거치)*/
		              ,YEA_INC_NUM078   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(고정금리이거나,비거치)*/
		              ,YEA_INC_NUM079   /*[2015귀속] 장기주택저당차입금_2015년이후,15년이상(기타대출)*/
		              ,YEA_INC_NUM080   /*[2015귀속] 장기주택저당차입금_2015년이후,10~15년(고정금리이거나,비거치)*/
		              ,YEA_INC_NUM081   /*[2015귀속] 청약저축(2015.01.01 이후 가입분)*/
		              ,YEA_INC_NUM082   /*[2015귀속] 주택청약종합저축(2015.01.01 이후 가입분)*/
		              ,YEA_INC_NUM083   /*[2015귀속] 투자조합출자등_2015년 출자·투자분(50%)*/
		              ,YEA_INC_NUM084   /*[2015귀속] 투자조합출자등_2015년 출자·투자분(30%)*/
		              ,YEA_INC_NUM085   /*[2015귀속] 본인 신용카드등 사용액(2015년)*/
		              ,YEA_INC_NUM086   /*[2015귀속] 본인 추가공제율 사용분(2014년)*/
		              ,YEA_INC_NUM087   /*[2015귀속] 본인 추가공제율 사용분(2015년 하반기)*/
		              ,YEA_INC_NUM088   /*[2015귀속] 6세이하자녀수*/
		              ,YEA_INC_NUM089   /*[2015귀속] 출산입양수*/
                      ,YEA_INS_DATE
                      ,YEA_INS_USER_ID
                      ,YEA_UPD_DATE
                      ,YEA_UPD_USER_ID
                    ) VALUES (
                      #YEA_STD_YY#
                     ,#YEA_EMP_NO#
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,''
                     ,'0'
                     ,'0'
                     ,'0'
                     ,'0'
                     ,'0'
                     ,'0'
                     ,(SELECT YEA_HOUSEHOLD_YN FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#)) WHERE YEA_EMP_NO = #YEA_EMP_NO#) /*세대주여부*/
                     ,'0'
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,0
                     ,SYSDATE
                     ,#UPDT_USID#
                     ,SYSDATE
                     ,#UPDT_USID#
                );
            END IF;

            /*이전 자료가 있으면 이전자료에서 읽을것.*/
            SELECT COUNT(*)
              INTO v_ROWCNT2
              FROM YEA_YEFAMI
             WHERE YEA_STD_YY = (
                                 SELECT MAX(YEA_STD_YY)
                                   FROM YEA_YEFAMI
                                  WHERE YEA_STD_YY < #YEA_STD_YY#
                                    AND YEA_EMP_NO = #YEA_EMP_NO#
                                )
               AND YEA_EMP_NO = #YEA_EMP_NO#;
            
            IF v_ROWCNT2 > 0 THEN

              INSERT INTO YEA_YEFAMI (
                     YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_FAMI_SEQ
                    ,YEA_FAM_STR001   /*가족관계신고코드*/
                    ,YEA_FAM_STR002   /*내외국인구분*/
                    ,YEA_FAM_STR003   /*성명*/
                    ,YEA_FAM_STR004   /*주민등록번호*/
                    ,YEA_FAM_STR005   /*기본공제여부*/
                    ,YEA_FAM_STR006   /*경로자여부*/
                    ,YEA_FAM_STR007   /*부녀자여부*/
                    ,YEA_FAM_STR008   /*한부모여부*/
                    ,YEA_FAM_STR009   /*장애자여부*/
                    ,YEA_FAM_STR010   /*교육비구분코드*/
                    ,YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                    ,YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                    ,YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                    ,YEA_FAM_NUM004   /*보험료_보장성_기타*/
                    ,YEA_FAM_NUM005   /*의료비_국세청*/
                    ,YEA_FAM_NUM006   /*의료비_기타*/
                    ,YEA_FAM_NUM007   /*교육비_국세청*/
                    ,YEA_FAM_NUM008   /*교육비_기타*/
                    ,YEA_FAM_NUM009   /*신용카드_국세청*/
                    ,YEA_FAM_NUM010   /*신용카드_기타*/
                    ,YEA_FAM_NUM011   /*직불카드_국세청*/
                    ,YEA_FAM_NUM012   /*직불카드_기타*/
                    ,YEA_FAM_NUM013   /*현금영수증_국세청*/
                    ,YEA_FAM_NUM014   /*전통시장_국세청*/
                    ,YEA_FAM_NUM015   /*전통시장_기타*/
                    ,YEA_FAM_NUM016   /*대중교통_국세청*/
                    ,YEA_FAM_NUM017   /*대중교통_기타*/
                    ,YEA_FAM_NUM018   /*기부금_국세청*/
                    ,YEA_FAM_NUM019   /*기부금_기타*/
                    ,YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM022   /*[2015귀속] 추가 난임시술비_국세청*/
                  	,YEA_FAM_NUM023   /*[2015귀속] 추가 난임시술비_기타*/  
                    ,YEA_INS_DATE
                    ,YEA_INS_USER_ID
                    ,YEA_UPD_DATE
                    ,YEA_UPD_USER_ID
                    )
             SELECT #YEA_STD_YY#
                   ,YEA_EMP_NO
                   ,YEA_FAMI_SEQ
                   ,YEA_FAM_STR001   /*가족관계신고코드*/
                   ,YEA_FAM_STR002   /*내외국인구분*/
                   ,YEA_FAM_STR003   /*성명*/
                   ,YEA_FAM_STR004   /*주민등록번호*/
                   ,YEA_FAM_STR005   /*기본공제여부*/
                   ,CASE WHEN YEA_FAM_STR005 = '1' AND
                    CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004), 7, 1) IN ('1', '2', '5', '6') THEN '19' ELSE '20' END
                    || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004), 1, 6) <= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#, 1, 4) || '1231', 'YYYYMMDD'), -840),'YYYYMMDD')
                    THEN '1' ELSE '0' END  /*경로자여부*/
                   ,YEA_FAM_STR007   /*부녀자여부*/
                   ,YEA_FAM_STR008   /*한부모여부*/
                   ,YEA_FAM_STR009   /*장애자여부*/
                   ,''               /*교육비구분코드*/
                   ,CASE WHEN YEA_FAM_STR001 IN ('4','8') AND YEA_FAM_STR005 = '1' AND CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) >= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#,1,4) || '0101','YYYYMMDD'), -72),'YYYYMMDD') THEN '1' ELSE '0' END   /*6세이하 6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                   ,CASE WHEN YEA_FAM_STR001 = '4' AND YEA_FAM_STR005 = '1' AND SUBSTR(CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6),1 ,4) = #YEA_STD_YY# THEN '1' ELSE '0' END   /*출산입양 출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                   ,0                /*보험료_건강고용_국세청*/
                   ,0                /*보험료_건강고용_기타*/
                   ,0                /*보험료_보장성_국세청*/
                   ,0                /*보험료_보장성_기타*/
                   ,0                /*의료비_국세청*/
                   ,0                /*의료비_기타*/
                   ,0                /*교육비_국세청*/
                   ,0                /*교육비_기타*/
                   ,0                /*신용카드_국세청*/
                   ,0                /*신용카드_기타*/
                   ,0                /*직불카드_국세청*/
                   ,0                /*직불카드_기타*/
                   ,0                /*현금영수증_국세청*/
                   ,0                /*전통시장_국세청*/
                   ,0                /*전통시장_기타*/
                   ,0                /*대중교통_국세청*/
                   ,0                /*대중교통_기타*/
                   ,0                /*기부금_국세청*/
                   ,0                /*기부금_기타*/
                   ,0                /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                   ,0                /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                   ,0  	 			 /*[2015귀속] 추가 난임시술비_국세청*/
                   ,0  	 			 /*[2015귀속] 추가 난임시술비_기타*/  
                   ,SYSDATE
                   ,#UPDT_USID#
                   ,SYSDATE
                   ,#UPDT_USID#
               FROM YEA_YEFAMI
              WHERE YEA_STD_YY = (
                                  SELECT MAX(YEA_STD_YY)
                                    FROM YEA_YEFAMI
                                   WHERE YEA_STD_YY < #YEA_STD_YY#
                                     AND YEA_EMP_NO = #YEA_EMP_NO#
                                  )
                AND YEA_EMP_NO = #YEA_EMP_NO#;
            
            END IF;
        END IF;   
        
             /*본인자료 입력*/
             MERGE INTO YEA_YEFAMI S
			 USING ( 
			          SELECT #YEA_STD_YY#                       AS YEA_STD_YY
		                    ,A.YEA_EMP_NO                       AS YEA_EMP_NO
		                    ,1                                  AS YEA_FAMI_SEQ               /*가족순번*/
		                    ,'0'                                AS YEA_FAM_STR001             /*가족관계신고코드*/
		                    ,A.YEA_LOFO_CD                      AS YEA_FAM_STR002             /*내외국인구분*/
		                    ,A.YEA_EMP_NM                       AS YEA_FAM_STR003             /*성명*/
		                    ,SF_YEA_ENCRYPT_SSN(A.YEA_EMP_SSN)  AS YEA_FAM_STR004             /*주민등록번호*/
		                    ,'1'                                AS YEA_FAM_STR005             /*기본공제여부*/
		                    ,CASE WHEN CASE WHEN SUBSTR(A.YEA_EMP_SSN, 7, 1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(A.YEA_EMP_SSN, 1, 6) <= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#, 1, 4) || '1231', 'YYYYMMDD'), -840),'YYYYMMDD') THEN '1' ELSE '0' END AS YEA_FAM_STR006  /*경로자여부*/
		                    ,CASE WHEN SUBSTR(A.YEA_EMP_SSN, 7, 1) IN ('2', '4') THEN '1' ELSE '0' END                                                      AS YEA_FAM_STR007  /*부녀자여부*/
		                    ,'0'                                AS YEA_FAM_STR008             /*한부모여부*/
		                    ,(SELECT SUB.YEA_RE1F_VALUE FROM VI_YEA_CODEXD SUB WHERE SUB.YEA_COMM_CD = 'YEA_90005' AND SUB.YEA_COMD_CD = A.YEA_DISABLED_CD) AS YEA_FAM_STR009  /*장애자여부*/
		                    ,''                                 AS YEA_FAM_STR010             /*교육비구분코드*/
		                    ,'0'                                AS YEA_FAM_STR011             /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,'0'                                AS YEA_FAM_STR012             /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM001             /*보험료_건강고용_국세청*/
		                    ,0                                  AS YEA_FAM_NUM002             /*보험료_건강고용_기타*/
		                    ,0                                  AS YEA_FAM_NUM003             /*보험료_보장성_국세청*/
		                    ,0                                  AS YEA_FAM_NUM004             /*보험료_보장성_기타*/
		                    ,0                                  AS YEA_FAM_NUM005             /*의료비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM006             /*의료비_기타*/
		                    ,0                                  AS YEA_FAM_NUM007             /*교육비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM008             /*교육비_기타*/
		                    ,0                                  AS YEA_FAM_NUM009             /*신용카드_국세청*/
		                    ,0                                  AS YEA_FAM_NUM010             /*신용카드_기타*/
		                    ,0                                  AS YEA_FAM_NUM011             /*직불카드_국세청*/
		                    ,0                                  AS YEA_FAM_NUM012             /*직불카드_기타*/
		                    ,0                                  AS YEA_FAM_NUM013             /*현금영수증_국세청*/
		                    ,0                                  AS YEA_FAM_NUM014             /*전통시장_국세청*/
		                    ,0                                  AS YEA_FAM_NUM015             /*전통시장_기타*/
		                    ,0                                  AS YEA_FAM_NUM016             /*대중교통_국세청*/
		                    ,0                                  AS YEA_FAM_NUM017             /*대중교통_기타*/
		                    ,0                                  AS YEA_FAM_NUM018             /*기부금_국세청*/
		                    ,0                                  AS YEA_FAM_NUM019             /*기부금_기타*/
		                    ,0                                  AS YEA_FAM_NUM020			  /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM021   		  /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM022  		   	  /*[2015귀속] 추가 난임시술비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM023			  /*[2015귀속] 추가 난임시술비_기타*/  
		                    ,SYSDATE                            AS YEA_INS_DATE
		                    ,#UPDT_USID#                        AS YEA_INS_USER_ID
		                    ,SYSDATE                            AS YEA_UPD_DATE
		                    ,#UPDT_USID#                        AS YEA_UPD_USER_ID
		                FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#, #YEA_STD_YY# || '1231')) A
		               WHERE A.YEA_EMP_NO = #YEA_EMP_NO#
			       ) M
			    ON ( S.YEA_STD_YY = #YEA_STD_YY# AND S.YEA_EMP_NO = M.YEA_EMP_NO AND S.YEA_FAMI_SEQ = M.YEA_FAMI_SEQ)	
			 WHEN MATCHED THEN UPDATE SET
    			     S.YEA_FAM_STR002 = M.YEA_FAM_STR002   /*내외국인구분*/
                    ,S.YEA_FAM_STR003 = M.YEA_FAM_STR003   /*성명*/
                    ,S.YEA_FAM_STR004 = M.YEA_FAM_STR004   /*주민등록번호*/
                    ,S.YEA_FAM_STR006 = M.YEA_FAM_STR006   /*경로자여부*/
                    ,S.YEA_FAM_STR007 = M.YEA_FAM_STR007   /*부녀자여부*/
                    ,S.YEA_FAM_STR008 = M.YEA_FAM_STR008   /*한부모여부*/
                    ,S.YEA_FAM_STR009 = M.YEA_FAM_STR009   /*장애자여부*/
             WHEN NOT MATCHED THEN INSERT	
				( 	                		 
                     YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_FAMI_SEQ
                    ,YEA_FAM_STR001   /*가족관계신고코드*/
                    ,YEA_FAM_STR002   /*내외국인구분*/
                    ,YEA_FAM_STR003   /*성명*/
                    ,YEA_FAM_STR004   /*주민등록번호*/
                    ,YEA_FAM_STR005   /*기본공제여부*/
                    ,YEA_FAM_STR006   /*경로자여부*/
                    ,YEA_FAM_STR007   /*부녀자여부*/
                    ,YEA_FAM_STR008   /*한부모여부*/
                    ,YEA_FAM_STR009   /*장애자여부*/
                    ,YEA_FAM_STR010   /*교육비구분코드*/
                    ,YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                    ,YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                    ,YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                    ,YEA_FAM_NUM004   /*보험료_보장성_기타*/
                    ,YEA_FAM_NUM005   /*의료비_국세청*/
                    ,YEA_FAM_NUM006   /*의료비_기타*/
                    ,YEA_FAM_NUM007   /*교육비_국세청*/
                    ,YEA_FAM_NUM008   /*교육비_기타*/
                    ,YEA_FAM_NUM009   /*신용카드_국세청*/
                    ,YEA_FAM_NUM010   /*신용카드_기타*/
                    ,YEA_FAM_NUM011   /*직불카드_국세청*/
                    ,YEA_FAM_NUM012   /*직불카드_기타*/
                    ,YEA_FAM_NUM013   /*현금영수증_국세청*/
                    ,YEA_FAM_NUM014   /*전통시장_국세청*/
                    ,YEA_FAM_NUM015   /*전통시장_기타*/
                    ,YEA_FAM_NUM016   /*대중교통_국세청*/
                    ,YEA_FAM_NUM017   /*대중교통_기타*/
                    ,YEA_FAM_NUM018   /*기부금_국세청*/
                    ,YEA_FAM_NUM019   /*기부금_기타*/
                    ,YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM022   /*[2015귀속] 추가 난임시술비_국세청*/
                    ,YEA_FAM_NUM023   /*[2015귀속] 추가 난임시술비_기타*/  
                    ,YEA_INS_DATE
                    ,YEA_INS_USER_ID
                    ,YEA_UPD_DATE
                    ,YEA_UPD_USER_ID
                    )
             VALUES (
                     M.YEA_STD_YY
                    ,M.YEA_EMP_NO
                    ,M.YEA_FAMI_SEQ               /*가족순번*/
                    ,M.YEA_FAM_STR001             /*가족관계신고코드*/
                    ,M.YEA_FAM_STR002             /*내외국인구분*/
                    ,M.YEA_FAM_STR003             /*성명*/
                    ,M.YEA_FAM_STR004             /*주민등록번호*/
                    ,M.YEA_FAM_STR005             /*기본공제여부*/
                    ,M.YEA_FAM_STR006             /*경로자여부*/
                    ,M.YEA_FAM_STR007             /*부녀자여부*/
                    ,M.YEA_FAM_STR008             /*한부모여부*/
                    ,M.YEA_FAM_STR009             /*장애자여부*/
                    ,M.YEA_FAM_STR010             /*교육비구분코드*/
                    ,M.YEA_FAM_STR011             /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_STR012             /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM001             /*보험료_건강고용_국세청*/
                    ,M.YEA_FAM_NUM002             /*보험료_건강고용_기타*/
                    ,M.YEA_FAM_NUM003             /*보험료_보장성_국세청*/
                    ,M.YEA_FAM_NUM004             /*보험료_보장성_기타*/
                    ,M.YEA_FAM_NUM005             /*의료비_국세청*/
                    ,M.YEA_FAM_NUM006             /*의료비_기타*/
                    ,M.YEA_FAM_NUM007             /*교육비_국세청*/
                    ,M.YEA_FAM_NUM008             /*교육비_기타*/
                    ,M.YEA_FAM_NUM009             /*신용카드_국세청*/
                    ,M.YEA_FAM_NUM010             /*신용카드_기타*/
                    ,M.YEA_FAM_NUM011             /*직불카드_국세청*/
                    ,M.YEA_FAM_NUM012             /*직불카드_기타*/
                    ,M.YEA_FAM_NUM013             /*현금영수증_국세청*/
                    ,M.YEA_FAM_NUM014             /*전통시장_국세청*/
                    ,M.YEA_FAM_NUM015             /*전통시장_기타*/
                    ,M.YEA_FAM_NUM016             /*대중교통_국세청*/
                    ,M.YEA_FAM_NUM017             /*대중교통_기타*/
                    ,M.YEA_FAM_NUM018             /*기부금_국세청*/
                    ,M.YEA_FAM_NUM019             /*기부금_기타*/
                    ,M.YEA_FAM_NUM020			  /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM021   		  /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM022  		   	  /*[2015귀속] 추가 난임시술비_국세청*/
                    ,M.YEA_FAM_NUM023			  /*[2015귀속] 추가 난임시술비_기타*/  
                    ,M.YEA_INS_DATE
                    ,M.YEA_INS_USER_ID
                    ,M.YEA_UPD_DATE
                    ,M.YEA_UPD_USER_ID
                    );
            

             /*가족자료입력*/
	         MERGE INTO YEA_YEFAMI S
			 USING ( 
			          SELECT #YEA_STD_YY#                       AS YEA_STD_YY
		                    ,A.YEA_EMP_NO                       AS YEA_EMP_NO
		                    ,ROW_NUMBER() OVER(ORDER BY B.YEA_FAMI_SEQ, B.YEA_FAMI_SSN) +1                                                                         AS YEA_FAMI_SEQ               /*가족순번*/
		                    ,B.YEA_FAMI_NTS_CD                  AS YEA_FAM_STR001             /*가족관계신고코드*/
		                    ,CASE WHEN SUBSTR(B.YEA_FAMI_SSN,7,1) IN ('1','2','3','4') THEN '1' WHEN SUBSTR(B.YEA_FAMI_SSN,7,1) IN ('5','6','7','8') THEN '9' END  AS YEA_FAM_STR002             /*내외국인구분*/
		                    ,B.YEA_FAMI_NM                      AS YEA_FAM_STR003             /*성명*/
		                    ,B.YEA_FAMI_SSN                     AS YEA_FAM_STR004             /*주민등록번호*/
		                    ,B.YEA_FAMI_NTS_YN                  AS YEA_FAM_STR005             /*기본공제여부*/
		                    ,CASE WHEN CASE WHEN SUBSTR(A.YEA_EMP_SSN, 7, 1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(A.YEA_EMP_SSN, 1, 6) <= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#, 1, 4) || '1231', 'YYYYMMDD'), -840),'YYYYMMDD') THEN '1' ELSE '0' END                                AS YEA_FAM_STR006             /*경로자여부*/
		                    ,'0'                                AS YEA_FAM_STR007             /*부녀자여부*/
		                    ,'0'                                AS YEA_FAM_STR008             /*한부모여부*/
		                    ,DECODE(B.YEA_FAMI_NTS_YN,'1',NVL(B.YEA_DISABLED_YN, '0'),'0')                                                                         AS YEA_FAM_STR009             /*장애자여부*/
		                    ,''                                 AS YEA_FAM_STR010             /*교육비구분코드*/
		                    ,CASE WHEN B.YEA_FAMI_NTS_CD IN ('4', '8') AND CASE WHEN SUBSTR(B.YEA_FAMI_SSN,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(B.YEA_FAMI_SSN,1,6) >= TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#,1,4) || '0101','YYYYMMDD'), -72),'YYYYMMDD') THEN '1' ELSE '0' END  AS YEA_FAM_STR011             /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,CASE WHEN B.YEA_FAMI_NTS_CD = '4' AND SUBSTR(CASE WHEN SUBSTR(B.YEA_FAMI_SSN,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(B.YEA_FAMI_SSN,1,6),1 ,4) = #YEA_STD_YY# THEN '1' ELSE '0' END                                                                             AS YEA_FAM_STR012             /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM001             /*보험료_건강고용_국세청*/
		                    ,0                                  AS YEA_FAM_NUM002             /*보험료_건강고용_기타*/
		                    ,0                                  AS YEA_FAM_NUM003             /*보험료_보장성_국세청*/
		                    ,0                                  AS YEA_FAM_NUM004             /*보험료_보장성_기타*/
		                    ,0                                  AS YEA_FAM_NUM005             /*의료비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM006             /*의료비_기타*/
		                    ,0                                  AS YEA_FAM_NUM007             /*교육비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM008             /*교육비_기타*/
		                    ,0                                  AS YEA_FAM_NUM009             /*신용카드_국세청*/
		                    ,0                                  AS YEA_FAM_NUM010             /*신용카드_기타*/
		                    ,0                                  AS YEA_FAM_NUM011             /*직불카드_국세청*/
		                    ,0                                  AS YEA_FAM_NUM012             /*직불카드_기타*/
		                    ,0                                  AS YEA_FAM_NUM013             /*현금영수증_국세청*/
		                    ,0                                  AS YEA_FAM_NUM014             /*전통시장_국세청*/
		                    ,0                                  AS YEA_FAM_NUM015             /*전통시장_기타*/
		                    ,0                                  AS YEA_FAM_NUM016             /*대중교통_국세청*/
		                    ,0                                  AS YEA_FAM_NUM017             /*대중교통_기타*/
		                    ,0                                  AS YEA_FAM_NUM018             /*기부금_국세청*/
		                    ,0                                  AS YEA_FAM_NUM019             /*기부금_기타*/
		                    ,0                                  AS YEA_FAM_NUM020			  /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM021   		  /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
		                    ,0                                  AS YEA_FAM_NUM022  		   	  /*[2015귀속] 추가 난임시술비_국세청*/
		                    ,0                                  AS YEA_FAM_NUM023			  /*[2015귀속] 추가 난임시술비_기타*/  
		                    ,SYSDATE                            AS YEA_INS_DATE
		                    ,#UPDT_USID#                        AS YEA_INS_USER_ID
		                    ,SYSDATE                            AS YEA_UPD_DATE
		                    ,#UPDT_USID#                        AS YEA_UPD_USER_ID
		                FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#, #YEA_STD_YY# || '1231')) A
                  INNER JOIN VI_YEA_FAMYXM B
                          ON A.YEA_EMP_NO = B.YEA_EMP_NO
                       WHERE A.YEA_EMP_NO = #YEA_EMP_NO#                   		               
			       ) M
			    ON ( S.YEA_STD_YY = #YEA_STD_YY# AND S.YEA_EMP_NO = M.YEA_EMP_NO AND S.YEA_FAMI_SEQ = M.YEA_FAMI_SEQ)	
			 WHEN MATCHED THEN UPDATE SET
			         S.YEA_FAM_STR001 = M.YEA_FAM_STR001   /*가족관계신고코드*/
    			    ,S.YEA_FAM_STR002 = M.YEA_FAM_STR002   /*내외국인구분*/
                    ,S.YEA_FAM_STR003 = M.YEA_FAM_STR003   /*성명*/
                    ,S.YEA_FAM_STR004 = M.YEA_FAM_STR004   /*주민등록번호*/
                    ,S.YEA_FAM_STR005 = M.YEA_FAM_STR005
                    ,S.YEA_FAM_STR006 = M.YEA_FAM_STR006   /*경로자여부*/
                    ,S.YEA_FAM_STR007 = M.YEA_FAM_STR007   /*부녀자여부*/
                    ,S.YEA_FAM_STR008 = M.YEA_FAM_STR008   /*한부모여부*/
                    ,S.YEA_FAM_STR009 = M.YEA_FAM_STR009   /*장애자여부*/
                    ,S.YEA_FAM_STR010 = M.YEA_FAM_STR010 
                    ,S.YEA_FAM_STR011 = M.YEA_FAM_STR011
                    ,S.YEA_FAM_STR012 = M.YEA_FAM_STR012
             WHEN NOT MATCHED THEN INSERT	
				( 	                		 
                     YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_FAMI_SEQ
                    ,YEA_FAM_STR001   /*가족관계신고코드*/
                    ,YEA_FAM_STR002   /*내외국인구분*/
                    ,YEA_FAM_STR003   /*성명*/
                    ,YEA_FAM_STR004   /*주민등록번호*/
                    ,YEA_FAM_STR005   /*기본공제여부*/
                    ,YEA_FAM_STR006   /*경로자여부*/
                    ,YEA_FAM_STR007   /*부녀자여부*/
                    ,YEA_FAM_STR008   /*한부모여부*/
                    ,YEA_FAM_STR009   /*장애자여부*/
                    ,YEA_FAM_STR010   /*교육비구분코드*/
                    ,YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                    ,YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                    ,YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                    ,YEA_FAM_NUM004   /*보험료_보장성_기타*/
                    ,YEA_FAM_NUM005   /*의료비_국세청*/
                    ,YEA_FAM_NUM006   /*의료비_기타*/
                    ,YEA_FAM_NUM007   /*교육비_국세청*/
                    ,YEA_FAM_NUM008   /*교육비_기타*/
                    ,YEA_FAM_NUM009   /*신용카드_국세청*/
                    ,YEA_FAM_NUM010   /*신용카드_기타*/
                    ,YEA_FAM_NUM011   /*직불카드_국세청*/
                    ,YEA_FAM_NUM012   /*직불카드_기타*/
                    ,YEA_FAM_NUM013   /*현금영수증_국세청*/
                    ,YEA_FAM_NUM014   /*전통시장_국세청*/
                    ,YEA_FAM_NUM015   /*전통시장_기타*/
                    ,YEA_FAM_NUM016   /*대중교통_국세청*/
                    ,YEA_FAM_NUM017   /*대중교통_기타*/
                    ,YEA_FAM_NUM018   /*기부금_국세청*/
                    ,YEA_FAM_NUM019   /*기부금_기타*/
                    ,YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                    ,YEA_FAM_NUM022   /*[2015귀속] 추가 난임시술비_국세청*/
                    ,YEA_FAM_NUM023   /*[2015귀속] 추가 난임시술비_기타*/  
                    ,YEA_INS_DATE
                    ,YEA_INS_USER_ID
                    ,YEA_UPD_DATE
                    ,YEA_UPD_USER_ID
                    )
             VALUES (
                     M.YEA_STD_YY
                    ,M.YEA_EMP_NO
                    ,M.YEA_FAMI_SEQ               /*가족순번*/
                    ,M.YEA_FAM_STR001             /*가족관계신고코드*/
                    ,M.YEA_FAM_STR002             /*내외국인구분*/
                    ,M.YEA_FAM_STR003             /*성명*/
                    ,M.YEA_FAM_STR004             /*주민등록번호*/
                    ,M.YEA_FAM_STR005             /*기본공제여부*/
                    ,M.YEA_FAM_STR006             /*경로자여부*/
                    ,M.YEA_FAM_STR007             /*부녀자여부*/
                    ,M.YEA_FAM_STR008             /*한부모여부*/
                    ,M.YEA_FAM_STR009             /*장애자여부*/
                    ,M.YEA_FAM_STR010             /*교육비구분코드*/
                    ,M.YEA_FAM_STR011             /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_STR012             /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM001             /*보험료_건강고용_국세청*/
                    ,M.YEA_FAM_NUM002             /*보험료_건강고용_기타*/
                    ,M.YEA_FAM_NUM003             /*보험료_보장성_국세청*/
                    ,M.YEA_FAM_NUM004             /*보험료_보장성_기타*/
                    ,M.YEA_FAM_NUM005             /*의료비_국세청*/
                    ,M.YEA_FAM_NUM006             /*의료비_기타*/
                    ,M.YEA_FAM_NUM007             /*교육비_국세청*/
                    ,M.YEA_FAM_NUM008             /*교육비_기타*/
                    ,M.YEA_FAM_NUM009             /*신용카드_국세청*/
                    ,M.YEA_FAM_NUM010             /*신용카드_기타*/
                    ,M.YEA_FAM_NUM011             /*직불카드_국세청*/
                    ,M.YEA_FAM_NUM012             /*직불카드_기타*/
                    ,M.YEA_FAM_NUM013             /*현금영수증_국세청*/
                    ,M.YEA_FAM_NUM014             /*전통시장_국세청*/
                    ,M.YEA_FAM_NUM015             /*전통시장_기타*/
                    ,M.YEA_FAM_NUM016             /*대중교통_국세청*/
                    ,M.YEA_FAM_NUM017             /*대중교통_기타*/
                    ,M.YEA_FAM_NUM018             /*기부금_국세청*/
                    ,M.YEA_FAM_NUM019             /*기부금_기타*/
                    ,M.YEA_FAM_NUM020			  /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM021   		  /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                    ,M.YEA_FAM_NUM022  		   	  /*[2015귀속] 추가 난임시술비_국세청*/
                    ,M.YEA_FAM_NUM023			  /*[2015귀속] 추가 난임시술비_기타*/  
                    ,M.YEA_INS_DATE
                    ,M.YEA_INS_USER_ID
                    ,M.YEA_UPD_DATE
                    ,M.YEA_UPD_USER_ID
                    );          
            
            /*부녀자공제 체크 중 남편이 없는 사람 제외*/
            SELECT COUNT(*)
              INTO v_ROWCNT3
              FROM YEA_YEFAMI
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAM_STR001 = '3';

            IF v_ROWCNT3 = 0 THEN
              UPDATE YEA_YEFAMI
                 SET YEA_FAM_STR007 = '0'
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_FAM_STR007 = '1';
            END IF;

            /*기본공제여부가 'Y' 이면서 연령제한(직계존속이면서 60세미만, 직계비속이면서 20세초과, 형제자매로서 20세초과, 60세미만)*/
            /*인경우는 장애자여부가 'Y' 가 아닐때에는 기본공제여부 N, 장애자여부 N, 육세이하자녀여부 N, 경로자여부 N,  다자녀여부 N, 출산입양자여부 N*/
            UPDATE YEA_YEFAMI
               SET YEA_FAM_STR005 = '0'
                  ,YEA_FAM_STR006 = '0'
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAM_STR005 = '1'
               AND NVL(YEA_FAM_STR009, '0') = '0' /*장애자여부*/
               AND ((YEA_FAM_STR001 IN ('1','2','6') AND CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) > TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#,1,4) || '1231','YYYYMMDD'), -720),'YYYYMMDD') )
                  OR
                    (YEA_FAM_STR001 IN ('4','5','6') AND CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) < TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(#YEA_STD_YY#,1,4) || '0101','YYYYMMDD'), -240),'YYYYMMDD') )
                   );            

    END;
    ]]>	
	</update>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 근로소득 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC01" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC01.연말정산처리 근로소득 처리 */
        v_ROWCNT INT;
        v_TARN_STDT VARCHAR2(8);   /*20160511 중소기업취업감면 시작일*/
        v_TARN_ENDT VARCHAR2(8);   /*20160511 중소기업취업감면 종료일*/
    BEGIN             	
        v_TARN_STDT := '';         /*20160511 중소기업취업감면 시작일*/
       	v_TARN_ENDT := '';         /*20160511 중소기업취업감면 종료일*/
       
        /*확정여부 체크*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_YEPROC A
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_PRC_STR001 = '1';
        
        /*확정되었다면 삭제불가*/
        IF v_ROWCNT > 0 THEN
            RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA012')); /* 이미 확정되었습니다. 변경/삭제 할 수 없습니다. */  
        END IF;
        
        /*마감여부 체크*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_INCDEC A
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_INC_STR025 = '1';
        
        /*마감되었다면 삭제불가*/
        IF v_ROWCNT > 0 THEN
           RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA007')); /* 이미 마감되었습니다. 변경/삭제 할 수 없습니다. */    
        END IF;
        
        /*부양가족처리 체크*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_INCDEC A
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#;
            
        /*부양가족처리 미처리시 수정불가*/
        IF v_ROWCNT = 0 THEN
            RAISE_APPLICATION_ERROR(-20000, SF_GET_MESSAGE('YEA005', '부양가족')); /* 부양가족 처리를 먼저 실행하세요! */    
        END IF;
      
        /*이전 자료 삭제*/
        DELETE FROM YEA_PAYDTL
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
           
        
        INSERT INTO YEA_PAYDTL (
                    YEA_STD_YY
                  , YEA_PAY_YYMM      /*지급년월*/
                  , YEA_EMP_NO        /*사원번호*/
                  , YEA_PAY_NUM001    /*지급금액*/
                  , YEA_PAY_NUM002    /*기타소득*/
                  , YEA_PAY_NUM003    /*상여금액*/
                  , YEA_PAY_NUM004    /*인정상여*/
                  , YEA_PAY_NUM005    /*주식매수선택권행사이익*/
                  , YEA_PAY_NUM006    /*우리사주조합인출금*/
                  , YEA_PAY_NUM007    /*임원 퇴직소득금액 한도초과액*/
                  , YEA_PAY_STR001    /*국외근로지급연월*/
                  , YEA_PAY_NUM008    /*국외근로외화금액*/
                  , YEA_PAY_NUM009    /*국외근로원화금액*/
                  , YEA_PAY_NUM010    /*야간근로비과세*/
                  , YEA_PAY_NUM011    /*출산보육비과세*/
                  , YEA_PAY_NUM012    /*연구활동비과세*/
                  , YEA_PAY_STR002    /*비과세내용*/
                  , YEA_PAY_NUM013    /*기타비과세액*/
                  , YEA_PAY_NUM014    /*감면세액*/
                  , YEA_PAY_NUM015    /*소득세*/
                  , YEA_PAY_NUM016    /*주민세*/
                  , YEA_PAY_NUM017    /*농특세*/
                  , YEA_PAY_NUM018    /*납부특례세액_소득세*/
                  , YEA_PAY_NUM019    /*납부특례세액_지방소득세*/
                  , YEA_PAY_NUM020    /*납부특례세액_농특세*/
                  , YEA_PAY_NUM021    /*국민연금*/
                  , YEA_PAY_NUM022    /*건강보험*/
                  , YEA_PAY_NUM023    /*고용보험*/
                  , YEA_PAY_NUM024    /*노동조합비*/
                  , YEA_PAY_NUM025    /*기부금*/
                  , YEA_PAY_NUM026    /*비과세학자금*/
                  , YEA_INS_DATE      /*입력작업자*/
                  , YEA_INS_USER_ID   /*입력일시*/
                  , YEA_UPD_DATE      /*수정작업자*/
                  , YEA_UPD_USER_ID   /*수정일시*/
       )
       WITH iv_YEA_PAY_YYMM AS (
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '01' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '02' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '03' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '04' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '05' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '06' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '07' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '08' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '09' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '10' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '11' AS YEA_PAY_YYMM FROM DUAL
           UNION
           SELECT SUBSTR(#YEA_STD_YY#,1,4) || '12' AS YEA_PAY_YYMM FROM DUAL
       )   
       SELECT  #YEA_STD_YY#
              ,Y.YEA_PAY_YYMM /*지급년월*/
              ,#YEA_EMP_NO# /*사원번호*/
              ,SUM(NVL(YEA_PAY_NUM001,0)) /*지급금액*/
              ,SUM(NVL(YEA_PAY_NUM002,0)) /*기타소득*/
              ,SUM(NVL(YEA_PAY_NUM003,0)) /*상여금액*/
              ,SUM(NVL(YEA_PAY_NUM004,0)) /*인정상여*/
              ,SUM(NVL(YEA_PAY_NUM005,0)) /*주식매수선택권행사이익금액*/
              ,SUM(NVL(YEA_PAY_NUM006,0)) /*우리사주조합인출금액*/
              ,SUM(NVL(YEA_PAY_NUM007,0)) /*임원퇴직소득한도초과액*/
              ,MAX(YEA_PAY_STR001)        /*국외근로지급연월*/
              ,SUM(NVL(YEA_PAY_NUM008,0))
              ,SUM(NVL(YEA_PAY_NUM009,0))
              ,SUM(NVL(YEA_PAY_NUM010,0))
              ,SUM(NVL(YEA_PAY_NUM011,0))
              ,SUM(NVL(YEA_PAY_NUM012,0))
              ,MAX(YEA_PAY_STR002)        /*비과세내용*/
              ,SUM(NVL(YEA_PAY_NUM013,0)) /*기타비과세액*/
              ,SUM(NVL(YEA_PAY_NUM014,0)) /*감면세액*/
              ,SUM(NVL(YEA_PAY_NUM015,0)) /*소득세*/
              ,SUM(NVL(YEA_PAY_NUM016,0)) /*주민세*/
              ,SUM(NVL(YEA_PAY_NUM017,0)) /*농특세*/
              ,SUM(NVL(YEA_PAY_NUM018,0)) /*납부특례세액_소득세*/
              ,SUM(NVL(YEA_PAY_NUM019,0)) /*납부특례세액_지방소득세*/
              ,SUM(NVL(YEA_PAY_NUM020,0)) /*납부특례세액_농특세*/
              ,SUM(NVL(YEA_PAY_NUM021,0)) /*국민연금*/
              ,SUM(NVL(YEA_PAY_NUM022,0)) /*건강보험*/
              ,SUM(NVL(YEA_PAY_NUM023,0)) /*고용보험*/
              ,SUM(NVL(YEA_PAY_NUM024,0)) /*노동조합비*/
              ,SUM(NVL(YEA_PAY_NUM025,0)) /*기부금*/
              ,SUM(NVL(YEA_PAY_NUM026,0)) /*비과세학자금*/
              ,SYSDATE
              ,#UPDT_USID#
              ,SYSDATE
              ,#UPDT_USID#
         FROM iv_YEA_PAY_YYMM Y   
   LEFT OUTER JOIN (
				   /*급여*/
                   SELECT  X.WAGE_YMTH                                                                         AS YEA_PAY_YYMM
                          ,SUM(CASE WHEN A.WAGE_CODE IN ('1000','1200','2900') AND B.EXPD_CODE NOT IN ('A0052','A0053','A0055','A0070','A0240') AND D.RETA_YSNO = '1' THEN NVL(B.EXPD_AMOT,0) - NVL(B.NTAX_INCM,0) ELSE 0 END) AS YEA_PAY_NUM001 /*급여지급금액*/
                          ,0                                                                                   AS YEA_PAY_NUM002 /*기타소득*/
                          ,SUM(CASE WHEN A.WAGE_CODE IN ('1000','1200','2900','2000','2010','2020','5000','7000') AND B.EXPD_CODE IN ('A0052','A0053','A0055','A0070','A0240') AND D.RETA_YSNO = '1' THEN NVL(B.EXPD_AMOT,0) - NVL(B.NTAX_INCM,0) ELSE 0 END) AS YEA_PAY_NUM003 /*상여금액*/
                          ,0                                                                                   AS YEA_PAY_NUM004 /*인정상여*/
                          ,0                                                                                   AS YEA_PAY_NUM005 /*주식매수선택권행사이익*/
                          ,0                                                                                   AS YEA_PAY_NUM006 /*우리사주조합인출금*/
                          ,0                                                                                   AS YEA_PAY_NUM007  /*임원퇴직소득한도초과액*/
                          ,''                                                                                  AS YEA_PAY_STR001 /*국외근로지급연월*/
                          ,0                                                                                   AS YEA_PAY_NUM008  /*국외근로외화금액*/
                          ,SUM(CASE WHEN A.WAGE_CODE IN ('1000','1200','2900','2000','2010','2020','5000','7000') AND B.EXPD_CODE IN ('A0067') AND D.RETA_YSNO = '1' THEN NVL(B.NTAX_INCM,0) ELSE 0 END) AS YEA_PAY_NUM009  /*국외근로원화금액*/
                          ,0                                                                                   AS YEA_PAY_NUM010  /*야간근로비과세*/ 
                          ,0                                                                                   AS YEA_PAY_NUM011 /*출산보육비과세*/
                          ,0                                                                                   AS YEA_PAY_NUM012 /*연구활동비과세*/
                          ,''                                                                                  AS YEA_PAY_STR002   /*비과세내용*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'A1080' THEN B.NTAX_INCM ELSE 0 END)                    AS YEA_PAY_NUM013  /*그 밖의 비과세액*/
                          ,0                                                                                   AS YEA_PAY_NUM014   /*감면세액*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'D2000' THEN B.EXPD_AMOT ELSE 0 END)                    AS YEA_PAY_NUM015   /*소득세*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'D2010' THEN B.EXPD_AMOT ELSE 0 END)                    AS YEA_PAY_NUM016   /*주민세*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'D2150' THEN B.EXPD_AMOT ELSE 0 END)                    AS YEA_PAY_NUM017   /*농특세*/
                          ,0                                                                                   AS YEA_PAY_NUM018   /*납부특례세액_소득세*/
                          ,0                                                                                   AS YEA_PAY_NUM019   /*납부특례세액_지방소득세*/
                          ,0                                                                                   AS YEA_PAY_NUM020   /*납부특례세액_농특세*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'D0304' THEN B.EXPD_AMOT ELSE 0 END)                    AS YEA_PAY_NUM021   /*국민연금납부액*/
                          ,SUM(CASE WHEN B.EXPD_CODE IN ('D0303','D0305','D1103') THEN B.EXPD_AMOT ELSE 0 END) AS YEA_PAY_NUM022   /*건강보험납부액*/
                          ,SUM(CASE WHEN B.EXPD_CODE = 'D0306' THEN B.EXPD_AMOT ELSE 0 END)                    AS YEA_PAY_NUM023   /*고용보험납부액*/
                          ,0                                                                                   AS YEA_PAY_NUM024   /*노동조합비*/
                          ,0                                                                                   AS YEA_PAY_NUM025   /*기부금*/
                          ,0                                                                                   AS YEA_PAY_NUM026   /*비과세학자금*/ 
				       FROM PY_PMDIRY X
				      INNER JOIN PY_PMMAST A
				         ON X.PAYX_DATE = A.PAYX_DATE
				        AND X.WAGE_CODE = A.WAGE_CODE
				      INNER JOIN PY_PMDETL B
				         ON A.PAYX_DATE = B.PAYX_DATE
				        AND A.WAGE_CODE = B.WAGE_CODE
				        AND A.EMPL_NUMB = B.EMPL_NUMB
				       LEFT OUTER JOIN PY_DONAXM C
				         ON X.PAYX_DATE = C.PAYX_DATE
				        AND X.WAGE_CODE = C.WAGE_CODE
				        AND B.EXPD_CODE = C.EXPD_CODE      
                      INNER JOIN PY_ALLDED D
	                     ON B.EXPD_CODE = D.EXPD_CODE
	                  INNER JOIN HR_MASTXM Z
	                     ON A.EMPL_NUMB = Z.EMPL_NUMB
	                  WHERE X.WADE_YSNO = '1'
	                    AND SUBSTR(X.WAGE_YMTH, 1, 4) = SUBSTR(#YEA_STD_YY#, 1, 4)
	                    AND Z.RERN_NUMB = (SELECT RERN_NUMB FROM HR_MASTXM WHERE EMPL_NUMB = #YEA_EMP_NO#)
	                  GROUP BY X.WAGE_YMTH  
  
	                UNION ALL
	                SELECT  X.WAGE_YMTH                                                          AS YEA_PAY_YYMM
	                       ,0
	                       ,SUM(NVL(A.TAP1_AMOT, 0) + NVL(A.TAP2_AMOT, 0) + NVL(A.TAP3_AMOT, 0)) AS YEA_PAY_NUM002   /*지급액*/
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,''
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,''
	                       ,SUM(NVL(A.NTP1_AMOT, 0) + NVL(A.NTP2_AMOT, 0) + NVL(A.NTP3_AMOT, 0)) AS YEA_PAY_NUM013   /*비과세*/
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                  FROM PY_INCOME A
	                 INNER JOIN PY_PMDIRY X
				        ON X.PAYX_DATE = A.PAYX_DATE
				       AND X.WAGE_CODE = A.WAGE_CODE
	                 INNER JOIN HR_MASTXM B
	                    ON A.EMPL_NUMB = B.EMPL_NUMB
	                 WHERE X.WADE_YSNO               = '1'
	                   AND SUBSTR(X.WAGE_YMTH, 1, 4) = SUBSTR(#YEA_STD_YY#, 1, 4)
	                   AND B.RERN_NUMB               = (SELECT RERN_NUMB FROM HR_MASTXM WHERE EMPL_NUMB = #YEA_EMP_NO#)
	                   AND A.INDN_CODE              != '09' 
	                 GROUP BY X.WAGE_YMTH
	                   
	                UNION ALL
	                SELECT  X.WAGE_YMTH                                                          AS YEA_PAY_YYMM
	                       ,0
	                       ,SUM(NVL(A.TAP1_AMOT, 0) + NVL(A.TAP2_AMOT, 0) + NVL(A.TAP3_AMOT, 0)) AS YEA_PAY_NUM002   /*지급액*/
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,''
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,''
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,0
	                       ,SUM(NVL(A.NTP1_AMOT, 0) + NVL(A.NTP2_AMOT, 0) + NVL(A.NTP3_AMOT, 0)) AS YEA_PAY_NUM026   /*비과세학자금*/
	                  FROM PY_INCOME A
	                 INNER JOIN PY_PMDIRY X
				        ON X.PAYX_DATE = A.PAYX_DATE
				       AND X.WAGE_CODE = A.WAGE_CODE
	                 INNER JOIN HR_MASTXM B
	                    ON A.EMPL_NUMB = B.EMPL_NUMB
	                 WHERE X.WADE_YSNO               = '1'
	                   AND SUBSTR(X.WAGE_YMTH, 1, 4) = SUBSTR(#YEA_STD_YY#, 1, 4)
	                   AND B.RERN_NUMB               = (SELECT RERN_NUMB FROM HR_MASTXM WHERE EMPL_NUMB = #YEA_EMP_NO#)
	                   AND A.INDN_CODE               = '09' 
	                 GROUP BY X.WAGE_YMTH
              ) Z
              ON Y.YEA_PAY_YYMM = Z.YEA_PAY_YYMM
           GROUP BY Y.YEA_PAY_YYMM;
  
          /*기부금명세서 작성*/
          DELETE FROM YEA_DONASP
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#
             AND SF_YEA_DECRYPT_SSN(YEA_DOS_STR008) IN (SELECT BIZR_RGNB FROM PY_DONAXM WHERE PAYX_DATE LIKE SUBSTR(#YEA_STD_YY#,1,4) || '%'); 
  
           INSERT INTO YEA_DONASP (
                  YEA_STD_YY   /*기준년월*/
                 ,YEA_EMP_NO   /*사원번호*/
                 ,YEA_FAMI_SEQ   /*가족일련번호*/
                 ,YEA_DONA_SEQ   /*기부금일련번호*/
                 ,YEA_DOS_STR005   /*기부자관계코드*/
                 ,YEA_DOS_STR006   /*기부유형코드*/
                 ,YEA_DOS_STR007   /*기부처*/
                 ,YEA_DOS_STR008   /*사업자주민번호*/
                 ,YEA_DOS_STR009   /*기부내용*/
                 ,YEA_DOS_NUM001   /*기부건수*/
                 ,YEA_DOS_NUM002   /*기부금액*/
                 ,YEA_DOS_STR001   /*자료구분코드*/
                 ,YEA_DOS_STR002   /*가족성명*/
                 ,YEA_DOS_STR003   /*주민등록번호*/
                 ,YEA_DOS_STR004   /*내외국인구분코드*/
                 ,YEA_INS_DATE   /*등록일*/
                 ,YEA_INS_USER_ID   /*등록자*/
                 ,YEA_UPD_DATE   /*수정일*/
                 ,YEA_UPD_USER_ID   /*수정자*/
                 )
          SELECT  D.YEA_STD_YY
                 ,A.EMPL_NUMB
                 ,1
                 ,ROW_NUMBER() OVER (ORDER BY C.DOTE_CODE) 
                 /* 테이블 삭제에 따른 REMARK
                    + (SELECT NVL(MAX(DONA_SEQN),0)  FROM PY_DONASP
                     WHERE BASE_YMTH LIKE D.YEA_STD_YY || '%'
                       AND EMPL_NUMB = A.EMPL_NUMB
                     )
                 */
                 ,'1'
                 ,C.DOTE_CODE
                 ,C.DNTN_ORGT
                 ,C.BIZR_RGNB
                 ,C.DNTN_CNTT
                 ,COUNT(B.EXPD_CODE)
                 ,SUM(B.EXPD_AMOT)
                 ,'2'
                 ,D.YEA_FAM_STR003   /*성명*/
                 ,D.YEA_FAM_STR004   /*주민등록번호*/
                 ,D.YEA_FAM_STR002   /*내외국인구분*/
                 ,#UPDT_USID#
                 ,SYSDATE
                 ,#UPDT_USID#
                 ,SYSDATE
            FROM PY_PMDIRY X
             INNER JOIN PY_PMMAST A
                ON X.PAYX_DATE = A.PAYX_DATE
               AND X.WAGE_CODE = A.WAGE_CODE
             INNER JOIN PY_PMDETL B
                ON A.PAYX_DATE = B.PAYX_DATE
               AND A.WAGE_CODE = B.WAGE_CODE
               AND A.EMPL_NUMB = B.EMPL_NUMB
             INNER JOIN PY_DONAXM C
                ON B.PAYX_DATE = C.PAYX_DATE
               AND B.WAGE_CODE = C.WAGE_CODE
               AND B.EXPD_CODE = C.EXPD_CODE
             INNER JOIN YEA_YEFAMI D
                ON A.EMPL_NUMB = D.YEA_EMP_NO
               AND D.YEA_STD_YY = #YEA_STD_YY#
               AND D.YEA_FAMI_SEQ = 1
           WHERE X.WADE_YSNO = '1'
             AND SUBSTR(A.PAYX_DATE, 1, 4) = SUBSTR(#YEA_STD_YY#, 1, 4)
             AND A.EMPL_NUMB = #YEA_EMP_NO#
           GROUP BY D.YEA_STD_YY, A.EMPL_NUMB, C.DOTE_CODE, C.DNTN_ORGT, C.BIZR_RGNB, C.DNTN_CNTT, D.YEA_FAM_STR003, D.YEA_FAM_STR004, D.YEA_FAM_STR002
          ;
           
  
      DELETE
        FROM YEA_DONAAD
       WHERE YEA_STD_YY = #YEA_STD_YY#
         AND YEA_EMP_NO = #YEA_EMP_NO#
         AND YEA_DOA_STR002 <> #YEA_STD_YY#;
  
          /*기부금이월(2011년 추가)*/
          INSERT INTO YEA_DONAAD (
             YEA_STD_YY       /*기준년월*/
            ,YEA_EMP_NO       /*사원번호*/
            ,YEA_DONA_SEQ     /*기부금순번*/
            ,YEA_DOA_STR001   /*기부유형코드[DOTE_CODE]*/
            ,YEA_DOA_STR002   /*기부년도*/
            ,YEA_DOA_NUM001   /*기부금*/
            ,YEA_DOA_NUM002   /*기부금기공제액*/
            ,YEA_DOA_NUM003   /*기부금공제대상액*/
            ,YEA_DOA_NUM004   /*기부금공제액*/
            ,YEA_DOA_NUM005   /*기부금소멸액*/
            ,YEA_DOA_NUM006   /*기부금이월액*/
            ,YEA_INS_DATE     /*등록일시*/
            ,YEA_INS_USER_ID  /*등록자*/
            ,YEA_UPD_DATE     /*수정일시*/
            ,YEA_UPD_USER_ID  /*수정자*/
          )
          SELECT
             #YEA_STD_YY#   /*정산년월*/
            ,A.YEA_EMP_NO   /*사원번호 /*2012.12.26 변경*/
            ,(SELECT NVL(MAX(YEA_DONA_SEQ),0) FROM YEA_DONAAD WHERE YEA_STD_YY = #YEA_STD_YY# AND YEA_EMP_NO = #YEA_EMP_NO#) + ROW_NUMBER() OVER (ORDER BY A.YEA_DOA_STR001)   /*기부금순번 /*2012.12.26 변경*/
            ,A.YEA_DOA_STR001   /*기부유형코드 /*2012.12.26 변경*/
            ,A.YEA_DOA_STR002   /*기부년도 /*2012.12.26 변경*/
            ,A.YEA_DOA_NUM001   /*기부금  /*2012.12.26 변경*/
            ,SUM(CASE WHEN SUBSTR(YEA_STD_YY,1,1) <> 'Y' THEN YEA_DOA_NUM004 ELSE 0 END ) /*기부금기공제액[2015귀속]_수정 2014년 재정산관련 */
            ,B.YEA_DOA_NUM006   /*기부금공제대상액 /*2012.12.26 변경*/
            ,0   /*기부금공제액*/
            ,0   /*기부금소멸액*/
            ,0   /*기부금이월액*/
            ,SYSDATE
            ,#UPDT_USID#
            ,SYSDATE
            ,#UPDT_USID#
          FROM YEA_DONAAD A  /*2012.12.26 변경*/
            INNER JOIN (    /*2012.12.26 추가*/
              SELECT  YEA_EMP_NO /*2012.12.26 추가*/
                     ,YEA_DOA_STR001 /*2012.12.26 추가*/
                     ,YEA_DOA_STR002 /*2012.12.26 추가*/
                     ,YEA_DOA_NUM006 /*2012.12.26 추가*/
                FROM YEA_DONAAD  /*2012.12.26 추가*/
               WHERE YEA_EMP_NO = #YEA_EMP_NO# /*2012.12.26 추가*/
                 AND SUBSTR(YEA_STD_YY, 1, 4) = TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-1) /*2012.12.26 추가*/
                 AND YEA_DOA_NUM006 > 0  /*2012.12.26 추가*/
            ) B   /*2012.12.26 추가*/
              ON A.YEA_EMP_NO = B.YEA_EMP_NO  /*2012.12.26 추가*/
             AND A.YEA_DOA_STR001 = B.YEA_DOA_STR001  /*2012.12.26 추가*/
             AND A.YEA_DOA_STR002 = B.YEA_DOA_STR002  /*2012.12.26 추가*/
          WHERE ((A.YEA_DOA_STR001 = '30' AND SUBSTR(A.YEA_DOA_STR002,1,4) BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-2) AND TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-1))           /*2012.12.26 변경*/
               OR (A.YEA_DOA_STR001 IN ('10','31') AND SUBSTR(A.YEA_DOA_STR002,1,4) BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-3) AND TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-1))  /*2012.12.26 변경*/
               OR (A.YEA_DOA_STR001 IN ('40','41') AND SUBSTR(A.YEA_DOA_STR002,1,4) BETWEEN TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-5) AND TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-1))  /*2012.12.26 변경*/
                ) /*2012.12.26 변경*/
            AND A.YEA_EMP_NO = #YEA_EMP_NO#
          GROUP BY A.YEA_EMP_NO, A.YEA_DOA_STR001, A.YEA_DOA_STR002, A.YEA_DOA_NUM001, B.YEA_DOA_NUM006; /*2012.12.26 추가*/
          /*기부금이월(2011년 추가)*/
  
  
          /*소득공제신고서 UPDATE*/
          /*국민연금, 국민건강보험, 고용보험*/        
          /*수정*/
            UPDATE YEA_INCDEC A
             SET (YEA_INC_NUM002, YEA_INC_NUM012, YEA_INC_NUM014) = (
                SELECT  SUM(YEA_PAY_NUM021) /*국민연금*/
                       ,CASE WHEN SUM(YEA_PAY_NUM022)<0 THEN 0 ELSE SUM(YEA_PAY_NUM022) END /*건강보험*/
                       ,SUM(YEA_PAY_NUM023) /*고용보험*/
                  FROM YEA_PAYDTL B
                 WHERE A.YEA_STD_YY = B.YEA_STD_YY
                   AND A.YEA_EMP_NO = B.YEA_EMP_NO
                )
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
             
          /*가족사항 UPDATE*/
          /*건강보험, 고용보험*/        
          /*수정*/
            UPDATE YEA_YEFAMI A
             SET (YEA_FAM_NUM002) = (
                SELECT  CASE WHEN SUM(YEA_PAY_NUM022)<0 THEN SUM(YEA_PAY_NUM023) ELSE SUM(YEA_PAY_NUM022) + SUM(YEA_PAY_NUM023) END /*건강보험*/
                  FROM YEA_PAYDTL B
                 WHERE A.YEA_STD_YY = B.YEA_STD_YY
                   AND A.YEA_EMP_NO = B.YEA_EMP_NO
                )
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#
             AND YEA_FAM_STR001 = '0';
          
          /*종근무지 고용 건강보험 재합산*/
        UPDATE YEA_YEFAMI A
           SET (YEA_FAM_NUM002) = NVL((YEA_FAM_NUM002), 0) + NVL((
                                                      SELECT CASE WHEN SUM(YEA_BFW_NUM008)<0 THEN SUM(YEA_BFW_NUM009) ELSE SUM(YEA_BFW_NUM008) + SUM(YEA_BFW_NUM009) END   /*건강보험*/
                                                        FROM YEA_BFWORK B
                                                        WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                                          AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                                      ), 0)
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FAM_STR001 = '0';

        /*소득공제 ..종(전)근무지 건강보험 재 입력*/
        UPDATE YEA_INCDEC A
          SET (YEA_INC_NUM011) = NVL((
                                    SELECT CASE WHEN SUM(YEA_BFW_NUM008)<0 THEN 0 ELSE SUM(YEA_BFW_NUM008) END   /*건강보험*/
                                      FROM YEA_BFWORK B
                                      WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                        AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                     ), 0)
          WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제 ..종(전)근무지 고용보험 재 입력*/
        UPDATE YEA_INCDEC A
          SET (YEA_INC_NUM013) = NVL((
                                      SELECT SUM(YEA_BFW_NUM009)  /*고용보험*/
                                        FROM YEA_BFWORK B
                                        WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                          AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                     ), 0)
          WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#;
          
          /*20160511 중소기업취업청년 로직 추가_시작*/
	        SELECT COUNT(*)
	          INTO v_ROWCNT
	          FROM PY_MASTPM
	         WHERE EMPL_NUMB = #YEA_EMP_NO#;
	         
	        /*확정되었다면 삭제불가*/
	        IF v_ROWCNT > 0 THEN
	            SELECT TARN_STDT, TARN_ENDT
	              INTO v_TARN_STDT, v_TARN_ENDT
	              FROM PY_MASTPM
	             WHERE EMPL_NUMB = #YEA_EMP_NO#;
	        END IF;    
	
	         FOR RS IN (
	             SELECT YEA_STD_YY   /*기준년월*/
	                   ,YEA_EMP_NO   /*사원번호*/
	                   ,YEA_PAY_YYMM /*지급년월*/
	                   ,SUM(NVL(YEA_PAY_NUM001,0)+NVL(YEA_PAY_NUM002,0)+NVL(YEA_PAY_NUM003,0)+Nvl(YEA_PAY_NUM004,0)) AS YEA_PAY_SUM
	               FROM YEA_PAYDTL
	              WHERE YEA_STD_YY = #YEA_STD_YY#
	                AND YEA_EMP_NO = #YEA_EMP_NO#
	           GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_PAY_YYMM
	           ORDER BY YEA_STD_YY, YEA_EMP_NO, YEA_PAY_YYMM
	        ) LOOP
	            IF RS.YEA_PAY_YYMM >= SUBSTR(v_TARN_STDT,1,6) AND RS.YEA_PAY_YYMM <= SUBSTR(v_TARN_ENDT,1,6) THEN
	              /*근로소득테이블에 중소기업청취업감면금액 업데이트(급여+기타소득+상여+인정상여)*/
	              UPDATE YEA_PAYDTL
	                 SET YEA_PAY_NUM014 = RS.YEA_PAY_SUM
	               WHERE YEA_STD_YY = RS.YEA_STD_YY
	                 AND YEA_EMP_NO = RS.YEA_EMP_NO
	                 AND YEA_PAY_YYMM = RS.YEA_PAY_YYMM;
	
	            END IF;
	        END LOOP;
	
	        IF LENGTH(v_TARN_STDT) = 8 AND LENGTH(v_TARN_ENDT) = 8 THEN
	            /*소득공제테이블에 중소기업취업청년감면 취업일,감면종료일 업데이트*/
	            /*취업일은 입사일*/
	            /*감면종료일은 감면종료일,해당귀속년도말인,퇴사일중 작은값*/
	            UPDATE YEA_INCDEC
	               SET YEA_INC_STR008 = (SELECT YEA_HIRE_YMD FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#)) WHERE YEA_EMP_NO = #YEA_EMP_NO#)
	                  ,YEA_INC_STR009 = LEAST(v_TARN_ENDT, #YEA_STD_YY# || '1231', (SELECT Nvl(YEA_QUIT_YMD,'999999999') FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#)) WHERE YEA_EMP_NO = #YEA_EMP_NO#))
	             WHERE YEA_STD_YY = #YEA_STD_YY#
	               AND YEA_EMP_NO = #YEA_EMP_NO#;
	        END IF ;
	      /*20160511 중소기업취업청년 로직 추가_종료*/
        
          /*가족사항의 기부금 업데이트*/
          /*SP_YEAA0070_2015_PROC06(##YEA_STD_YY##, ##YEA_EMP_NO##);*/    /*★체크해야함★*/
           
           
    END;
    ]]>	
	</update>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연말정산 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC02" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC02.연말정산처리 연말정산 처리 */
          
          /*연말정산데이터*/
          r_YEA_YEPROC YEA_YEPROC%ROWTYPE;
          /*소득공제신고서*/
          r_YEA_INCDEC YEA_INCDEC%ROWTYPE;
  
          /*공제금액한도*/
          v_LIMI_AMT NUMBER(15,0);
          
          /*[2013귀속] 2014년부터 근로소득세액공제 한도 총급여비율로 적용하기 위함*/
          v_TAXD_TAX1 NUMBER(15,0);
          
          /*농특세 계산하기위한 과세표준*/
          v_STAN_FARM NUMBER(15,0);
          /*농특세 계산하기위한 산출세액*/
          v_TAX_FARM NUMBER(15,0);
          /*산출세액차액*/
          v_TAX_DIFF NUMBER(15,0);
  
          /*외국인근로자여부(1:내국인, 9:외국인)*/
          v_LOFO_GUBN CHAR(1);
          /*단일세율적용여부*/
          v_SIPL_TAXR CHAR(1);
          /*표준세액공제여부*/
          v_YEA_STANTAX_YN CHAR(1);
          
          v_ROWCNT INT;

          v_DONA_DEDU NUMBER(15,0);
          v_DONA_IWOL NUMBER(15,0);
          v_DONA_RATE FLOAT;
          
          /*연금공제액*/
          v_PESA_DEDU NUMBER(15,0); 
            
          /*기부한도금액*/
          v_DONA_LIMT NUMBER(15,0);
          v_DONA_LIMT2 NUMBER(15,0);  /*종교단체기부한도*/
  
          /*기부누적금액*/
          v_DONA_TAMT NUMBER(15,0);
          v_DONA_DAMT NUMBER(15,0);   /*기부금이월처리소멸금액*/
          
          /*[2013귀속] 월세주택 공제한도금액*/
          v_RTER_LIMT NUMBER(15,0);
          
          v_DONA_APPO NUMBER(15,0);
          v_DONA_RELI NUMBER(15,0);

          /*신용카드*/
          v_CRCA_AMOT1 NUMBER(15,0);
          v_CRCA_AMOT2 NUMBER(15,0);
          v_CRCA_AMOT3 NUMBER(15,0);
          v_CRCA_AMOT4 NUMBER(15,0);
          v_CRCA_AMOT5 NUMBER(15,0);
          v_CRCA_AMOT6 NUMBER(15,0);
          v_CRCA_AMOT7 NUMBER(15,0);
          v_CRCA_AMOT8 NUMBER(15,0); /*[2013귀속] 추가공제금액2*/
          v_CRCA_AMOT9 NUMBER(15,0); /*[2015귀속]_추가 15년하반기 사용분*/
  
          /*감면소득(전근무지)*/
          v_EXTX_AMOT NUMBER(15,0); /*조특법30조 제외 감면소득*/
          v_EX30_AMOT NUMBER(15,0); /*조특법30조 감면소득*/
          v_EX30_RATE FLOAT;        /*조특법30조 감면비율*/
          v_TTTR_AMOT NUMBER(15,0); /*조세조약 감면소득*/ 

          v_YEA_DONA NUMBER(15,0);  /*기부금 공제대상금액 합계*/
          v_YEA_PRC_NUM071_CARRY NUMBER(15,0);  /*법정기부금 이월분*/
          v_YEA_ETC_CARRY NUMBER(15,0);  /*공인신탁 이월분*/
          v_YEA_PRC_NUM073_CARRY NUMBER(15,0);  /*지정기부금 이월분*/

          v_YEA_DONA_CARRY NUMBER(15,0);  /*기부금 이월분*/
          v_YEA_DONA_CARRY_SUM NUMBER(15,0);

          v_YEA_MORT NUMBER(15,0); /*장기주택저당차입이자상환공제액 계*/

          v_KOASE_STANDARD NUMBER(15,0);
          
      	  v_HANDO_15_82 NUMBER(15,0); 		  /*[2015귀속]_추가 연말정산주택자금공제_통합공제한도*/
      		            
          /* [2015귀속]_주택저당차입금이자상환액공재순서 때문에 추가_시작 */
          v_tmp_YEA_INC_NUM01   NUMBER(20,5);
          v_tmp_YEA_INC_NUM02   NUMBER(20,5);
          v_tmp_YEA_INC_NUM03   NUMBER(20,5);
          v_tmp_YEA_INC_NUM04   NUMBER(20,5);
          v_tmp_YEA_INC_NUM05   NUMBER(20,5);
          v_tmp_YEA_INC_NUM06   NUMBER(20,5);
          v_tmp_YEA_INC_NUM07   NUMBER(20,5);
          v_tmp_YEA_INC_NUM08   NUMBER(20,5);
          v_tmp_YEA_INC_NUM09   NUMBER(20,5);
          /* [2015귀속]_주택저당차입금이자상환액공재순서 문에 추가_끝*/      
          
          v_TARN_STDT VARCHAR2(8);   /*20160511 중소기업취업감면 시작일*/
      	  v_TARN_ENDT VARCHAR2(8);   /*20160511 중소기업취업감면 종료일*/
    BEGIN
 	  	v_TARN_STDT := '';       /*20160510 중소기업취업감면 시작일*/
     	v_TARN_ENDT := '';       /*20160510 중소기업취업감면 종료일*/
 
        IF #YEA_PRC_STR002# <> '9' THEN
            /*마감여부 체크*/
			SELECT COUNT(*)
			  INTO v_ROWCNT
			  FROM YEA_INCDEC A
			 WHERE A.YEA_STD_YY = #YEA_STD_YY#
			   AND A.YEA_EMP_NO = #YEA_EMP_NO#
			   AND A.YEA_INC_STR025 = '1';
	
            IF v_ROWCNT = 0 THEN
                RAISE_APPLICATION_ERROR(-20000, '입력마감 전 입니다. 입력마감 후 실행해주세요!');  
            END IF;           
        END IF;

      	
      /*이전 자료 삭제*/
      DELETE FROM YEA_YEPROC
       WHERE YEA_STD_YY = #YEA_STD_YY#
         AND YEA_EMP_NO = #YEA_EMP_NO#;

      /*소득공제신고서*/
      SELECT * 
        INTO r_YEA_INCDEC
        FROM YEA_INCDEC
       WHERE YEA_STD_YY = #YEA_STD_YY#
         AND YEA_EMP_NO = #YEA_EMP_NO#;

      v_DONA_DEDU := 0;

      /*외국인구분,외국인단일세율,표준세액공제 적용여부*/
      SELECT YEA_LOFO_CD
           , YEA_RATE_YN 
           , YEA_STANTAX_YN
        INTO v_LOFO_GUBN
           , v_SIPL_TAXR
           , v_YEA_STANTAX_YN
        FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#, #YEA_STD_YY# || '1231'))
       WHERE 1 = 1
      ;
          
     /******************************************************************************
     * ★단일세율-적용 시작!                                                       *
     ******************************************************************************/
     IF v_LOFO_GUBN = '9' AND v_SIPL_TAXR = '1' THEN /*외국인근로자,단일세율적용*/
        /*근로소득에 17%를 세액으로 하여 분리과세로 종결*/
        /*근로소득, 소득세, 주민세, 농특세*/
        /*총급여, 소득세, 주민세, 농특세*/
            SELECT NVL(A.PAYX_TAMT,0) + NVL(B.PAYX_TAMT,0)
              ,NVL(A.INCO_TAXX,0)
              ,NVL(A.RESI_TAXX,0)
              ,NVL(A.FARM_TAXX,0)
              ,NVL(B.INCO_TAXX,0)
              ,NVL(B.RESI_TAXX,0)
              ,NVL(B.FARM_TAXX,0)
            INTO
               r_YEA_YEPROC.YEA_PRC_NUM001   /*총급여*/
              ,r_YEA_YEPROC.YEA_PRC_NUM089   /*주근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM090   /*주근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM091   /*주근무지농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM086   /*종근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM087   /*종근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM088   /*종근무지농특세*/
            FROM
            (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,SUM(NVL(YEA_PAY_NUM001,0) + NVL(YEA_PAY_NUM002,0) + NVL(YEA_PAY_NUM003,0) + NVL(YEA_PAY_NUM004,0) + NVL(YEA_PAY_NUM005,0)+ NVL(YEA_PAY_NUM006,0)+ NVL(YEA_PAY_NUM007,0)) AS PAYX_TAMT  /*현근무지*/
                    ,NVL(SUM(YEA_PAY_NUM015),0) AS INCO_TAXX    /*소득세*/
                    ,NVL(SUM(YEA_PAY_NUM016),0) AS RESI_TAXX    /*주민세*/
                    ,NVL(SUM(YEA_PAY_NUM017),0) AS FARM_TAXX    /*농특세*/
                FROM YEA_PAYDTL
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
            GROUP BY YEA_STD_YY, YEA_EMP_NO
            ) A
            LEFT OUTER JOIN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,SUM(NVL(YEA_BFW_NUM001,0) + NVL(YEA_BFW_NUM002,0) + NVL(YEA_BFW_NUM003,0) + NVL(YEA_BFW_NUM004,0)+ NVL(YEA_BFW_NUM005,0)+ NVL(YEA_BFW_NUM006,0)) AS PAYX_TAMT   /*전근무지*/
                    ,NVL(SUM(YEA_BFW_NUM010),0) AS INCO_TAXX   /*소득세*/
                    ,NVL(SUM(YEA_BFW_NUM011),0) AS RESI_TAXX   /*주민세*/
                    ,NVL(SUM(YEA_BFW_NUM012),0) AS FARM_TAXX   /*농특세*/
              FROM YEA_BFWORK
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
          GROUP BY YEA_STD_YY, YEA_EMP_NO
            ) B
              ON A.YEA_STD_YY = B.YEA_STD_YY
                AND A.YEA_EMP_NO = B.YEA_EMP_NO;

        r_YEA_YEPROC.YEA_PRC_NUM003 := r_YEA_YEPROC.YEA_PRC_NUM001;
        r_YEA_YEPROC.YEA_PRC_NUM030 := r_YEA_YEPROC.YEA_PRC_NUM001;
        r_YEA_YEPROC.YEA_PRC_NUM045 := r_YEA_YEPROC.YEA_PRC_NUM001;
        r_YEA_YEPROC.YEA_PRC_NUM046 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * 0.17, 0);

        /*결정세액소득세 = 산출세액 - 세액감면계 - 세액공제계*/
        r_YEA_YEPROC.YEA_PRC_NUM083 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046, -1);
        /*결정세액주민세*/
        r_YEA_YEPROC.YEA_PRC_NUM084 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM083 / 10, -1);
        /*결정세액농특세*/
        r_YEA_YEPROC.YEA_PRC_NUM085 := TRUNC(NVL(v_TAX_DIFF, 0) * 0.2, -1);

        /*납부특례세액*/
        SELECT SUM(NVL(YEA_PAY_NUM018,0))
              ,SUM(NVL(YEA_PAY_NUM019,0))
              ,SUM(NVL(YEA_PAY_NUM020,0))
          INTO r_YEA_YEPROC.YEA_PRC_NUM095
              ,r_YEA_YEPROC.YEA_PRC_NUM096
              ,r_YEA_YEPROC.YEA_PRC_NUM097
          FROM YEA_PAYDTL
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /*차감징수세액*/
        r_YEA_YEPROC.YEA_PRC_NUM092 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM083 - r_YEA_YEPROC.YEA_PRC_NUM086 - r_YEA_YEPROC.YEA_PRC_NUM089 - r_YEA_YEPROC.YEA_PRC_NUM095) ,-1);
        r_YEA_YEPROC.YEA_PRC_NUM093 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM084 - r_YEA_YEPROC.YEA_PRC_NUM087 - r_YEA_YEPROC.YEA_PRC_NUM090 - r_YEA_YEPROC.YEA_PRC_NUM096) ,-1);
        r_YEA_YEPROC.YEA_PRC_NUM094 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM085 - r_YEA_YEPROC.YEA_PRC_NUM088 - r_YEA_YEPROC.YEA_PRC_NUM091 - r_YEA_YEPROC.YEA_PRC_NUM097) ,-1);

        /*소액부징수적용*/
        IF r_YEA_YEPROC.YEA_PRC_NUM092 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM092 < 1000 THEN
          r_YEA_YEPROC.YEA_PRC_NUM092 := 0;
        END IF;

        IF r_YEA_YEPROC.YEA_PRC_NUM092 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM092 < 1000 THEN
          r_YEA_YEPROC.YEA_PRC_NUM093 := 0;
        END IF;

        IF r_YEA_YEPROC.YEA_PRC_NUM094 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM094 < 1000 THEN
          r_YEA_YEPROC.YEA_PRC_NUM094 := 0;
        END IF;


     /******************************************************************************
     * ★단일세율-적용 끝!                                                         *
     ******************************************************************************/
     ELSE
     /******************************************************************************
     * ★단일세율-미적용 시작!                                                     *
     ******************************************************************************/
               
          /*총급여, 소득세, 주민세, 농특세*/
        SELECT NVL(A.PAYX_TAMT,0) + NVL(B.PAYX_TAMT,0)
              ,NVL(A.INCO_TAXX,0)
              ,NVL(A.RESI_TAXX,0)
              ,NVL(A.FARM_TAXX,0)
              ,NVL(B.INCO_TAXX,0)
              ,NVL(B.RESI_TAXX,0)
              ,NVL(B.FARM_TAXX,0)
              ,NVL(C.EXTX_AMOT,0) /*조특법30조 제외 감면소득*/
              ,NVL(A.REDU_TAXX,0) /*조특법30조 감면소득*/
              ,NVL(C.TTTR_AMOT,0) /*조세조약 감면소득*/
          INTO
               r_YEA_YEPROC.YEA_PRC_NUM001   /*총급여*/
              ,r_YEA_YEPROC.YEA_PRC_NUM089   /*주근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM090   /*주근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM091   /*주근무지농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM086   /*종근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM087   /*종근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM088   /*종근무지농특세*/
              ,v_EXTX_AMOT  /*조특법30조 제외 감면소득*/
              ,v_EX30_AMOT  /*조특법30조 감면소득*/
              ,v_TTTR_AMOT  /*조세조약 감면소득*/
          FROM (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,SUM(NVL(YEA_PAY_NUM001,0) + NVL(YEA_PAY_NUM002,0) + NVL(YEA_PAY_NUM003,0) + NVL(YEA_PAY_NUM004,0) + NVL(YEA_PAY_NUM005,0)+ NVL(YEA_PAY_NUM006,0)+ NVL(YEA_PAY_NUM007,0)) AS PAYX_TAMT  /*현근무지*/
                      ,NVL(SUM(YEA_PAY_NUM014),0) AS REDU_TAXX    /*감면세액*/
                      ,NVL(SUM(YEA_PAY_NUM015),0) AS INCO_TAXX    /*소득세*/
                      ,NVL(SUM(YEA_PAY_NUM016),0) AS RESI_TAXX    /*주민세*/
                      ,NVL(SUM(YEA_PAY_NUM017),0) AS FARM_TAXX    /*농특세*/
                  FROM YEA_PAYDTL
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              GROUP BY YEA_STD_YY, YEA_EMP_NO
               ) A
     LEFT JOIN (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,SUM(NVL(YEA_BFW_NUM001,0) + NVL(YEA_BFW_NUM002,0) + NVL(YEA_BFW_NUM003,0) + NVL(YEA_BFW_NUM004,0)+ NVL(YEA_BFW_NUM005,0)+ NVL(YEA_BFW_NUM006,0)) AS PAYX_TAMT   /*전근무지*/
                      ,NVL(SUM(YEA_BFW_NUM010),0) AS INCO_TAXX   /*소득세*/
                      ,NVL(SUM(YEA_BFW_NUM011),0) AS RESI_TAXX   /*주민세*/
                      ,NVL(SUM(YEA_BFW_NUM012),0) AS FARM_TAXX   /*농특세*/
                  FROM YEA_BFWORK
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              GROUP BY YEA_STD_YY, YEA_EMP_NO
             ) B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO
     LEFT JOIN (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,NVL(SUM(CASE WHEN YEA_NON_TAX_CD IN ('T01','Z01') THEN YEA_BFN_NUM001 ELSE 0 END),0) AS EXTX_AMOT
                      ,NVL(SUM(CASE WHEN YEA_NON_TAX_CD IN ('T10') THEN YEA_BFN_NUM001 ELSE 0 END),0) AS EX30_AMOT
                      ,NVL(SUM(CASE WHEN YEA_NON_TAX_CD IN ('T20') THEN YEA_BFN_NUM001 ELSE 0 END),0) AS TTTR_AMOT
                  FROM YEA_BFNTAX
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
                   AND YEA_NON_TAX_CD IN ('T01','Z01','T10','T20')
              GROUP BY YEA_STD_YY, YEA_EMP_NO
             ) C
            ON A.YEA_STD_YY = C.YEA_STD_YY
           AND A.YEA_EMP_NO = C.YEA_EMP_NO;
  
           /*근로소득공제*/
           r_YEA_YEPROC.YEA_PRC_NUM002 := CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0010','A') THEN TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0010','B'),0)
                             WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0020','A') AND r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0020','B') THEN TRUNC(SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0020','C') + (r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0020','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0020','D'),0)
                             WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0030','A') AND r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0030','B') THEN TRUNC(SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0030','C') + (r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0030','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0030','D'),0)
                             WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0040','A') AND r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0040','B') THEN TRUNC(SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0040','C') + (r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0040','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0040','D'),0)
                             WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0050','A') THEN TRUNC(SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0050','B') + (r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0050','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000010','0050','C'),0)
                        END;

          /*근로소득*/
          r_YEA_YEPROC.YEA_PRC_NUM003 := r_YEA_YEPROC.YEA_PRC_NUM001 - r_YEA_YEPROC.YEA_PRC_NUM002;
  
          /*인적공제*/
          SELECT COUNT(CASE WHEN A.YEA_FAM_STR001 = '0' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END) * SF_YEA_YETABS(#YEA_STD_YY#,'000010','0010','A')
                ,COUNT(CASE WHEN A.YEA_FAM_STR001 = '3' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END) * SF_YEA_YETABS(#YEA_STD_YY#,'000010','0010','A')
                ,COUNT(CASE WHEN A.YEA_FAM_STR001 IN ('1','2','4','5','6','7','8') AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END)
                ,COUNT(CASE WHEN A.YEA_FAM_STR006 = '1' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END)
                ,COUNT(CASE WHEN NVL(A.YEA_FAM_STR009, '0') >= '1' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END)    /*장애자여부 코드화*/
                ,COUNT(CASE WHEN A.YEA_FAM_STR007 = '1' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END) * SF_YEA_YETABS(#YEA_STD_YY#,'000020','0030','A')   /*부녀자공제*/
                ,COUNT(CASE WHEN A.YEA_FAM_STR008 = '1' AND A.YEA_FAM_STR005 = '1' THEN A.YEA_FAMI_SEQ END) * SF_YEA_YETABS(#YEA_STD_YY#,'000020','0040','A')  /*한부모공제*/
                ,SUM(CASE WHEN A.YEA_FAM_STR011 = '1' THEN 1 ELSE 0 END)
              	,SUM(CASE WHEN A.YEA_FAM_STR012 = '1' THEN 1 ELSE 0 END)
                ,SUM(CASE WHEN A.YEA_FAM_STR001 = '0' AND A.YEA_FAM_STR010 = '1' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END)
                ,SUM(CASE WHEN A.YEA_FAM_STR001 NOT IN ('1','2') AND A.YEA_FAM_STR010 = '2' THEN SF_YEA_GET_MIN(NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0),SF_YEA_YETABS(#YEA_STD_YY#,'000060','0050','B')) ELSE 0 END)   /*취학전*/	/*20160511 세액감면 추가로 000050->000060으로변경*/
                ,SUM(CASE WHEN A.YEA_FAM_STR001 NOT IN ('1','2') AND A.YEA_FAM_STR010 = '3' THEN SF_YEA_GET_MIN(NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0),SF_YEA_YETABS(#YEA_STD_YY#,'000060','0050','C')) ELSE 0 END)   /*초중고*/ /*20160511 세액감면 추가로 000050->000060으로변경*/
                ,SUM(CASE WHEN A.YEA_FAM_STR001 NOT IN ('1','2') AND A.YEA_FAM_STR010 = '4' THEN SF_YEA_GET_MIN(NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0),SF_YEA_YETABS(#YEA_STD_YY#,'000060','0050','D')) ELSE 0 END)   /*대학생*/ /*20160511 세액감면 추가로 000050->000060으로변경*/
                ,SUM(CASE WHEN NVL(A.YEA_FAM_STR009, '0') >= '1' AND A.YEA_FAM_STR010 = '5' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END)  /*장애자여부 코드화*/
            INTO
                 r_YEA_YEPROC.YEA_PRC_NUM004 /*본인공제*/
                ,r_YEA_YEPROC.YEA_PRC_NUM005 /*배우자공제*/
                ,r_YEA_YEPROC.YEA_PRC_NUM006 /*부양가족인원*/
                ,r_YEA_YEPROC.YEA_PRC_NUM008 /*경로우대인원*/
                ,r_YEA_YEPROC.YEA_PRC_NUM010 /*장애인인원*/
                ,r_YEA_YEPROC.YEA_PRC_NUM012 /*부녀자공제*/
                ,r_YEA_YEPROC.YEA_PRC_NUM013 /*한부모공제*/
                ,r_YEA_YEPROC.YEA_PRC_NUM098 /*6세이하 귀속년도2014년 연말정산 재정산(소급)*/
                ,r_YEA_YEPROC.YEA_PRC_NUM100 /*출생입양*/
                ,r_YEA_INCDEC.YEA_INC_NUM056 /*본인교육비*/
                ,r_YEA_INCDEC.YEA_INC_NUM058 /*취학전아동교육비*/
                ,r_YEA_INCDEC.YEA_INC_NUM060 /*초중고교육비*/
                ,r_YEA_INCDEC.YEA_INC_NUM062 /*대학생교육비*/
                ,r_YEA_INCDEC.YEA_INC_NUM064 /*장애인교육비*/
            FROM YEA_YEFAMI A
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
          
          v_KOASE_STANDARD := r_YEA_YEPROC.YEA_PRC_NUM003;
          
          IF r_YEA_YEPROC.YEA_PRC_NUM004 > v_KOASE_STANDARD THEN
            r_YEA_YEPROC.YEA_PRC_NUM004 := v_KOASE_STANDARD;
            v_KOASE_STANDARD := 0;
          END IF;
      
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM004;
      
          r_YEA_YEPROC.YEA_PRC_NUM005 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM005,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM005;
        
          /*부양가족공제*/
          r_YEA_YEPROC.YEA_PRC_NUM007 := r_YEA_YEPROC.YEA_PRC_NUM006 * SF_YEA_YETABS(#YEA_STD_YY#,'000010','0010','A');
          
          r_YEA_YEPROC.YEA_PRC_NUM007 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM007,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM007;
   
          /*경로우대공제 70세 이상*/
          r_YEA_YEPROC.YEA_PRC_NUM009 := r_YEA_YEPROC.YEA_PRC_NUM008 * SF_YEA_YETABS(#YEA_STD_YY#,'000020','0010','B');
   
          r_YEA_YEPROC.YEA_PRC_NUM009 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM009,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM009;
   
          /*장애인공제*/
          r_YEA_YEPROC.YEA_PRC_NUM011 := r_YEA_YEPROC.YEA_PRC_NUM010 * SF_YEA_YETABS(#YEA_STD_YY#,'000020','0020','A');
   
          r_YEA_YEPROC.YEA_PRC_NUM011 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM011,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM011;
   
          /*부녀자공제 체크: 해당연도 근로소득금액이 3천만원 이상인 여성근로자는 공제받을수 없음*/
          IF r_YEA_YEPROC.YEA_PRC_NUM012 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM003 > SF_YEA_YETABS(#YEA_STD_YY#,'000020','0030','B') THEN
   
            UPDATE YEA_YEFAMI
               SET YEA_FAM_STR007 = '0'
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_FAM_STR007 = '1';
   
            r_YEA_YEPROC.YEA_PRC_NUM012 := 0;
   
          END IF;
   
          r_YEA_YEPROC.YEA_PRC_NUM012 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM012,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM012;
   
          /*한부모공제*/
          r_YEA_YEPROC.YEA_PRC_NUM013 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM013,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM013;          
   
          /*건강보험*/
          r_YEA_YEPROC.YEA_PRC_NUM019 := CASE WHEN r_YEA_INCDEC.YEA_INC_NUM011 + r_YEA_INCDEC.YEA_INC_NUM012 < 0 THEN 0 ELSE  r_YEA_INCDEC.YEA_INC_NUM011 + r_YEA_INCDEC.YEA_INC_NUM012 END;
   
          r_YEA_YEPROC.YEA_PRC_NUM019 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM019,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM019;
   
          /*고용보험*/
          r_YEA_YEPROC.YEA_PRC_NUM020 := CASE WHEN r_YEA_INCDEC.YEA_INC_NUM013 + r_YEA_INCDEC.YEA_INC_NUM014 < 0 THEN 0 ELSE  r_YEA_INCDEC.YEA_INC_NUM013 + r_YEA_INCDEC.YEA_INC_NUM014 END;
   
          r_YEA_YEPROC.YEA_PRC_NUM020 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM020,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM020;
   
          /*주택자금*/
          /*주택임차차입금상환*/
          r_YEA_INCDEC.YEA_INC_NUM015 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM015 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','A'),0);
          r_YEA_INCDEC.YEA_INC_NUM016 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM016 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','A'),0);
   
          /*주택저당차입금이자상환액1*/
          r_YEA_INCDEC.YEA_INC_NUM017 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM017 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','B'));  /*2012.12.26 변경*/
          /*주택저당차입금이자상환액2*/
          r_YEA_INCDEC.YEA_INC_NUM018 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM018 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','C'));  /*2012.12.26 변경*/
          /*주택저당차입금이자상환액3*/
          r_YEA_INCDEC.YEA_INC_NUM019 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM019 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','D'));  /*2012.12.26 변경*/
          /*주택저당차입금이자상환액4*/
          r_YEA_INCDEC.YEA_INC_NUM020 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM020 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','A'));  /*2012.12.26 추가*/
          /*주택저당차입금이자상환액5*/
          r_YEA_INCDEC.YEA_INC_NUM021 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM021 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','B'));  /*2012.12.26 추가*/
   		  /*[2015귀속]_추가 주택저당차입금이자상환액6*/
		  r_YEA_INCDEC.YEA_INC_NUM077 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM077 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','A'));
		  /*[2015귀속]_추가 주택저당차입금이자상환액7*/
		  r_YEA_INCDEC.YEA_INC_NUM078 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM078 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','B'));
		  /*[2015귀속]_추가 주택저당차입금이자상환액8*/
		  r_YEA_INCDEC.YEA_INC_NUM079 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM079 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','C'));
		  /*[2015귀속]_추가 주택저당차입금이자상환액9*/
		  r_YEA_INCDEC.YEA_INC_NUM080 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM080 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','A'),0),SF_YEA_YETABS(#YEA_STD_YY#,'000030','0045','A'));
   		  
          /*[2015귀속]_변경 주택마련저축(청약저축_2014.12.31 이전가입분)*/
		  IF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','A')	THEN /*[2015귀속]_추가 총급여7000만원초과 한도*/
	        r_YEA_INCDEC.YEA_INC_NUM024 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM024 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','C'));
	      ELSE
	        r_YEA_INCDEC.YEA_INC_NUM024 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM024 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','C'));
	      END IF;
	
          /*[2015귀속]_변경 주택마련저축(주택청약종합저축_2014.12.31 이전가입분)*/
	      IF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','A') THEN	/*[2015귀속]_추가 총급여7000만원초과 한도*/
	        r_YEA_INCDEC.YEA_INC_NUM026 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM026 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','C'));
	      ELSE
	        r_YEA_INCDEC.YEA_INC_NUM026 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM026 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','C'));
	      END IF;
	
	      /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
	      IF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','A')	THEN /*[2015귀속]_추가 총급여7000만원초과 한도*/
	        r_YEA_INCDEC.YEA_INC_NUM081 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM081 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','B'));
	      ELSE
	        r_YEA_INCDEC.YEA_INC_NUM081 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM081 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','C'));
	      END IF;
	
	      /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
	      IF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','A') THEN	/*[2015귀속]_추가 총급여7000만원초과 한도*/
	        r_YEA_INCDEC.YEA_INC_NUM082 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM082 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0035','B'));
	      ELSE
	        r_YEA_INCDEC.YEA_INC_NUM082 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM082 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','C'));
	      END IF;

        
          /*주택마련저축(근로자주택마련)*/
          r_YEA_INCDEC.YEA_INC_NUM025 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM025 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','D'));
   
   
          /*주택임차차입금상환 + 주택마련저축 300만원한도*/
          /*2011년 변경*/
          /*[2015귀속] 청약저축,주택청약종합저축_2015.01.01 이후가입분조건 추가*/
          IF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 +  r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026 + r_YEA_INCDEC.YEA_INC_NUM082) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
            IF r_YEA_INCDEC.YEA_INC_NUM015 > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM015 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B');
               r_YEA_INCDEC.YEA_INC_NUM016 := 0;
               r_YEA_INCDEC.YEA_INC_NUM024 := 0;
               r_YEA_INCDEC.YEA_INC_NUM081 := 0;    /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
               r_YEA_INCDEC.YEA_INC_NUM025 := 0;
               r_YEA_INCDEC.YEA_INC_NUM026 := 0;
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            /*2011년 추가*/
            ELSIF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM016 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - r_YEA_INCDEC.YEA_INC_NUM015; /*2011년 추가*/
               r_YEA_INCDEC.YEA_INC_NUM024 := 0;
               r_YEA_INCDEC.YEA_INC_NUM081 := 0;    /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
               r_YEA_INCDEC.YEA_INC_NUM025 := 0;
               r_YEA_INCDEC.YEA_INC_NUM026 := 0;
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            /*2011년 변경*/
            ELSIF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM024 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016); /*2011년 변경*/
               r_YEA_INCDEC.YEA_INC_NUM081 := 0;    /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
               r_YEA_INCDEC.YEA_INC_NUM025 := 0;
               r_YEA_INCDEC.YEA_INC_NUM026 := 0;
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
            ELSIF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM081 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024);    /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후가입분)*/
               r_YEA_INCDEC.YEA_INC_NUM025 := 0;
               r_YEA_INCDEC.YEA_INC_NUM026 := 0;
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            ELSIF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM025 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081);
               r_YEA_INCDEC.YEA_INC_NUM026 := 0;
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            ELSIF (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026) > SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') THEN
               r_YEA_INCDEC.YEA_INC_NUM026 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025);
               r_YEA_INCDEC.YEA_INC_NUM082 := 0;    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후가입분)*/
            ELSE
               r_YEA_INCDEC.YEA_INC_NUM082 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','B') - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026); /*2011년 변경*/
            END IF;
          END IF;
          /*[2015귀속] 청약저축,주택청약종합저축_2015.01.01 이후가입분조건 추가끝*/

          /*[2015귀속]_추가_통합공제한도 계산 변경*/
          /*
          r_YEA_INCDEC.YEA_INC_NUM017  :  600한도
          r_YEA_INCDEC.YEA_INC_NUM018  :  1000한도
          r_YEA_INCDEC.YEA_INC_NUM019  :  1500한도
          r_YEA_INCDEC.YEA_INC_NUM020  :  1500한도
          r_YEA_INCDEC.YEA_INC_NUM021  :  500한도
          r_YEA_INCDEC.YEA_INC_NUM077  :  1800한도
          r_YEA_INCDEC.YEA_INC_NUM078  :  1500한도
          r_YEA_INCDEC.YEA_INC_NUM079  :  500한도
          r_YEA_INCDEC.YEA_INC_NUM080  :  300한도
          */

	      IF r_YEA_INCDEC.YEA_INC_NUM077 > 0 THEN /*1800한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','A');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM019 > 0 THEN  /*1500한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','D');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM020 > 0 THEN  /*1500한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','A');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM078 > 0 THEN  /*1500한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','B');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM018 > 0 THEN  /*1000한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','C');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM017 > 0 THEN  /*600한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','B');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM021 > 0 THEN  /*500한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','B');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM079 > 0 THEN  /*500한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','C');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM079;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM080;
          ELSIF r_YEA_INCDEC.YEA_INC_NUM080 > 0 THEN  /*300한도*/
             v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0045','A');
             v_tmp_YEA_INC_NUM01 := r_YEA_INCDEC.YEA_INC_NUM080;
             v_tmp_YEA_INC_NUM02 := r_YEA_INCDEC.YEA_INC_NUM017;
             v_tmp_YEA_INC_NUM03 := r_YEA_INCDEC.YEA_INC_NUM018;
             v_tmp_YEA_INC_NUM04 := r_YEA_INCDEC.YEA_INC_NUM019;
             v_tmp_YEA_INC_NUM05 := r_YEA_INCDEC.YEA_INC_NUM020;
             v_tmp_YEA_INC_NUM06 := r_YEA_INCDEC.YEA_INC_NUM021;
             v_tmp_YEA_INC_NUM07 := r_YEA_INCDEC.YEA_INC_NUM077;
             v_tmp_YEA_INC_NUM08 := r_YEA_INCDEC.YEA_INC_NUM078;
             v_tmp_YEA_INC_NUM09 := r_YEA_INCDEC.YEA_INC_NUM079;
          ELSE
             v_HANDO_15_82 := 0;
             v_tmp_YEA_INC_NUM01 := 0;
             v_tmp_YEA_INC_NUM02 := 0;
             v_tmp_YEA_INC_NUM03 := 0;
             v_tmp_YEA_INC_NUM04 := 0;
             v_tmp_YEA_INC_NUM05 := 0;
             v_tmp_YEA_INC_NUM06 := 0;
             v_tmp_YEA_INC_NUM07 := 0;
             v_tmp_YEA_INC_NUM08 := 0;
             v_tmp_YEA_INC_NUM09 := 0;
          END IF;

          IF  v_HANDO_15_82 > 0 then
            IF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04
               + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024
               + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026 + r_YEA_INCDEC.YEA_INC_NUM082 > v_HANDO_15_82 THEN

              IF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM01 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016);
                 v_tmp_YEA_INC_NUM02 := 0;
                 v_tmp_YEA_INC_NUM03 := 0;
                 v_tmp_YEA_INC_NUM04 := 0;
                 v_tmp_YEA_INC_NUM05 := 0;
                 v_tmp_YEA_INC_NUM06 := 0;
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM02 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01);
                 v_tmp_YEA_INC_NUM03 := 0;
                 v_tmp_YEA_INC_NUM04 := 0;
                 v_tmp_YEA_INC_NUM05 := 0;
                 v_tmp_YEA_INC_NUM06 := 0;
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM03 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02);
                 v_tmp_YEA_INC_NUM04 := 0;
                 v_tmp_YEA_INC_NUM05 := 0;
                 v_tmp_YEA_INC_NUM06 := 0;
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM04 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03);
                 v_tmp_YEA_INC_NUM05 := 0;
                 v_tmp_YEA_INC_NUM06 := 0;
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM05 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04);
                 v_tmp_YEA_INC_NUM06 := 0;
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM06 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05);
                 v_tmp_YEA_INC_NUM07 := 0;
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM07 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06);
                 v_tmp_YEA_INC_NUM08 := 0;
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM08 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07);
                 v_tmp_YEA_INC_NUM09 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 > v_HANDO_15_82 THEN
                 v_tmp_YEA_INC_NUM09 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08);
                 r_YEA_INCDEC.YEA_INC_NUM024 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 > v_HANDO_15_82 THEN
                 r_YEA_INCDEC.YEA_INC_NUM024 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09);
                 r_YEA_INCDEC.YEA_INC_NUM081 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 > v_HANDO_15_82 THEN
                 r_YEA_INCDEC.YEA_INC_NUM081 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024);
                 r_YEA_INCDEC.YEA_INC_NUM025 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 > v_HANDO_15_82 THEN
                 r_YEA_INCDEC.YEA_INC_NUM025 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081);
                 r_YEA_INCDEC.YEA_INC_NUM026 := 0;
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSIF r_YEA_INCDEC.YEA_INC_NUM015  + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026 > v_HANDO_15_82 THEN
                 r_YEA_INCDEC.YEA_INC_NUM026 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025);
                 r_YEA_INCDEC.YEA_INC_NUM082 := 0;
              ELSE
                 r_YEA_INCDEC.YEA_INC_NUM082 := v_HANDO_15_82 - (r_YEA_INCDEC.YEA_INC_NUM015 + r_YEA_INCDEC.YEA_INC_NUM016 + v_tmp_YEA_INC_NUM01 + v_tmp_YEA_INC_NUM02 + v_tmp_YEA_INC_NUM03 + v_tmp_YEA_INC_NUM04 + v_tmp_YEA_INC_NUM05 + v_tmp_YEA_INC_NUM06 + v_tmp_YEA_INC_NUM07 + v_tmp_YEA_INC_NUM08 + v_tmp_YEA_INC_NUM09 + r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081 + r_YEA_INCDEC.YEA_INC_NUM025 + r_YEA_INCDEC.YEA_INC_NUM026);
              END IF;
            END IF;


            IF r_YEA_INCDEC.YEA_INC_NUM077 > 0 THEN /*1800한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','A');
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM019 > 0 THEN  /*1500한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','D');
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM020 > 0 THEN  /*1500한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','A');
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM078 > 0 THEN  /*1500한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','B');
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM018 > 0 THEN  /*1000한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','C');
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM017 > 0 THEN  /*600한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0020','B');
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM021  > 0 THEN  /*500한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0030','B');
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM079 > 0 THEN  /*500한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0040','C');
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM09;
            ELSIF r_YEA_INCDEC.YEA_INC_NUM080 > 0 THEN  /*300한도*/
               v_HANDO_15_82 := SF_YEA_YETABS(#YEA_STD_YY#,'000030','0045','A');
               r_YEA_INCDEC.YEA_INC_NUM080 := v_tmp_YEA_INC_NUM01;
               r_YEA_INCDEC.YEA_INC_NUM017 := v_tmp_YEA_INC_NUM02;
               r_YEA_INCDEC.YEA_INC_NUM018 := v_tmp_YEA_INC_NUM03;
               r_YEA_INCDEC.YEA_INC_NUM019 := v_tmp_YEA_INC_NUM04;
               r_YEA_INCDEC.YEA_INC_NUM020 := v_tmp_YEA_INC_NUM05;
               r_YEA_INCDEC.YEA_INC_NUM021 := v_tmp_YEA_INC_NUM06;
               r_YEA_INCDEC.YEA_INC_NUM077 := v_tmp_YEA_INC_NUM07;
               r_YEA_INCDEC.YEA_INC_NUM078 := v_tmp_YEA_INC_NUM08;
               r_YEA_INCDEC.YEA_INC_NUM079 := v_tmp_YEA_INC_NUM09;
            END IF;
          END IF;
          /*[2015귀속]_추가_통합공제한도 계산 변경끝*/   
   
          /*주택임차차입금상환액공제액*/
          r_YEA_YEPROC.YEA_PRC_NUM021 := r_YEA_INCDEC.YEA_INC_NUM015;
   
          r_YEA_YEPROC.YEA_PRC_NUM021 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM021,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM021;
   
          r_YEA_YEPROC.YEA_PRC_NUM022 := r_YEA_INCDEC.YEA_INC_NUM016;
   
          r_YEA_YEPROC.YEA_PRC_NUM022 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM022,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM022;
   
          /*[2014귀속] 공제금액*/
          v_RTER_LIMT := r_YEA_YEPROC.YEA_PRC_NUM022;
          FOR RS IN (
                SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_RENT_SEQ2   /*월세주택임차차입금2_순번*/
                      ,YEA_RT2_NUM002   /*주택차입이자상환액*/
                  FROM YEA_RENTA2
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              ORDER BY YEA_RT2_NUM002
              ) LOOP
              IF v_RTER_LIMT > 0 THEN
   
                v_RTER_LIMT := v_RTER_LIMT - TRUNC(RS.YEA_RT2_NUM002 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','A'), 0);
   
                UPDATE YEA_RENTA2
                   SET YEA_RT2_NUM005 = TRUNC(RS.YEA_RT2_NUM002 * SF_YEA_YETABS(#YEA_STD_YY#,'000030','0010','A'), 0) + CASE WHEN v_RTER_LIMT < 0 THEN v_RTER_LIMT ELSE 0 END
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
                   AND YEA_RENT_SEQ2 = RS.YEA_RENT_SEQ2;
   
              END IF;
   
          END LOOP;
   
   
          /*장기주택저당차입금이자상환공제액*/
          r_YEA_YEPROC.YEA_PRC_NUM023 := r_YEA_INCDEC.YEA_INC_NUM017; /*2011년 추가*/
   
          r_YEA_YEPROC.YEA_PRC_NUM023 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM023,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM023;
   
          r_YEA_YEPROC.YEA_PRC_NUM024 := r_YEA_INCDEC.YEA_INC_NUM018; /*2011년 추가*/
   
          r_YEA_YEPROC.YEA_PRC_NUM024 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM024,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM024;
   
          r_YEA_YEPROC.YEA_PRC_NUM025 := r_YEA_INCDEC.YEA_INC_NUM019; /*2011년 추가*/
   
          r_YEA_YEPROC.YEA_PRC_NUM025 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM025,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM025;
   
          r_YEA_YEPROC.YEA_PRC_NUM026 := r_YEA_INCDEC.YEA_INC_NUM020; /*2012.12.26 추가*/
   
          r_YEA_YEPROC.YEA_PRC_NUM026 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM026,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM026;
   
          r_YEA_YEPROC.YEA_PRC_NUM027 := r_YEA_INCDEC.YEA_INC_NUM021; /*2012.12.26 추가*/
   
          r_YEA_YEPROC.YEA_PRC_NUM027 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM027,v_KOASE_STANDARD),0);
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM027;
   		  
   		  /*[2015귀속]_추가 장기주택저당차입금이자상환공제액(2015년이후)*/
		  r_YEA_YEPROC.YEA_PRC_NUM104 := r_YEA_INCDEC.YEA_INC_NUM077;

		  r_YEA_YEPROC.YEA_PRC_NUM104 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM104,v_KOASE_STANDARD),0);
		  v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM104;

		  r_YEA_YEPROC.YEA_PRC_NUM105 := r_YEA_INCDEC.YEA_INC_NUM078;

     	  r_YEA_YEPROC.YEA_PRC_NUM105 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM105,v_KOASE_STANDARD),0);
		  v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM105;

		  r_YEA_YEPROC.YEA_PRC_NUM106 := r_YEA_INCDEC.YEA_INC_NUM079;

		  r_YEA_YEPROC.YEA_PRC_NUM106 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM106,v_KOASE_STANDARD),0);
		  v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM106;

		  r_YEA_YEPROC.YEA_PRC_NUM107 := r_YEA_INCDEC.YEA_INC_NUM080;

     	  r_YEA_YEPROC.YEA_PRC_NUM107 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM107,v_KOASE_STANDARD),0);
		  v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM107;
		  /*[2015귀속]_추가 장기주택저당차입금이자상환공제액(2015년이후)끝*/
		    
          v_YEA_MORT := r_YEA_YEPROC.YEA_PRC_NUM023 + r_YEA_YEPROC.YEA_PRC_NUM024 + r_YEA_YEPROC.YEA_PRC_NUM025 + r_YEA_YEPROC.YEA_PRC_NUM026 + r_YEA_YEPROC.YEA_PRC_NUM027 + r_YEA_YEPROC.YEA_PRC_NUM104 + r_YEA_YEPROC.YEA_PRC_NUM105 + r_YEA_YEPROC.YEA_PRC_NUM106 + r_YEA_YEPROC.YEA_PRC_NUM107;    /*[2015귀속]_추가 장기주택저당차입금이자상환공제액(2015년이후)*/

          /*기부금 (!처리하면서 이월처리도 하여야 함)*/
          /*2011 수정*/
          /*기부금 [2013귀속] "정치자금기부금, 법정기부금, 우리사주조합기부금, 지정기부금"으로 분리*/
          v_YEA_DONA := 0;   /*기부금공제대상금액 계*/
          r_YEA_YEPROC.YEA_PRC_NUM069 := 0;   /*정치자금기부금_10만원초과_공제대상금액*/
          r_YEA_YEPROC.YEA_PRC_NUM071 := 0;   /*법정기부금*/
          r_YEA_YEPROC.YEA_PRC_NUM039 := 0;   /*우리사주조합기부금*/
          r_YEA_YEPROC.YEA_PRC_NUM073 := 0;   /*지정기부금*/
   
          /*한도금액*/
          v_DONA_LIMT := r_YEA_YEPROC.YEA_PRC_NUM003;   /*근로소득금액*/
          v_DONA_TAMT := 0;
          r_YEA_YEPROC.YEA_PRC_NUM069 :=  r_YEA_YEPROC.YEA_PRC_NUM069 - r_YEA_INCDEC.YEA_INC_NUM065;      /*[2015귀속]_추가 정치자금기부금10만원이하빼기*/
                    
          /*정치자금기부금*/
          FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                     ,YEA_EMP_NO   /*사원번호*/
                     ,YEA_DOA_STR002   /*기부년도*/
                     ,SUM(CASE WHEN YEA_DOA_STR001 = '20' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA20
                 FROM YEA_DONAAD
                WHERE YEA_STD_YY = #YEA_STD_YY#
                  AND YEA_EMP_NO = #YEA_EMP_NO#
             GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
             ORDER BY DECODE(YEA_DOA_STR002,SUBSTR(#YEA_STD_YY#,1,4),'1000',YEA_DOA_STR002)
          ) LOOP
              IF RS.DONA20 > 0 THEN
   
                v_DONA_DEDU := NVL(v_YEA_DONA, 0);
                v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA20, v_DONA_LIMT - v_DONA_TAMT); /*정치자금*/
                r_YEA_YEPROC.YEA_PRC_NUM069 := r_YEA_YEPROC.YEA_PRC_NUM069 + SF_YEA_GET_MIN(RS.DONA20, v_DONA_LIMT - v_DONA_TAMT);  /*[2013귀속] 추가*/
   
                v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
   
                UPDATE YEA_DONAAD
                   SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
                      ,YEA_DOA_NUM005 = RS.DONA20 - (v_YEA_DONA - v_DONA_DEDU)
                      ,YEA_DOA_NUM006 = 0
                 WHERE YEA_STD_YY = RS.YEA_STD_YY
                   AND YEA_EMP_NO = RS.YEA_EMP_NO
                   AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                   AND YEA_DOA_STR001 = '20';
              END IF;
   
          END LOOP;
          /*정치자금기부금*/
   
          /*기부금 이월분부터 처리*/
          /*법정기부금(이월)*/
          IF v_YEA_STANTAX_YN = 1 THEN
   
            FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                      ,SUM(CASE WHEN YEA_DOA_STR001 = '10' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA10_CARRY
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
              GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
              ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
                IF RS.DONA10_CARRY > 0 THEN
   
                  UPDATE YEA_DONAAD
                    SET YEA_DOA_NUM004 = 0
                        ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 2 THEN RS.DONA10_CARRY ELSE 0 END
                        ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 2 THEN RS.DONA10_CARRY ELSE 0 END
                  WHERE YEA_STD_YY = RS.YEA_STD_YY
                    AND YEA_EMP_NO = RS.YEA_EMP_NO
                    AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                    AND YEA_DOA_STR001 = '10';
   
                END IF;
            END LOOP;
   
          ELSE
   
            v_YEA_DONA_CARRY := 0; /*기부금이월분*/
            v_DONA_LIMT := r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA;  /*공제한도*/
            v_DONA_TAMT := 0; /*합계 초기화*/
   
            FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                      ,SUM(CASE WHEN YEA_DOA_STR001 = '10' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA10_CARRY
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/ 
              GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
              ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
                IF RS.DONA10_CARRY > 0 THEN
   
                  v_DONA_DEDU := NVL(v_YEA_DONA,0);
                  v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA10_CARRY, v_DONA_LIMT - v_DONA_TAMT); /*정치자금*/
                  v_YEA_PRC_NUM071_CARRY :=  v_YEA_PRC_NUM071_CARRY + SF_YEA_GET_MIN(RS.DONA10_CARRY, v_DONA_LIMT - v_DONA_TAMT);  /*이월분*/
                  v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
   
                  UPDATE YEA_DONAAD
                    SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
                        ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 2 THEN RS.DONA10_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                        ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 2 THEN RS.DONA10_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                  WHERE YEA_STD_YY = RS.YEA_STD_YY
                    AND YEA_EMP_NO = RS.YEA_EMP_NO
                    AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                    AND YEA_DOA_STR001 = '10';
   
                  v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + v_YEA_DONA - v_DONA_DEDU;
   
                END IF;
            END LOOP;
          END IF;
            /*법정기부금(이월)*/
   		  
   		  IF v_YEA_STANTAX_YN = 1 THEN
   		  	FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                      ,SUM(CASE WHEN YEA_DOA_STR001 = '10' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA10
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
              GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
              ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
                IF RS.DONA10 > 0 THEN
   
                  UPDATE YEA_DONAAD
                    SET YEA_DOA_NUM004 = 0
                        ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 2 THEN RS.DONA10 ELSE 0 END
                        ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 2 THEN RS.DONA10 ELSE 0 END
                  WHERE YEA_STD_YY = RS.YEA_STD_YY
                    AND YEA_EMP_NO = RS.YEA_EMP_NO
                    AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                    AND YEA_DOA_STR001 = '10';
   
                END IF;
            END LOOP;  		  	
   		  ELSE	
	          v_DONA_LIMT := r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA;
	          v_DONA_TAMT := 0;
	          FOR RS IN (
	               SELECT YEA_STD_YY   /*기준년월*/
	                      ,YEA_EMP_NO   /*사원번호*/
	                      ,YEA_DOA_STR002   /*기부년도*/
	                     ,SUM(CASE WHEN YEA_DOA_STR001 = '10' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA10
	                 FROM YEA_DONAAD
	                WHERE YEA_STD_YY = #YEA_STD_YY#
	                  AND YEA_EMP_NO = #YEA_EMP_NO#
	                  AND YEA_DOA_STR002 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
	                GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
	                ORDER BY  DECODE(YEA_DOA_STR002,SUBSTR(#YEA_STD_YY#,1,4),'1000',YEA_DOA_STR002)
	          ) LOOP
	              IF RS.DONA10 > 0 THEN
	                v_DONA_DEDU := NVL(v_YEA_DONA, 0);
	                v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA10, v_DONA_LIMT - v_DONA_TAMT); /*법정기부금*/
	                r_YEA_YEPROC.YEA_PRC_NUM071 := r_YEA_YEPROC.YEA_PRC_NUM071 + SF_YEA_GET_MIN(RS.DONA10, v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
	   
	   
	                v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
	   
	                UPDATE YEA_DONAAD
	                   SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
	                      ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 2 THEN RS.DONA10 - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
	                      ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 2 THEN RS.DONA10 - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
	                 WHERE YEA_STD_YY = RS.YEA_STD_YY
	                   AND YEA_EMP_NO = RS.YEA_EMP_NO
	                   AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
	                   AND YEA_DOA_STR001 = '10';
	              END IF;
	          END LOOP;
   		  END IF;
   		  
          /*우리사주소득공제*/
          FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                     ,SUM(CASE WHEN YEA_DOA_STR001 = '42' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA42
                 FROM YEA_DONAAD
                WHERE YEA_STD_YY = #YEA_STD_YY#
                  AND YEA_EMP_NO = #YEA_EMP_NO#
             GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002             
             ORDER BY DECODE(YEA_DOA_STR002,SUBSTR(#YEA_STD_YY#,1,4),'1000',YEA_DOA_STR002) 
          ) LOOP
              IF RS.DONA42 > 0 THEN
                v_DONA_DEDU := NVL(v_YEA_DONA, 0);
   
                v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA42, v_DONA_LIMT - v_DONA_TAMT); /*우리사주조합기부금*/
                r_YEA_YEPROC.YEA_PRC_NUM039 := r_YEA_YEPROC.YEA_PRC_NUM039 + SF_YEA_GET_MIN(RS.DONA42, v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
   
                v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
   
                UPDATE YEA_DONAAD
                   SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
                      ,YEA_DOA_NUM005 = RS.DONA42 - (v_YEA_DONA - v_DONA_DEDU)
                      ,YEA_DOA_NUM006 = 0
                 WHERE YEA_STD_YY = RS.YEA_STD_YY
                   AND YEA_EMP_NO = RS.YEA_EMP_NO
                   AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                   AND YEA_DOA_STR001 = '42';
              END IF;
   
          END LOOP;
   		  
   		  v_DONA_LIMT := NVL(v_DONA_LIMT, 0) - NVL(v_DONA_TAMT, 0);
	      v_DONA_TAMT := 0;   		  
          BEGIN
              SELECT SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA40
                    ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA41
                    INTO v_DONA_APPO, v_DONA_RELI
               FROM YEA_DONAAD
              WHERE YEA_STD_YY = #YEA_STD_YY#
                AND YEA_EMP_NO = #YEA_EMP_NO#
              ;
   
   
              EXCEPTION WHEN NO_DATA_FOUND THEN
                  v_DONA_APPO := 0;
                  v_DONA_RELI := 0;
          END;
   
          IF v_DONA_RELI > 0 THEN
              v_DONA_LIMT := (TRUNC((r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA + r_YEA_INCDEC.YEA_INC_NUM065) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','D'),0)) + (SF_YEA_GET_MIN(TRUNC((r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA) * (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','C')- SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','D')),0), v_DONA_APPO));  /*[2015귀속]변경 정치자금기부금 10만원이하금액 더하기*/ /*20160511 세액감면 추가로 000050->000060으로변경*/
              v_DONA_LIMT2 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','D'),0); /*2012.02.06 추가*/	/*20160511 세액감면 추가로 000050->000060으로변경*/
              v_DONA_TAMT := 0;
          ELSE
              v_DONA_LIMT := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM003 - v_YEA_DONA + r_YEA_INCDEC.YEA_INC_NUM065) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','C'),0);    /*[2015귀속]변경 정치자금기부금 10만원이하금액 더하기*/	/*20160511 세액감면 추가로 000050->000060으로변경*/
              v_DONA_TAMT := 0;
          END IF;     
   
          /*지정기부금 이월금액*/
          IF v_YEA_STANTAX_YN = 1 THEN
            FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA40_CARRY
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA41_CARRY
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
                  GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
                  ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
   
                  IF RS.DONA40_CARRY + RS.DONA41_CARRY > 0 THEN
   
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = 0
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA40_CARRY ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40_CARRY ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '40';
   
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = 0
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA41_CARRY ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA41_CARRY ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '41';
   
                  END IF;
            END LOOP;
          ELSE
            v_DONA_TAMT := 0;
            FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA40_CARRY
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA41_CARRY
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
                  GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002, YEA_DOA_STR001
                  ORDER BY YEA_DOA_STR001, YEA_DOA_STR002 ASC
            ) LOOP
   
                IF v_DONA_RELI > 0 THEN /*종교기부금이 있다면..*/
                  IF RS.DONA40_CARRY > 0 THEN
                    v_DONA_DEDU := NVL(v_YEA_DONA, 0);
                    v_YEA_DONA  := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA40_CARRY, v_DONA_LIMT - v_DONA_TAMT); /*이월분*/
                    v_YEA_PRC_NUM073_CARRY := NVL(v_YEA_PRC_NUM073_CARRY,0) + SF_YEA_GET_MIN(RS.DONA40_CARRY, v_DONA_LIMT - v_DONA_TAMT);  /*이월분*/
                    v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
      
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA40_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '40';
      				
      				v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + SF_YEA_GET_MIN(RS.DONA40_CARRY,v_YEA_DONA - v_DONA_DEDU);
                  	v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + v_YEA_DONA - v_DONA_DEDU - SF_YEA_GET_MIN(RS.DONA40_CARRY,v_YEA_DONA - v_DONA_DEDU);
                  	
                  END IF;
      
                  IF RS.DONA41_CARRY > 0 THEN
      
                    v_DONA_DEDU := NVL(v_YEA_DONA, 0);
                    v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA41_CARRY, v_DONA_LIMT - v_DONA_TAMT); /*이월분*/
                    v_YEA_PRC_NUM073_CARRY := NVL(v_YEA_PRC_NUM073_CARRY,0) + SF_YEA_GET_MIN(RS.DONA41_CARRY, v_DONA_LIMT - v_DONA_TAMT);  /*이월분*/
                    v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
      
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 =   v_YEA_DONA - v_DONA_DEDU
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA41_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA41_CARRY - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '41';
      				
      				v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + SF_YEA_GET_MIN(RS.DONA41_CARRY,v_YEA_DONA - v_DONA_DEDU);
                  	v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + v_YEA_DONA - v_DONA_DEDU - SF_YEA_GET_MIN(RS.DONA41_CARRY,v_YEA_DONA - v_DONA_DEDU);
                  
                  END IF;                                   
                  
                ELSE
                  IF RS.DONA40_CARRY > 0 THEN
                    v_DONA_DEDU := NVL(v_YEA_PRC_NUM073_CARRY, 0);
                    v_YEA_PRC_NUM073_CARRY := v_YEA_PRC_NUM073_CARRY + SF_YEA_GET_MIN(RS.DONA40_CARRY , v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
   
                    v_YEA_DONA_CARRY := NVL(v_YEA_DONA_CARRY,0) + SF_YEA_GET_MIN(RS.DONA40_CARRY , v_DONA_LIMT - v_DONA_TAMT);
   
                    v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA_CARRY - v_DONA_DEDU);
   
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = v_DONA_TAMT - v_DONA_DEDU
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA40_CARRY - (v_DONA_TAMT - v_DONA_DEDU) ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40_CARRY - (v_DONA_TAMT - v_DONA_DEDU) ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '40';
   
                      v_YEA_DONA_CARRY_SUM := NVL(v_YEA_DONA_CARRY_SUM,0) + v_DONA_TAMT - v_DONA_DEDU;
                  END IF;
                END IF;
            END LOOP;
          END IF;
   		  
   		  IF v_YEA_STANTAX_YN = 1 THEN
	      	FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA40
                        ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA41
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
                  GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
                  ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
   
                  IF RS.DONA40 + RS.DONA41 > 0 THEN
   
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = 0
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA40 ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40 ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '40';
   
                    UPDATE YEA_DONAAD
                      SET YEA_DOA_NUM004 = 0
                          ,YEA_DOA_NUM005 = CASE WHEN RS.YEA_DOA_STR002 < SUBSTR(RS.YEA_STD_YY,1,4) - 4 THEN RS.DONA41 ELSE 0 END
                          ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA41 ELSE 0 END
                    WHERE YEA_STD_YY = RS.YEA_STD_YY
                      AND YEA_EMP_NO = RS.YEA_EMP_NO
                      AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                      AND YEA_DOA_STR001 = '41';
   
                  END IF;
            END LOOP;
	      ELSE
	          FOR RS IN (
	               SELECT YEA_STD_YY   /*기준년월*/
	                      ,YEA_EMP_NO   /*사원번호*/
	                      ,YEA_DOA_STR002   /*기부년도*/
	                      ,SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA40
	                      ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM003 ELSE 0 END) AS DONA41
	                 FROM YEA_DONAAD
	                WHERE YEA_STD_YY = #YEA_STD_YY#
	                  AND YEA_EMP_NO = #YEA_EMP_NO#
	                  AND YEA_DOA_STR002 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
	                GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOA_STR002
	                ORDER BY DECODE(YEA_DOA_STR002,SUBSTR(#YEA_STD_YY#,1,4),'1000',YEA_DOA_STR002)
	          ) LOOP
	   
	              IF v_DONA_RELI > 0 THEN
	                IF RS.DONA40 > 0 THEN /*종교기부금이 있다면..*/
	                  v_DONA_DEDU := NVL(v_YEA_DONA, 0);
	                  v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA40, v_DONA_LIMT - v_DONA_TAMT);
	                
	                  r_YEA_YEPROC.YEA_PRC_NUM073 := r_YEA_YEPROC.YEA_PRC_NUM073 + SF_YEA_GET_MIN(RS.DONA40, v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
	                
	                  v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
	                
	                  UPDATE YEA_DONAAD
	                    SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
	                       ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40 - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
	                  WHERE YEA_STD_YY = RS.YEA_STD_YY
	                    AND YEA_EMP_NO = RS.YEA_EMP_NO
	                    AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
	                    AND YEA_DOA_STR001 = '40';
	                END IF;
	                
	                IF RS.DONA41 > 0 THEN /*종교기부금이 있다면..*/
	                
	                  v_DONA_DEDU := NVL(v_YEA_DONA, 0);
	                  v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA41, v_DONA_LIMT - v_DONA_TAMT);
	                
	                  r_YEA_YEPROC.YEA_PRC_NUM073 := r_YEA_YEPROC.YEA_PRC_NUM073 + SF_YEA_GET_MIN(RS.DONA41, v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
	                
	                  v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
	                
	                  UPDATE YEA_DONAAD
	                    SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
	                       ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA41 - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
	                  WHERE YEA_STD_YY = RS.YEA_STD_YY
	                    AND YEA_EMP_NO = RS.YEA_EMP_NO
	                    AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
	                    AND YEA_DOA_STR001 = '41';
	                END IF;
	             ELSE
	                v_DONA_DEDU := NVL(v_YEA_DONA, 0);
	                v_YEA_DONA := NVL(v_YEA_DONA,0) + SF_YEA_GET_MIN(RS.DONA40 , v_DONA_LIMT - v_DONA_TAMT);
	   
	                r_YEA_YEPROC.YEA_PRC_NUM073 := r_YEA_YEPROC.YEA_PRC_NUM073 + SF_YEA_GET_MIN(RS.DONA40 , v_DONA_LIMT - v_DONA_TAMT);   /*[2013귀속] 추가*/
	   
	                v_DONA_TAMT := v_DONA_TAMT + (v_YEA_DONA - v_DONA_DEDU);
	   
	                UPDATE YEA_DONAAD
	                  SET YEA_DOA_NUM004 = v_YEA_DONA - v_DONA_DEDU
	                      ,YEA_DOA_NUM006 = CASE WHEN RS.YEA_DOA_STR002 >= SUBSTR(RS.YEA_STD_YY,1,4)- 4 THEN RS.DONA40 - (v_YEA_DONA - v_DONA_DEDU) ELSE 0 END
	                WHERE YEA_STD_YY = RS.YEA_STD_YY
	                  AND YEA_EMP_NO = RS.YEA_EMP_NO
	                  AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
	                  AND YEA_DOA_STR001 = '40';
	             END IF;
	   
	          END LOOP;
          END IF;
                                  
          /*기부금공제대상액 = 당해분 + 이월분*/                                                                     
          r_YEA_YEPROC.YEA_PRC_NUM071 := NVL(r_YEA_YEPROC.YEA_PRC_NUM071, 0) + NVL(v_YEA_PRC_NUM071_CARRY, 0);          
          r_YEA_YEPROC.YEA_PRC_NUM073 := NVL(r_YEA_YEPROC.YEA_PRC_NUM073, 0) + NVL(v_YEA_PRC_NUM073_CARRY, 0);
   		  
   		  	
          /*기부금 이월분*/
          r_YEA_YEPROC.YEA_PRC_NUM028 := NVL(v_YEA_DONA_CARRY_SUM,0);
   
          /*근로소득금액이 이미 차감이 완료 되었다면 기부금 이월분에 대한 이월처리를 다시해줘야 한다*/
          IF v_KOASE_STANDARD < 0 THEN
            v_KOASE_STANDARD := 0;
          END IF;

          IF r_YEA_YEPROC.YEA_PRC_NUM028 > v_KOASE_STANDARD THEN
          	          	          	
          	v_DONA_DEDU := v_KOASE_STANDARD;
            v_DONA_TAMT := 0;
   
            FOR RS IN (
               SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_DOA_STR002   /*기부년도*/
                      ,YEA_DOA_NUM003
                      ,YEA_DOA_NUM004
                      ,YEA_DOA_NUM005
                      ,YEA_DONA_SEQ
                  FROM YEA_DONAAD
                  WHERE YEA_STD_YY = #YEA_STD_YY#
                    AND YEA_EMP_NO = #YEA_EMP_NO#
                    AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
                    AND YEA_DOA_STR001 = '10'
              ORDER BY YEA_DOA_STR002 ASC
            ) LOOP
              IF RS.YEA_DOA_NUM004 > 0 THEN
                IF v_DONA_DEDU = 0 THEN
                  IF RS.YEA_DOA_STR002 < TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-2) THEN
                    v_DONA_IWOL := 0;
                    v_DONA_DAMT := RS.YEA_DOA_NUM003;
                  ELSE
                    v_DONA_IWOL := RS.YEA_DOA_NUM003;
                    v_DONA_DAMT := 0;
                  END IF;
                ELSE
                  IF RS.YEA_DOA_STR002 < TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-2) THEN
                    IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                      v_DONA_IWOL := 0;
                      v_DONA_DAMT := RS.YEA_DOA_NUM003-RS.YEA_DOA_NUM004;
                    ELSE
                      v_DONA_IWOL := RS.YEA_DOA_NUM003;
                    END IF;
                  ELSE
                    IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                      v_DONA_IWOL := 0;
                      v_DONA_DAMT := 0;
                    ELSE
                      v_DONA_IWOL := RS.YEA_DOA_NUM003;
                      v_DONA_DAMT := 0;
                    END IF;
                  END IF;
                END IF;

                UPDATE YEA_DONAAD
                  SET YEA_DOA_NUM004 = CASE WHEN v_DONA_DEDU = 0 THEN 0 WHEN v_DONA_IWOL = 0 THEN RS.YEA_DOA_NUM004 ELSE RS.YEA_DOA_NUM004 - v_DONA_IWOL END
                      ,YEA_DOA_NUM005 = v_DONA_DAMT
                      ,YEA_DOA_NUM006 = v_DONA_IWOL
                WHERE YEA_STD_YY = RS.YEA_STD_YY
                  AND YEA_EMP_NO = RS.YEA_EMP_NO
                  AND YEA_DOA_STR002 = RS.YEA_DOA_STR002
                  AND YEA_DONA_SEQ = RS.YEA_DONA_SEQ;

                v_DONA_DEDU := v_DONA_DEDU - SF_YEA_GET_MIN(RS.YEA_DOA_NUM004,v_DONA_DEDU);

              END IF;
          END LOOP;
   
            FOR RS IN (
            SELECT YEA_STD_YY   /*기준년월*/
                  ,YEA_EMP_NO   /*사원번호*/
                  ,YEA_DOA_STR002   /*기부년도*/
                  ,YEA_DOA_NUM003
                  ,YEA_DOA_NUM004
                  ,YEA_DOA_NUM005
                  ,YEA_DONA_SEQ
              FROM YEA_DONAAD
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_DOA_STR002 <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
               AND YEA_DOA_STR001 IN ('40','41')
          ORDER BY YEA_DOA_STR001
        ) LOOP


            IF RS.YEA_DOA_NUM004 > 0 THEN
              IF v_DONA_DEDU = 0 THEN
                IF RS.YEA_DOA_STR002 < TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-4) THEN
                  v_DONA_IWOL := 0;
                  v_DONA_DAMT := RS.YEA_DOA_NUM003;
                ELSE
                  v_DONA_IWOL := RS.YEA_DOA_NUM003;
                  v_DONA_DAMT := 0;
                END IF;
              ELSE
                IF RS.YEA_DOA_STR002 < TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-4) THEN
                  IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                    v_DONA_IWOL := 0;
                    v_DONA_DAMT := RS.YEA_DOA_NUM003-RS.YEA_DOA_NUM004;
                  ELSE
                    v_DONA_IWOL := RS.YEA_DOA_NUM003;
                  END IF;
                ELSE
                  IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                    v_DONA_IWOL := 0;
                    v_DONA_DAMT := 0;
                  ELSE
                    v_DONA_IWOL := RS.YEA_DOA_NUM003;
                    v_DONA_DAMT := 0;
                  END IF;
                END IF;
              END IF;

              UPDATE YEA_DONAAD
                 SET YEA_DOA_NUM004 = CASE WHEN v_DONA_DEDU = 0 THEN 0 WHEN v_DONA_IWOL = 0 THEN RS.YEA_DOA_NUM004 ELSE RS.YEA_DOA_NUM004 - v_DONA_IWOL END
                    ,YEA_DOA_NUM005 = v_DONA_DAMT
                    ,YEA_DOA_NUM006 = v_DONA_IWOL
              WHERE YEA_STD_YY = RS.YEA_STD_YY
                AND YEA_EMP_NO = RS.YEA_EMP_NO
                AND YEA_DONA_SEQ = RS.YEA_DONA_SEQ;

              v_DONA_DEDU := v_DONA_DEDU - SF_YEA_GET_MIN(RS.YEA_DOA_NUM004,v_DONA_DEDU);
            END IF;
          END LOOP;
   
          END IF;
          r_YEA_YEPROC.YEA_PRC_NUM028 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM028,v_KOASE_STANDARD),0);
   
          v_KOASE_STANDARD := v_KOASE_STANDARD - r_YEA_YEPROC.YEA_PRC_NUM028;
   
   
          /*표준공제 [2014귀속]*/
          IF v_YEA_STANTAX_YN = 1 THEN
            /*귀속년도2014년 연말정산 재정산(소급)*/
          	r_YEA_YEPROC.YEA_PRC_NUM076 := 130000;
          ELSE
            r_YEA_YEPROC.YEA_PRC_NUM076 := 0;
          END IF;
   
          /*특별소득공제 계*/
          r_YEA_YEPROC.YEA_PRC_NUM029 := NVL(r_YEA_YEPROC.YEA_PRC_NUM019 , 0) /*건강보험료*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM020, 0) /*고용보험료*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM021, 0) /*주택임차차입금상환(대출기관)*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM022, 0) /*주택임차차입금상환(거주자)*/
                                + NVL(v_YEA_MORT, 0) /*장기주택저당차입금이자상환*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM028, 0); /*기부금(이월분)*/
   
   
   
          /*차감소득금액*/
          r_YEA_YEPROC.YEA_PRC_NUM030 := NVL(r_YEA_YEPROC.YEA_PRC_NUM003, 0) /*근로소득*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM004, 0) /*본인공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM005, 0) /*배우자공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM007, 0) /*부양가족공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM009, 0) /*경로우대추가공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM011, 0) /*장애인추가공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM012, 0) /*부녀자추가공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM013, 0) /*한부모공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM014, 0) /*국민연금보험료공제*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM015, 0) /*기타연금보험료공제(공무원)*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM016, 0) /*기타연금보험료공제(군인)*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM017, 0) /*기타연금보험료공제(교직원)*/
                               - NVL(r_YEA_YEPROC.YEA_PRC_NUM018, 0) /*기타연금보험료공제(우체국)*/
                               - CASE WHEN NVL(r_YEA_YEPROC.YEA_PRC_NUM076, 0) < 130000 THEN NVL(r_YEA_YEPROC.YEA_PRC_NUM029, 0) ELSE 0 END; /*[2014귀속] 표준세액공제 금액이 없으면 특별공제 계를 차감한다 귀속년도2014년 연말정산 재정산(소급)*/
   
          /*차감소득금액*/
          IF r_YEA_YEPROC.YEA_PRC_NUM030<0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM030 := 0;
          END IF;
   
          /*조특법공제(공제금액의 한도는 차감소득)*/
          v_LIMI_AMT := r_YEA_YEPROC.YEA_PRC_NUM030;
   
          /*개인연금저축*/
          r_YEA_YEPROC.YEA_PRC_NUM031 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM022 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0010','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0010','B'), v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM031;
   
          /*20110207 개인연금저축*/
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM031;
          FOR RS_PENS21 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '21'
          ) LOOP
   
              UPDATE YEA_PENSAV
                 SET YEA_PEN_NUM002 = SF_YEA_GET_MIN(TRUNC(RS_PENS21.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0010','A'),0), v_PESA_DEDU)
               WHERE YEA_STD_YY = RS_PENS21.YEA_STD_YY
                 AND YEA_EMP_NO = RS_PENS21.YEA_EMP_NO
                 AND YEA_PENS_SEQ = RS_PENS21.YEA_PENS_SEQ;
   
              v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN(TRUNC(RS_PENS21.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0010','A'),0), v_PESA_DEDU);
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
   
          /*소기업공제부금*/
          r_YEA_YEPROC.YEA_PRC_NUM032 := SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM023, SF_YEA_YETABS(#YEA_STD_YY#,'000040','0020','A'), v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM032;
   
          /*주택마련저축공제액*/
          r_YEA_YEPROC.YEA_PRC_NUM033 := r_YEA_INCDEC.YEA_INC_NUM024 + r_YEA_INCDEC.YEA_INC_NUM081;   /*[2015귀속]_추가 청약저축(2015.01.01이후가입분)*/
          r_YEA_YEPROC.YEA_PRC_NUM034 := r_YEA_INCDEC.YEA_INC_NUM026 + r_YEA_INCDEC.YEA_INC_NUM082;   /*[2015귀속]_추가 주택청약종합저축(2015.01.01이후가입분)*/
          r_YEA_YEPROC.YEA_PRC_NUM035 := r_YEA_INCDEC.YEA_INC_NUM025;
   
          /*주택마련저축*/
          r_YEA_YEPROC.YEA_PRC_NUM033 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM033, v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM033;
   
          /*20110207 청약저축*/
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM033;
          FOR RS_PENS31 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '31'
          ) LOOP
   
              UPDATE YEA_PENSAV
                 SET YEA_PEN_NUM002 = SF_YEA_GET_MIN(TRUNC(RS_PENS31.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU)
               WHERE YEA_STD_YY = RS_PENS31.YEA_STD_YY
                 AND YEA_EMP_NO = RS_PENS31.YEA_EMP_NO
                 AND YEA_PENS_SEQ = RS_PENS31.YEA_PENS_SEQ;
   
              v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN(TRUNC(RS_PENS31.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU);
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*20110207 청약저축*/
   
   
          r_YEA_YEPROC.YEA_PRC_NUM034 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM034, v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM034;
   
          /*20110207 주택청약종합저축*/
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM034;
          FOR RS_PENS32 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '32'
          ) LOOP
   
              UPDATE YEA_PENSAV
                 SET YEA_PEN_NUM002 = SF_YEA_GET_MIN(TRUNC(RS_PENS32.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU)
               WHERE YEA_STD_YY = RS_PENS32.YEA_STD_YY
                 AND YEA_EMP_NO = RS_PENS32.YEA_EMP_NO
                 AND YEA_PENS_SEQ = RS_PENS32.YEA_PENS_SEQ;
   
              v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN(TRUNC(RS_PENS32.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU);
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*20110207 주택청약종합저축*/
   
          r_YEA_YEPROC.YEA_PRC_NUM035 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM035, v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM035;
   
          /*20110207 근로자주택마련저축*/
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM035;
          FOR RS_PENS34 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '34'
          ) LOOP
   
              UPDATE YEA_PENSAV
                 SET YEA_PEN_NUM002 = SF_YEA_GET_MIN(TRUNC(RS_PENS34.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU)
               WHERE YEA_STD_YY = RS_PENS34.YEA_STD_YY
                 AND YEA_EMP_NO = RS_PENS34.YEA_EMP_NO
                 AND YEA_PENS_SEQ = RS_PENS34.YEA_PENS_SEQ;
   
              v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN(TRUNC(RS_PENS34.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0030','A'),0), v_PESA_DEDU);
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*20110207 근로자주택마련저축*/
   
   
          r_YEA_INCDEC.YEA_INC_NUM029 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM029 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','A'),0);   /*2013년(10%)*/
          r_YEA_INCDEC.YEA_INC_NUM030 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM030 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','B'),0);   /*2013년(30%)*/
          r_YEA_INCDEC.YEA_INC_NUM031 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM031 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','A'),0);   /*2014년이후(10%)*/
          r_YEA_INCDEC.YEA_INC_NUM032 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM032 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','B'),0);   /*2014년이후(50%)*/
          r_YEA_INCDEC.YEA_INC_NUM033 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM033 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','C'),0);   /*2014년이후(30%)*/
          /*[2015귀속]_추가 2015년이후출자투자분*/
          r_YEA_INCDEC.YEA_INC_NUM027 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM027 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','A'),0);   /*2015년 출자 · 투자분(10% 해당분)*/
          r_YEA_INCDEC.YEA_INC_NUM028 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM028 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','B'),0);   /*2015년 출자 · 투자분(100% 해당분)*/
          r_YEA_INCDEC.YEA_INC_NUM083 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM083 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','C'),0);   /*2015년 출자 · 투자분(10% 해당분)*/
          r_YEA_INCDEC.YEA_INC_NUM084 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM084 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','D'),0);   /*2015년 출자 · 투자분(100% 해당분)*/
         /*[2015귀속]_추가 2015년이후출자투자분끝*/
   
   
   
          r_YEA_YEPROC.YEA_PRC_NUM036 := 0;
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM029, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0)); /*2013년(10%)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM030, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0)); /*2013년(30%)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM031, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0)); /*2014년이후(10%)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM032, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0)); /*2014년이후(50%)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM033, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0)); /*2014년이후(30%)*/
          /*[2015귀속]_추가 2015년이후출자투자분*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM027, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)); /*2015년 출자 · 투자분(10% 해당분)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM028, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)); /*2015년 출자 · 투자분(100% 해당분)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM083, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)); /*2015년 출자 · 투자분(50% 해당분)*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := r_YEA_YEPROC.YEA_PRC_NUM036 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM084, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)); /*2015년 출자 · 투자분(30% 해당분)*/
          /*[2015귀속]_추가 2015년이후출자투자분끝*/
          r_YEA_YEPROC.YEA_PRC_NUM036 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM036, v_LIMI_AMT); /*2012.12.26 추가*/
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM036;
   
          /*신용카드등 소득공제*/
          /*최저사용금액*/
          v_CRCA_AMOT1 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0080','A'),0);
   
   		  /*공제제외금액*/	
          v_CRCA_AMOT2 := CASE WHEN v_CRCA_AMOT1 <= r_YEA_INCDEC.YEA_INC_NUM034 THEN
                              TRUNC(v_CRCA_AMOT1 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0080','B'),0)
                          ELSE
                              (TRUNC(r_YEA_INCDEC.YEA_INC_NUM034 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0080','B'),0))
                              + TRUNC((v_CRCA_AMOT1 - r_YEA_INCDEC.YEA_INC_NUM034) * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0100','B'),0)  /*전통시장 공제비율*/
                          END;
   
          /*체크카드 등 사용액 증가분*/
          IF v_CRCA_AMOT1 < NVL(r_YEA_INCDEC.YEA_INC_NUM034,0) + NVL(r_YEA_INCDEC.YEA_INC_NUM035,0)
             + NVL(r_YEA_INCDEC.YEA_INC_NUM036,0) + NVL(r_YEA_INCDEC.YEA_INC_NUM037,0) + NVL(r_YEA_INCDEC.YEA_INC_NUM038,0) THEN

            /*[2015귀속]_변경 15년상반기사용분*/
          	IF r_YEA_INCDEC.YEA_INC_NUM040 >  r_YEA_INCDEC.YEA_INC_NUM039 THEN
              v_CRCA_AMOT8 := GREATEST(r_YEA_INCDEC.YEA_INC_NUM042 - (r_YEA_INCDEC.YEA_INC_NUM041 * 0.5),0);
              v_CRCA_AMOT8 := v_CRCA_AMOT8 * 0.1;
          	END IF ;
          	/*[2015귀속]_추가 15년하반기사용분*/
          	IF r_YEA_INCDEC.YEA_INC_NUM085 >  r_YEA_INCDEC.YEA_INC_NUM040 THEN
              v_CRCA_AMOT9 := GREATEST(r_YEA_INCDEC.YEA_INC_NUM087 - (r_YEA_INCDEC.YEA_INC_NUM086 * 0.5),0);
              v_CRCA_AMOT9 := v_CRCA_AMOT9 * 0.2;
          	END IF;
  
          END IF;
   
   
          v_CRCA_AMOT3 := TRUNC(r_YEA_INCDEC.YEA_INC_NUM034 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0080','B'), 0)  /*신용카드*/
                        + TRUNC(r_YEA_INCDEC.YEA_INC_NUM036 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0090','B')      /*현금영수증*/
                          + r_YEA_INCDEC.YEA_INC_NUM035  * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0090','B')    /*직불카드*/
                          + r_YEA_INCDEC.YEA_INC_NUM037 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0100','B')     /*전통시장*/
                          + r_YEA_INCDEC.YEA_INC_NUM038 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0110','B')     /*대중교통*/
                          + NVL(v_CRCA_AMOT8,0) + Nvl(v_CRCA_AMOT9,0) /*[2015귀속]_추가 15년하반기사용분*/
                        , 0)
                        - v_CRCA_AMOT2;
   
   
          /*공제한도*/
          v_CRCA_AMOT4 := SF_YEA_GET_MIN(TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0070','B'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0070','A'));
   
          /*일반공제금액*/
          v_CRCA_AMOT5 := SF_YEA_GET_MIN(v_CRCA_AMOT3, v_CRCA_AMOT4);
   
          /*추가공제금액(전통시장, 대중교통이용분)*/
          v_CRCA_AMOT6 := SF_YEA_GET_MIN(v_CRCA_AMOT3 - v_CRCA_AMOT4, TRUNC(r_YEA_INCDEC.YEA_INC_NUM037 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0100','B'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0070','C'));
          v_CRCA_AMOT7 := LEAST(GREATEST(v_CRCA_AMOT3 - v_CRCA_AMOT4 - v_CRCA_AMOT6, 0), r_YEA_INCDEC.YEA_INC_NUM038 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0110','B'), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0070','D'));
   
          r_YEA_YEPROC.YEA_PRC_NUM037 := SF_YEA_GET_MIN(v_CRCA_AMOT5 + (v_CRCA_AMOT6 + v_CRCA_AMOT7), v_LIMI_AMT);
   
   
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM037;
          /*신용카드등 소득공제*/
   
          /*우리사주조합*/
          r_YEA_YEPROC.YEA_PRC_NUM038 := SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM043, SF_YEA_YETABS(#YEA_STD_YY#,'000040','0120','A'), v_LIMI_AMT);
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM038;
   			
   		  /*  [2015귀속]_세액공제항목으로 이동 */	
          /*우리사주조합기부금*/
          /*고용유지중소기업근로자소득공제*/
          r_YEA_YEPROC.YEA_PRC_NUM040 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM045 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0140','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0140','B'), v_LIMI_AMT);
   
          /*목돈 안드는 전세 이자상환액 공제*/
          r_YEA_YEPROC.YEA_PRC_NUM041 := GREATEST(LEAST(TRUNC(r_YEA_INCDEC.YEA_INC_NUM046 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0150','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0150','B'), v_LIMI_AMT), 0);
   		  v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM041;
   		  
   		  /*장기집합투자증권저축*/          
          /*[2015귀속]_장기집합투자증권저축 공제요건추가*/
          IF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','C') THEN
            r_YEA_YEPROC.YEA_PRC_NUM042 := GREATEST(LEAST(TRUNC(r_YEA_INCDEC.YEA_INC_NUM047 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','D'), v_LIMI_AMT), 0);
          ELSE
          	r_YEA_YEPROC.YEA_PRC_NUM042 := GREATEST(LEAST(TRUNC(r_YEA_INCDEC.YEA_INC_NUM047 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','A'),0), SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','B'), v_LIMI_AMT), 0);
          END IF;
          v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM042;
   
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM042;
   
          FOR RS_PENS51 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '51'
          ) LOOP
   
              UPDATE YEA_PENSAV
                 SET YEA_PEN_NUM002 = SF_YEA_GET_MIN(TRUNC(RS_PENS51.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','A'),0), v_PESA_DEDU)
               WHERE YEA_STD_YY = RS_PENS51.YEA_STD_YY
                 AND YEA_EMP_NO = RS_PENS51.YEA_EMP_NO
                 AND YEA_PENS_SEQ = RS_PENS51.YEA_PENS_SEQ;
   
              v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN(TRUNC(RS_PENS51.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0160','A'),0), v_PESA_DEDU);
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*장기집합투자증권저축*/
   		  
   		  /*[2015귀속]_연금보험료 후공제 시작*/
   		  /*국민연금보험료공제*/
          r_YEA_YEPROC.YEA_PRC_NUM014 := r_YEA_INCDEC.YEA_INC_NUM001 + r_YEA_INCDEC.YEA_INC_NUM002;
   
          r_YEA_YEPROC.YEA_PRC_NUM014 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM014,v_LIMI_AMT),0);
          v_LIMI_AMT := v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM014;
   
   
          /*기타연금보험료공제*/
          r_YEA_YEPROC.YEA_PRC_NUM015 := r_YEA_INCDEC.YEA_INC_NUM003 + r_YEA_INCDEC.YEA_INC_NUM004;   /*공무원연금*/
   
          r_YEA_YEPROC.YEA_PRC_NUM015 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM015,v_LIMI_AMT),0);
          v_LIMI_AMT := v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM015;
   
          r_YEA_YEPROC.YEA_PRC_NUM016 := r_YEA_INCDEC.YEA_INC_NUM005 + r_YEA_INCDEC.YEA_INC_NUM006;   /*군인연금*/
   
          r_YEA_YEPROC.YEA_PRC_NUM016 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM016,v_LIMI_AMT),0);
          v_LIMI_AMT := v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM016;
   
          r_YEA_YEPROC.YEA_PRC_NUM017 := r_YEA_INCDEC.YEA_INC_NUM007 + r_YEA_INCDEC.YEA_INC_NUM008;   /*교직원연금*/
   
          r_YEA_YEPROC.YEA_PRC_NUM017 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM017,v_LIMI_AMT),0);
          v_LIMI_AMT := v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM017;
   
          r_YEA_YEPROC.YEA_PRC_NUM018 := r_YEA_INCDEC.YEA_INC_NUM009 + r_YEA_INCDEC.YEA_INC_NUM010;   /*별정우체국연금*/
   
          r_YEA_YEPROC.YEA_PRC_NUM018 := GREATEST(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM018,v_LIMI_AMT),0);
          v_LIMI_AMT := v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM018;
          
          /*차감소득금액*/
          r_YEA_YEPROC.YEA_PRC_NUM030 := NVL(r_YEA_YEPROC.YEA_PRC_NUM030, 0) /*차감소득금액*/                               
                             - NVL(r_YEA_YEPROC.YEA_PRC_NUM014, 0) /*국민연금보험료공제*/
                             - NVL(r_YEA_YEPROC.YEA_PRC_NUM015, 0) /*기타연금보험료공제(공무원)*/
                             - NVL(r_YEA_YEPROC.YEA_PRC_NUM016, 0) /*기타연금보험료공제(군인)*/
                             - NVL(r_YEA_YEPROC.YEA_PRC_NUM017, 0) /*기타연금보험료공제(교직원)*/
                             - NVL(r_YEA_YEPROC.YEA_PRC_NUM018, 0) /*기타연금보험료공제(우체국)*/  
                             ;        
          /*[2015귀속]_연금보험료 후공제 시작끝*/
          
          /*그 밖의 소득공제 계*/
          r_YEA_YEPROC.YEA_PRC_NUM043 :=  NVL(r_YEA_YEPROC.YEA_PRC_NUM031, 0) /*개인연금저축*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM032, 0)        /*소기업공제부금*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM033, 0)        /*청약저축*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM034, 0)        /*주택청약종합저*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM035, 0)        /*근로자주택마련저축*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM036, 0)        /*투자조합출자*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM037, 0)        /*신용카드*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM038, 0)        /*우리사주조합*/
                                 /*+ NVL(r_YEA_YEPROC.YEA_PRC_NUM039, 0)      우리사주조합기부금[2015귀속]우리사주조합기부금 세액공제로 이동 */
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM040, 0)        /*고용유지중소기업근로*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM041, 0)        /*목돈안드는전세이자상환액*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM042, 0)        /*장기집합투자증권저축*/
                                 ;
   
          /*소득공제종합한도초과액*/
          r_YEA_YEPROC.YEA_PRC_NUM044 := NVL(r_YEA_YEPROC.YEA_PRC_NUM061, 0) /*보험료_보장성보험*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM021, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM022, 0)  /*주택임차차입금원리금상환액*/
                                 + NVL(v_YEA_MORT, 0) /*장기주택저당차입금 이자상환액*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM032, 0) /*소기업공제부금소득공제*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM033, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM034, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM035, 0) /*주택마련저축*/
                                 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM029, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0)) /*2013년(10%)*/
                                 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM030, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0)) /*2013년(30%)*/
                                 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM031, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0)) /*2014년이후(10%)*/
                                 + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM027, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','A'),0)) /*[2015귀속]_추가 2015년이후(10%)*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM037, 0) /*신용카드 등 소득공제*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM038, 0) /*우리사주조합소득공제*/
                                 + NVL(r_YEA_YEPROC.YEA_PRC_NUM042, 0) /*장기집합투자증권저축*/
                                 ;
          r_YEA_YEPROC.YEA_PRC_NUM044 := GREATEST(r_YEA_YEPROC.YEA_PRC_NUM044 - SF_YEA_YETABS(#YEA_STD_YY#,'000040','0170','A'), 0);
   
          /*음수 제외, 소득공제종합한도초과액 합산*/
          r_YEA_YEPROC.YEA_PRC_NUM045 := GREATEST(r_YEA_YEPROC.YEA_PRC_NUM030 - r_YEA_YEPROC.YEA_PRC_NUM043 + r_YEA_YEPROC.YEA_PRC_NUM044, 0);
   
          /*산출세액*/
          r_YEA_YEPROC.YEA_PRC_NUM046 := CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM045 = 0 THEN 0
                              WHEN r_YEA_YEPROC.YEA_PRC_NUM045 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM045 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0010','A') THEN TRUNC(r_YEA_YEPROC.YEA_PRC_NUM045 * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0010','B'),0)
                              WHEN r_YEA_YEPROC.YEA_PRC_NUM045 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','A') AND r_YEA_YEPROC.YEA_PRC_NUM045 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','B') THEN TRUNC((r_YEA_YEPROC.YEA_PRC_NUM045 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','C'),0)
                              WHEN r_YEA_YEPROC.YEA_PRC_NUM045 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','A') AND r_YEA_YEPROC.YEA_PRC_NUM045 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','B') THEN TRUNC((r_YEA_YEPROC.YEA_PRC_NUM045 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','C'),0)
                              WHEN r_YEA_YEPROC.YEA_PRC_NUM045 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','A') AND r_YEA_YEPROC.YEA_PRC_NUM045 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','B') THEN TRUNC((r_YEA_YEPROC.YEA_PRC_NUM045 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','C'),0)
                              WHEN r_YEA_YEPROC.YEA_PRC_NUM045 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','A') THEN TRUNC((r_YEA_YEPROC.YEA_PRC_NUM045 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','C') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','B'),0)
                        END;
   
   
          v_LIMI_AMT := r_YEA_YEPROC.YEA_PRC_NUM046;
   
          /*세액감면 추가해야함..*/
   
          /*세액감면_소득세법*/
          r_YEA_YEPROC.YEA_PRC_NUM047 := 0;
          /*RAISE_APPLICATION_ERROR(-20000,v_EXTX_AMOT);*/
   
          /*세액감면_조세특례제한법*/
          r_YEA_YEPROC.YEA_PRC_NUM048 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046 * (v_EXTX_AMOT/r_YEA_YEPROC.YEA_PRC_NUM001),0);
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM048 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM048 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM048;
          END IF;
   
          /*전근무지가 중소기업인 경우*/
          /*액감면_조세특례제한법 제30조 : 세액감면금액 = 산출세액 * (감면금액/총급여)*/
          /*[2014귀속]감면기간 2014년1월1일 이후 는 50% 적용*/
          v_EX30_RATE := 0;
	      FOR RS_EX30 IN (
	          SELECT A.YEA_BFW_STR005
	                ,B.YEA_BFN_NUM001
	            FROM YEA_BFWORK A
	      INNER JOIN YEA_BFNTAX B
	              ON A.YEA_STD_YY = B.YEA_STD_YY
	             AND A.YEA_EMP_NO = B.YEA_EMP_NO
	             AND A.YEA_BIZ_NO = B.YEA_BIZ_NO
	           WHERE A.YEA_STD_YY = #YEA_STD_YY#
	             AND A.YEA_EMP_NO = #YEA_EMP_NO#
	             AND B.YEA_NON_TAX_CD = 'T10'
	      ) LOOP
	            /*20160511 중소기업취업감면(종근무지) 로직 수정 2012년이후는 100%, 2014년이후는 50%, 2016년 이후는 70%*/
	            IF substr(RS_EX30.YEA_BFW_STR005,1,4) <= 2013 THEN
	              v_EX30_RATE := v_EX30_RATE + (RS_EX30.YEA_BFN_NUM001/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','A');
	            ELSIF substr(RS_EX30.YEA_BFW_STR005,1,4) <= 2015 THEN
	              v_EX30_RATE := v_EX30_RATE + (RS_EX30.YEA_BFN_NUM001/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','B');
	            ELSE
	              v_EX30_RATE := v_EX30_RATE + (RS_EX30.YEA_BFN_NUM001/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','C');
	            END IF;
				/*20160511 중소기업취업감면(종근무지) 로직 수정 2012년이후는 100%, 2014년이후는 50%, 2016년 이후는 70%*/
	      END LOOP;	            
		  
		  /*20160511 중소기업취업감면(현근무지) 로직 수정 2012년이후는 100%, 2014년이후는 50%, 2016년 이후는 70%*/  
		  SELECT TARN_STDT, TARN_ENDT
            INTO v_TARN_STDT, v_TARN_ENDT
            FROM PY_MASTPM
           WHERE EMPL_NUMB = #YEA_EMP_NO#;
          
          IF length(v_TARN_STDT) = 8 AND Length(v_TARN_ENDT) = 8 THEN   
		      IF SubStr(v_TARN_STDT,1,4) <= 2013 THEN
		        v_EX30_RATE := v_EX30_RATE +  (v_EX30_AMOT/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','A');
		      ELSIF SubStr(v_TARN_STDT,1,4) <= 2015 THEN		      
		        v_EX30_RATE := v_EX30_RATE +  (v_EX30_AMOT/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','B');
		      ELSE
		      	v_EX30_RATE := v_EX30_RATE +  (v_EX30_AMOT/r_YEA_YEPROC.YEA_PRC_NUM001) * SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','C');		      	
		      END IF;
		  END IF;
		  
		  /*20160511 중소기업취업감면(현근무지) 로직 수정 2012년이후는 100%, 2014년이후는 50%, 2016년 이후는 70%*/
	      
	      /*20160511 중소기업취업감면 계산로직변경 MIN(산출세액*(중소기업감면대상금액/총급여)*감면비율,중소기업취업감면한도)*/
	      r_YEA_YEPROC.YEA_PRC_NUM049 := SF_YEA_GET_MIN(TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046 * v_EX30_RATE,0),SF_YEA_YETABS(#YEA_STD_YY#,'000050','0010','D'));

          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM049 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM049 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM049;
          END IF;
   
          /*조세조약세액감면*/
          r_YEA_YEPROC.YEA_PRC_NUM050 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046 * (v_TTTR_AMOT/r_YEA_YEPROC.YEA_PRC_NUM001),0);
          /*2012.12.26 추가 종료*/
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM050 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM050 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM050;
          END IF;
   
          /*세액감면계*/
          r_YEA_YEPROC.YEA_PRC_NUM051 := r_YEA_YEPROC.YEA_PRC_NUM047 + r_YEA_YEPROC.YEA_PRC_NUM048 + r_YEA_YEPROC.YEA_PRC_NUM049 + r_YEA_YEPROC.YEA_PRC_NUM050; /*2012.12.26 변경*/
   
          IF v_LIMI_AMT < 0 THEN
            v_LIMI_AMT := 0;
          END IF;
          /*세액감면*/
   
          /*근로소득 2014년부터 근로소득세액공제 한도 총급여비율로 적용*/
          IF r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0010','A') THEN
            v_TAXD_TAX1 := SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0010','B');
   
          ELSIF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','A') AND r_YEA_YEPROC.YEA_PRC_NUM001 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','B') THEN
            /*귀속년도2014년 연말정산 재정산(소급)*/
            v_TAXD_TAX1 := GREATEST(SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','C') - ((r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','D')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','E')), SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0020','F'));
   
          ELSIF r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0030','A') THEN
            v_TAXD_TAX1 := GREATEST(SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0030','B') - ((r_YEA_YEPROC.YEA_PRC_NUM001 - SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0030','C')) / 2), SF_YEA_TAXBAS(#YEA_STD_YY#,'000070','0030','D'));
   
          END IF;
   
          r_YEA_YEPROC.YEA_PRC_NUM052 := SF_YEA_GET_MIN(TRUNC(CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM046 <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000060','0010','A') 
          													       THEN SF_YEA_GET_MIN(TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046 * SF_YEA_TAXBAS(#YEA_STD_YY#,'000060','0010','B'),0), v_TAXD_TAX1) /*2012.12.26 변경*/
                                                                   ELSE SF_YEA_GET_MIN(SF_YEA_TAXBAS(#YEA_STD_YY#,'000060','0020','B') +  (TRUNC((r_YEA_YEPROC.YEA_PRC_NUM046 -  SF_YEA_TAXBAS(#YEA_STD_YY#,'000060','0020','A')) *  SF_YEA_TAXBAS(#YEA_STD_YY#,'000060','0020','C'),0)), v_TAXD_TAX1) END
                                  * (1 - v_EX30_RATE ),0)  /*[2014귀속]*/                                  
                                  ,  v_LIMI_AMT);
   
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM052 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM052 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM052;
          END IF;
          /*근로소득*/
   
          r_YEA_YEPROC.YEA_PRC_NUM053 := r_YEA_INCDEC.YEA_INC_NUM048;
   
          IF r_YEA_YEPROC.YEA_PRC_NUM053 >= 3 THEN
            r_YEA_YEPROC.YEA_PRC_NUM054 := 2 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0010','A') + (r_YEA_YEPROC.YEA_PRC_NUM053 - 2) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0010','B'); /*20160511 세액감면 추가로 000050->000060으로변경*/
          ELSE
            r_YEA_YEPROC.YEA_PRC_NUM054 := r_YEA_YEPROC.YEA_PRC_NUM053 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0010','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/
          END IF;
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM054 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM054 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM054;
          END IF;
          /*자녀*/
          
          IF r_YEA_YEPROC.YEA_PRC_NUM098 >  SF_YEA_YETABS(#YEA_STD_YY#,'000060','0013','A') THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
            r_YEA_YEPROC.YEA_PRC_NUM099 := SF_YEA_YETABS(#YEA_STD_YY#,'000060','0013','B') * (r_YEA_YEPROC.YEA_PRC_NUM098 - SF_YEA_YETABS(#YEA_STD_YY#,'000060','0013','A'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
          ELSE
            r_YEA_YEPROC.YEA_PRC_NUM099 := 0;
          END IF;

          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM099 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM099 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM099;
          END IF;
          /*6세이하*/

          r_YEA_YEPROC.YEA_PRC_NUM101 := r_YEA_YEPROC.YEA_PRC_NUM100 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0016','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/

          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM101 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM101 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM101;
          END IF;
          /*출생입양*/ 
             		  
   		  /*귀속년도2014년 연말정산 재정산(소급) 보장성보험 100만원 한도*/
          r_YEA_YEPROC.YEA_PRC_NUM061 := SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM052, SF_YEA_YETABS(#YEA_STD_YY#,'000060','0030','B'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
   
   
          r_YEA_YEPROC.YEA_PRC_NUM062 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM061 * SF_YEA_YETABS(#YEA_STD_YY#,'000060', '0030', 'A'), 0);	/*20160511 세액감면 추가로 000050->000060으로변경*/
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM062 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM062 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM062;
          END IF;
          /*보장성보험 100만원 한도*/
          
          /*귀속년도2014년 연말정산 재정산(소급) 장애인보장성보험 100만원 한도*/
          r_YEA_YEPROC.YEA_PRC_NUM102 := SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM053, SF_YEA_YETABS(#YEA_STD_YY#,'000060','0030','B'));	/*20160511 세액감면 추가로 000050->000060으로변경*/


          r_YEA_YEPROC.YEA_PRC_NUM103 := Trunc(r_YEA_YEPROC.YEA_PRC_NUM102 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0030','C'),0);	/*20160511 세액감면 추가로 000050->000060으로변경*/

          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM103 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM103 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM103;
          END IF;
          /*장애인보장성보험 100만원 한도*/
   
          /*의료비*/
          /*의료비: 그밖의 의료비가 총급여액 * 의료비공제율 보다 작으면*/
          IF r_YEA_INCDEC.YEA_INC_NUM055 < TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C'),0) THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
            r_YEA_INCDEC.YEA_INC_NUM054 := r_YEA_INCDEC.YEA_INC_NUM054 - (TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C'),0) - r_YEA_INCDEC.YEA_INC_NUM055);	/*20160511 세액감면 추가로 000050->000060으로변경*/
            r_YEA_INCDEC.YEA_INC_NUM055 := 0;
          ELSE
            r_YEA_INCDEC.YEA_INC_NUM054 := r_YEA_INCDEC.YEA_INC_NUM054;
            r_YEA_INCDEC.YEA_INC_NUM055 := LEAST(r_YEA_INCDEC.YEA_INC_NUM055 - (TRUNC(r_YEA_YEPROC.YEA_PRC_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C'),0)), SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','B'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
          END IF;
   
          r_YEA_YEPROC.YEA_PRC_NUM063 := GREATEST(r_YEA_INCDEC.YEA_INC_NUM054 + r_YEA_INCDEC.YEA_INC_NUM055,0);
          r_YEA_YEPROC.YEA_PRC_NUM064 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM063 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','A'),0);	/*20160511 세액감면 추가로 000050->000060으로변경*/
   
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM064 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM064 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM064;
          END IF;
          /*의료비*/
   
          /*교육비*/
          r_YEA_YEPROC.YEA_PRC_NUM065 := r_YEA_INCDEC.YEA_INC_NUM056 + r_YEA_INCDEC.YEA_INC_NUM058 + r_YEA_INCDEC.YEA_INC_NUM060 + r_YEA_INCDEC.YEA_INC_NUM062+ r_YEA_INCDEC.YEA_INC_NUM064;
          r_YEA_YEPROC.YEA_PRC_NUM066 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM065 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0050','A'),0);	/*20160511 세액감면 추가로 000050->000060으로변경*/
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM066 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM066 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM066;
          END IF;
          /*교육비*/
   		  
   		  /******************************** 기부금은 이월가능하므로 먼저 계산한다!  ********************************/
   		  /*납세조합세액공제*/
          r_YEA_YEPROC.YEA_PRC_NUM077 := 0;
   
          /*주택차입금세액공제*/
          r_YEA_YEPROC.YEA_PRC_NUM078 := SF_YEA_GET_MIN(TRUNC(r_YEA_INCDEC.YEA_INC_NUM073 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0080','A'),0), v_LIMI_AMT);	/*20160511 세액감면 추가로 000050->000060으로변경*/
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM078 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM078 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM078;
          END IF;
          /*주택차입금세액공제*/
   
          /*외국납부세액공제*/
          IF r_YEA_YEPROC.YEA_PRC_NUM001 = 0 THEN
              r_YEA_YEPROC.YEA_PRC_NUM079 := 0;
          ELSE
              r_YEA_YEPROC.YEA_PRC_NUM079 := SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM072, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM046 * (r_YEA_INCDEC.YEA_INC_NUM070/r_YEA_YEPROC.YEA_PRC_NUM001),0),v_LIMI_AMT);
          END IF;
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM079 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM079 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM079;
          END IF;
          /*외국납부세액공제*/
   
          /*월세액공제*/
          IF v_YEA_STANTAX_YN = 1 THEN
            r_YEA_YEPROC.YEA_PRC_NUM080 := 0;
          ELSE
            r_YEA_YEPROC.YEA_PRC_NUM080 := SF_YEA_GET_MIN(NVL(r_YEA_INCDEC.YEA_INC_NUM074,0),SF_YEA_YETABS(#YEA_STD_YY#,'000060','0090','B'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
          END IF;
   
          r_YEA_YEPROC.YEA_PRC_NUM081 := TRUNC(SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM080 ,SF_YEA_YETABS(#YEA_STD_YY#,'000060','0090','B')) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0090','A'),0);	/*20160511 세액감면 추가로 000050->000060으로변경*/
   
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM081 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM081 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM081;
          END IF;
          /*[공제금액*/
          v_RTER_LIMT := r_YEA_YEPROC.YEA_PRC_NUM081;
   
   
          FOR RS IN (
                SELECT YEA_STD_YY   /*기준년월*/
                      ,YEA_EMP_NO   /*사원번호*/
                      ,YEA_RENT_SEQ1   /*월세주택임차차입금1_순번*/
                      ,YEA_RT1_NUM001  /*월세액*/
                  FROM YEA_RENTA1
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              ORDER BY YEA_RT1_NUM001
          ) LOOP
              IF v_RTER_LIMT > 0 THEN
   
                UPDATE YEA_RENTA1
                   SET YEA_RT1_NUM002 = SF_YEA_GET_MIN(TRUNC(RS.YEA_RT1_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0090','A'), 0),v_RTER_LIMT)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
                   AND YEA_RT1_NUM001 = RS.YEA_RT1_NUM001;
   
              END IF;
              v_RTER_LIMT := v_RTER_LIMT - SF_YEA_GET_MIN(TRUNC(RS.YEA_RT1_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0090','A'), 0),v_RTER_LIMT);	/*20160511 세액감면 추가로 000050->000060으로변경*/
          END LOOP;
          /*월세액공제*/ 
   		  /******************************** 기부금은 이월가능하므로 먼저 계산한다!  ********************************/ 
   		  
   		  /*기부금*/
          /*정치자금세액공제 10만원 이하*/
          r_YEA_YEPROC.YEA_PRC_NUM067 := r_YEA_INCDEC.YEA_INC_NUM065;
          r_YEA_YEPROC.YEA_PRC_NUM068 := SF_YEA_GET_MIN(TRUNC(r_YEA_YEPROC.YEA_PRC_NUM067 * 100 / 110,0), v_LIMI_AMT);
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM068 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM068 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM068;
          END IF;
          /*정치자금세액공제 10만원 이하*/
   
          /*정치자금세액공제 10만원 초과*/
          IF NVL(r_YEA_YEPROC.YEA_PRC_NUM069,0) <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A') THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
            v_DONA_RATE := SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/
            v_DONA_DEDU := TRUNC(NVL(r_YEA_YEPROC.YEA_PRC_NUM069,0) * v_DONA_RATE,0);
            /*-r_YEA_YEPROC.YEA_PRC_NUM070 := TRUNC(NVL(r_YEA_YEPROC.YEA_PRC_NUM069,0) * v_DONA_RATE,0);*/
          ELSE
            v_DONA_DEDU :=
                (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','A'))	/*20160511 세액감면 추가로 000050->000060으로변경*/
                + (NVL(r_YEA_YEPROC.YEA_PRC_NUM069,0) - SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A')) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','B');	/*20160511 세액감면 추가로 000050->000060으로변경*/
          END IF;
   
          r_YEA_YEPROC.YEA_PRC_NUM070 := v_DONA_DEDU;
   
          /*정치자금 세액공제 초과시 이월금액 변경*/
          IF v_DONA_DEDU > v_LIMI_AMT THEN
   
            /*1. 공제대상금액 역산해서 차감액 구하기*/
            /* 1) 450만원 이상은 3,000만원 이상이라는 뜻...*/
            IF v_LIMI_AMT > (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','A')) THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
              v_DONA_DEDU :=
                (
                  (v_LIMI_AMT - (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','A')))	/*20160511 세액감면 추가로 000050->000060으로변경*/
                  / SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','B')		/*20160511 세액감면 추가로 000050->000060으로변경*/
                ) + SF_YEA_YETABS(#YEA_STD_YY#,'000060','0061','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/	
   
            /* 2) 450만원 이하는 3,000만원 미만이라는 뜻...*/
            ELSE
              v_DONA_DEDU := v_LIMI_AMT / SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/
   
            END IF;
   
            v_DONA_DEDU := (r_YEA_YEPROC.YEA_PRC_NUM069) - v_DONA_DEDU;  /*공제대상금액 차감분*/
            v_LIMI_AMT := (r_YEA_YEPROC.YEA_PRC_NUM070) - v_LIMI_AMT;  /*공제금액 차감분*/
   
            /*2. 연말정산처리 공제금액 보정...*/
            IF r_YEA_YEPROC.YEA_PRC_NUM069 > v_DONA_DEDU THEN
              r_YEA_YEPROC.YEA_PRC_NUM069 := r_YEA_YEPROC.YEA_PRC_NUM069 - v_DONA_DEDU;
              r_YEA_YEPROC.YEA_PRC_NUM070 := r_YEA_YEPROC.YEA_PRC_NUM070 - v_LIMI_AMT;
   
            ELSE
              r_YEA_YEPROC.YEA_PRC_NUM069 := 0;
              r_YEA_YEPROC.YEA_PRC_NUM070 := 0;
   
            END IF;
   
   
            /*3. 공제대상금액 보정... (명세서) :  역순으로 불러와서 차례대로 차감해주면 된다*/
            FOR RS IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_DOA_STR002     /*기부년도*/
                    ,YEA_DOA_NUM003     /*기부금공제대상액*/
                    ,YEA_DOA_NUM004     /*기부금공제액*/
                    ,YEA_DOA_NUM006     /*기부금이월액*/
                    ,YEA_DONA_SEQ
                FROM YEA_DONAAD
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_DOA_STR002 = #YEA_STD_YY#
                 AND YEA_DOA_STR001 IN ('20')
            ORDER BY YEA_DOA_STR001 DESC
                   , YEA_DONA_SEQ DESC

          ) LOOP

              /*기부금공제액*/
              IF v_DONA_DEDU > 0 THEN

                IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                  v_DONA_DEDU := v_DONA_DEDU - RS.YEA_DOA_NUM004;
                  RS.YEA_DOA_NUM004 := 0;

                ELSE
                  RS.YEA_DOA_NUM004 := RS.YEA_DOA_NUM004 - v_DONA_DEDU;
                  v_DONA_DEDU := 0;

                END IF;

                UPDATE YEA_DONAAD
                   SET YEA_DOA_NUM004 = NVL(RS.YEA_DOA_NUM004, 0)
                     , YEA_DOA_NUM005 = NVL(RS.YEA_DOA_NUM003, 0) - NVL(RS.YEA_DOA_NUM004, 0)
                     , YEA_DOA_NUM006 = 0
                WHERE YEA_STD_YY = RS.YEA_STD_YY
                  AND YEA_EMP_NO = RS.YEA_EMP_NO
                  AND YEA_DONA_SEQ = RS.YEA_DONA_SEQ;

              END IF;

          END LOOP;
   
            v_LIMI_AMT := 0;
   
          ELSE
            v_LIMI_AMT := v_LIMI_AMT - NVL(r_YEA_YEPROC.YEA_PRC_NUM070, 0);
   
          END IF;
   
          /*정치자금세액공제 10만원 초과*/
          
                           
          /*기부금공제대상액 당해분만 써야하므로 이월분 빼자!*/
          r_YEA_YEPROC.YEA_PRC_NUM071 := NVL(r_YEA_YEPROC.YEA_PRC_NUM071, 0) - NVL(v_YEA_PRC_NUM071_CARRY, 0);          
          r_YEA_YEPROC.YEA_PRC_NUM073 := NVL(r_YEA_YEPROC.YEA_PRC_NUM073, 0) - NVL(v_YEA_PRC_NUM073_CARRY, 0);         
          
          /*법정기부금, 지정기부금 안분 계산*/   
          IF NVL(r_YEA_YEPROC.YEA_PRC_NUM071, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM039, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM073, 0) <= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A') THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
            v_DONA_RATE := SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/
            r_YEA_YEPROC.YEA_PRC_NUM072 := ROUND(NVL(r_YEA_YEPROC.YEA_PRC_NUM071,0) * v_DONA_RATE);
            r_YEA_YEPROC.YEA_PRC_NUM108 := ROUND(NVL(r_YEA_YEPROC.YEA_PRC_NUM039,0) * v_DONA_RATE);
            r_YEA_YEPROC.YEA_PRC_NUM074 := ROUND(NVL(r_YEA_YEPROC.YEA_PRC_NUM073,0) * v_DONA_RATE);

          ELSE
            v_DONA_DEDU :=
                (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','A'))	/*20160511 세액감면 추가로 000050->000060으로변경*/
                + (NVL(r_YEA_YEPROC.YEA_PRC_NUM071,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM039,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM073,0) - SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A')) * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','B');	/*20160511 세액감면 추가로 000050->000060으로변경*/

            v_DONA_RATE := NVL(r_YEA_YEPROC.YEA_PRC_NUM071,0) / (NVL(r_YEA_YEPROC.YEA_PRC_NUM071,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM039,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM073,0));
            r_YEA_YEPROC.YEA_PRC_NUM072 := ROUND(NVL(v_DONA_DEDU,0) * v_DONA_RATE);

            v_DONA_RATE := NVL(r_YEA_YEPROC.YEA_PRC_NUM039,0) / (NVL(r_YEA_YEPROC.YEA_PRC_NUM071,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM039,0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM073,0));
            r_YEA_YEPROC.YEA_PRC_NUM108 := ROUND(NVL(v_DONA_DEDU,0) * v_DONA_RATE);
            r_YEA_YEPROC.YEA_PRC_NUM074 := NVL(v_DONA_DEDU,0) - NVL(r_YEA_YEPROC.YEA_PRC_NUM072, 0) - NVL(r_YEA_YEPROC.YEA_PRC_NUM108, 0);

          END IF;        
   		  	
          /*[2015귀속]_로직변경 법정기부금,우리사주조합기부금,지정기부금 세액공제 초과시 이월금액 변경*/
          IF NVL(r_YEA_YEPROC.YEA_PRC_NUM072, 0) + Nvl(r_YEA_YEPROC.YEA_PRC_NUM108, 0) + NVL(r_YEA_YEPROC.YEA_PRC_NUM074, 0) > v_LIMI_AMT THEN

            /*1. 공제대상금액 역산해서 차감액 구하기!*/
            /* 1) 450만원 초과는 3,000만원 이상이라는 뜻...*/
            IF v_LIMI_AMT > (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','A')) THEN	/*20160511 세액감면 추가로 000050->000060으로변경*/
              v_DONA_DEDU :=
                (
                  (v_LIMI_AMT - (SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A') * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','A')))	/*20160511 세액감면 추가로 000050->000060으로변경*/
                  / SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','B')		/*20160511 세액감면 추가로 000050->000060으로변경*/	
                ) + SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/

            /* 2) 450만원 이하는 3,000만원 미만이라는 뜻...*/
            ELSE
              v_DONA_DEDU := v_LIMI_AMT / SF_YEA_YETABS(#YEA_STD_YY#,'000060','0070','A');	/*20160511 세액감면 추가로 000050->000060으로변경*/

            END IF;

			/*** 공제 초과분 구함***/
            v_DONA_DEDU := (r_YEA_YEPROC.YEA_PRC_NUM071 + r_YEA_YEPROC.YEA_PRC_NUM039 + r_YEA_YEPROC.YEA_PRC_NUM073) - v_DONA_DEDU;  /*공제대상금액 차감분*/
            v_LIMI_AMT := (r_YEA_YEPROC.YEA_PRC_NUM072 + r_YEA_YEPROC.YEA_PRC_NUM108 + r_YEA_YEPROC.YEA_PRC_NUM074) - v_LIMI_AMT;    /*공제*/

            /*2. 연말정산처리 공제금액 보정...*/
			v_DONA_TAMT := v_DONA_DEDU;
            v_DONA_DAMT := v_LIMI_AMT;
			
            IF r_YEA_YEPROC.YEA_PRC_NUM071 > v_DONA_TAMT THEN
	            r_YEA_YEPROC.YEA_PRC_NUM071 := r_YEA_YEPROC.YEA_PRC_NUM071 - v_DONA_TAMT;
	            r_YEA_YEPROC.YEA_PRC_NUM072 := r_YEA_YEPROC.YEA_PRC_NUM072 - v_DONA_DAMT;
	
	            v_DONA_TAMT := 0;
	            v_DONA_DAMT := 0;
	
	        ELSE
	            v_DONA_TAMT := v_DONA_TAMT - r_YEA_YEPROC.YEA_PRC_NUM071;
	            v_DONA_DAMT := v_DONA_DAMT - r_YEA_YEPROC.YEA_PRC_NUM072;
	
	            r_YEA_YEPROC.YEA_PRC_NUM071 := 0;
	            r_YEA_YEPROC.YEA_PRC_NUM072 := 0;
	
	        END IF;
	
	
	        IF r_YEA_YEPROC.YEA_PRC_NUM073 > v_DONA_TAMT THEN
	            r_YEA_YEPROC.YEA_PRC_NUM073 := r_YEA_YEPROC.YEA_PRC_NUM073 - v_DONA_TAMT;
	            r_YEA_YEPROC.YEA_PRC_NUM074 := r_YEA_YEPROC.YEA_PRC_NUM074 - v_DONA_DAMT;
	
	            v_DONA_TAMT := 0;
	            v_DONA_DAMT := 0;
	
	        ELSE
	            v_DONA_TAMT := v_DONA_TAMT - r_YEA_YEPROC.YEA_PRC_NUM073;
	            v_DONA_DAMT := v_DONA_DAMT - r_YEA_YEPROC.YEA_PRC_NUM074;
	
	            r_YEA_YEPROC.YEA_PRC_NUM073 := 0;
	            r_YEA_YEPROC.YEA_PRC_NUM074 := 0;
	
	        END IF;
	
	
	        IF r_YEA_YEPROC.YEA_PRC_NUM039 > v_DONA_TAMT THEN
	            r_YEA_YEPROC.YEA_PRC_NUM039 := r_YEA_YEPROC.YEA_PRC_NUM039 - v_DONA_TAMT;
	            r_YEA_YEPROC.YEA_PRC_NUM108 := r_YEA_YEPROC.YEA_PRC_NUM108 - v_DONA_DAMT;
	
	            v_DONA_TAMT := 0;
	            v_DONA_DAMT := 0;
	
	        ELSE
	            v_DONA_TAMT := v_DONA_TAMT - r_YEA_YEPROC.YEA_PRC_NUM039;
	            v_DONA_DAMT := v_DONA_DAMT - r_YEA_YEPROC.YEA_PRC_NUM108;
	
	            r_YEA_YEPROC.YEA_PRC_NUM039 := 0;
	            r_YEA_YEPROC.YEA_PRC_NUM108 := 0;
	
	        END IF;


            /*3. 공제대상금액 보정... (명세서) :  역순으로 불러와서 차례대로 차감해주면 된다!*/           
            FOR RS IN (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,YEA_DOA_STR002     /*기부년도*/
                      ,YEA_DOA_NUM003     /*기부금공제대상액*/
                      ,YEA_DOA_NUM004     /*기부금공제액*/
                      ,YEA_DOA_NUM005     /*기부금소멸액*/
                      ,YEA_DOA_NUM006     /*기부금이월액*/
                      ,YEA_DONA_SEQ
                  FROM YEA_DONAAD
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#                   
                   AND YEA_DOA_STR002 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0071','B')  /*20160510 이월분 소득공제 기부년도기준 셋팅값으로 변경*/
                   AND YEA_DOA_STR001 IN ('10', '40', '41', '42') /*10:법정, 40:지정, 41:종교, 42:우리사주*/
              ORDER BY YEA_DOA_STR001 DESC
                     , YEA_DOA_STR002 DESC

            ) LOOP

                /* 기부금공제액*/
                IF v_DONA_DEDU > 0 THEN

                  IF RS.YEA_DOA_NUM004 <= v_DONA_DEDU THEN
                    v_DONA_DEDU := v_DONA_DEDU - RS.YEA_DOA_NUM004;
                    RS.YEA_DOA_NUM004 := 0;

                  ELSE
                    RS.YEA_DOA_NUM004 := RS.YEA_DOA_NUM004 - v_DONA_DEDU;
                    v_DONA_DEDU := 0;

                  END IF;

                  UPDATE YEA_DONAAD
                    SET YEA_DOA_NUM004 = NVL(RS.YEA_DOA_NUM004, 0)
                      , YEA_DOA_NUM005 =
                                       CASE
                                           WHEN YEA_DOA_STR001 IN ('42') THEN /*42:우리사주 이월 안함*/
                                               NVL(RS.YEA_DOA_NUM003, 0) - NVL(RS.YEA_DOA_NUM004, 0)   /*소멸액=대상액-공제액*/
                                           ELSE 0
                                       END
                     , YEA_DOA_NUM006 =
                                       CASE
                                           WHEN YEA_DOA_STR001 NOT IN ('42') THEN
                                               NVL(RS.YEA_DOA_NUM003, 0) - NVL(RS.YEA_DOA_NUM004, 0)  /*이월액=대상액-공제액*/
                                           ELSE 0
                                       END

                  WHERE YEA_STD_YY = RS.YEA_STD_YY
                    AND YEA_EMP_NO = RS.YEA_EMP_NO
                    AND YEA_DONA_SEQ = RS.YEA_DONA_SEQ;

                END IF;

            END LOOP;

            v_LIMI_AMT := 0;

          ELSE
            v_LIMI_AMT := v_LIMI_AMT - NVL(r_YEA_YEPROC.YEA_PRC_NUM072, 0) - NVL(r_YEA_YEPROC.YEA_PRC_NUM108, 0) - NVL(r_YEA_YEPROC.YEA_PRC_NUM074, 0);

          END IF;
          
          
   		  /*[2015귀속]_연금계좌공제 후공제로 변경*/ 
   		  /*연금보험료공제*/
          /*퇴직연금공제 (연금저축과 더했을때 400만원한도)*/
          /*과학기술인공제회*/
          /*[2015귀속]_변경 연금계좌세액공제 한도변경*/
          r_YEA_YEPROC.YEA_PRC_NUM055 := SF_YEA_GET_MIN(SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM051, SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','B'))+r_YEA_INCDEC.YEA_INC_NUM049+r_YEA_INCDEC.YEA_INC_NUM050,SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','E'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
          r_YEA_YEPROC.YEA_PRC_NUM055 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM055,r_YEA_INCDEC.YEA_INC_NUM049);
          /*귀속년도2014년 연말정산 재정산(소급)*/
          r_YEA_YEPROC.YEA_PRC_NUM056 := SF_YEA_GET_MIN(SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','E') /*[2015귀속]_변경 연금계좌세액공제 한도변경*/	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                      , CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')		/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  THEN TRUNC(r_YEA_YEPROC.YEA_PRC_NUM055 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  ELSE TRUNC(r_YEA_YEPROC.YEA_PRC_NUM055 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                        END );
                                                        
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM056 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM056 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM056;
          END IF;
          
          /*[2014귀속] 세액공제가 0원이면 공제대상금액도 0원으로..전산매체때문에*/
          IF r_YEA_YEPROC.YEA_PRC_NUM056 <= 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM055 := 0;          
          END IF;
        
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM056;
   
          FOR RS_PENS12 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '12'
             ) LOOP
   
              UPDATE YEA_PENSAV
               SET YEA_PEN_NUM002 = SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')		/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         THEN TRUNC(RS_PENS12.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/ 
                                                         ELSE TRUNC(RS_PENS12.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                    END
                                                   , v_PESA_DEDU)
             WHERE YEA_STD_YY = RS_PENS12.YEA_STD_YY
               AND YEA_EMP_NO = RS_PENS12.YEA_EMP_NO
               AND YEA_PENS_SEQ = RS_PENS12.YEA_PENS_SEQ;

            v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                              THEN TRUNC(RS_PENS12.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                              ELSE TRUNC(RS_PENS12.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         END
                                                        , v_PESA_DEDU);
   
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*과학기술인공제회*/
   
          /*근로자퇴직급여보장법*/
          /*[2015귀속]_변경 연금계좌세액공제 한도변경*/
          r_YEA_YEPROC.YEA_PRC_NUM057 := SF_YEA_GET_MIN(SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM051, SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','B'))+r_YEA_INCDEC.YEA_INC_NUM049+r_YEA_INCDEC.YEA_INC_NUM050,SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','E'))-r_YEA_YEPROC.YEA_PRC_NUM055;	/*20160511 세액감면 추가로 000050->000060으로변경*/
          r_YEA_YEPROC.YEA_PRC_NUM057 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM057,r_YEA_INCDEC.YEA_INC_NUM050);
          /*귀속년도2014년 연말정산 재정산(소급)*/
          r_YEA_YEPROC.YEA_PRC_NUM058 := SF_YEA_GET_MIN(SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','E') /*[2015귀속]_변경 연금계좌세액공제 한도변경*/	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                      , CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')			/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  THEN TRUNC(r_YEA_YEPROC.YEA_PRC_NUM057 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  ELSE TRUNC(r_YEA_YEPROC.YEA_PRC_NUM057 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                        END );
                                                        
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM058 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM058 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM058;
          END IF;
          
          /*[2014귀속] 세액공제가 0원이면 공제대상금액도 0원으로..전산매체때문에*/
          IF r_YEA_YEPROC.YEA_PRC_NUM058 <= 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM057 := 0;                    
          END IF;
          
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM058;
   
          FOR RS_PENS11 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '11'
          ) LOOP
   
              UPDATE YEA_PENSAV
               SET YEA_PEN_NUM002 = SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')		/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         THEN TRUNC(RS_PENS11.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         ELSE TRUNC(RS_PENS11.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                    END
                                                   , v_PESA_DEDU)
             WHERE YEA_STD_YY = RS_PENS11.YEA_STD_YY
               AND YEA_EMP_NO = RS_PENS11.YEA_EMP_NO
               AND YEA_PENS_SEQ = RS_PENS11.YEA_PENS_SEQ;

            v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')	/*20160511 세액감면 추가로 000050->000060으로변경*/		
                                                              THEN TRUNC(RS_PENS11.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                              ELSE TRUNC(RS_PENS11.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         END
                                                        , v_PESA_DEDU);
                                                        
              IF v_PESA_DEDU <= 0 THEN
                  EXIT;
              END IF;
          END LOOP;
          /*근로자퇴직급여보장법*/
   
          /*연금저축*/
          /*[2015귀속]_변경 연금계좌세액공제 한도변경*/
          r_YEA_YEPROC.YEA_PRC_NUM059 := SF_YEA_GET_MIN(SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM051, SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','B'))+r_YEA_INCDEC.YEA_INC_NUM049+r_YEA_INCDEC.YEA_INC_NUM050,SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','E'))-r_YEA_YEPROC.YEA_PRC_NUM055-r_YEA_YEPROC.YEA_PRC_NUM057;	/*20160511 세액감면 추가로 000050->000060으로변경*/
          r_YEA_YEPROC.YEA_PRC_NUM059 := SF_YEA_GET_MIN(r_YEA_YEPROC.YEA_PRC_NUM059,r_YEA_INCDEC.YEA_INC_NUM051);
          /*귀속년도2014년 연말정산 재정산(소급)*/
          r_YEA_YEPROC.YEA_PRC_NUM060 := SF_YEA_GET_MIN(SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','B')		/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                      , CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  THEN TRUNC(r_YEA_YEPROC.YEA_PRC_NUM059 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                                  ELSE TRUNC(r_YEA_YEPROC.YEA_PRC_NUM059 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                        END );
                                                        
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM060 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM060 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM060;
          END IF;
          
          /*[2014귀속] 세액공제가 0원이면 공제대상금액도 0원으로..전산매체때문에*/
          IF r_YEA_YEPROC.YEA_PRC_NUM060 <= 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM059 := 0;
          END IF;   
          
          v_PESA_DEDU := r_YEA_YEPROC.YEA_PRC_NUM060;
          FOR RS_PENS22 IN (
              SELECT YEA_STD_YY
                    ,YEA_EMP_NO
                    ,YEA_PENS_SEQ
                    ,YEA_PEN_STR001
                    ,YEA_PEN_NUM001
                FROM YEA_PENSAV
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_PEN_STR001 = '22'
          ) LOOP

            UPDATE YEA_PENSAV
               SET YEA_PEN_NUM002 = SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         THEN TRUNC(RS_PENS22.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         ELSE TRUNC(RS_PENS22.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                    END
                                                   , v_PESA_DEDU)
             WHERE YEA_STD_YY = RS_PENS22.YEA_STD_YY
               AND YEA_EMP_NO = RS_PENS22.YEA_EMP_NO
               AND YEA_PENS_SEQ = RS_PENS22.YEA_PENS_SEQ;

            v_PESA_DEDU := v_PESA_DEDU - SF_YEA_GET_MIN( CASE WHEN r_YEA_YEPROC.YEA_PRC_NUM001 > SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','C')	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                              THEN TRUNC(RS_PENS22.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','A'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/	
                                                              ELSE TRUNC(RS_PENS22.YEA_PEN_NUM001 * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0020','D'), 0)	/*20160511 세액감면 추가로 000050->000060으로변경*/
                                                         END
                                                        , v_PESA_DEDU);
                                                        
            IF v_PESA_DEDU <= 0 THEN
                EXIT;
            END IF;
          END LOOP;
          /*연금저축*/
          /*[2015귀속]_연금계좌공제 후공제로 변경끝*/
             
          /*특별세액공제 계 [2014귀속]*/
          r_YEA_YEPROC.YEA_PRC_NUM075 := Nvl(r_YEA_YEPROC.YEA_PRC_NUM062, 0) /*보장성보험료*/
          						+ Nvl(r_YEA_YEPROC.YEA_PRC_NUM103, 0) /*장애인전용보험료 귀속년도2014년 연말정산 재정산(소급)*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM064, 0) /*의료비*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM066, 0) /*교육비-장애인*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM068, 0) /*10만원이하 정치자금기부금*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM070, 0) /*10만원초 정치자금기부금*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM072, 0) /*법정기부금*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM108, 0) /*[2015귀속]_추가 우리사주조합기부금*/
                                + Nvl(r_YEA_YEPROC.YEA_PRC_NUM074, 0); /*지정기부금*/
   
          /*표준세액공제*/
          IF v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM076 < 0 THEN
            r_YEA_YEPROC.YEA_PRC_NUM076 := v_LIMI_AMT;
            v_LIMI_AMT:= 0;
          ELSE
            v_LIMI_AMT :=  v_LIMI_AMT - r_YEA_YEPROC.YEA_PRC_NUM076;
          END IF;
          /*표준세액공제*/
   
          
   
          /*세액공제계*/
          r_YEA_YEPROC.YEA_PRC_NUM082 := NVL(r_YEA_YEPROC.YEA_PRC_NUM052,0) /*근로소득세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM054,0) /*자녀세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM056,0) /*과학기술인공제세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM058,0) /*근로자퇴직급여보장법세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM060,0) /*근로자퇴직급여보장법세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM075,0) /*특별세액공제 계*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM076,0) /*[2014귀속] 표준세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM077,0) /*납세조합세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM078,0) /*주택차입금세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM079,0) /*외국납부세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM081,0) /*월세액세액공제*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM099,0)  /*6세이하 귀속년도2014년 연말정산 재정산(소급)*/
                                + NVL(r_YEA_YEPROC.YEA_PRC_NUM101,0); /*출산입양 귀속년도2014년 연말정산 재정산(소급)*/
   
   
          /*농특세*/
          IF r_YEA_YEPROC.YEA_PRC_NUM041 + r_YEA_YEPROC.YEA_PRC_NUM078 + r_YEA_YEPROC.YEA_PRC_NUM036      /*[2015귀속]_장기집합투자증권저축 제외(r_YEA_YEPROC.YEA_PRC_NUM042) , 투자조합출자소득공제(r_YEA_YEPROC.YEA_PRC_NUM036)추가*/
             + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM029, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0))
             + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM031, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0))
             + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM027, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)) > 0 THEN 	/*[2015귀속]_추가 2015년 출자ㆍ투자분(10% 해당분)*/

          	/*농특세 계산하기위한 과세표준*/
          	v_STAN_FARM := r_YEA_YEPROC.YEA_PRC_NUM030 - ((r_YEA_YEPROC.YEA_PRC_NUM043 - NVL(r_YEA_YEPROC.YEA_PRC_NUM036,0) - NVL(r_YEA_YEPROC.YEA_PRC_NUM041,0))    /*[2015귀속]_장기집합투자증권저축 제외(r_YEA_YEPROC.YEA_PRC_NUM042)*/
                       + GREATEST(0,GREATEST(r_YEA_YEPROC.YEA_PRC_NUM044 - SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM029, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0))
                       - SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM030, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0050','C'),0))
                       - SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM031, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0060','D'),0))      /* [2015귀속]_장기집합투자증권저축 제외(r_YEA_YEPROC.YEA_PRC_NUM042)*/
                       - SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM027, TRUNC(r_YEA_YEPROC.YEA_PRC_NUM003 * SF_YEA_YETABS(#YEA_STD_YY#,'000040','0065','E'),0)))));   /*[2015귀속]_추가 2015년 출자ㆍ투자분(10% 해당분)*/
          ELSE
          	v_STAN_FARM := 0;
          END IF;

   
          /*농특세 계산하기위한 산출세액*/
          v_TAX_FARM := CASE WHEN v_STAN_FARM = 0 THEN 0
                              WHEN v_STAN_FARM > 0 AND v_STAN_FARM <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0010','A') THEN TRUNC(v_STAN_FARM * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0010','B'),0)
                              WHEN v_STAN_FARM > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','A') AND v_STAN_FARM <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','B') THEN TRUNC((v_STAN_FARM - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0020','C'),0)
                              WHEN v_STAN_FARM > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','A') AND v_STAN_FARM <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','B') THEN TRUNC((v_STAN_FARM - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0030','C'),0)
                              WHEN v_STAN_FARM > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','A') AND v_STAN_FARM <= SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','B') THEN TRUNC((v_STAN_FARM - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','D') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0040','C'),0)
                              WHEN v_STAN_FARM > SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','A') THEN TRUNC((v_STAN_FARM - SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','A')) * SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','C') + SF_YEA_TAXBAS(#YEA_STD_YY#,'000050','0050','B'),0)
                        END;
   
   
          /*산출세액차액*/
          IF v_TAX_FARM > 0 THEN
            v_TAX_DIFF := v_TAX_FARM - r_YEA_YEPROC.YEA_PRC_NUM046;
            v_TAX_DIFF := v_TAX_DIFF + r_YEA_YEPROC.YEA_PRC_NUM078;
          END IF;
          /*농특세*/
   
   
   
          /*결정세액소득세 = 산출세액 - 세액감면계 - 세액공제계*/
          r_YEA_YEPROC.YEA_PRC_NUM083 := r_YEA_YEPROC.YEA_PRC_NUM046 - r_YEA_YEPROC.YEA_PRC_NUM051 - r_YEA_YEPROC.YEA_PRC_NUM082;
          /*결정세액주민세*/
          r_YEA_YEPROC.YEA_PRC_NUM084 := TRUNC(r_YEA_YEPROC.YEA_PRC_NUM083 / 10, 0);
          /*결정세액농특세*/
          r_YEA_YEPROC.YEA_PRC_NUM085 := TRUNC(NVL(v_TAX_DIFF, 0) * 0.2, 0);
   
          /*납부특례세액*/
          SELECT SUM(NVL(YEA_PAY_NUM018,0))
                ,SUM(NVL(YEA_PAY_NUM019,0))
                ,SUM(NVL(YEA_PAY_NUM020,0))
            INTO r_YEA_YEPROC.YEA_PRC_NUM095
                ,r_YEA_YEPROC.YEA_PRC_NUM096
                ,r_YEA_YEPROC.YEA_PRC_NUM097
            FROM YEA_PAYDTL
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
   
   
          /*차감징수세액*/
          r_YEA_YEPROC.YEA_PRC_NUM092 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM083 - r_YEA_YEPROC.YEA_PRC_NUM086 - r_YEA_YEPROC.YEA_PRC_NUM089 - r_YEA_YEPROC.YEA_PRC_NUM095) ,-1);
          r_YEA_YEPROC.YEA_PRC_NUM093 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM084 - r_YEA_YEPROC.YEA_PRC_NUM087 - r_YEA_YEPROC.YEA_PRC_NUM090 - r_YEA_YEPROC.YEA_PRC_NUM096) ,-1);
          r_YEA_YEPROC.YEA_PRC_NUM094 := TRUNC((r_YEA_YEPROC.YEA_PRC_NUM085 - r_YEA_YEPROC.YEA_PRC_NUM088 - r_YEA_YEPROC.YEA_PRC_NUM091 - r_YEA_YEPROC.YEA_PRC_NUM097) ,-1);
   
          /*소액부징수적용*/
          IF r_YEA_YEPROC.YEA_PRC_NUM092 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM092 < 1000 THEN
            r_YEA_YEPROC.YEA_PRC_NUM092 := 0;
          END IF;
   
          IF r_YEA_YEPROC.YEA_PRC_NUM092 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM092 < 1000 THEN
            r_YEA_YEPROC.YEA_PRC_NUM093 := 0;
          END IF;
   
          IF r_YEA_YEPROC.YEA_PRC_NUM094 > 0 AND r_YEA_YEPROC.YEA_PRC_NUM094 < 1000 THEN
            r_YEA_YEPROC.YEA_PRC_NUM094 := 0;
          END IF;
   
       /******************************************************************************
       * ★단일세율-미적용 끝!                                                       *
       ******************************************************************************/
       END IF;
   
        /*입력*/
        INSERT INTO YEA_YEPROC (
               YEA_STD_YY
              ,YEA_EMP_NO
              ,YEA_PRC_NUM001   /*총급여*/
              ,YEA_PRC_NUM002   /*근로소득공제*/
              ,YEA_PRC_NUM003   /*근로소득금액*/
              ,YEA_PRC_NUM004   /*기본공제_본인*/
              ,YEA_PRC_NUM005   /*기본공제_배우자*/
              ,YEA_PRC_NUM006   /*기본공제_부양가족 수*/
              ,YEA_PRC_NUM007   /*기본공제_부양가족*/
              ,YEA_PRC_NUM008   /*추가공제_경로우대 수*/
              ,YEA_PRC_NUM009   /*추가공제_경로우대*/
              ,YEA_PRC_NUM010   /*추가공제_장애인 수*/
              ,YEA_PRC_NUM011   /*추가공제_장애인*/
              ,YEA_PRC_NUM012   /*추가공제_부녀자*/
              ,YEA_PRC_NUM013   /*한부모공제*/
              ,YEA_PRC_NUM014   /*국민연금보험료*/
              ,YEA_PRC_NUM015   /*공무원연금*/
              ,YEA_PRC_NUM016   /*군인연금*/
              ,YEA_PRC_NUM017   /*사립학교교직원연금*/
              ,YEA_PRC_NUM018   /*별정우체국연금*/
              ,YEA_PRC_NUM019   /*보험료(건강보험료)*/
              ,YEA_PRC_NUM020   /*보험료(고용보험료)*/
              ,YEA_PRC_NUM021   /*주택임차차입금_대출기관*/
              ,YEA_PRC_NUM022   /*주택임차차입금_거주자*/
              ,YEA_PRC_NUM023   /*장기주택저당차입금_2011년이전(15년미만)*/
              ,YEA_PRC_NUM024   /*장기주택저당차입금 _2011년이전(15년~29년)*/
              ,YEA_PRC_NUM025   /*장기주택저당차입금_2011년이전(30년이상)*/
              ,YEA_PRC_NUM026   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
              ,YEA_PRC_NUM027   /*장기주택저당차입금_2012년이후(기타대출)*/
              ,YEA_PRC_NUM028   /*기부금(이월분)*/
              ,YEA_PRC_NUM029   /*특별소득공제 계*/
              ,YEA_PRC_NUM030   /*차감소득금액*/
              ,YEA_PRC_NUM031   /*개인연금저축*/
              ,YEA_PRC_NUM032   /*소기업·소상공인 공제부금*/
              ,YEA_PRC_NUM033   /*청약저축*/
              ,YEA_PRC_NUM034   /*주택청약종합저축*/
              ,YEA_PRC_NUM035   /*근로자주택마련저축*/
              ,YEA_PRC_NUM036   /*투자조합출자 등*/
              ,YEA_PRC_NUM037   /*신용카드 등 사용액*/
              ,YEA_PRC_NUM038   /*우리사주조합 출연금*/
              ,YEA_PRC_NUM039   /*우리사주조합 기부금*/
              ,YEA_PRC_NUM040   /*고용유지 중소기업 근로자*/
              ,YEA_PRC_NUM041   /*목돈 안 드는 전세 이자상환액*/
              ,YEA_PRC_NUM042   /*장기집합투자증권저축*/
              ,YEA_PRC_NUM043   /*그 박의 소득공제 계*/
              ,YEA_PRC_NUM044   /*소득공제 종합한도 초과액*/
              ,YEA_PRC_NUM045   /*종합소득 과세표준*/
              ,YEA_PRC_NUM046   /*산출세액*/
              ,YEA_PRC_NUM047   /*세액감면_소득세법*/
              ,YEA_PRC_NUM048   /*세액감면_조세특례제한법*/
              ,YEA_PRC_NUM049   /*세액감면_조세특례제한법 제30조*/
              ,YEA_PRC_NUM050   /*조세조약*/
              ,YEA_PRC_NUM051   /*세액감면 계*/
              ,YEA_PRC_NUM052   /*세액공제_근로소득*/
              ,YEA_PRC_NUM053   /*세액공제_자녀 수*/
              ,YEA_PRC_NUM054   /*세액공제_자녀*/
              ,YEA_PRC_NUM055   /*과학기술인공제_공제대상금액*/
              ,YEA_PRC_NUM056   /*과학기술인공제_세액공제액*/
              ,YEA_PRC_NUM057   /*근로자퇴직급여보장법_공제대상금액*/
              ,YEA_PRC_NUM058   /*근로자퇴직급여보장법_세액공제액*/
              ,YEA_PRC_NUM059   /*연금저축_공제대상금액*/
              ,YEA_PRC_NUM060   /*연금저축_세액공제액*/
              ,YEA_PRC_NUM061   /*보장성보험료_공제대상금액*/
              ,YEA_PRC_NUM062   /*보장성보험료_세액공제액*/
              ,YEA_PRC_NUM063   /*의료비_공제대상금액*/
              ,YEA_PRC_NUM064   /*의료비_세액공제액*/
              ,YEA_PRC_NUM065   /*교육비_공제대상금액*/
              ,YEA_PRC_NUM066   /*교육비_세액공제액*/
              ,YEA_PRC_NUM067   /*정치자금기부금_10만원이하_공제대상금액*/
              ,YEA_PRC_NUM068   /*정치자금기부금_10만원이하_세액공제액*/
              ,YEA_PRC_NUM069   /*정치자금기부금_10만원초과_공제대상금액*/
              ,YEA_PRC_NUM070   /*정치자금기부금_10만원초과_세액공제액*/
              ,YEA_PRC_NUM071   /*법정기부금_공제대상금액*/
              ,YEA_PRC_NUM072   /*법정기부금_세액공제액*/
              ,YEA_PRC_NUM073   /*지정기부금_공제대상금액*/
              ,YEA_PRC_NUM074   /*지정기부금_세액공제액*/
              ,YEA_PRC_NUM075   /*특별세액공제 계*/
              ,YEA_PRC_NUM076   /*표준세액공제*/
              ,YEA_PRC_NUM077   /*납세조합공제*/
              ,YEA_PRC_NUM078   /*주택차입금*/
              ,YEA_PRC_NUM079   /*외국납부*/
              ,YEA_PRC_NUM080   /*월세세액공제_공제대상금액*/
              ,YEA_PRC_NUM081   /*월세세액공제_세액공제액*/
              ,YEA_PRC_NUM082   /*세액공제 계*/
              ,YEA_PRC_NUM083   /*결정세액 소득세*/
              ,YEA_PRC_NUM084   /*결정세액 주민세*/
              ,YEA_PRC_NUM085   /*결정세액 농특세*/
              ,YEA_PRC_NUM086   /*종근무지소득세*/
              ,YEA_PRC_NUM087   /*종근무지주민세*/
              ,YEA_PRC_NUM088   /*종근무지농특세*/
              ,YEA_PRC_NUM089   /*주근무지소득세*/
              ,YEA_PRC_NUM090   /*주근무지주민세*/
              ,YEA_PRC_NUM091   /*주근무지농특세*/
              ,YEA_PRC_NUM092   /*차감징수소득세*/
              ,YEA_PRC_NUM093   /*차감징수주민세*/
              ,YEA_PRC_NUM094   /*차감징수농특세*/
              ,YEA_PRC_NUM095   /*납부특례소득세*/
              ,YEA_PRC_NUM096   /*납부특례주민세*/
              ,YEA_PRC_NUM097   /*납부특례농특세*/
              ,YEA_PRC_STR001   /*확정여부*/
              ,YEA_PRC_STR002   /*정산구분*/
              ,YEA_PRC_STR003   /*신고년월*/
              ,YEA_PRC_STR005   /*사업장코드*/
              ,YEA_PRC_NUM098   /*세액공제_6세이하 수 귀속년도2014년 연말정산 재정산(소급)*/
              ,YEA_PRC_NUM099   /*세액공제_6세이하 귀속년도2014년 연말정산 재정산(소급)*/
              ,YEA_PRC_NUM100   /*세액공제_출산 입양 수*/
              ,YEA_PRC_NUM101   /*세액공제_출산 입양*/
              ,YEA_PRC_NUM102   /*장애인전용보험료_공제대상금액*/
              ,YEA_PRC_NUM103   /*장애인전용보험료_세액공제액*/
              ,YEA_PRC_NUM104	/*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이면서 비거치)*/
              ,YEA_PRC_NUM105	/*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이거나 비거치)*/
              ,YEA_PRC_NUM106	/*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(기타대출)*/
              ,YEA_PRC_NUM107	/*[2015귀속] 장기주택저당차입금_2015년이후, 10~15년(고정금리이거나 비거치)*/
              ,YEA_PRC_NUM108	/*[2015귀속] 우리사주조합기부금_세액공제액*/              
              ,YEA_INS_DATE
              ,YEA_INS_USER_ID
              ,YEA_UPD_DATE
              ,YEA_UPD_USER_ID
              ) VALUES (
               #YEA_STD_YY#
              ,#YEA_EMP_NO#
              ,r_YEA_YEPROC.YEA_PRC_NUM001   /*총급여*/
              ,r_YEA_YEPROC.YEA_PRC_NUM002   /*근로소득공제*/
              ,r_YEA_YEPROC.YEA_PRC_NUM003   /*근로소득금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM004   /*기본공제_본인*/
              ,r_YEA_YEPROC.YEA_PRC_NUM005   /*기본공제_배우자*/
              ,r_YEA_YEPROC.YEA_PRC_NUM006   /*기본공제_부양가족 수*/
              ,r_YEA_YEPROC.YEA_PRC_NUM007   /*기본공제_부양가족*/
              ,r_YEA_YEPROC.YEA_PRC_NUM008   /*추가공제_경로우대 수*/
              ,r_YEA_YEPROC.YEA_PRC_NUM009   /*추가공제_경로우대*/
              ,r_YEA_YEPROC.YEA_PRC_NUM010   /*추가공제_장애인 수*/
              ,r_YEA_YEPROC.YEA_PRC_NUM011   /*추가공제_장애인*/
              ,r_YEA_YEPROC.YEA_PRC_NUM012   /*추가공제_부녀자*/
              ,r_YEA_YEPROC.YEA_PRC_NUM013   /*한부모공제*/
              ,r_YEA_YEPROC.YEA_PRC_NUM014   /*국민연금보험료*/
              ,r_YEA_YEPROC.YEA_PRC_NUM015   /*공무원연금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM016   /*군인연금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM017   /*사립학교교직원연금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM018   /*별정우체국연금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM019   /*보험료(건강보험료)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM020   /*보험료(고용보험료)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM021   /*주택임차차입금_대출기관*/
              ,r_YEA_YEPROC.YEA_PRC_NUM022   /*주택임차차입금_거주자*/
              ,r_YEA_YEPROC.YEA_PRC_NUM023   /*장기주택저당차입금_2011년이전(15년미만)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM024   /*장기주택저당차입금 _2011년이전(15년~29년)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM025   /*장기주택저당차입금_2011년이전(30년이상)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM026   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM027   /*장기주택저당차입금_2012년이후(기타대출)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM028   /*기부금(이월분)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM029   /*특별소득공제 계*/
              ,r_YEA_YEPROC.YEA_PRC_NUM030   /*차감소득금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM031   /*개인연금저축*/
              ,r_YEA_YEPROC.YEA_PRC_NUM032   /*소기업·소상공인 공제부금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM033   /*청약저축*/
              ,r_YEA_YEPROC.YEA_PRC_NUM034   /*주택청약종합저축*/
              ,r_YEA_YEPROC.YEA_PRC_NUM035   /*근로자주택마련저축*/
              ,r_YEA_YEPROC.YEA_PRC_NUM036   /*투자조합출자 등*/
              ,r_YEA_YEPROC.YEA_PRC_NUM037   /*신용카드 등 사용액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM038   /*우리사주조합 출연금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM039   /*우리사주조합 기부금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM040   /*고용유지 중소기업 근로자*/
              ,r_YEA_YEPROC.YEA_PRC_NUM041   /*목돈 안 드는 전세 이자상환액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM042   /*장기집합투자증권저축*/
              ,r_YEA_YEPROC.YEA_PRC_NUM043   /*그 박의 소득공제 계*/
              ,r_YEA_YEPROC.YEA_PRC_NUM044   /*소득공제 종합한도 초과액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM045   /*종합소득 과세표준*/
              ,r_YEA_YEPROC.YEA_PRC_NUM046   /*산출세액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM047   /*세액감면_소득세법*/
              ,r_YEA_YEPROC.YEA_PRC_NUM048   /*세액감면_조세특례제한법*/
              ,r_YEA_YEPROC.YEA_PRC_NUM049   /*세액감면_조세특례제한법 제30조*/
              ,r_YEA_YEPROC.YEA_PRC_NUM050   /*조세조약*/
              ,r_YEA_YEPROC.YEA_PRC_NUM051   /*세액감면 계*/
              ,r_YEA_YEPROC.YEA_PRC_NUM052   /*세액공제_근로소득*/
              ,r_YEA_YEPROC.YEA_PRC_NUM053   /*세액공제_자녀 수*/
              ,r_YEA_YEPROC.YEA_PRC_NUM054   /*세액공제_자녀*/
              ,r_YEA_YEPROC.YEA_PRC_NUM055   /*과학기술인공제_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM056   /*과학기술인공제_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM057   /*근로자퇴직급여보장법_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM058   /*근로자퇴직급여보장법_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM059   /*연금저축_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM060   /*연금저축_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM061   /*보장성보험료_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM062   /*보장성보험료_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM063   /*의료비_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM064   /*의료비_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM065   /*교육비_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM066   /*교육비_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM067   /*정치자금기부금_10만원이하_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM068   /*정치자금기부금_10만원이하_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM069   /*정치자금기부금_10만원초과_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM070   /*정치자금기부금_10만원초과_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM071   /*법정기부금_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM072   /*법정기부금_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM073   /*지정기부금_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM074   /*지정기부금_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM075   /*특별세액공제 계*/
              ,r_YEA_YEPROC.YEA_PRC_NUM076   /*표준세액공제*/
              ,r_YEA_YEPROC.YEA_PRC_NUM077   /*납세조합공제*/
              ,r_YEA_YEPROC.YEA_PRC_NUM078   /*주택차입금*/
              ,r_YEA_YEPROC.YEA_PRC_NUM079   /*외국납부*/
              ,r_YEA_YEPROC.YEA_PRC_NUM080   /*월세세액공제_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM081   /*월세세액공제_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM082   /*세액공제 계*/
              ,r_YEA_YEPROC.YEA_PRC_NUM083   /*결정세액 소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM084   /*결정세액 주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM085   /*결정세액 농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM086   /*종근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM087   /*종근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM088   /*종근무지농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM089   /*주근무지소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM090   /*주근무지주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM091   /*주근무지농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM092   /*차감징수소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM093   /*차감징수주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM094   /*차감징수농특세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM095   /*납부특례소득세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM096   /*납부특례주민세*/
              ,r_YEA_YEPROC.YEA_PRC_NUM097   /*납부특례농특세*/
              ,'0'
              ,#YEA_PRC_STR002#              /*정산구분*/
              ,''
              ,#YEA_BRANCH_CD#   /*사업장코드*/
              ,r_YEA_YEPROC.YEA_PRC_NUM098   /*세액공제_6세이하 수 귀속년도2014년 연말정산 재정산(소급)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM099   /*세액공제_6세이하*/
              ,r_YEA_YEPROC.YEA_PRC_NUM100   /*세액공제_출산 입양 수*/
              ,r_YEA_YEPROC.YEA_PRC_NUM101   /*세액공제_출산 입양*/
              ,r_YEA_YEPROC.YEA_PRC_NUM102   /*장애인전용보험료_공제대상금액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM103   /*장애인전용보험료_세액공제액*/
              ,r_YEA_YEPROC.YEA_PRC_NUM104   /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이면서 비거치)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM105	 /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(고정금리이거나 비거치)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM106	 /*[2015귀속] 장기주택저당차입금_2015년이후, 15년이상(기타대출)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM107	 /*[2015귀속] 장기주택저당차입금_2015년이후, 10~15년(고정금리이거나 비거치)*/
              ,r_YEA_YEPROC.YEA_PRC_NUM108	 /*[2015귀속] 우리사주조합기부금_세액공제액*/              
              ,SYSDATE
              ,#UPDT_USID#
              ,SYSDATE
              ,#UPDT_USID#
            );
  
      EXCEPTION
         WHEN OTHERS THEN
            RAISE;
    END;
    ]]>	
	</update>

<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 입력마감 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC03" parameterClass="hashmap">
    <![CDATA[
    /* YEAA0070_2015.PROC03.연말정산처리 입력마감 처리 */
    DECLARE     
          v_ROWCNT INT;
          v_ROWCNT2 INT;
          v_ROWCNT3 INT;
          v_YEA_EMP_NO VARCHAR2(100);
          v_YEA_EMP_NM VARCHAR2(100);
          r_YEA_INCDEC YEA_INCDEC%ROWTYPE;
          v_INSU_ESUM NUMBER(15,0);
          v_INSU_SUM NUMBER(15,0);
          v_MEDI_SSUM NUMBER(15,0);
          v_MEDI_DSUM NUMBER(15,0);
          v_MEDI_GSUM NUMBER(15,0);
          v_EDUC_CNT2 NUMBER(15,0);
          v_EDUC_CNT3 NUMBER(15,0);
          v_EDUC_CNT4 NUMBER(15,0);
          v_EDUC_CNT5 NUMBER(15,0);
          v_EDUC_SUM1 NUMBER(15,0);
          v_EDUC_SUM2 NUMBER(15,0);
          v_EDUC_SUM3 NUMBER(15,0);
          v_EDUC_SUM4 NUMBER(15,0);
          v_EDUC_SUM5 NUMBER(15,0);
          v_CARD_SUM NUMBER(15,0);
          v_DCAD_SUM NUMBER(15,0);
          v_GIRO_SUM NUMBER(15,0);
          v_CASH_SUM NUMBER(15,0);
          v_MRKT_SUM NUMBER(15,0);
          v_PTRA_SUM NUMBER(15,0);
          v_DONA_SUM NUMBER(15,0);
          v_CHLD_CNT NUMBER(15,0);
          v_INSU_DSUM NUMBER(15,0);
          v_CHRE_CNT NUMBER(15,0);
		  v_ADPN_CNT NUMBER(15,0);
          v_YEA_MES_CNT INT;
          v_YEA_MES_NUM002_AMT YEA_MEDISP.YEA_MES_NUM002%TYPE;
          v_YEA_MES_NUM002_AMT_2015 YEA_MEDISP.YEA_MES_NUM002%TYPE;
          v_YEA_DOS_CNT INT;          
          v_YEA_DOS_NUM002_AMT YEA_DONASP.YEA_DOS_NUM002%TYPE;   
          v_DONA_ALLX NUMBER(15,0);
          v_DONA_POLI NUMBER(15,0);
          v_DONA_50PC NUMBER(15,0);
          v_DONA_30PC NUMBER(15,0);
          v_DONA_APPO NUMBER(15,0);
          v_DONA_RELI NUMBER(15,0);           
          v_PESA_11 NUMBER(15,0);
          v_PESA_12 NUMBER(15,0);
          v_PESA_21 NUMBER(15,0);
          v_PESA_22 NUMBER(15,0);
          v_PESA_31 NUMBER(15,0);
          v_PESA_32 NUMBER(15,0);
          v_PESA_34 NUMBER(15,0);
          v_PESA_51 NUMBER(15,0);
          v_PESA_31_2015 NUMBER(15,0);
          v_PESA_32_2015 NUMBER(15,0);
          v_MREN_DEDU YEA_RENTA1.YEA_RT1_NUM001%TYPE;
          v_SEND_INTE YEA_RENTA2.YEA_RT2_NUM002%TYPE;            
          v_DONA_10 NUMBER(15,0);
          v_DONA_20 NUMBER(15,0);
          v_DONA_3031 NUMBER(15,0);
          v_DONA_42 NUMBER(15,0);
          v_DONA_40 NUMBER(15,0);
          v_DONA_41 NUMBER(15,0);      
          v_BEFO_FIRM YEA_INCDEC.YEA_INC_STR016%TYPE;
          v_BEFO_BUSI YEA_INCDEC.YEA_INC_STR017%TYPE;
          v_BEFO_PAYX YEA_INCDEC.YEA_INC_NUM075%TYPE;
          v_BEFO_ITAX YEA_INCDEC.YEA_INC_NUM076%TYPE;
          v_PAYX_TAMT YEA_YEPROC.YEA_PRC_NUM001%TYPE;
          v_MEDI_DEDU YEA_YEPROC.YEA_PRC_NUM063%TYPE;
          sSQL VARCHAR2(4000);          
    BEGIN               
          SELECT A.YEA_EMP_NO
               , A.YEA_EMP_NM
            INTO v_YEA_EMP_NO
               , v_YEA_EMP_NM
            FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#, #YEA_STD_YY# || '1231')) A;
            
            /*마감여부 체크*/
			SELECT COUNT(*)
			  INTO v_ROWCNT
			  FROM YEA_INCDEC A
			 WHERE A.YEA_STD_YY = #YEA_STD_YY#
			   AND A.YEA_EMP_NO = #YEA_EMP_NO#
			   AND A.YEA_INC_STR025 = '1';
			
			/*마감되었다면 입력불가*/
			IF v_ROWCNT > 0 THEN
				RAISE_APPLICATION_ERROR(-20000,'마감되었습니다. 입력,수정,삭제가 불가 합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );          
			END IF;           
			
			/*확정여부 체크*/
			SELECT COUNT(*)
			  INTO v_ROWCNT
			  FROM YEA_YEPROC A
			 WHERE A.YEA_STD_YY = #YEA_STD_YY#
			   AND A.YEA_EMP_NO = #YEA_EMP_NO#
			   AND A.YEA_PRC_STR001 = '1';
			
			/*확정되었다면 삭제불가*/
			IF v_ROWCNT > 0 THEN
				RAISE_APPLICATION_ERROR(-20000,'확정되었습니다. 입력,수정,삭제가 불가 합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );      
			END IF;
      
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_PAYDTL
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
      
            IF v_ROWCNT = 0 THEN
              RAISE_APPLICATION_ERROR(-20000,'근로소득 데이터가 존재하지 않습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
            END IF;
      
            SELECT COUNT(*)
              INTO v_ROWCNT
              FROM YEA_INCDEC
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
      
            IF v_ROWCNT = 0 THEN
              RAISE_APPLICATION_ERROR(-20000,'소득공제 데이터가 존재하지 않습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
            END IF;
      
          /*오류체크*/
          /*소득공제신고서*/
            SELECT *
              INTO r_YEA_INCDEC
              FROM YEA_INCDEC
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
        
          /*명세서 여부*/
            SELECT COUNT(*)
              INTO v_YEA_MES_CNT
              FROM YEA_MEDISP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
        
            SELECT COUNT(*)
              INTO v_YEA_DOS_CNT
              FROM YEA_DONASP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;

          FOR RS IN (
            SELECT YEA_STD_YY       /*정산년월*/
                  ,YEA_EMP_NO       /*사원번호*/
                  ,YEA_FAMI_SEQ     /*가족순번*/
                  ,YEA_FAM_STR001   /*가족관계신고코드*/
                  ,YEA_FAM_STR002   /*내외국인구분*/
                  ,YEA_FAM_STR003   /*성명*/
                  ,SF_YEA_DECRYPT_SSN(YEA_FAM_STR004) AS YEA_FAM_STR004   /*주민등록번호*/
                  ,YEA_FAM_STR005   /*기본공제여부*/
                  ,YEA_FAM_STR006   /*경로자여부*/
                  ,YEA_FAM_STR007   /*부녀자여부*/
                  ,YEA_FAM_STR008   /*한부모여부*/
                  ,YEA_FAM_STR009   /*장애자여부*/
                  ,YEA_FAM_STR011   /*6세이하여부 귀속년도2014년 연말정산 재정산(소급)*/
                  ,YEA_FAM_STR012   /*출산입양여부 귀속년도2014년 연말정산 재정산(소급)*/
                  ,YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                  ,YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                  ,YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                  ,YEA_FAM_NUM004   /*보험료_보장성_기타*/
                  ,YEA_FAM_NUM005   /*의료비국세청*/
                  ,YEA_FAM_NUM006   /*의료비기타*/
                  ,YEA_FAM_STR010   /*교육비구분코드*/
                  ,YEA_FAM_NUM007   /*교육비국세청*/
                  ,YEA_FAM_NUM008   /*교육비기타*/
                  ,YEA_FAM_NUM009   /*신용카드등국세청*/
                  ,YEA_FAM_NUM010   /*신용카드등기타*/
                  ,YEA_FAM_NUM011   /*직불카드등국세청*/
                  ,YEA_FAM_NUM012   /*직불카드등기타*/
                  ,YEA_FAM_NUM013   /*현금영수증*/
                  ,YEA_FAM_NUM014   /*전통시장_국세청*/
                  ,YEA_FAM_NUM015   /*전통시장_기타*/
                  ,YEA_FAM_NUM016   /*대중교통_국세청*/
                  ,YEA_FAM_NUM017   /*대중교통_기타*/
                  ,YEA_FAM_NUM018   /*기부금국세청*/
                  ,YEA_FAM_NUM019   /*기부금기타*/
                  ,YEA_FAM_NUM020   /*장애인전용_국세청 귀속년도2014년 연말정산 재정산(소급)*/
                  ,YEA_FAM_NUM021   /*장애인전용_기타 귀속년도2014년 연말정산 재정산(소급)*/
                  ,YEA_FAM_NUM022   /*[2015귀속] 추가 난임시술비_국세청*/
                  ,YEA_FAM_NUM023   /*[2015귀속] 추가 난임시술비_기타*/                  
                  ,CHIL_CNT         /*직계비속수*/
                  ,YEA_INS_USER_ID
                  ,YEA_INS_DATE
                  ,YEA_UPD_USER_ID
                  ,YEA_UPD_DATE
              FROM YEA_YEFAMI A
         LEFT JOIN (
                   SELECT YEA_STD_YY AS YEA_STD_YY_B
                         ,YEA_EMP_NO AS YEA_EMP_NO_B
                         ,COUNT(1) AS CHIL_CNT
                    FROM YEA_YEFAMI
                   WHERE YEA_STD_YY = #YEA_STD_YY#
                     AND YEA_EMP_NO = #YEA_EMP_NO#
                     AND YEA_FAM_STR005 = '1'
                     AND YEA_FAM_STR001 IN ('4', '8')
                GROUP BY YEA_STD_YY, YEA_EMP_NO
                    ) B
                ON A.YEA_STD_YY = B.YEA_STD_YY_B
               AND A.YEA_EMP_NO = B.YEA_EMP_NO_B
               AND A.YEA_FAM_STR001 = '0' /*본인만*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
          ) LOOP
  
              /*관계코드 체크*/
              IF RS.YEA_FAM_STR001 IS NULL THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 ||':관계코드를 입력해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*내외국인 체크*/
              IF RS.YEA_FAM_STR002 IS NULL THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 ||':내외국인을 입력해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*성명 체크*/
              IF RS.YEA_FAM_STR003 IS NULL THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 ||':성명을 입력해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*주민등록번호 체크*/
              IF RS.YEA_FAM_STR004 IS NULL THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 ||':주민등록번호를 입력해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*주민등록번호 자릿수 체크*/
              IF LENGTH(RS.YEA_FAM_STR004) !=  13 THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 ||':주민등록번호를 확인해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
               /*기본공제 체크 (대상자의 신고코드가 1,2,4,5,6 인경우 20세이하, 60세 이상이 아니거나 장애인이 아니면 오류)*/
              IF RS.YEA_FAM_STR005 = '1'
                AND RS.YEA_FAM_STR001 IN ('1','2','4','5','6')
                AND Nvl(RS.YEA_FAM_STR009, '0') = '0'
                AND CASE WHEN SUBSTR(RS.YEA_FAM_STR004,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(RS.YEA_FAM_STR004,1,6) > TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-60) || '1231'
                AND CASE WHEN SUBSTR(RS.YEA_FAM_STR004,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(RS.YEA_FAM_STR004,1,6) < TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-20) || '0101'
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':기본공제 체크 오류입니다. 관계코드 및 나이를 확인해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*한부모체크 추가*/
              IF RS.YEA_FAM_STR008 = '1'
                AND RS.YEA_FAM_STR001 = '0'
              THEN
                IF RS.YEA_FAM_STR007 = '1' THEN
                  RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':부녀자와 한부모가족 여부는 동시 선택이 불가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
                END IF;
  
                IF NVL(RS.CHIL_CNT, 0) <= 0 THEN
                  RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':한부모가족 공제는 기본공제 대상인 직계비속 대상자가 필요합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
                END IF;
              END IF;
  
              /*장애인공제 체크 (기본공제대상자만 가능)*/
              IF RS.YEA_FAM_STR005 = '0'
                AND NVL(RS.YEA_FAM_STR009, '0') >= '1'  /*장애자여부->코드로변경 [2013귀속] 수정*/
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':장애인공제 체크 오류입니다. 기본공제 대상자만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*경로우대 체크 (기본공제대상자만 가능, 만 70세 이상만 체크)*/
              IF RS.YEA_FAM_STR005 = '1'
                AND CASE WHEN SUBSTR(RS.YEA_FAM_STR004,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(RS.YEA_FAM_STR004,1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-70) || '1231'
                AND RS.YEA_FAM_STR006 = '0'
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':경로우대공제 체크 오류입니다. 경로우대를 체크 해주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_STR005 = '1'
                AND CASE WHEN SUBSTR(RS.YEA_FAM_STR004,7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(RS.YEA_FAM_STR004,1,6) > TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-70) || '1231'
                AND RS.YEA_FAM_STR006 = '1'
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':경로우대공제 체크 오류입니다. 경로우대는 만 70이상 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*보험료체크 (기본공제대상자만 가능)*/
              IF RS.YEA_FAM_NUM001 < 0
                OR RS.YEA_FAM_NUM002 < 0
                OR RS.YEA_FAM_NUM003 < 0
                OR RS.YEA_FAM_NUM004 < 0
                OR RS.YEA_FAM_NUM020 < 0
                OR RS.YEA_FAM_NUM021 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':보험료 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF (RS.YEA_FAM_NUM001 > 0
                  OR RS.YEA_FAM_NUM002 > 0
                  OR RS.YEA_FAM_NUM003 > 0
                  OR RS.YEA_FAM_NUM004 > 0
                  OR RS.YEA_FAM_NUM020 > 0
                  OR RS.YEA_FAM_NUM021 > 0)
                AND RS.YEA_FAM_STR005 = '0'
              THEN
                 RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':보험료 금액 오류입니다. 기본공제대상자만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*교육비체크(본인교육비는 신고코드가 0, 교육구분이 있으면서 금액없으면 오류, 교육구분이 없으면서 금액있으면 오류*/
              /*본인교육비가 본인이 아니면 오류*/
              /*초중대학생은 직계존속이면 오류*/
              /*장애인 교육비는 장애인공제 대상자만 가능*/
              IF RS.YEA_FAM_NUM007 < 0
                OR RS.YEA_FAM_NUM008 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':교육비 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF (RS.YEA_FAM_NUM007 > 0
                  OR RS.YEA_FAM_NUM008 > 0)
                AND RS.YEA_FAM_STR010 IS NULL
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':교육비구분 오류입니다. 교육비구분을 선택해주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_STR010 = '1'
                AND RS.YEA_FAM_STR001 != '0'
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':교육비구분 오류입니다. 본인교육비는 소득자본인만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_STR010 IN ('2','3','4')
                AND RS.YEA_FAM_STR001 IN ('1','2')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':교육비 오류입니다. 초중고대학생 교육비는 직계존속은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_STR010 = '5'
                AND RS.YEA_FAM_STR009 = '0'
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':교육비 오류입니다. 장애인 교육비는 장애인공제 대상자만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*신용카드(관계코드가 6,7 이면 오류)*/
              IF RS.YEA_FAM_NUM009 < 0
                OR RS.YEA_FAM_NUM010 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':신용카드 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_NUM011 < 0
                OR RS.YEA_FAM_NUM012 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':직불카드 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*2012.12.26 추가 시작*/
  
              IF RS.YEA_FAM_NUM015 < 0
                OR RS.YEA_FAM_NUM016 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':전통시장사용분 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF (RS.YEA_FAM_NUM015 > 0
                  OR RS.YEA_FAM_NUM016 > 0)
                AND RS.YEA_FAM_STR001 IN ('6','7','8')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':전통시장사용분 오류입니다. 관계코드(6,7,8)은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
              /*2012.12.26 추가 종료*/
  
              IF (RS.YEA_FAM_NUM009 > 0
                  OR RS.YEA_FAM_NUM010 > 0)
                AND RS.YEA_FAM_STR001 IN ('6','7','8')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':신용카드 금액 오류입니다. 관계코드(6,7,8)은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF (RS.YEA_FAM_NUM011 > 0
                  OR RS.YEA_FAM_NUM012 > 0)
                AND RS.YEA_FAM_STR001 IN ('6','7','8')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':직불카드 금액 오류입니다. 관계코드(6,7,8)은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*현금영수증(관계코드가 6,7,8 이면 오류)*/
              IF RS.YEA_FAM_NUM013 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':현금영수증 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF RS.YEA_FAM_NUM013 > 0
                AND RS.YEA_FAM_STR001 IN ('6','7','8')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':현금영수증 금액 오류입니다. 관계코드(6,7,8)은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*대중교통(관계코드가 6,7,8 이면 오류) [2013귀속]*/
              IF RS.YEA_FAM_NUM016 < 0
                OR RS.YEA_FAM_NUM017 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':대중교통사용액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              IF (RS.YEA_FAM_NUM016 > 0
                  OR RS.YEA_FAM_NUM017 > 0)
                AND RS.YEA_FAM_STR001 IN ('6','7','8')
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':대중교통사용액 오류입니다. 관계코드(6,7,8)은 입력할 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*기부금 체크 (관계코드 0,3,4,5가 아니면 오류, 정치자금20, 우리사주조합기부금42 은 본인이 아니면 오류, 기본공제대상자 아니면 오류)*/
              IF RS.YEA_FAM_NUM018 < 0
                OR RS.YEA_FAM_NUM019 < 0
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':기부금 금액 오류입니다. 양수만 가능합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
              /*의료비 명세서 합*/
              SELECT NVL(SUM(YEA_MES_NUM002),0) AS YEA_MES_NUM002
                INTO v_YEA_MES_NUM002_AMT
                FROM YEA_MEDISP
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_FAMI_SEQ = RS.YEA_FAMI_SEQ
                 AND NVL(YEA_MES_STR008,0) != '1';	/*[2015귀속]_추가 난임시술비가 아닌것*/
  
              IF v_YEA_MES_CNT > 0
                AND v_YEA_MES_NUM002_AMT != RS.YEA_FAM_NUM005 + RS.YEA_FAM_NUM006
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':의료비 오류입니다. 의료비명세서와 개인별 의료비는 같아야 합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  			  
  			  /*[2015귀속]_추가 난임시술비 명세서 합*/
	          SELECT NVL(SUM(YEA_MES_NUM002),0) AS YEA_MES_NUM002
	            INTO v_YEA_MES_NUM002_AMT_2015
	            FROM YEA_MEDISP
	           WHERE YEA_STD_YY = #YEA_STD_YY#
	             AND YEA_EMP_NO = #YEA_EMP_NO#
	             AND YEA_FAMI_SEQ = RS.YEA_FAMI_SEQ
	             AND NVL(YEA_MES_STR008,0) = '1';
	
	          IF v_YEA_MES_CNT > 0
	            AND v_YEA_MES_NUM002_AMT_2015 != RS.YEA_FAM_NUM022 + RS.YEA_FAM_NUM023
	          THEN
	            RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':난임시술비 오류입니다. 의료비명세서와 개인별 난임시술비는 같아야 합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
	          END IF;
	  			  
	  			  
              /*기부금 명세서 합*/
              SELECT NVL(SUM(YEA_DOS_NUM002),0) AS YEA_DOS_NUM002
                INTO v_YEA_DOS_NUM002_AMT
                FROM YEA_DONASP
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#
                 AND YEA_FAMI_SEQ = RS.YEA_FAMI_SEQ;
  
              IF v_YEA_DOS_CNT > 0
                AND v_YEA_DOS_NUM002_AMT != RS.YEA_FAM_NUM018 + RS.YEA_FAM_NUM019
              THEN
                RAISE_APPLICATION_ERROR(-20000,RS.YEA_FAM_STR003 || ':기부금 오류입니다. 기부금명세서와 개인별 기부금은 같아야 합니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
              END IF;
  
          END LOOP;
  
  
          /*금액 합 구하기*/
          SELECT SUM(NVL(YEA_FAM_NUM001,0) + NVL(YEA_FAM_NUM002,0)) AS INSU_ESUM
                ,SUM(NVL(YEA_FAM_NUM003,0) + NVL(YEA_FAM_NUM004,0)) AS INSU_SUM
                ,SUM( /*장애인 의료비 추가 (우선순위 최상)*/
                    CASE
                        WHEN NVL(YEA_FAM_STR009, '0') >= '1' OR YEA_FAM_STR001 = '0' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN NVL(YEA_FAM_NUM005,0) + NVL(YEA_FAM_NUM006,0) 
                        ELSE 0
                    END
                ) + SUM(NVL(YEA_FAM_NUM022,0) + NVL(YEA_FAM_NUM023,0)) AS MEDI_SSUM    /*[2015귀속]_추가 난임시술비(국세청,기타)*/
                ,SUM( /*장애인 의료비 추가 (우선순위 최상)*/
                    CASE
                        WHEN NVL(YEA_FAM_STR009, '0') >= '1' THEN 0
                        WHEN YEA_FAM_STR001 = '0' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN 0
                        ELSE NVL(YEA_FAM_NUM005,0) + NVL(YEA_FAM_NUM006,0) 
                    END
                ) AS MEDI_DSUM
  
                ,SUM(CASE WHEN YEA_FAM_STR010 = '2' THEN 1 ELSE 0 END) AS EDUC_CNT2
                ,SUM(CASE WHEN YEA_FAM_STR010 = '3' THEN 1 ELSE 0 END) AS EDUC_CNT3
                ,SUM(CASE WHEN YEA_FAM_STR010 = '4' THEN 1 ELSE 0 END) AS EDUC_CNT4
                ,SUM(CASE WHEN YEA_FAM_STR010 = '5' THEN 1 ELSE 0 END) AS EDUC_CNT5
                ,SUM(CASE WHEN YEA_FAM_STR010 = '1' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END) AS EDUC_SUM1
                ,SUM(CASE WHEN YEA_FAM_STR010 = '2' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END) AS EDUC_SUM2
                ,SUM(CASE WHEN YEA_FAM_STR010 = '3' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END) AS EDUC_SUM3
                ,SUM(CASE WHEN YEA_FAM_STR010 = '4' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END) AS EDUC_SUM4
                ,SUM(CASE WHEN YEA_FAM_STR010 = '5' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008,0) ELSE 0 END) AS EDUC_SUM5
                ,SUM(NVL(YEA_FAM_NUM009,0) + NVL(YEA_FAM_NUM010,0)) AS CARD_SUM
                ,SUM(NVL(YEA_FAM_NUM011,0) + NVL(YEA_FAM_NUM012,0)) AS DCAD_SUM
                ,SUM(NVL(YEA_FAM_NUM013,0)) AS CASH_SUM
                ,SUM(NVL(YEA_FAM_NUM014,0) + NVL(YEA_FAM_NUM015,0)) AS MRKT_SUM  /*전통시장*/
                ,SUM(NVL(YEA_FAM_NUM016,0) + NVL(YEA_FAM_NUM017,0)) AS PTRA_SUM  /*대중교통*/
                ,SUM(NVL(YEA_FAM_NUM018,0) + NVL(YEA_FAM_NUM019,0)) AS DONA_SUM  /*기부금*/
                ,SUM(CASE WHEN YEA_FAM_STR005 ='1' AND YEA_FAM_STR001 IN ('4', '8') THEN 1 ELSE 0 END) AS CHLD_CNT  /*자녀수*/
                ,COUNT(CASE WHEN YEA_FAM_STR011 = '1' THEN YEA_FAMI_SEQ END) AS v_CHRE_CNT  /*[2015귀속] 6세이하자녀수*/
				,COUNT(CASE WHEN YEA_FAM_STR012 = '1' THEN YEA_FAMI_SEQ END) AS v_ADPN_CNT  /*[2015귀속] 출산입양수*/                
                ,SUM(NVL(YEA_FAM_NUM020,0) + NVL(YEA_FAM_NUM021,0)) AS INSU_DSUM /*보험료_장애인전용 귀속년도2014년 연말정산 재정산(소급)*/
            INTO
                 v_INSU_ESUM  /*건강고용 보험료*/
                ,v_INSU_SUM
                ,v_MEDI_SSUM  /*의료비_본인ㆍ65세 이상자ㆍ장애인*/
                ,v_MEDI_DSUM
                ,v_EDUC_CNT2
                ,v_EDUC_CNT3
                ,v_EDUC_CNT4
                ,v_EDUC_CNT5
                ,v_EDUC_SUM1
                ,v_EDUC_SUM2
                ,v_EDUC_SUM3
                ,v_EDUC_SUM4
                ,v_EDUC_SUM5
                ,v_CARD_SUM
                ,v_DCAD_SUM
                ,v_CASH_SUM
                ,v_MRKT_SUM  /*전통시장*/
                ,v_PTRA_SUM  /*대중교통*/
                ,v_DONA_SUM  /*기부금*/
                ,v_CHLD_CNT  /*자녀수*/
                ,v_CHRE_CNT  /*[2015귀속] 6세이하자녀수*/
              	,v_ADPN_CNT  /*[2015귀속] 출산입양수*/                
                ,v_INSU_DSUM /*보험료_장애인전용 귀속년도2014년 연말정산 재정산(소급)*/
            FROM YEA_YEFAMI
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
  
  		  /*건강고용보험료체크
	      IF v_INSU_ESUM != r_YEA_INCDEC.YEA_INC_NUM011 + r_YEA_INCDEC.YEA_INC_NUM012 + r_YEA_INCDEC.YEA_INC_NUM013 + r_YEA_INCDEC.YEA_INC_NUM014 THEN
	        RAISE_APPLICATION_ERROR(-20000,'건강·고용 보험료 오류입니다. 부양가족 건강·고용 보험료와 신고서의 건강·고용 보험료를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
	      END IF;
  		  */
  		  	
          /*보험료체크*/
          IF v_INSU_SUM != r_YEA_INCDEC.YEA_INC_NUM052 THEN
            RAISE_APPLICATION_ERROR(-20000,'보험료 오류입니다. 부양가족 보험료와 신고서의 보험료를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;

          /*보험료_장애인전용체크*/
          IF v_INSU_DSUM != r_YEA_INCDEC.YEA_INC_NUM053 THEN
            RAISE_APPLICATION_ERROR(-20000,'장애인전용 보험료 오류입니다. 부양가족 장애인전용 보험료와 신고서의 장애인전용 보험료를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*의료비체크*/
          IF v_MEDI_SSUM != r_YEA_INCDEC.YEA_INC_NUM054 THEN
            RAISE_APPLICATION_ERROR(-20000,'의료비(본인ㆍ65세 이상자ㆍ장애인ㆍ난임시술비) 오류입니다. 부양가족 의료비와 신고서의 의료비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );  /*[2015귀속]_추가 난임시술비*/
          END IF;
  
          IF v_MEDI_DSUM != r_YEA_INCDEC.YEA_INC_NUM055 THEN
            RAISE_APPLICATION_ERROR(-20000,'의료비(그 밖의 공제대상자) 오류입니다. 부양가족 의료비와 신고서의 의료비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*교육비체크*/
          IF v_EDUC_CNT2 != r_YEA_INCDEC.YEA_INC_NUM057 THEN
            RAISE_APPLICATION_ERROR(-20000,'취학전 교육비 오류입니다. 취학전 아동수를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_CNT3 != r_YEA_INCDEC.YEA_INC_NUM059 THEN
            RAISE_APPLICATION_ERROR(-20000,'초중고 교육비 오류입니다. 초중고등학교 학생수를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_CNT4 != r_YEA_INCDEC.YEA_INC_NUM061 THEN
            RAISE_APPLICATION_ERROR(-20000,'대학생 교육비 오류입니다. 대학생수를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_CNT5 != r_YEA_INCDEC.YEA_INC_NUM063 THEN
            RAISE_APPLICATION_ERROR(-20000,'장애인 교육비 오류입니다. 장애인교육비 대상자 수를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_SUM1 != r_YEA_INCDEC.YEA_INC_NUM056 THEN
            RAISE_APPLICATION_ERROR(-20000,'본인 교육비 오류입니다. 부양가족 교육비와 신고서의 교육비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_SUM2 != r_YEA_INCDEC.YEA_INC_NUM058 THEN
            RAISE_APPLICATION_ERROR(-20000,'취학전 교육비 오류입니다. 부양가족 교육비와 신고서의 교육비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_SUM3 != r_YEA_INCDEC.YEA_INC_NUM060 THEN
            RAISE_APPLICATION_ERROR(-20000,'초중고 교육비 오류입니다. 부양가족 교육비와 신고서의 교육비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_SUM4 != r_YEA_INCDEC.YEA_INC_NUM062 THEN
            RAISE_APPLICATION_ERROR(-20000,'대학생 교육비 오류입니다. 부양가족 교육비와 신고서의 교육비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_EDUC_SUM5 != r_YEA_INCDEC.YEA_INC_NUM064 THEN
            RAISE_APPLICATION_ERROR(-20000,'장애인 교육비 오류입니다. 부양가족 교육비와 신고서의 교육비를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
  
          IF v_CARD_SUM != r_YEA_INCDEC.YEA_INC_NUM034 THEN    /*2012.12.26 변경*/
            RAISE_APPLICATION_ERROR(-20000,'신용카드 오류입니다. 부양가족 신용카드와 신고서의 신용카드를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DCAD_SUM != r_YEA_INCDEC.YEA_INC_NUM035 THEN
            RAISE_APPLICATION_ERROR(-20000,'직불카드 오류입니다. 부양가족 직불카드와 신고서의 직불카드를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_MRKT_SUM != r_YEA_INCDEC.YEA_INC_NUM037 THEN
            RAISE_APPLICATION_ERROR(-20000,'전통시장 사용금액 오류입니다. 부양가족 전통시장 사용금액과 신고서의 전통시장 사용금액을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
          /*2012.12.26 추가 종료*/
  
          /*[2013귀속] 추가*/
          IF v_PTRA_SUM != r_YEA_INCDEC.YEA_INC_NUM038 THEN
            RAISE_APPLICATION_ERROR(-20000,'대중교통 사용금액 오류입니다. 부양가족 대중교통 사용금액과 신고서의 대중교통 사용금액을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_CASH_SUM != r_YEA_INCDEC.YEA_INC_NUM036 THEN
            RAISE_APPLICATION_ERROR(-20000,'현금영수증 오류입니다. 부양가족 현금영수증 금액과 신고서의 현금영수증 금액을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
  
          IF v_DONA_SUM != r_YEA_INCDEC.YEA_INC_NUM044 + r_YEA_INCDEC.YEA_INC_NUM065 + r_YEA_INCDEC.YEA_INC_NUM066 + r_YEA_INCDEC.YEA_INC_NUM067 + r_YEA_INCDEC.YEA_INC_NUM068 THEN   /*[2015귀속]_추가 정치자금기부금 10만원이하*/
            RAISE_APPLICATION_ERROR(-20000,'기부금 오류입니다. 부양가족 기부금과 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*기부유형별 금액*/
          SELECT SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 ELSE 0 END) AS DONA_ALLX
                ,SUM(CASE WHEN YEA_DOS_STR006 = '20' THEN YEA_DOS_NUM002 ELSE 0 END) AS DONA_POLI
                ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 ELSE 0 END) AS DONA_30PC
                ,SUM(CASE WHEN YEA_DOS_STR006 = '40' OR YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 ELSE 0 END) AS DONA_APPO
            INTO
                 v_DONA_ALLX
                ,v_DONA_POLI
                ,v_DONA_30PC
                ,v_DONA_APPO
            FROM YEA_DONASP
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
          /*기부금조정명세 체크*/
          SELECT SUM(CASE WHEN YEA_DOA_STR001 = '10' THEN YEA_DOA_NUM001 ELSE 0 END) AS DONA_10
                ,SUM(CASE WHEN YEA_DOA_STR001 = '20' THEN YEA_DOA_NUM001 ELSE 0 END) AS DONA_20
                ,SUM(CASE WHEN YEA_DOA_STR001 = '42' THEN YEA_DOA_NUM001 ELSE 0 END) AS DONA_42
                ,SUM(CASE WHEN YEA_DOA_STR001 = '40' THEN YEA_DOA_NUM001 ELSE 0 END) AS DONA_40
                ,SUM(CASE WHEN YEA_DOA_STR001 = '41' THEN YEA_DOA_NUM001 ELSE 0 END) AS DONA_41
            INTO
                 v_DONA_10
                ,v_DONA_20
                ,v_DONA_42
                ,v_DONA_40
                ,v_DONA_41
            FROM YEA_DONAAD
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#
             AND YEA_DOA_STR002 = SUBSTR(#YEA_STD_YY#,1,4);
  
  
          IF v_DONA_ALLX != r_YEA_INCDEC.YEA_INC_NUM067 THEN
            RAISE_APPLICATION_ERROR(-20000,'전액공제 기부금 오류입니다. 기부금명세서와 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_ALLX != v_DONA_10 THEN
            RAISE_APPLICATION_ERROR(-20000,'법정기부금 오류입니다. 기부명세와 기부금조정명세를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_POLI != r_YEA_INCDEC.YEA_INC_NUM065 + r_YEA_INCDEC.YEA_INC_NUM066 THEN       /*[2015귀속]_추가 정치자금기부금10만원이하*/
            RAISE_APPLICATION_ERROR(-20000,'정치자금 기부금 오류입니다. 기부금명세서와 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_POLI != v_DONA_20 THEN
            RAISE_APPLICATION_ERROR(-20000,'정치자금 기부금 오류입니다. 기부명세와 기부금조정명세를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF r_YEA_INCDEC.YEA_INC_NUM066>0 AND r_YEA_INCDEC.YEA_INC_NUM065 != 100000 THEN
            RAISE_APPLICATION_ERROR(-20000,'정치자금기부금은 세액공제분을 제외하고 입력해 주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_30PC != r_YEA_INCDEC.YEA_INC_NUM044 THEN
            RAISE_APPLICATION_ERROR(-20000,'30%한도적용 기부금 오류입니다. 기부금명세서와 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_30PC != v_DONA_42 THEN
            RAISE_APPLICATION_ERROR(-20000,'우리사주조합기부금 오류입니다. 기부명세와 기부금조정명세를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_APPO != r_YEA_INCDEC.YEA_INC_NUM068 THEN
            RAISE_APPLICATION_ERROR(-20000,'지정 기부금 오류입니다. 기부금명세서와 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_APPO != v_DONA_40 + v_DONA_41 THEN
            RAISE_APPLICATION_ERROR(-20000,'지정기부금 오류입니다. 기부명세와 기부금조정명세를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*IF v_DONA_RELI != r_YEA_INCDEC.YEA_INC_NUM069 THEN
            RAISE_APPLICATION_ERROR(-20000,'종교단체 기부금 오류입니다. 기부금명세서와 신고서의 기부금을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_DONA_RELI != v_DONA_41 THEN
            RAISE_APPLICATION_ERROR(-20000,'종교단체 기부금 오류입니다. 기부명세와 기부금조정명세를 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
          */
          /*연금.저축명세 체크*/
          SELECT SUM(CASE WHEN YEA_PEN_STR001 = '11' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_11  /*연금_근로자퇴직급여*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '12' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_12  /*연금_과학기술인공제*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '21' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_21  /*개인연금저축*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '22' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_22  /*연금저축*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '31' AND NVL(YEA_PEN_STR005,0) != '1' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_31 /*[2015귀속]_변경 주택마련저축(청약저축_2014.12.31 이전 가입분)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '32' AND NVL(YEA_PEN_STR005,0) != '1' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_32 /*[2015귀속]_변경 주택마련저축(주택청약종합저축_2014.12.31 이전 가입분)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '34' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_34  /*주택마련저축(근로자주택마련저축)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '51' THEN YEA_PEN_NUM001 ELSE 0 END) AS PESA_51  /*장기집합투자증권저축*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '31' AND NVL(YEA_PEN_STR005,0) = '1' THEN YEA_PEN_NUM001 ELSE 0 END) AS v_PESA_31_2015 /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후 가입분)*/
              	,SUM(CASE WHEN YEA_PEN_STR001 = '32' AND NVL(YEA_PEN_STR005,0) = '1' THEN YEA_PEN_NUM001 ELSE 0 END) AS v_PESA_32_2015 /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후 가입분)*/
            INTO
                 v_PESA_11
                ,v_PESA_12
                ,v_PESA_21
                ,v_PESA_22
                ,v_PESA_31
                ,v_PESA_32
                ,v_PESA_34
                ,v_PESA_51
                ,v_PESA_31_2015    /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후 가입분)*/
              	,v_PESA_32_2015    /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후 가입분)*/
            FROM YEA_PENSAV
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
  
          IF v_PESA_11 != (r_YEA_INCDEC.YEA_INC_NUM050) THEN
            RAISE_APPLICATION_ERROR(-20000,'퇴직연금(근로자퇴직급여) 오류입니다. 연금·저축명세서와 신고서의 퇴직연금(근로자퇴직급여보장법)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_PESA_12 != (r_YEA_INCDEC.YEA_INC_NUM049) THEN
            RAISE_APPLICATION_ERROR(-20000,'퇴직연금(과학기술인공제회) 오류입니다. 연금·저축명세서와 신고서의 퇴직연금(과학기술인공제)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_PESA_21 != r_YEA_INCDEC.YEA_INC_NUM022 THEN
            RAISE_APPLICATION_ERROR(-20000,'연금저축(개인연금저축) 오류입니다. 연금·저축명세서와 신고서의 연금저축공제(개인연금저축)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_PESA_22 != r_YEA_INCDEC.YEA_INC_NUM051 THEN
            RAISE_APPLICATION_ERROR(-20000,'연금저축(연금저축) 오류입니다. 연금·저축명세서와 신고서의 연금저축공제(연금저축)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*[2015귀속]_변경 주택마련저축(청약저축_2014.12.31 이전 가입분)*/
	      IF v_PESA_31 != r_YEA_INCDEC.YEA_INC_NUM024 THEN
    	    RAISE_APPLICATION_ERROR(-20000,'주택마련저축(청약저축_2014.12.31 이전 가입분) 오류입니다. 연금·저축명세서와 신고서의 주택마련저축 소득공제(청약저축_2014.12.31 이전 가입분)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*[2015귀속]_변경 주택마련저축(주택청약종합저축_2014.12.31 이전 가입분)*/
          IF v_PESA_32 != r_YEA_INCDEC.YEA_INC_NUM026 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택마련저축(주택청약종합저축_2014.12.31 이전 가입분) 오류입니다. 연금·저축명세서와 신고서의 주택마련저축 소득공제(주택청약종합저축_2014.12.31 이전 가입분)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  		  
  		  /*[2015귀속]_추가 주택마련저축(청약저축_2015.01.01 이후 가입분)*/
          IF v_PESA_31_2015 != r_YEA_INCDEC.YEA_INC_NUM081 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택마련저축(청약저축_2015.01.01 이후 가입분) 오류입니다. 연금·저축명세서와 신고서의 주택마련저축 소득공제(청약저축_2015.01.01 이후 가입분)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;

          /*[2015귀속]_추가 주택마련저축(주택청약종합저축_2015.01.01 이후 가입분)*/
          IF v_PESA_32_2015 != r_YEA_INCDEC.YEA_INC_NUM082 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택마련저축(주택청약종합저축_2015.01.01 이후 가입분) 오류입니다. 연금·저축명세서와 신고서의 주택마련저축 소득공제(주택청약종합저축_2015.01.01 이후 가입분)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
        
          /*20110211 120만원 한도수정*/
          /*[2015귀속]_변경 주택청약종합저축 한도변경(240만원) 및 2015.01.01이후분 포함*/
          IF r_YEA_INCDEC.YEA_INC_NUM026 + r_YEA_INCDEC.YEA_INC_NUM082 > 2400000 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택마련저축(주택청약종합저축) 오류입니다. 주택청약종합저축은 240만원을 초과할수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_PESA_34 != r_YEA_INCDEC.YEA_INC_NUM025 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택마련저축(근로자주택마련저축) 오류입니다. 연금·저축명세서와 신고서의 주택마련저축 소득공제(근로자주택마련저축)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_PESA_51 != r_YEA_INCDEC.YEA_INC_NUM047 THEN
            RAISE_APPLICATION_ERROR(-20000,'장기집합투자증권저축 오류입니다. 연금·저축명세서와 신고서의 장기집합투자증권저축을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*세대주 체크*/
          /*IF NVL(r_YEA_INCDEC.YEA_INC_STR024,'0') != '1' THEN  *//*1217_3*/
  
            /*2011년 귀속 변경*/
            /*
            IF r_YEA_INCDEC.YEA_INC_NUM015 != 0 OR r_YEA_INCDEC.YEA_INC_NUM016 != 0 THEN
                RAISE_APPLICATION_ERROR(-20000,'주택임차차입금상환 공제는 세대주만 해당됩니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
            END IF;
  			*/
  			
            /* 2014년 없어짐
            IF r_YEA_INCDEC.YEA_INC_NUM074 != 0 THEN
                RAISE_APPLICATION_ERROR(-20000,'월세액 공제는 세대주만 해당됩니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
            END IF;
            */
            
            /*[2015귀속]_추가 청약저축,주택청약종합저축(2015.01.01이후가입분)*/  
            /*IF r_YEA_INCDEC.YEA_INC_NUM024 != 0 OR r_YEA_INCDEC.YEA_INC_NUM025 != 0 OR r_YEA_INCDEC.YEA_INC_NUM026 != 0 OR r_YEA_INCDEC.YEA_INC_NUM081 != 0 OR r_YEA_INCDEC.YEA_INC_NUM082 != 0 THEN 
                RAISE_APPLICATION_ERROR(-20000,'주택마련저축 공제는 세대주만 해당됩니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
            END IF;
            */  
          /*END IF;*/
  
          SELECT SUM(NVL(YEA_RT1_NUM001, 0)) AS YEA_RT1_NUM001
                ,SUM(NVL(YEA_RT2_NUM002, 0)) AS YEA_RT2_NUM002
            INTO
                 v_MREN_DEDU
                ,v_SEND_INTE
            FROM (
                  SELECT SUB1.YEA_RT1_NUM001
                        ,0 AS YEA_RT2_NUM002
                    FROM YEA_RENTA1 SUB1
                   WHERE SUB1.YEA_STD_YY = #YEA_STD_YY#
                     AND SUB1.YEA_EMP_NO = #YEA_EMP_NO#
               UNION ALL
                  SELECT 0 AS YEA_RT1_NUM001
                        ,SUB2.YEA_RT2_NUM002
                    FROM YEA_RENTA2 SUB2
                   WHERE SUB2.YEA_STD_YY = #YEA_STD_YY#
                     AND SUB2.YEA_EMP_NO = #YEA_EMP_NO#
                 );
  
          IF v_MREN_DEDU != r_YEA_INCDEC.YEA_INC_NUM074 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택자금 월세액 오류입니다. 월세주택임차차입금명세서와 신고서의 주택자금 월세액을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          IF v_SEND_INTE != r_YEA_INCDEC.YEA_INC_NUM016 THEN
            RAISE_APPLICATION_ERROR(-20000,'주택임차차임금(거주자차입) 오류입니다. 월세주택임차차입금명세서와  신고서의 주택임차차임금(거주자차입)을 확인하세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
  
          /*총소득*/
          SELECT
             NVL(A.PAYX_TAMT,0) + NVL(B.PAYX_TAMT,0)
          INTO
             v_PAYX_TAMT
          FROM (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,SUM(NVL(YEA_PAY_NUM001,0) + NVL(YEA_PAY_NUM002,0) + NVL(YEA_PAY_NUM003,0) + NVL(YEA_PAY_NUM004,0) + NVL(YEA_PAY_NUM005,0)+ NVL(YEA_PAY_NUM006,0) + NVL(YEA_PAY_NUM007,0)) AS PAYX_TAMT    /*현근무지*/
                  FROM YEA_PAYDTL
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              GROUP BY YEA_STD_YY, YEA_EMP_NO
               ) A
     LEFT JOIN (
                SELECT YEA_STD_YY
                      ,YEA_EMP_NO
                      ,SUM(NVL(YEA_BFW_NUM001,0) + NVL(YEA_BFW_NUM002,0) + NVL(YEA_BFW_NUM003,0) + NVL(YEA_BFW_NUM004,0)+ NVL(YEA_BFW_NUM005,0) + NVL(YEA_BFW_NUM006,0)) AS PAYX_TAMT   /*종근무지*/
                  FROM YEA_BFWORK
                 WHERE YEA_STD_YY = #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#
              GROUP BY YEA_STD_YY, YEA_EMP_NO
               ) B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO;
  
          IF v_PAYX_TAMT > 70000000 AND r_YEA_INCDEC.YEA_INC_NUM074 != 0 THEN
              RAISE_APPLICATION_ERROR(-20000,'월세액 공제는 총급여 7000만원 이하인 근로소득자만 해당됩니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*전액공제의료비*/
          v_MEDI_DEDU := r_YEA_INCDEC.YEA_INC_NUM054
                           + CASE WHEN
                              r_YEA_INCDEC.YEA_INC_NUM055 - (TRUNC(v_PAYX_TAMT * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C') ,0))<0					/*20160511 세액감면 추가로 000050->000060으로변경*/
                             THEN r_YEA_INCDEC.YEA_INC_NUM055 - (TRUNC(v_PAYX_TAMT * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C'),0)) ELSE 0 END;	/*20160511 세액감면 추가로 000050->000060으로변경*/
  
          IF v_MEDI_DEDU < 0  THEN
            v_MEDI_DEDU := 0;
          END IF;
  
          /*기타의료비.*/
          v_MEDI_DEDU := v_MEDI_DEDU + SF_YEA_GET_MIN(r_YEA_INCDEC.YEA_INC_NUM055 - (TRUNC(v_PAYX_TAMT * SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','C'),0)), SF_YEA_YETABS(#YEA_STD_YY#,'000060','0040','B'));	/*20160511 세액감면 추가로 000050->000060으로변경*/
  
          IF v_MEDI_DEDU >= 2000000 AND  v_YEA_MES_CNT = 0 THEN
              RAISE_APPLICATION_ERROR(-20000,'의료비 공제금액이 200만원 이상입니다. 의료비명세서를 작성해주세요! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
  
          /*20110211 장기주택저당차입금이자상환액과 주택차입금세액공제는 동시에 공제 받을 수 없습니다*/
          IF r_YEA_INCDEC.YEA_INC_NUM017 + r_YEA_INCDEC.YEA_INC_NUM018 + r_YEA_INCDEC.YEA_INC_NUM019 + r_YEA_INCDEC.YEA_INC_NUM020 + r_YEA_INCDEC.YEA_INC_NUM021 + r_YEA_INCDEC.YEA_INC_NUM077 + r_YEA_INCDEC.YEA_INC_NUM078 + r_YEA_INCDEC.YEA_INC_NUM079 + r_YEA_INCDEC.YEA_INC_NUM080 >0 AND r_YEA_INCDEC.YEA_INC_NUM073 > 0 THEN  /*2012.12.26 변경*/ /*[2015귀속]_추가 2015이후장기주택추가*/
              RAISE_APPLICATION_ERROR(-20000,'장기주택저당차입금이자상환액과 주택차입금세액공제는 동시에 공제 받을 수 없습니다! (사원번호 : ' || v_YEA_EMP_NO || '성명 : ' || v_YEA_EMP_NM || ')' );
          END IF;
          /*20110211 장기주택저당차입금이자상환액과 주택차입금세액공제는 동시에 공제 받을 수 없습니다*/
  
          IF #YEA_PRC_STR002# <> '9' THEN
            UPDATE YEA_INCDEC
               SET YEA_INC_STR025 = '1'                 /*입력마감여부*/
                  ,YEA_UPD_DATE = SYSDATE               /*수정일*/
                  ,YEA_UPD_USER_ID = #UPDT_USID#  /*수정자*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
          END IF;
          
          /*자녀수*/
          UPDATE YEA_INCDEC
             SET YEA_INC_NUM048 = v_CHLD_CNT
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  			
  		  /*[2015귀속] 6세이하자녀수*/
		  UPDATE YEA_INCDEC
             SET YEA_INC_NUM088 = v_CHRE_CNT
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;

		  /*[2015귀속] 출산입양자수*/
		  UPDATE YEA_INCDEC
             SET YEA_INC_NUM089 = v_ADPN_CNT
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;		  
  		  
          /*명세서 제출여부*/
          SELECT COUNT(*)
            INTO v_ROWCNT
            FROM YEA_RENTA1
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
          IF v_ROWCNT > 0 THEN
             UPDATE YEA_INCDEC
                SET YEA_INC_STR021 = '1'   /*월세액명세서제출여부*/
              WHERE YEA_STD_YY = #YEA_STD_YY#
                AND YEA_EMP_NO = #YEA_EMP_NO#;
          ELSE
             UPDATE YEA_INCDEC
                SET YEA_INC_STR021 = '0'   /*월세액명세서제출여부*/
              WHERE YEA_STD_YY = #YEA_STD_YY#
                AND YEA_EMP_NO = #YEA_EMP_NO#;
          END IF;
  
          SELECT COUNT(*)
            INTO v_ROWCNT
            FROM YEA_MEDISP
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
          IF v_ROWCNT > 0 THEN
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR022 = '1'   /*의료비명세서 제출여부 1217_1*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          ELSE
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR022 = '0'   /*의료비명세서 제출여부 1217_1*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          END IF;
  
          SELECT COUNT(*)
            INTO v_ROWCNT
            FROM YEA_DONASP
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
          IF v_ROWCNT > 0 THEN
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR023 = '1'   /*기부금명세서제출여부 1217_2*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          ELSE
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR023 = '0'   /*기부금명세서제출여부 1217_2*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          END IF;
  
          SELECT COUNT(*)
            INTO v_ROWCNT
            FROM YEA_PENSAV
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
          IF v_ROWCNT > 0 THEN
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR020 = '1'   /*연금저축명세서제출여부*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          ELSE
              UPDATE YEA_INCDEC
                 SET YEA_INC_STR020 = '0'   /*연금저축명세서제출여부*/
               WHERE YEA_STD_YY = #YEA_STD_YY#
                 AND YEA_EMP_NO = #YEA_EMP_NO#;
          END IF;
  
          SELECT NVL(MAX(B.YEA_BIZ_NAME),' ') AS BEFO_FIRM
                ,NVL(MAX(B.YEA_BIZ_NO),' ') AS BEFO_BUSI
                ,NVL(SUM(NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0) + NVL(A.YEA_BFW_NUM003,0)
                 + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0) + NVL(YEA_BFW_NUM006, 0)),0)
                ,NVL(SUM(A.YEA_BFW_NUM010),0)
                ,COUNT(A.YEA_EMP_NO)
            INTO v_BEFO_FIRM, v_BEFO_BUSI, v_BEFO_PAYX, v_BEFO_ITAX, v_ROWCNT
            FROM YEA_BFWORK A
                ,(
                  SELECT YEA_BFW_STR002 AS YEA_BIZ_NAME, YEA_BIZ_NO AS YEA_BIZ_NO
                    FROM YEA_BFWORK
                   WHERE YEA_STD_YY = #YEA_STD_YY#
                     AND YEA_EMP_NO = #YEA_EMP_NO#
                     AND YEA_BFW_STR004 = (
                                           SELECT MAX(YEA_BFW_STR004)
                                             FROM YEA_BFWORK
                                            WHERE YEA_STD_YY = #YEA_STD_YY#
                                              AND YEA_EMP_NO = #YEA_EMP_NO#
                                           )
                 ) B
           WHERE A.YEA_STD_YY = #YEA_STD_YY#
             AND A.YEA_EMP_NO = #YEA_EMP_NO#;
  
          UPDATE YEA_INCDEC
             SET YEA_INC_STR016 = TRIM(v_BEFO_FIRM) /*12_17_4*/
                ,YEA_INC_STR017 = TRIM(v_BEFO_BUSI) /*12_17_4*/
                ,YEA_INC_NUM075 = v_BEFO_PAYX
                ,YEA_INC_NUM076 = v_BEFO_ITAX
                ,YEA_INC_STR018 = DECODE(v_ROWCNT,0,'0','1')
           WHERE YEA_STD_YY = #YEA_STD_YY#
             AND YEA_EMP_NO = #YEA_EMP_NO#;
  
        /*표준세액공제여부에 따라..*/ 
        FOR RS IN (
            SELECT A.YEA_EMP_NO
              FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#, #YEA_STD_YY# || '1231')) A
             WHERE A.YEA_STANTAX_YN = '1' 
        ) LOOP      
            /*표준세액공제 처리*/
            /*소득공제 신고서 UPDATE*/
            UPDATE YEA_INCDEC
               SET YEA_INC_NUM011 = 0    /*국민건강보험전근무지*/
                  ,YEA_INC_NUM012 = 0    /*국민건강보험현근무지*/
                  ,YEA_INC_NUM013 = 0    /*고용보험전근무지*/
                  ,YEA_INC_NUM014 = 0    /*고용보험현근무지*/
                  ,YEA_INC_NUM015 = 0    /*주택임차차입금_대출기관차입*/
                  ,YEA_INC_NUM016 = 0    /*주택임차차입금_거주자차입*/
                  ,YEA_INC_NUM017 = 0    /*장기주택저당차입금_2011년이전(15년미만)*/
                  ,YEA_INC_NUM018 = 0    /*장기주택저당차입금 _2011년이전(15년~29년)*/
                  ,YEA_INC_NUM019 = 0    /*장기주택저당차입금_2011년이전(30년이상)*/
                  ,YEA_INC_NUM020 = 0    /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                  ,YEA_INC_NUM021 = 0    /*장기주택저당차입금_2012년이후(기타대출)*/
                  ,YEA_INC_NUM052 = 0    /*보험료_보장성*/
                  ,YEA_INC_NUM053 = 0    /*보험료_장애인전용보장성*/
                  ,YEA_INC_NUM054 = 0    /*의료비_본인ㆍ65세 이상자ㆍ장애인*/
                  ,YEA_INC_NUM055 = 0    /*의료비_그 밖의 공제대상자*/
                  ,YEA_INC_NUM056 = 0    /*교육비_소득자본인*/
                  ,YEA_INC_NUM057 = 0    /*교육비_취학전 아동 수*/
                  ,YEA_INC_NUM058 = 0    /*교육비_취학전 아동*/
                  ,YEA_INC_NUM059 = 0    /*교육비_초·중·고등학교 학생 수*/
                  ,YEA_INC_NUM060 = 0    /*교육비_초·중·고등학교*/
                  ,YEA_INC_NUM061 = 0    /*교육비_대학생 수*/
                  ,YEA_INC_NUM062 = 0    /*교육비_대학생*/
                  ,YEA_INC_NUM063 = 0    /*교육비_장애인 수*/
                  ,YEA_INC_NUM064 = 0    /*교육비_장애인*/
                  ,YEA_INC_NUM067 = 0    /*법정기부금(당해)*/
                  ,YEA_INC_NUM068 = 0    /*지정기부금(당해)*/
                  ,YEA_INC_NUM074 = 0    /*월세세액공제*/
                  ,YEA_INC_NUM077 = 0    /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이면서,비거치)*/
                  ,YEA_INC_NUM078 = 0    /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이거나,비거치)*/
                  ,YEA_INC_NUM079 = 0    /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(기타대출)*/
                  ,YEA_INC_NUM080 = 0    /*[2015귀속]_추가 장기주택저당차입금_2015년이후_10~15년(고정금리이거나,비거치)*/ 
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
    
            /*의료비 삭제*/
            DELETE
              FROM YEA_MEDISP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
    
            /*기부금 명세 삭제*/
            DELETE
              FROM YEA_DONASP
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#
               AND YEA_DOS_STR006 IN ('10', '31', '40', '41');
    
            /*월세액 삭제*/
            DELETE
              FROM YEA_RENTA1
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
    
            DELETE
              FROM YEA_RENTA2
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
    
            /*가족사항 탭 업데이트*/
            UPDATE YEA_YEFAMI
               SET YEA_FAM_NUM001 = 0
                  ,YEA_FAM_NUM002 = 0
                  ,YEA_FAM_NUM003 = 0
                  ,YEA_FAM_NUM004 = 0
                  ,YEA_FAM_NUM005 = 0
                  ,YEA_FAM_NUM006 = 0
                  ,YEA_FAM_NUM007 = 0
                  ,YEA_FAM_NUM008 = 0
                  ,YEA_FAM_STR010 = 0
                  ,YEA_FAM_NUM020 = 0
                  ,YEA_FAM_NUM021 = 0
                  ,YEA_FAM_NUM022 = 0 /*[2015귀속]_추가 난임시술비_국세청*/
                  ,YEA_FAM_NUM023 = 0 /*[2015귀속]_추가 난임시술비_기타*/
             WHERE YEA_STD_YY = #YEA_STD_YY#
               AND YEA_EMP_NO = #YEA_EMP_NO#;
                                                        
        END LOOP;
                           
    END;    
    ]]>	
	</update>         
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 확정 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC04" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC04.연말정산처리 확정 처리 */
		v_ROWCNT INT;
	BEGIN
		
		SELECT COUNT(*) 
		  INTO v_ROWCNT
          FROM YEA_YEPROC
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
		
		IF v_ROWCNT = 0 THEN
			RAISE_APPLICATION_ERROR(-20000, '연말정산 처리를 하지 않았습니다! (사번 : ' || #YEA_EMP_NO# || ')'); 
        END IF;
		
		UPDATE YEA_YEPROC
           SET YEA_PRC_STR001 = '1'
              ,YEA_PRC_STR002 = #YEA_PRC_STR002#
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#;
		
	END;
    ]]>	
	</update>  
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 연금저축명세->>소득공제신고서에 반영 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC05" parameterClass="hashmap">
    <![CDATA[
        UPDATE YEA_INCDEC A     /* YEAA0070_2015.PROC05.연말정산처리 연금저축명세->>소득공제신고서에 반영 처리 */
           SET (YEA_INC_NUM049, YEA_INC_NUM050, YEA_INC_NUM022, YEA_INC_NUM051, YEA_INC_NUM024, YEA_INC_NUM026, YEA_INC_NUM025, YEA_INC_NUM047, YEA_INC_NUM081, YEA_INC_NUM082) = (			 /*[2015귀속]_추가 청약저축,주택청약종합저축(2015.01.01이후가입분)*/
              SELECT
                 SUM(CASE WHEN YEA_PEN_STR001 = '12' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM049(과학기술인공제)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '11' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM050(「근로자퇴직급여 보장법」에 따른 퇴직연금)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '21' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM022(개인연금저축(2000년 이전 가입))*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '22' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM051(연금저축)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '31' AND NVL(YEA_PEN_STR005,0) != '1' THEN YEA_PEN_NUM001 ELSE 0 END)   /*[2015귀속_수정]YEA_INC_NUM024(청약저축2014.12.31 이전 가입분)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '32' AND NVL(YEA_PEN_STR005,0) != '1' THEN YEA_PEN_NUM001 ELSE 0 END)   /*[2015귀속_수정]YEA_INC_NUM026(주택청약종합저축2014.12.31 이전 가입분)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '34' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM025(근로자주택마련저축)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '51' THEN YEA_PEN_NUM001 ELSE 0 END)   /*YEA_INC_NUM047(장기집합투자증권저축)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '31' AND NVL(YEA_PEN_STR005,0) = '1' THEN YEA_PEN_NUM001 ELSE 0 END)   /*[2015귀속]YEA_INC_NUM081(청약저축2015.01.01 이후 가입분)*/
                ,SUM(CASE WHEN YEA_PEN_STR001 = '32' AND NVL(YEA_PEN_STR005,0) = '1' THEN YEA_PEN_NUM001 ELSE 0 END)   /*[2015귀속]YEA_INC_NUM082(주택청약종합저축2015.01.01 이후 가입분)*/
              FROM YEA_PENSAV B
              WHERE YEA_STD_YY = #YEA_STD_YY#
                AND YEA_EMP_NO = #YEA_EMP_NO#
            )
          WHERE A.YEA_STD_YY = #YEA_STD_YY#
            AND A.YEA_EMP_NO = #YEA_EMP_NO#
    ]]>	
	</update>       
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 기부금명세->>소득공제신고서에 반영 처리
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC06" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC06.연말정산처리 기부금명세->>소득공제신고서에 반영 처리 */
    	
        v_YEA_INC_NUM065 YEA_INCDEC.YEA_INC_NUM065%TYPE;  /*[2015귀속]_로직변경 정치자금기부금10만원이하*/
        v_YEA_INC_NUM066 YEA_INCDEC.YEA_INC_NUM066%TYPE;  /*[2015귀속]_로직변경 정치자금기부금10만원초과*/
        v_YEA_DOS_NUM002 YEA_DONASP.YEA_DOS_NUM002%TYPE;  /*[2015귀속]_로직변경 정치자금기부금총금액*/
    
    BEGIN
    	
    	v_YEA_DOS_NUM002 := 0;	/*[2015귀속]_정치자금기부금총금액*/
    	
          /*가족사항update*/
          UPDATE YEA_YEFAMI A
           SET (YEA_FAM_NUM018, YEA_FAM_NUM019) = (
                SELECT
                     SUM(CASE WHEN YEA_DOS_STR001 = '1' THEN YEA_DOS_NUM002 ELSE 0 END)
                    ,SUM(CASE WHEN YEA_DOS_STR001 != '1' THEN YEA_DOS_NUM002 ELSE 0 END)
                  FROM YEA_DONASP B
                 WHERE A.YEA_STD_YY = B.YEA_STD_YY
                   AND A.YEA_EMP_NO = B.YEA_EMP_NO
                   AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
            )
        WHERE A.YEA_STD_YY = #YEA_STD_YY#
          AND A.YEA_EMP_NO = #YEA_EMP_NO#;
		
		/*[2015귀속]_로직변경 정치기부금10만원이하,정치기부금10만원초과*/
		BEGIN
	        SELECT SUM(YEA_DOS_NUM002)
	          INTO v_YEA_DOS_NUM002
	          FROM YEA_DONASP
	         WHERE YEA_STD_YY = #YEA_STD_YY#
	           AND YEA_EMP_NO = #YEA_EMP_NO#
	           AND YEA_DOS_STR006 = '20';
	
	        EXCEPTION WHEN NO_DATA_FOUND THEN
	          v_YEA_DOS_NUM002 := 0;
	    END;

        IF v_YEA_DOS_NUM002 >= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','C') THEN     /*정치자금기부금이 10만원 이상일경우 정기기부금_10만원이하는 10만원 */	/*20160511 10만원하드코딩 셋팅값으로 변경*/
          v_YEA_INC_NUM065 := SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','C');			/*20160511 10만원하드코딩 셋팅값으로 변경*/
        ELSIF v_YEA_DOS_NUM002 < SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','C') THEN	/*20160511 10만원하드코딩 셋팅값으로 변경*/
          v_YEA_INC_NUM065 := NVL(v_YEA_DOS_NUM002,0);
        ELSE
          v_YEA_INC_NUM065 := 0;
        END IF ;

        IF v_YEA_INC_NUM065 >= SF_YEA_YETABS(#YEA_STD_YY#,'000060','0060','C') THEN     /*정치자금기부금이 10만원 이상일경우 정치기부금_10만원초과는 10만원제외하고 나머지금액*/	/*20160511 10만원하드코딩 셋팅값으로 변경*/
          v_YEA_INC_NUM066 := NVL(v_YEA_DOS_NUM002,0) - NVL(v_YEA_INC_NUM065,0);
        ELSE
          v_YEA_INC_NUM066 := 0;
        END IF;

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM065 = v_YEA_INC_NUM065
              ,YEA_INC_NUM066 = v_YEA_INC_NUM066
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_로직변경 정치기부금10만원이하,정치기부금10만원초과끝*/
		
        UPDATE YEA_INCDEC A		/*[2015귀속]_로직변경 정치기부금제외*/
           SET (YEA_INC_NUM067, YEA_INC_NUM044, YEA_INC_NUM068) = (
                SELECT                     
                     NVL(YEA_INC_NUM067,0)
                    ,NVL(YEA_INC_NUM044,0)
                    ,NVL(YEA_INC_NUM068,0)
              FROM (
                SELECT                    
                     SUM(CASE WHEN YEA_DOS_STR006 = '10' THEN YEA_DOS_NUM002 ELSE 0 END) AS YEA_INC_NUM067
                    ,SUM(CASE WHEN YEA_DOS_STR006 = '42' THEN YEA_DOS_NUM002 ELSE 0 END) AS YEA_INC_NUM044
                    ,SUM(CASE WHEN YEA_DOS_STR006 = '40' OR YEA_DOS_STR006 = '41' THEN YEA_DOS_NUM002 ELSE 0 END) AS YEA_INC_NUM068
                FROM YEA_DONASP B
                WHERE YEA_STD_YY = #YEA_STD_YY#
                  AND YEA_EMP_NO = #YEA_EMP_NO#
              )
            )
          WHERE A.YEA_STD_YY = #YEA_STD_YY#
            AND A.YEA_EMP_NO = #YEA_EMP_NO#;

        /*조정명세*/
        DELETE FROM YEA_DONAAD
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_DOA_STR002 = SUBSTR(#YEA_STD_YY#,1,4);

        INSERT INTO YEA_DONAAD (
               YEA_STD_YY      /*기준년월*/
              ,YEA_EMP_NO      /*사원번호*/
              ,YEA_DONA_SEQ    /*기부금순번*/
              ,YEA_DOA_STR001  /*기부유형코드[DONA_TYPE]*/
              ,YEA_DOA_STR002  /*기부년도*/
              ,YEA_DOA_NUM001  /*기부금*/
              ,YEA_DOA_NUM002  /*기부금기공제액*/
              ,YEA_DOA_NUM003  /*기부금공제대상액*/
              ,YEA_DOA_NUM004  /*기부금공제액*/
              ,YEA_DOA_NUM005  /*기부금소멸액*/
              ,YEA_DOA_NUM006  /*기부금이월액*/
              ,YEA_INS_DATE    /*등록일시*/
              ,YEA_INS_USER_ID /*등록자*/
              ,YEA_UPD_DATE    /*수정일시*/
              ,YEA_UPD_USER_ID /*수정자*/
              )
       SELECT  YEA_STD_YY
              ,YEA_EMP_NO
              ,(SELECT NVL(MAX(YEA_DONA_SEQ),0) FROM YEA_DONAAD WHERE YEA_STD_YY = #YEA_STD_YY# AND YEA_EMP_NO = #YEA_EMP_NO#) + ROW_NUMBER() OVER (ORDER BY YEA_DOS_STR006)
              ,YEA_DOS_STR006
              ,SUBSTR(YEA_STD_YY,1,4)
              ,SUM(YEA_DOS_NUM002)
              ,0
              ,SUM(YEA_DOS_NUM002)
              ,0
              ,0
              ,0
              ,MAX(YEA_INS_DATE)
              ,MAX(YEA_INS_USER_ID)
              ,MAX(YEA_UPD_DATE)
              ,MAX(YEA_UPD_USER_ID)
         FROM YEA_DONASP
        WHERE YEA_STD_YY = #YEA_STD_YY#
          AND YEA_EMP_NO = #YEA_EMP_NO#
        GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_DOS_STR006;
        
        END;
    ]]>	
	</update>   
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : PDF파일 업로드
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC07" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC07.PDF파일 업로드 */ 
        v_ROWCNT INT;

        v_SING_CODE YEA_YEFAMI.YEA_FAM_STR001%TYPE; /*가족관계신고코드*/
        v_FAMI_NAME YEA_YEFAMI.YEA_FAM_STR003%TYPE; /*가족성명*/
        v_BASE_YSNO YEA_YEFAMI.YEA_FAM_STR005%TYPE; /*기본공제여부*/

        v_INSU_REST YEA_YEFAMI.YEA_FAM_NUM004%TYPE; /*보험료기타*/
        v_INS2_REST YEA_YEFAMI.YEA_FAM_NUM021%TYPE; /*[2015귀속]_추가 보험료장애인전용*/
        v_CARD_REST YEA_YEFAMI.YEA_FAM_NUM010%TYPE; /*신용카드기타*/
        v_DCAD_REST YEA_YEFAMI.YEA_FAM_NUM012%TYPE; /*직불카드기타*/
        v_MRKT_REST YEA_YEFAMI.YEA_FAM_NUM015%TYPE; /*전통시장사용금액기타*/
        v_PTRA_REST YEA_YEFAMI.YEA_FAM_NUM017%TYPE; /*대중교통사용금액기타  추가*/

    BEGIN
        /*입력마감인 경우 업로드 불가*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_INCDEC
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_INC_STR025 = '1';

        IF v_ROWCNT > 0 THEN
            RAISE_APPLICATION_ERROR(-20000, '이미 입력마감 하였습니다!');

        END IF;

        /*확정인 경우 수정 불가*/
        SELECT COUNT(*)
          INTO v_ROWCNT
          FROM YEA_YEPROC
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PRC_STR001 = '1';

        IF v_ROWCNT > 0 THEN
            RAISE_APPLICATION_ERROR(-20000,'확정되었습니다. 입력,수정,삭제가 불가 합니다!');

        END IF;

        /*주민번호가 가족사항에 없는 경우 오류*/
        SELECT MAX(A.YEA_FM1_STR004)
          INTO v_FAMI_NAME
          FROM YEA_YEYSOM A
     LEFT JOIN YEA_YEFAMI B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND B.YEA_EMP_NO IS NULL;
        
        IF v_FAMI_NAME IS NOT NULL THEN
			RAISE_APPLICATION_ERROR(-20000, '부양가족 (' || v_FAMI_NAME || ') 자료가 존재하지 않습니다.');
        END IF;

        /***********************************************************************
            보험료 반영 [2014귀속] 기본공제대상자만 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM003 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('A102Y', 'A102M')
                               AND B.YEA_FM1_STR005 = 'G0001'  /*[2015귀속]_자료코드변경A01->G0001*/
                               AND C.YEA_FAM_STR005 = '1'    /*기본공제대상자만*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
		
		/*[2015귀속]_장애인보장성보험료분리*/
        /***********************************************************************
            장애인보장성보험 반영 [2015귀속] 기본공제대상자만 되도록 반영
        ************************************************************************/
         UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM020 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('A102Y', 'A102M')
                               AND B.YEA_FM1_STR005 = 'G0002'  /*[2015귀속]_자료코드변경A02->G0002*/
                               AND C.YEA_FAM_STR005 = '1'    /*기본공제대상자만*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_장애인보장성보험료분리끝*/
		
		
        /*소득공제신고서 보험료 업데이트*/
        /*국세청 외의 보험료*/
        SELECT NVL(SUM(YEA_FAM_NUM004),0)
          INTO v_INSU_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
		
		/*[2015귀속]_소득공제신고서 장애인보장성보험료 업데이트*/
        /*국세청 외의 보험료*/
        SELECT NVL(SUM(YEA_FAM_NUM021),0)
          INTO v_INS2_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_소득공제신고서 장애인보장성보험료 업데이트끝*/
		
		
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM052, YEA_INC_NUM053) = (
                            SELECT NVL(SUM(CASE WHEN YEA_FM1_STR005 = 'G0001' THEN YEA_FM1_NUM001 ELSE 0 END),0) + v_INSU_REST  /*[2015귀속]_자료코드변경A01->G0001*/
                                  ,NVL(SUM(CASE WHEN YEA_FM1_STR005 = 'G0002' THEN YEA_FM1_NUM001 ELSE 0 END),0) + v_INS2_REST  /*[2015귀속]_자료코드변경A02->G0002, 국세청 외의 장애인보장성보험료 추가*/
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('A102Y', 'A102M')
                               AND C.YEA_FAM_STR005 = '1'    /*기본공제대상자만*/
                                        )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;



        /***********************************************************************
            의료비 반영
        ************************************************************************/
        /*안경 또는 콘택트렌즈 구입비용 인당 50만원 한도 적용해야함.*/

        UPDATE YEA_YEFAMI A
           SET (YEA_FAM_NUM005, YEA_FAM_NUM022) = (			    /*[2015귀속]_추가_난임시술비_국세청_0으로초기화*/
                            SELECT NVL(LEAST(SUM(CASE WHEN YEA_FM1_STR005 = 'G0026' THEN YEA_FM1_NUM001 ELSE 0 END), 500000),0)    /*[2015귀속]_자료코드변경B04->G0026*/
                                 + NVL(SUM(CASE WHEN YEA_FM1_STR005 <> 'G0026' THEN YEA_FM1_NUM001 ELSE 0 END),0)                  /*[2015귀속]_자료코드변경B04->G0026*/
 								 ,0                             																   /*[2015귀속]_추가_난임시술비_국세청_0으로초기화*/	
                              FROM YEA_YEYSOM B
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO

                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('B101Y', 'B101D')
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /*의료비명세서*/
        /*의료비명세서 초기화*/
        DELETE FROM YEA_MEDISP
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_MES_STR001 = '1';  /*국세청자료*/


         INSERT INTO YEA_MEDISP (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_FAMI_SEQ     /*가족일련번호*/
               ,YEA_MEDI_SEQ     /*의료비일련번호*/
               ,YEA_MES_STR005   /*본인등해당여부*/
               ,YEA_MES_STR006   /*상호명*/
               ,YEA_MES_STR007   /*사업자번호*/
               ,YEA_MES_NUM001   /*지급건수*/
               ,YEA_MES_NUM002   /*지급금액*/
               ,YEA_MES_STR001   /*의료증빙코드*/
               ,YEA_MES_STR002   /*가족성명*/
               ,YEA_MES_STR003   /*주민등록번호*/
               ,YEA_MES_STR004   /*내외국인구분코드*/
               ,YEA_INS_USER_ID  /*입력작업자*/
               ,YEA_INS_DATE     /*입력일시*/
               ,YEA_UPD_USER_ID  /*수정작업자*/
               ,YEA_UPD_DATE     /*수정일시*/
               )
        SELECT A.YEA_STD_YY   /*기준년월*/
              ,A.YEA_EMP_NO   /*사원번호*/
              ,A.YEA_FAMI_SEQ   /*가족일련번호*/
              ,ROW_NUMBER() OVER (ORDER BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ)
              +(SELECT NVL(MAX(YEA_MEDI_SEQ), 0)
                  FROM YEA_MEDISP
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO
                   AND YEA_FAMI_SEQ = A.YEA_FAMI_SEQ)   /*의료비일련번호*/
              ,CASE WHEN A.YEA_FAM_STR001 = '0' OR NVL(A.YEA_FAM_STR009, '0') >= '1' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(A.YEA_STD_YY,1,4))-65) || '1231' THEN '1' ELSE '2' END    /*본인등해당여부 [2013귀속] 장애자여부 코드화*/
              ,B.YEA_FM1_STR007   /*상호명*/
              ,SF_YEA_ENCRYPT_SSN(B.YEA_FM1_STR006)   /*사업자번호*/
              ,COUNT(A.YEA_EMP_NO)   /*지급건수*/
              ,SUM(B.YEA_FM1_NUM001)   /*지급금액*/
              ,'1'   /*의료증빙코드*/
              ,B.YEA_FM1_STR004   /*가족성명*/
              ,A.YEA_FAM_STR004   /*주민등록번호*/
              ,A.YEA_FAM_STR002   /*내외국인구분코드*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE    /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE    /*수정일시*/
          FROM YEA_YEFAMI A
    INNER JOIN YEA_YEYSOM B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO
           AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND B.YEA_FM1_STR002 IN ('B101Y', 'B101D')
           AND B.YEA_FM1_STR005 <> 'G0026'              /*[2015귀속]_자료코드변경B04->G0026*/
      GROUP BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ, A.YEA_FAM_STR001, A.YEA_FAM_STR009, B.YEA_FM1_STR007, B.YEA_FM1_STR006, B.YEA_FM1_STR004, A.YEA_FAM_STR004, A.YEA_FAM_STR002;


        /*안경구입비*/
         INSERT INTO YEA_MEDISP (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_FAMI_SEQ     /*가족일련번호*/
               ,YEA_MEDI_SEQ     /*의료비일련번호*/
               ,YEA_MES_STR005   /*본인등해당여부*/
               ,YEA_MES_STR006   /*상호명*/
               ,YEA_MES_STR007   /*사업자번호*/
               ,YEA_MES_NUM001   /*지급건수*/
               ,YEA_MES_NUM002   /*지급금액*/
               ,YEA_MES_STR001   /*의료증빙코드*/
               ,YEA_MES_STR002   /*가족성명*/
               ,YEA_MES_STR003   /*주민등록번호*/
               ,YEA_MES_STR004   /*내외국인구분코드*/
               ,YEA_INS_USER_ID  /*입력작업자*/
               ,YEA_INS_DATE     /*입력일시*/
               ,YEA_UPD_USER_ID  /*수정작업자*/
               ,YEA_UPD_DATE     /*수정일시*/
               )
        SELECT A.YEA_STD_YY   /*기준년월*/
              ,A.YEA_EMP_NO   /*사원번호*/
              ,A.YEA_FAMI_SEQ   /*가족일련번호*/
              ,ROW_NUMBER() OVER (ORDER BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ)
              +(SELECT NVL(MAX(YEA_MEDI_SEQ), 0)
                  FROM YEA_MEDISP
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO
                   AND YEA_FAMI_SEQ = A.YEA_FAMI_SEQ)   /*의료비일련번호*/
              ,CASE WHEN A.YEA_FAM_STR001 = '0' OR NVL(A.YEA_FAM_STR009, '0') = '1' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(A.YEA_STD_YY,1,4))-65) || '1231' THEN '1' ELSE '2' END    /*본인등해당여부*/
              ,B.YEA_FM1_STR007   /*상호명*/
              ,SF_YEA_ENCRYPT_SSN(B.YEA_FM1_STR006)   /*사업자번호*/
              ,COUNT(A.YEA_EMP_NO)   /*지급건수*/
              ,LEAST(SUM(B.YEA_FM1_NUM001),500000)   /*지급금액*/
              ,'1'   /*의료증빙코드*/
              ,B.YEA_FM1_STR004   /*가족성명*/
              ,A.YEA_FAM_STR004   /*주민등록번호*/
              ,A.YEA_FAM_STR002   /*내외국인구분코드*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE    /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE    /*수정일시*/
          FROM YEA_YEFAMI A
    INNER JOIN YEA_YEYSOM B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO
           AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND B.YEA_FM1_STR002 IN ('B101Y', 'B101D')
           AND B.YEA_FM1_STR005 = 'G0026'                /*[2015귀속]_자료코드변경B04->G0026*/
      GROUP BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ, A.YEA_FAM_STR001, A.YEA_FAM_STR009, B.YEA_FM1_STR007, B.YEA_FM1_STR006, B.YEA_FM1_STR004, A.YEA_FAM_STR004, A.YEA_FAM_STR002;


        /*소득공제신고서 의료비 업데이트*/
        UPDATE YEA_INCDEC A
           SET (
                YEA_INC_NUM054
              , YEA_INC_NUM055
               ) = (
                    SELECT NVL(
                               SUM(  /*[2013귀속] 장애인 의료비 추가 (우선순위 최상)*/
                                   CASE
                                       WHEN NVL(YEA_FAM_STR009, '0') >= '1' THEN NVL(YEA_FAM_NUM005,0) + NVL(YEA_FAM_NUM006,0)
                                       WHEN YEA_FAM_STR001 = '0' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN NVL(YEA_FAM_NUM005,0) + NVL(YEA_FAM_NUM006, 0)
                                       ELSE 0
                                   END
                                  )
                            ,0) AS MEDI_SSUM
                          ,NVL(
                               SUM( /*[2013귀속] 장애인 의료비 추가 (우선순위 최상)*/
                                   CASE
                                       WHEN NVL(YEA_FAM_STR009, '0') >= '1' THEN 0
                                       WHEN YEA_FAM_STR001 = '0' OR CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN 0
                                       ELSE NVL(YEA_FAM_NUM005,0) + NVL(YEA_FAM_NUM006,0)
                                   END
                                  )
                             ,0) AS MEDI_DSUM
                      FROM YEA_YEFAMI B
                     WHERE A.YEA_STD_YY = B.YEA_STD_YY
                       AND A.YEA_EMP_NO = B.YEA_EMP_NO
                )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            교육비 반영
        ************************************************************************/
        /*교복 구입비용 인당 50만원 한도 적용해야함.*/

        UPDATE YEA_YEFAMI A
           SET (YEA_FAM_STR010, YEA_FAM_NUM007) = (
                            SELECT  MAX(CASE WHEN A.YEA_FAM_STR001 = '0' THEN '1'  /*본인*/
                                             WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'edu_tp') IN ('1', '8', 'F', 'G') AND B.YEA_FM1_STR005 IN ('G0004','G0007','G0008') THEN '2'        /*[2015귀속]_자료코드변경C01,C04->G0004,G0007 ,G0008 추가 취학전아동*/
                                             WHEN (SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'edu_tp') IN ('2', '3', '4') AND B.YEA_FM1_STR005 IN ('G0004','G0007','G0008')) THEN '3'           /*[2015귀속]_자료코드변경C01,C04->G0004,G0007 ,G0008 추가 초중고*/
                                             WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'edu_tp') IN ('5', '6', 'C', 'D') AND B.YEA_FM1_STR005 IN ('G0006','G0007') THEN '4'        /*[2015귀속]_자료코드변경C03,C04->G0006,G0007 대학*/
                                             WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'edu_tp') IN ('H', 'J', 'K') THEN '5'													   /*장애*/	 
                                             WHEN B.YEA_FM1_STR005 = 'G0024' THEN '3'      /*[2015귀속]_자료코드변경C06->G0024  중고 교복 */
                                             ELSE ''
                                         END)
                                   ,NVL(LEAST(SUM(CASE WHEN B.YEA_FM1_STR005 = 'G0024' THEN YEA_FM1_NUM001 ELSE 0 END), 500000),0)      /*[2015귀속]_자료코드변경C06->G0024*/
                                  + NVL(SUM(CASE WHEN YEA_FM1_STR005 <> 'G0024' THEN YEA_FM1_NUM001 ELSE 0 END),0)                      /*[2015귀속]_자료코드변경C06->G0024*/
                              FROM YEA_YEYSOM B
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('C101Y', 'C101M', 'C202Y', 'C202M', 'C301Y', 'C301M')
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /*소득공제신고서 교육비 업데이트*/
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM056, YEA_INC_NUM057, YEA_INC_NUM058, YEA_INC_NUM059, YEA_INC_NUM060, YEA_INC_NUM061, YEA_INC_NUM062, YEA_INC_NUM063, YEA_INC_NUM064) = (
                                          SELECT  SUM(CASE WHEN YEA_FAM_STR010 = '1' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008, 0) ELSE 0 END) /*본인교육비*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '2' THEN 1 ELSE 0 END) /*취학전아동수*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '2' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008, 0) ELSE 0 END) /*취학전아동교육비*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '3' THEN 1 ELSE 0 END) /*초중고인원수*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '3' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008, 0) ELSE 0 END) /*초중고교육비*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '4' THEN 1 ELSE 0 END) /*대학생인원수*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '4' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008, 0) ELSE 0 END) /*대학생교육비*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '5' THEN 1 ELSE 0 END) /*장애인인원수*/
                                                 ,SUM(CASE WHEN YEA_FAM_STR010 = '5' THEN NVL(YEA_FAM_NUM007,0) + NVL(YEA_FAM_NUM008, 0) ELSE 0 END) /*장애인교육비*/
                                            FROM YEA_YEFAMI B
                                           WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                             AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                        )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            개인연금저축 반영
        ************************************************************************/
        /*연금저축명세서*/
        /*연금저축명세서 초기화*/
        DELETE FROM YEA_PENSAV
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PEN_STR001 = '21';  /*개인연금저축*/


         INSERT INTO YEA_PENSAV (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_PENS_SEQ     /*연금명세서일련번호*/
               ,YEA_PEN_STR001   /*연금소득공제구분코드*/
               ,YEA_PEN_STR002   /*금융기관코드*/
               ,YEA_PEN_STR003   /*연금저축계좌번호*/
               ,YEA_PEN_NUM001   /*불입금액*/
               ,YEA_PEN_NUM002   /*연금및저축공제액*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT YEA_STD_YY   /*기준년월*/
              ,YEA_EMP_NO   /*사원번호*/
              ,ROW_NUMBER() OVER (ORDER BY YEA_STD_YY, YEA_EMP_NO)
              +(SELECT NVL(MAX(YEA_PENS_SEQ), 0)
                  FROM YEA_PENSAV
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO)   /*연금명세서일련번호*/
              ,'21'   /*연금소득공제구분코드*/
              ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'com_cd')   /*금융기관코드*/
              ,SF_YEA_ENCRYPT_ACCT_NO(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'acc_no'))   /*연금저축계좌번호*/
              ,SUM(YEA_FM1_NUM001)   /*불입금액*/
              ,0   /*연금및저축공제액*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE   /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE   /*수정일시*/
          FROM YEA_YEYSOM A
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FM1_STR002 IN ('D101Y', 'D101M')
         GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_FORM_SEQ1;

        /*소득공제신고서 개인연금저축 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM022 = (
                              SELECT NVL(SUM(CASE WHEN YEA_PEN_STR001 = '21' THEN YEA_PEN_NUM001 ELSE 0 END), 0)
                                FROM YEA_PENSAV B
                               WHERE YEA_STD_YY = #YEA_STD_YY#
                                 AND YEA_EMP_NO = #YEA_EMP_NO#
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            연금저축 반영
        ************************************************************************/
        /*연금저축명세서*/
        /*연금저축명세서 초기화*/
        DELETE FROM YEA_PENSAV
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PEN_STR001 = '22';  /*개인연금저축*/


         INSERT INTO YEA_PENSAV (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_PENS_SEQ     /*연금명세서일련번호*/
               ,YEA_PEN_STR001   /*연금소득공제구분코드*/
               ,YEA_PEN_STR002   /*금융기관코드*/
               ,YEA_PEN_STR003   /*연금저축계좌번호*/
               ,YEA_PEN_NUM001   /*불입금액*/
               ,YEA_PEN_NUM002   /*연금및저축공제액*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT YEA_STD_YY   /*기준년월*/
              ,YEA_EMP_NO   /*사원번호*/
              ,ROW_NUMBER() OVER (ORDER BY YEA_STD_YY, YEA_EMP_NO)
              +(SELECT NVL(MAX(YEA_PENS_SEQ), 0)
                  FROM YEA_PENSAV
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO)   /*연금명세서일련번호*/
              ,'22'   /*연금소득공제구분코드*/
              ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'com_cd')   /*금융기관코드*/
              ,SF_YEA_ENCRYPT_ACCT_NO(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'acc_no'))   /*연금저축계좌번호*/
              ,SUM(YEA_FM1_NUM001)   /*불입금액*/
              ,0   /*연금및저축공제액*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE   /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE   /*수정일시*/
          FROM YEA_YEYSOM A
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FM1_STR002 IN ('E102Y', 'E102M')  /*[2013귀속] E101Y -> 2013년:E102Y*/
         GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_FORM_SEQ1;

        /*소득공제신고서 연금저축 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM051 = (
                              SELECT NVL(SUM(CASE WHEN YEA_PEN_STR001 = '22' THEN YEA_PEN_NUM001 ELSE 0 END), 0)
                                FROM YEA_PENSAV B
                               WHERE YEA_STD_YY = #YEA_STD_YY#
                                 AND YEA_EMP_NO = #YEA_EMP_NO#
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /***********************************************************************
            퇴직연금 반영
        ************************************************************************/
        /*연금저축명세서*/
        /*연금저축명세서 초기화*/
        DELETE FROM YEA_PENSAV
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PEN_STR001 IN ('11', '12');  /*근로자퇴직급여보장법, 과학기술인공제*/


         INSERT INTO YEA_PENSAV (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_PENS_SEQ     /*연금명세서일련번호*/
               ,YEA_PEN_STR001   /*연금소득공제구분코드*/
               ,YEA_PEN_STR002   /*금융기관코드*/
               ,YEA_PEN_STR003   /*연금저축계좌번호*/
               ,YEA_PEN_NUM001   /*불입금액*/
               ,YEA_PEN_NUM002   /*연금및저축공제액*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT  YEA_STD_YY   /*기준년월*/
               ,YEA_EMP_NO   /*사원번호*/
               ,ROW_NUMBER() OVER (ORDER BY YEA_STD_YY, YEA_EMP_NO)
               +(SELECT NVL(MAX(YEA_PENS_SEQ), 0)
                   FROM YEA_PENSAV
                  WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO)   /*연금명세서일련번호*/
               ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'pension_cd')   /*연금소득공제구분코드*/
               ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'com_cd')   /*금융기관코드*/
               ,SF_YEA_ENCRYPT_ACCT_NO(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'acc_no'))   /*연금저축계좌번호*/
               ,SUM(YEA_FM1_NUM001)   /*불입금액*/
               ,0   /*연금및저축공제액*/
               ,#UPDT_USID#   /*입력작업자*/
               ,SYSDATE   /*입력일시*/
               ,#UPDT_USID#   /*수정작업자*/
               ,SYSDATE   /*수정일시*/
          FROM YEA_YEYSOM A
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FM1_STR002 IN ('F102Y', 'F102M')
      GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_FORM_SEQ1;


        /*소득공제신고서 퇴직연금 업데이트*/
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM050, YEA_INC_NUM049) = (
                                        SELECT  NVL(SUM(CASE WHEN YEA_PEN_STR001 = '11' THEN YEA_PEN_NUM001 ELSE 0 END), 0)
                                              , NVL(SUM(CASE WHEN YEA_PEN_STR001 = '12' THEN YEA_PEN_NUM001 ELSE 0 END), 0)
                                          FROM YEA_PENSAV B
                                         WHERE YEA_STD_YY = #YEA_STD_YY#
                                           AND YEA_EMP_NO = #YEA_EMP_NO#
                                        )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            신용카드 반영 [2014귀속] 형제자매는 안 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM009 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')           /*[2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제신고서 신용카드 업데이트*/
        /*국세청 외의 신용카드*/
        SELECT NVL(SUM(YEA_FAM_NUM010),0)
          INTO v_CARD_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM034 = (
                            SELECT CASE WHEN SUM(NVL(YEA_FM1_NUM001, 0)) IS NULL THEN 0 ELSE SUM(NVL(YEA_FM1_NUM001, 0)) END + v_CARD_REST
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')           /*[2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            현금영수증 반영 [2014귀속] 형제자매는 안 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM013 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('G204M')                    /*[2015귀속]_서식코드변경G203M->G204M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제신고서 현금영수증 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM036 = (
                            SELECT CASE WHEN SUM(NVL(YEA_FM1_NUM001, 0)) IS NULL THEN 0 ELSE SUM(NVL(YEA_FM1_NUM001, 0)) END
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G204M')                   /*[2015귀속]_서식코드변경G203M->G204M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /***********************************************************************
            직불카드 반영 [2014귀속] 형제자매는 안 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM011 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /*[2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제신고서 직불카드 업데이트*/
        /*국세청 외의 직불카드*/
        SELECT NVL(SUM(YEA_FAM_NUM012),0)
          INTO v_DCAD_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM035 = (
                            SELECT CASE WHEN SUM(NVL(YEA_FM1_NUM001, 0)) IS NULL THEN 0 ELSE SUM(NVL(YEA_FM1_NUM001, 0)) END + v_DCAD_REST
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /*[2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '1'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            전통시장사용금액 반영 [2014귀속] 형제자매는 안 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM014 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M', 'G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경 G102Y, G102M, G203M, G302Y, G302M->G103Y, G103M, G204M, G303Y, G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '2'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제신고서 전통시장사용금액 업데이트*/
        /*국세청 외의 전통시장사용금액*/
        SELECT NVL(SUM(YEA_FAM_NUM015),0)
          INTO v_MRKT_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM037 = (
                            SELECT CASE WHEN SUM(NVL(YEA_FM1_NUM001, 0)) IS NULL THEN 0 ELSE SUM(NVL(YEA_FM1_NUM001, 0)) END + v_MRKT_REST
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M', 'G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경 G102Y, G102M, G203M, G302Y, G302M->G103Y, G103M, G204M, G303Y, G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '2'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            대중교통사용금액 반영  [2014귀속] 형제자매는 안 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM016 = (
                            SELECT SUM(NVL(YEA_FM1_NUM001, 0))
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M', 'G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경 G102Y, G102M, G203M, G302Y, G302M->G103Y, G103M, G204M, G303Y, G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '3'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*소득공제신고서 대중교통사용금액 업데이트*/
        /*국세청 외의 대중교통사용금액*/
        SELECT NVL(SUM(YEA_FAM_NUM017),0)
          INTO v_PTRA_REST
          FROM YEA_YEFAMI
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM038 = (
                            SELECT CASE WHEN SUM(NVL(YEA_FM1_NUM001, 0)) IS NULL THEN 0 ELSE SUM(NVL(YEA_FM1_NUM001, 0)) END + v_PTRA_REST
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M', 'G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경 G102Y, G102M, G203M, G302Y, G302M->G103Y, G103M, G204M, G303Y, G303M*/
                               AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') = '3'
                               AND C.YEA_FAM_STR001 <> '6'    /*형제자매제외*/
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

		/*[2015귀속]_추가 본인신용카드등(2013년)사용액*/
        /***********************************************************************
            본인신용카드등(2013년)사용액
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM039 = (
                                 SELECT SUM(M.PRE_TOT) AS PRE_TOT
                                   FROM (
                                        SELECT DISTINCT NVL(YEA_FM1_NUM005+YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT    /*[2015귀속]_추가 YEA_FM1_NUM005, YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')        /*신용카드 [2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM005+YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT   /*[2015귀속]_추가 YEA_FM1_NUM005, YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G204M')               /*현금영수증 [2015귀속]_서식코드변경G203M->G204M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM005+YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT   /*[2015귀속]_추가 YEA_FM1_NUM005, YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /*직불카드 [2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                                           AND C.YEA_FAM_STR001 = '0'
                                         ) M
                                  WHERE A.YEA_STD_YY = M.YEA_STD_YY
                                    AND A.YEA_EMP_NO = M.YEA_EMP_NO
                                  )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_추가 본인신용카드등(2013년)사용액끝*/
		
		/*[2015귀속]_변경 본인신용카드등(2014년)사용액*/
        /***********************************************************************
            본인신용카드등(2014년)사용액
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM040 = (                 /*[2015귀속]_변경 본인신용카드등(2014년)사용액 YEA_INC_NUM039->YEA_INC_NUM040*/
                                 SELECT SUM(M.PRE_TOT) AS PRE_TOT
                                   FROM (
                                        SELECT DISTINCT NVL(YEA_FM1_NUM002+YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')        /*신용카드 [2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM002+YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G204M')               /*현금영수증 [2015귀속]_서식코드변경G203M->G204M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM002+YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /*직불카드 [2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                                           AND C.YEA_FAM_STR001 = '0'
                                         ) M
                                  WHERE A.YEA_STD_YY = M.YEA_STD_YY
                                    AND A.YEA_EMP_NO = M.YEA_EMP_NO
                                  )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
		
		/*[2015귀속]_추가 본인신용카드등(2013년) 추가공제율 사용분*/
        /***********************************************************************
            본인신용카드등(2013년)추가공제율 사용분
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM041 = (
                                 SELECT SUM(M.PRE_TOT) AS PRE_TOT
                                   FROM (
                                        SELECT DISTINCT NVL(YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT      /*[2015귀속]_추가 YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')        /*신용카드 [2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM005+YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT    /*[2015귀속]_추가 YEA_FM1_NUM005, YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G204M')               /*현금영수증 [2015귀속]_서식코드변경G203M->G204M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM005+YEA_FM1_NUM006+YEA_FM1_NUM007,0) AS PRE_TOT    /*[2015귀속]_추가 YEA_FM1_NUM005, YEA_FM1_NUM006, YEA_FM1_NUM007*/
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /* 직불카드 [2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                                           AND C.YEA_FAM_STR001 = '0'
                                         ) M
                                  WHERE A.YEA_STD_YY = M.YEA_STD_YY
                                    AND A.YEA_EMP_NO = M.YEA_EMP_NO
                                  )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_추가 본인신용카드등(2013년) 추가공제율 사용분끝*/
		
		/*[2015귀속]_추가 본인신용카드등(당해년도 상반기)추가공제율 사용분*/
        /***********************************************************************
            본인신용카드등(당해년도 상반기)추가공제율 사용분
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM042 = (
                                 SELECT SUM(M.PRE_TOT) AS PRE_TOT
                                   FROM (
                                         SELECT NVL(SUM(YEA_FM2_STR002),0) AS  PRE_TOT
                                           FROM YEA_YEYSOM B
                                     INNER JOIN YEA_YEFAMI C
                                             ON B.YEA_STD_YY = C.YEA_STD_YY
                                            AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                            AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                      LEFT JOIN YEA_YEYSOS D
                                             ON B.YEA_STD_YY = D.YEA_STD_YY
                                            AND B.YEA_EMP_NO = D.YEA_EMP_NO
                                            AND B.YEA_FORM_SEQ1 = D.YEA_FORM_SEQ1
                                          WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                            AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                            AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')            /*[2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                                            AND C.YEA_FAM_STR001 = '0'
                                            AND D.YEA_FM2_STR001 = 'first_year_tot_amt'           /*[2015귀속]_상반기추가 first_year_tot_amt*/
                                            AND SF_YEA_ATTRVALS(B.YEA_STD_YY, B.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'use_place_cd') <> '1'

                                          UNION
                                         SELECT NVL(SUM(YEA_FM2_STR002),0) AS  PRE_TOT
                                           FROM YEA_YEYSOM B
                                     INNER JOIN YEA_YEFAMI C
                                             ON B.YEA_STD_YY = C.YEA_STD_YY
                                            AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                            AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                      LEFT JOIN YEA_YEYSOS D
                                             ON B.YEA_STD_YY = D.YEA_STD_YY
                                            AND B.YEA_EMP_NO = D.YEA_EMP_NO
                                            AND B.YEA_FORM_SEQ1 = D.YEA_FORM_SEQ1
                                          WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                            AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                            AND B.YEA_FM1_STR002 IN ('G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경G203M,G302Y,G302M->G204M,G303Y,G303M*/
                                            AND C.YEA_FAM_STR001 = '0'
                                            AND D.YEA_FM2_STR001 = 'first_year_tot_amt'           /*[2015귀속]_상반기추가 first_year_tot_amt*/
                                         ) M
                                  )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
		
        
         /***********************************************************************
            본인신용카드등(당해년도)사용액
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM085 = (                                     /*[2015귀속]_변경 본인신용카드등(당해년도)사용액 YEA_INC_NUM040->YEA_INC_NUM085*/
                            SELECT NVL(SUM(YEA_FM1_NUM001),0)
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M', 'G204M', 'G303Y', 'G303M')   /*[2015귀속]_서식코드변경 G102Y, G102M, G203M, G302Y, G302M->G103Y, G103M, G204M, G303Y, G303M*/
                               AND C.YEA_FAM_STR001 = '0'
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /*[2015귀속]_변경 본인신용카드등(2014년) 추가공제율 사용분*/
        /***********************************************************************
            본인신용카드등(2014년)추가공제율 사용분
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM086 = (                                     /*[2015귀속]_변경 본인신용카드등(2014년)추가공제율 YEA_INC_NUM041->YEA_INC_NUM086*/
                                 SELECT SUM(M.PRE_TOT) AS PRE_TOT
                                   FROM (
                                        SELECT DISTINCT NVL(YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G103Y', 'G103M')        /*신용카드 [2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM002+YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G204M')               /*현금영수증 [2015귀속]_서식코드변경G203M->G204M*/
                                           AND C.YEA_FAM_STR001 = '0'

                                         UNION
                                        SELECT DISTINCT NVL(YEA_FM1_NUM002+YEA_FM1_NUM003+YEA_FM1_NUM004,0) AS PRE_TOT
                                              ,B.YEA_STD_YY
                                              ,B.YEA_EMP_NO
                                          FROM YEA_YEYSOM B
                                    INNER JOIN YEA_YEFAMI C
                                            ON B.YEA_STD_YY = C.YEA_STD_YY
                                           AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                           AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                         WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                           AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                           AND B.YEA_FM1_STR002 IN ('G303Y', 'G303M')       /*직불카드 [2015귀속]_서식코드변경G302Y,G302M->G303Y,G303M*/
                                           AND C.YEA_FAM_STR001 = '0'
                                         ) M
                                  WHERE A.YEA_STD_YY = M.YEA_STD_YY
                                    AND A.YEA_EMP_NO = M.YEA_EMP_NO
                                  )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_변경 본인신용카드등(2014년) 추가공제율 사용분끝*/

		/*[2015귀속]_변경 본인신용카드등(당해년도 하반기)추가공제율 사용분*/
        /***********************************************************************
            본인신용카드등(당해년도 하반기)추가공제율 사용분
        ************************************************************************/

        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM087 = (                                        /*[2015귀속]_변경 본인신용카드등(당해년도 하반기)추가공제율 YEA_INC_NUM042->YEA_INC_NUM087*/
                                 SELECT nvl(SUM(to_number(nvl(M.PRE_TOT,'0'))),0) AS PRE_TOT
                                   FROM (
                                         SELECT YEA_FM2_STR002 AS  PRE_TOT
                                           FROM YEA_YEYSOM B
                                     INNER JOIN YEA_YEFAMI C
                                             ON B.YEA_STD_YY = C.YEA_STD_YY
                                            AND B.YEA_EMP_NO = C.YEA_EMP_NO
                                            AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                                      LEFT JOIN YEA_YEYSOS D
                                             ON B.YEA_STD_YY = D.YEA_STD_YY
                                            AND B.YEA_EMP_NO = D.YEA_EMP_NO
                                            AND B.YEA_FORM_SEQ1 = D.YEA_FORM_SEQ1
                                          WHERE B.YEA_STD_YY = #YEA_STD_YY#
                                            AND B.YEA_EMP_NO = #YEA_EMP_NO#
                                            AND (
                                            		(
                                            			B.yea_fm1_str002 IN  ( 'G103Y', 'G103M' )    /*[2015귀속]_서식코드변경G102Y,G102M->G103Y,G103M*/                                      	        
		                                     		   AND Sf_yea_attrvals(B.yea_std_yy,  B.yea_emp_no, B.yea_form_seq1, 'use_place_cd') <> '1'
		                                        	)
		                                        	OR 
		                                        	( 
		                                        		B.yea_fm1_str002 IN ('G204M', 'G303Y', 'G303M' ) 	/*[2015귀속]_서식코드변경G203M,G302Y,G302M->G204M,G303Y,G303M*/
		                                            )
		                                         )
                                            AND C.YEA_FAM_STR001 = '0'
                                            AND D.YEA_FM2_STR001 = 'second_year_tot_amt'          /*[2015귀속]_하반기변경 second_tot_amt->second_year_tot_amt*/
                                            
                                         ) M)
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        /*[2015귀속]_변경 본인신용카드등(당해년도 하반기)추가공제율 사용분끝*/


        /***********************************************************************
            주택임차차입금 원리금상환액 반영
        ************************************************************************/

        /*소득공제신고서 주택임차차입금 원리금상환액 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM015 = (
                              SELECT NVL(SUM(YEA_FM1_NUM001),0)
                                FROM YEA_YEYSOM B
                               WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                 AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                 AND B.YEA_FM1_STR002 IN ('J101Y', 'J101M')
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            장기주택저당차입금 이자상환액 반영
        ************************************************************************/

        /*소득공제신고서 장기주택저당차입금 이자상환액 업데이트*/
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM017, YEA_INC_NUM018, YEA_INC_NUM019, YEA_INC_NUM020, YEA_INC_NUM021, YEA_INC_NUM077, YEA_INC_NUM078, YEA_INC_NUM079, YEA_INC_NUM080 ) = (  /*2011이전차입분 15년미만, 15~29년, 30년이상, 2012이후 차입분 15년이상(고정금리비거치)) [2015귀속]_추가_(2015년이후가입분_15년이상(고정금리이면서비거치,고정금리이거나비거치,기타대출), 10년~15년(고정금리이거나비거치)*/
                              SELECT  NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') <= '20111231' AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') < 15 THEN C.YEA_FM3_NUM001 ELSE 0 END),0)				
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') <= '20111231' AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') BETWEEN 15 AND 29 THEN C.YEA_FM3_NUM001 ELSE 0 END),0)	
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') <= '20111231' AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 30 THEN C.YEA_FM3_NUM001 ELSE 0 END),0)				
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') BETWEEN '20120101' AND '20141231' AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 15 AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) <> 0 AND (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) >= TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) * 0.7) THEN C.YEA_FM3_NUM001 ELSE 0 END),0) /*[2015귀속]_추가_2012이후부터2015이전까지*/
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') BETWEEN '20120101' AND '20141231' AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 15 AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) = 0 THEN C.YEA_FM3_NUM001 ELSE 0 END),0) /*[2015귀속]_추가_2012이후부터2015이전까지*/
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') >= '20150101'
                                          AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 15
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) <> 0
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) <> 0
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) <> 0
                                          AND (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) >= TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) * 0.7) AND (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) >= TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) * 0.7) THEN C.YEA_FM3_NUM001 ELSE 0 END),0)       /*[2015귀속]_추가_(2015년이후_15년이상_고정금이면서비거치)*/
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') >= '20150101'
                                          AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 15
                                          AND NOT (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) <> 0 AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) <> 0)
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) <> 0
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) <> 0
                                          AND (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) >= TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) * 0.7) THEN C.YEA_FM3_NUM001 ELSE 0 END),0)                                                                                                    /*[2015귀속]_추가_(2015년이후_15년이상_고정금이거나비거치)*/
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') >= '20150101'
                                          AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') >= 15
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) = 0 THEN C.YEA_FM3_NUM001 ELSE 0 END),0)                                                                                                     																						/*[2015귀속]_추가_(2015년이후_15년이상_기타대출)*/
                                     ,NVL(SUM(CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'start_dt') >= '20150101'
                                          AND SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'repay_years') BETWEEN 10 AND 14
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) <> 0
                                          AND TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) <> 0
                                          AND (TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'fixed_rate_debt')) + TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'not_defer_debt')) >= TO_NUMBER(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, B.YEA_FORM_SEQ1, 'debt')) * 0.7) THEN C.YEA_FM3_NUM001 ELSE 0 END),0)                                                                                        			/*[2015귀속]_추가_(2015년이후_10년~15년_고정금이거나비거치)*/
                                FROM YEA_YEYSOM B                           
                           LEFT JOIN YEA_YEYSON C 
                                  ON B.YEA_STD_YY = C.YEA_STD_YY AND B.YEA_EMP_NO = C.YEA_EMP_NO AND B.YEA_FORM_SEQ1 = C.YEA_FORM_SEQ1                            
                               WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                 AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                 AND B.YEA_FM1_STR002 IN ('J203Y', 'J203M')
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            주택마련저축 반영
        ************************************************************************/
        /*연금저축명세서*/
        /*연금저축명세서 초기화*/
        DELETE FROM YEA_PENSAV
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PEN_STR001 IN ('31', '32', '34');  /*청약저축, 주택청약종합저축, 근로자주택마련저축 [2013귀속] 장기주택마련저축(33) 삭제*/


         INSERT INTO YEA_PENSAV (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_PENS_SEQ     /*연금명세서일련번호*/
               ,YEA_PEN_STR001   /*연금소득공제구분코드*/
               ,YEA_PEN_STR002   /*금융기관코드*/
               ,YEA_PEN_STR003   /*연금저축계좌번호*/
               ,YEA_PEN_NUM001   /*불입금액*/
               ,YEA_PEN_NUM002   /*연금및저축공제액*/
               ,YEA_PEN_STR005   /*[2015귀속]_추가 2015.01.01 이후가입여부*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT YEA_STD_YY   /*기준년월*/
              ,YEA_EMP_NO   /*사원번호*/
              ,ROW_NUMBER() OVER (ORDER BY YEA_STD_YY, YEA_EMP_NO)
              +(SELECT NVL(MAX(YEA_PENS_SEQ), 0)
                  FROM YEA_PENSAV
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO)   /*연금명세서일련번호*/
              ,'3' || SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'saving_gubn')   /*연금소득공제구분코드*/
              ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'com_cd')   /*금융기관코드*/
              ,SF_YEA_ENCRYPT_ACCT_NO(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'acc_no'))   /*연금저축계좌번호*/
              ,NVL(SUM(YEA_FM1_NUM001),0)   /*불입금액*/
              ,0   /*연금및저축공제액*/
              ,CASE WHEN SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'saving_gubn') = '4' THEN 0
               WHEN SubStr(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'reg_dt'),1,4) = '2015' THEN 1 ELSE 0 END   /*[2015귀속]_추가 2015.01.01 이후가입여부*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE   /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE   /*수정일시*/
          FROM YEA_YEYSOM A
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FM1_STR002 IN ('J301Y', 'J301M')
      GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_FORM_SEQ1;

        /*소득공제신고서 주택마련저축 업데이트*/
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM024, YEA_INC_NUM025, YEA_INC_NUM026, YEA_INC_NUM081, YEA_INC_NUM082) = (           /*[2015귀속]_청약저축,주택청약종합저축(2015.01.01이후가입분)*/
                                          SELECT  NVL(SUM(CASE WHEN YEA_PEN_STR001 = '31' AND Nvl(YEA_PEN_STR005,0) !='1' THEN YEA_PEN_NUM001 ELSE 0 END),0)       /*[2015귀속]_추가 2015.01.01 이후가입여부*/
                                                 ,NVL(SUM(CASE WHEN YEA_PEN_STR001 = '34' THEN YEA_PEN_NUM001 ELSE 0 END),0)                                       /*[2015귀속] 근로자주택마련저축*/
                                                 ,NVL(SUM(CASE WHEN YEA_PEN_STR001 = '32' AND Nvl(YEA_PEN_STR005,0) !='1' THEN YEA_PEN_NUM001 ELSE 0 END),0)       /*[2015귀속]_추가 2015.01.01 이후가입여부*/
                                                 ,NVL(SUM(CASE WHEN YEA_PEN_STR001 = '31' AND Nvl(YEA_PEN_STR005,0) ='1' THEN YEA_PEN_NUM001 ELSE 0 END),0)       /*[2015귀속]_추가 청약저축(2015.01.01 이후가입분)*/
                                                 ,NVL(SUM(CASE WHEN YEA_PEN_STR001 = '32' AND Nvl(YEA_PEN_STR005,0) ='1' THEN YEA_PEN_NUM001 ELSE 0 END),0)       /*[2015귀속]_추가 주택청약종합저축(2015.01.01 이후가입분)*/
                                            FROM YEA_PENSAV B
                                           WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                             AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                        )
              ,YEA_UPD_USER_ID = #UPDT_USID#
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            J401Y,J401M-목돈 안드는 전세 이자상환액 반영    [2013귀속] 추가
        ************************************************************************/

        /*목돈 안드는 전세 이자상환액 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM046 = (
                              SELECT NVL(SUM(YEA_FM1_NUM001),0)
                                FROM YEA_YEYSOM B
                               WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                 AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                 AND B.YEA_FM1_STR002 IN ('J401Y', 'J401M')
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /***********************************************************************
            소기업소상공인 공제부금 반영
        ************************************************************************/

        /*소득공제신고서 소기업소상공인 공제부금 업데이트*/
        UPDATE YEA_INCDEC A
           SET YEA_INC_NUM023 = (
                              SELECT NVL(SUM(YEA_FM1_NUM001),0)
                                FROM YEA_YEYSOM B
                               WHERE A.YEA_STD_YY = B.YEA_STD_YY
                                 AND A.YEA_EMP_NO = B.YEA_EMP_NO
                                 AND B.YEA_FM1_STR002 = 'K101M'
                            )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /***********************************************************************
            장기집합투자증권저축 반영
        ************************************************************************/

        DELETE FROM YEA_PENSAV
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_PEN_STR001 IN ('51');


         INSERT INTO YEA_PENSAV (
                YEA_STD_YY       /*기준년월*/
               ,YEA_EMP_NO       /*사원번호*/
               ,YEA_PENS_SEQ     /*연금명세서일련번호*/
               ,YEA_PEN_STR001   /*연금소득공제구분코드*/
               ,YEA_PEN_STR002   /*금융기관코드*/
               ,YEA_PEN_STR003   /*연금저축계좌번호*/
               ,YEA_PEN_NUM001   /*불입금액*/
               ,YEA_PEN_NUM002   /*연금및저축공제액*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT  YEA_STD_YY   /*기준년월*/
               ,YEA_EMP_NO   /*사원번호*/
               ,ROW_NUMBER() OVER (ORDER BY YEA_STD_YY, YEA_EMP_NO)
               +(SELECT NVL(MAX(YEA_PENS_SEQ), 0)
                   FROM YEA_PENSAV
                  WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO)   /*연금명세서일련번호*/
               ,'51'   /*연금소득공제구분코드*/
               ,SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'com_cd')   /*금융기관코드*/
               ,SF_YEA_ENCRYPT_ACCT_NO(SF_YEA_ATTRVALS(A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FORM_SEQ1, 'secu_no'))   /*연금저축계좌번호*/
               ,SUM(YEA_FM1_NUM001)   /*불입금액*/
               ,0   /*연금및저축공제액*/
               ,#UPDT_USID#   /*입력작업자*/
               ,SYSDATE   /*입력일시*/
               ,#UPDT_USID#   /*수정작업자*/
               ,SYSDATE   /*수정일시*/
          FROM YEA_YEYSOM A
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_FM1_STR002 IN ('N101Y', 'N101M')
      GROUP BY YEA_STD_YY, YEA_EMP_NO, YEA_FORM_SEQ1;


        /*소득공제신고서 장기집합투자증권저축 업데이트*/
        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM047) = (
                                        SELECT NVL(SUM(CASE WHEN YEA_PEN_STR001 = '51' THEN YEA_PEN_NUM001 ELSE 0 END),0)
                                          FROM YEA_PENSAV B
                                         WHERE YEA_STD_YY = #YEA_STD_YY#
                                           AND YEA_EMP_NO = #YEA_EMP_NO#
                                        )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;


        /***********************************************************************
            기부금 반영 [2014귀속] 기본공제대상자만 되도록 반영
        ************************************************************************/
        UPDATE YEA_YEFAMI A
           SET YEA_FAM_NUM018 = (
                            SELECT NVL(SUM(YEA_FM1_NUM001),0)
                              FROM YEA_YEYSOM B
                        INNER JOIN YEA_YEFAMI C
                                ON B.YEA_STD_YY = C.YEA_STD_YY
                               AND B.YEA_EMP_NO = C.YEA_EMP_NO
                               AND B.YEA_FM1_STR003 = C.YEA_FAM_STR004
                             WHERE A.YEA_STD_YY = B.YEA_STD_YY
                               AND A.YEA_EMP_NO = B.YEA_EMP_NO
                               AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
                               AND B.YEA_FM1_STR002 IN ('L101Y', 'L101D')
                               AND C.YEA_FAM_STR005 = '1'    /*기본공제대상자만*/
                           )
              ,YEA_UPD_USER_ID = #UPDT_USID#
              ,YEA_UPD_DATE = SYSDATE
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;

        /*기부금명세서*/
        /*기부금명세서 초기화*/
        DELETE FROM YEA_DONASP
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#
           AND YEA_DOS_STR001 = '1';  /*국세청자료*/


         INSERT INTO YEA_DONASP (
                YEA_STD_YY   /*기준년월*/
               ,YEA_EMP_NO   /*사원번호*/
               ,YEA_FAMI_SEQ   /*가족일련번호*/
               ,YEA_DONA_SEQ   /*기부금일련번호*/
               ,YEA_DOS_STR005   /*기부자관계코드*/
               ,YEA_DOS_STR006   /*기부유형코드*/
               ,YEA_DOS_STR007   /*기부처*/
               ,YEA_DOS_STR008   /*사업자주민번호*/
               ,YEA_DOS_STR009   /*기부내용*/
               ,YEA_DOS_NUM001   /*기부건수*/
               ,YEA_DOS_NUM002   /*기부금액*/
               ,YEA_DOS_STR001   /*자료구분코드*/
               ,YEA_DOS_STR002   /*가족성명*/
               ,YEA_DOS_STR003   /*주민등록번호*/
               ,YEA_DOS_STR004   /*내외국인구분코드*/
               ,YEA_INS_USER_ID /*입력작업자*/
               ,YEA_INS_DATE    /*입력일시*/
               ,YEA_UPD_USER_ID /*수정작업자*/
               ,YEA_UPD_DATE    /*수정일시*/
               )
        SELECT A.YEA_STD_YY   /*기준년월*/
              ,A.YEA_EMP_NO   /*사원번호*/
              ,A.YEA_FAMI_SEQ   /*가족일련번호*/
              ,ROW_NUMBER() OVER (ORDER BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ)
              +(SELECT NVL(MAX(YEA_DONA_SEQ), 0)
                  FROM YEA_DONASP
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO
                   AND YEA_FAMI_SEQ = A.YEA_FAMI_SEQ)   /*기부금일련번호*/
              ,CASE WHEN A.YEA_FAM_STR001 = '0' THEN '1' WHEN A.YEA_FAM_STR001 = '3' THEN '2' WHEN A.YEA_FAM_STR001 IN ('4','5') THEN '3' 
                    WHEN A.YEA_FAM_STR001 IN ('1','2') THEN '4' WHEN A.YEA_FAM_STR001 = '6' THEN '5' ELSE '6' END                    
              ,(SELECT YEA_FM2_STR002
                  FROM YEA_YEYSOS
                 WHERE YEA_STD_YY = A.YEA_STD_YY
                   AND YEA_EMP_NO = A.YEA_EMP_NO
                   AND YEA_FORM_SEQ1 = B.YEA_FORM_SEQ1
                   AND YEA_FM2_STR001 = 'donation_cd')   /*기부유형코드*/
              ,B.YEA_FM1_STR007   /*기부처*/
              ,SF_YEA_ENCRYPT_SSN(B.YEA_FM1_STR006)   /*사업자주민번호*/
              ,'금전'   /*기부내용*/
              ,COUNT(A.YEA_EMP_NO)   /*기부건수*/
              ,NVL(SUM(YEA_FM1_NUM001),0)   /*기부금액*/
              ,'1'   /*자료구분코드*/
              ,A.YEA_FAM_STR003   /*가족성명*/
              ,A.YEA_FAM_STR004   /*주민등록번호*/
              ,A.YEA_FAM_STR002   /*내외국인구분코드*/
              ,#UPDT_USID#   /*입력작업자*/
              ,SYSDATE   /*입력일시*/
              ,#UPDT_USID#   /*수정작업자*/
              ,SYSDATE   /*수정일시*/
          FROM YEA_YEFAMI A
    INNER JOIN YEA_YEYSOM B
            ON A.YEA_STD_YY = B.YEA_STD_YY
           AND A.YEA_EMP_NO = B.YEA_EMP_NO
           AND A.YEA_FAM_STR004 = B.YEA_FM1_STR003
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND B.YEA_FM1_STR002 IN ('L101Y', 'L101D')
           AND A.YEA_FAM_STR005 = '1'    /*기본공제대상자만*/
      GROUP BY A.YEA_STD_YY, A.YEA_EMP_NO, A.YEA_FAMI_SEQ, A.YEA_FAM_STR001, B.YEA_FORM_SEQ1, B.YEA_FM1_STR007, B.YEA_FM1_STR006, A.YEA_FAM_STR003, A.YEA_FAM_STR004, A.YEA_FAM_STR002;


        /*기부금 업데이트*/
        /*SP_YEAA0070_PROC06(##YEA_STD_YY##, ##YEA_EMP_NO##);*/
        
        
        /*PDF파일 정보 업데이트*/
        UPDATE YEA_INCDEC 
           SET YEA_INC_STR048 = #YEA_INC_STR048#	/*PDF파일 물리파일명*/
              ,YEA_INC_STR049 = #YEA_INC_STR049#	/*PDF파일 파일경로*/
              ,YEA_INC_STR050 = #YEA_INC_STR050#	/*PDF파일 논리파일명*/
         WHERE YEA_STD_YY = #YEA_STD_YY#
           AND YEA_EMP_NO = #YEA_EMP_NO#;
        	
    END;
    ]]>	
	</update>   
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산처리 소득공제신고서에 반영
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC08" parameterClass="hashmap">
    <![CDATA[
    BEGIN     /* YEAA0070_2015.PROC08.연말정산처리 소득공제신고서에 반영 */
     	/*월세주택임차차입금1*/
         UPDATE YEA_INCDEC A
         SET (YEA_INC_NUM074) = (
            SELECT
               NVL(SUM(YEA_RT1_NUM001),0)
            FROM YEA_RENTA1 B
            WHERE YEA_STD_YY = #YEA_STD_YY#
        		AND YEA_EMP_NO = #YEA_EMP_NO#
          )
      WHERE A.YEA_STD_YY = #YEA_STD_YY#
        AND A.YEA_EMP_NO = #YEA_EMP_NO#;

      /*월세주택임차차입금2*/
         UPDATE YEA_INCDEC A
         SET (YEA_INC_NUM016) = (
            SELECT
               NVL(SUM(YEA_RT2_NUM002),0)
            FROM YEA_RENTA2 B
            WHERE YEA_STD_YY = #YEA_STD_YY#
        		AND YEA_EMP_NO = #YEA_EMP_NO#
          )
      WHERE A.YEA_STD_YY = #YEA_STD_YY#
        AND A.YEA_EMP_NO = #YEA_EMP_NO#;
     
     END;
    ]]>	
	</update>
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산 (사후처리)
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC09" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC09.연말정산 (사후처리) */
        sSQL VARCHAR2(4000);
        v_ROWCNT INT;
    BEGIN
        SELECT REPLACE(REPLACE(YEA_POSTSQL_DEL,'[년도]','''' || #YEA_STD_YY# || ''''), '[사번]', '''' || #YEA_EMP_NO# || '''')
          INTO sSQL
          FROM YEA_MINFOM
         WHERE YEA_STD_YY = #YEA_STD_YY#;

        EXECUTE IMMEDIATE sSQL;

        IF #STATUS# = 'INSERT' THEN
           SELECT REPLACE(REPLACE(YEA_POSTSQL_INS, '[년도]', '''' || #YEA_STD_YY# || ''''), '[사번]', '''' || #YEA_EMP_NO# || '''')
             INTO sSQL
             FROM YEA_MINFOM
            WHERE YEA_STD_YY = #YEA_STD_YY#;

           EXECUTE IMMEDIATE sSQL;
        END IF;
    END;	
    ]]>	
	</update>  
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 연말정산 (의료비명세->>소득공제신고서에 반영)
********************************************************************************/
-->	
    <update id="YEAA0070_2015.PROC10" parameterClass="hashmap">
    <![CDATA[
    DECLARE     /* YEAA0070_2015.PROC10.연말정산 (의료비명세->>소득공제신고서에 반영) */
	BEGIN
    	/*가족사항update*/
        UPDATE YEA_YEFAMI A
           SET (YEA_FAM_NUM005, YEA_FAM_NUM006, YEA_FAM_NUM022, YEA_FAM_NUM023) = (
                SELECT
                     SUM(CASE WHEN NVL(YEA_MES_STR008,0) != '1' AND YEA_MES_STR001 = '1' THEN YEA_MES_NUM002 ELSE 0 END)  /*[2015귀속_수정] 의료비_국세청*/
                    ,SUM(CASE WHEN NVL(YEA_MES_STR008,0) != '1' AND YEA_MES_STR001 != '1' THEN YEA_MES_NUM002 ELSE 0 END) /*[2015귀속_수정] 의료비_기타*/
                    ,SUM(CASE WHEN NVL(YEA_MES_STR008,0) = '1' AND YEA_MES_STR001 = '1' THEN YEA_MES_NUM002 ELSE 0 END)   /*[2015귀속] 난임시술비_국세청*/
                    ,SUM(CASE WHEN NVL(YEA_MES_STR008,0) = '1' AND YEA_MES_STR001 != '1' THEN YEA_MES_NUM002 ELSE 0 END)  /*[2015귀속] 난임시술비_기타*/
                  FROM YEA_MEDISP B
                 WHERE A.YEA_STD_YY = B.YEA_STD_YY
                   AND A.YEA_EMP_NO = B.YEA_EMP_NO
                   AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
            )
        WHERE A.YEA_STD_YY = #YEA_STD_YY#
          AND A.YEA_EMP_NO = #YEA_EMP_NO#;

        UPDATE YEA_INCDEC A
           SET (YEA_INC_NUM054, YEA_INC_NUM055) = (
                SELECT
                     Sum(CASE WHEN A.YEA_FAM_STR001 = '0' OR NVL(A.YEA_FAM_STR009, '0') >= '1' OR Nvl(B.YEA_MES_STR008,0) = '1' OR  /*[2015귀속] 난임시술비*/
                     CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN B.YEA_MES_NUM002 ELSE 0 END) AS YEN_INC_NUM054
                    ,Sum(CASE WHEN A.YEA_FAM_STR001 = '0' OR NVL(A.YEA_FAM_STR009, '0') >= '1' OR Nvl(B.YEA_MES_STR008,0) = '1' OR /*[2015귀속] 난임시술비*/
                     CASE WHEN SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),7,1) IN ('1','2','5','6') THEN '19' ELSE '20' END || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004),1,6) <= TO_CHAR(TO_NUMBER(SUBSTR(#YEA_STD_YY#,1,4))-65) || '1231' THEN 0 ELSE B.YEA_MES_NUM002 END) AS YEN_INC_NUM055
                FROM YEA_YEFAMI A
              LEFT JOIN YEA_MEDISP B   ON A.YEA_STD_YY = B.YEA_STD_YY AND A.YEA_EMP_NO = B.YEA_EMP_NO AND A.YEA_FAMI_SEQ = B.YEA_FAMI_SEQ
                WHERE A.YEA_STD_YY = #YEA_STD_YY#
                  AND A.YEA_EMP_NO = #YEA_EMP_NO#
              )
          WHERE A.YEA_STD_YY = #YEA_STD_YY#
            AND A.YEA_EMP_NO = #YEA_EMP_NO#;

	END;
    ]]>	
	</update>  
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 개인공제자료 PDF 업로드 처리위한 정보 조회
********************************************************************************/
-->	
    <select id="YEAA0070_2015.SEARCH90" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.SEARCH90.개인공제자료 PDF 업로드 처리위한 정보 조회 */
    SELECT A.YEA_STD_YY AS STDS_YMTH /* 기준년월 */
         , X.YEA_EMP_NO AS EMPL_NUMB	/* 사원번호 */
         , X.YEA_EMP_NM AS EMPL_NAME	/* 성명 */
         , NVL(A.YEA_INC_STR025, '0') AS ENDE_YSNO /* 입력마감여부 */
         , NVL(B.YEA_PRC_STR001, '0') AS EYCD_YSNO /* 연말정산확정여부 */
         , SUBSTR(X.YEA_EMP_SSN, 7) AS SCRT_NUMB /* 비밀번호(주민번호뒷자리)*/
	 FROM TABLE(SF_YEA_MASTXD(#YEA_STD_YY# || '1231')) X
	   LEFT OUTER JOIN YEA_INCDEC A
	     ON X.YEA_EMP_NO = A.YEA_EMP_NO
	    AND A.YEA_STD_YY = #YEA_STD_YY#
	   LEFT OUTER JOIN YEA_YEPROC B
	     ON A.YEA_STD_YY = B.YEA_STD_YY
	    AND A.YEA_EMP_NO = B.YEA_EMP_NO
	WHERE X.YEA_EMP_NO = #EMPL_NUMB#
    ]]>	
	</select>        
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 소득공제신고서1(기본) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT00" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT00.소득공제신고서1(기본) 출력회 */
        SELECT A.YEA_STD_YY     /*정산년월*/
             , A.YEA_EMP_NO      /*사원번호*/
             , B.YEA_EMP_NM      /*성명*/
             , B.YEA_EMP_SSN    /*주민등록번호*/
             , CASE WHEN B.YEA_HIRE_YMD < A.YEA_STD_YY || '0101' THEN A.YEA_STD_YY || '0101' ELSE  B.YEA_HIRE_YMD END AS YEA_HIRE_YMD    /*입사일*/
             , CASE WHEN NVL(B.YEA_QUIT_YMD,'29991231') > A.YEA_STD_YY || '1231' THEN A.YEA_STD_YY || '1231' ELSE  B.YEA_QUIT_YMD END AS YEA_QUIT_YMD   /*퇴사일*/
             , A.YEA_INC_NUM001      /*국민연금전근무지*/
             , A.YEA_INC_NUM002      /*국민연금현근무지*/
             , NVL(A.YEA_INC_NUM003,0) + NVL(YEA_INC_NUM005,0) + NVL(YEA_INC_NUM007,0) + NVL(YEA_INC_NUM009,0) AS YEA_INC_SUM001 /*국민연금보혐료외의 연금보험료(종)*/
             , NVL(A.YEA_INC_NUM004,0) + NVL(YEA_INC_NUM006,0) + NVL(YEA_INC_NUM008,0) + NVL(YEA_INC_NUM010,0) AS YEA_INC_SUM002 /*국민연금보혐료외의 연금보험료(현)*/
             , NVL(A.YEA_INC_NUM001,0) + NVL(A.YEA_INC_NUM002,0) + NVL(YEA_INC_NUM003,0) + NVL(YEA_INC_NUM004,0) + NVL(YEA_INC_NUM005,0)
               + NVL(A.YEA_INC_NUM006,0) + NVL(A.YEA_INC_NUM007,0) + NVL(YEA_INC_NUM008,0) + NVL(YEA_INC_NUM009,0) + NVL(YEA_INC_NUM010,0) AS YEA_INC_SUM003  /*연금보혐료계*/
             , A.YEA_INC_NUM011      /*건강보험전근무지*/
             , A.YEA_INC_NUM012      /*건강보험현근무지*/
             , A.YEA_INC_NUM013      /*고용보험전근무지*/
             , A.YEA_INC_NUM014      /*고용보험현근무지*/
             , NVL(A.YEA_INC_NUM011,0) + NVL(A.YEA_INC_NUM012,0) + NVL(A.YEA_INC_NUM013,0) + NVL(A.YEA_INC_NUM014,0) AS YEA_INC_SUM004  /*건강+고용 보험료계*/
             , A.YEA_INC_NUM015      /*주택임차원리금상환액(대출기관)*/
             , A.YEA_INC_NUM016      /*주택임차원리금상환액(거주자)*/
             , A.YEA_INC_NUM017      /*장기주택저당차입금_2011년이전(15년미만)*/
             , A.YEA_INC_NUM018      /*장기주택저당차입금 _2011년이전(15년~29년)*/
             , A.YEA_INC_NUM019      /*장기주택저당차입금_2011년이전(30년이상)*/
             , A.YEA_INC_NUM020      /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
             , A.YEA_INC_NUM021      /*장기주택저당차입금_2012년이후(기타대출)*/
             , A.YEA_INC_NUM077      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(고정금리이면서,비거치)*/
             , A.YEA_INC_NUM078      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(고정금리이거나,비거치)*/
             , A.YEA_INC_NUM079      /*[2015귀속]_장기주택임차저당차입금_2015년이후_15년이상(기타대출)*/
             , A.YEA_INC_NUM080      /*[2015귀속]_장기주택임차저당차입금_2015년이후_10~15년(고정금리이거나,비거치)*/             
             , NVL(A.YEA_INC_NUM015,0) + NVL(A.YEA_INC_NUM016,0) + NVL(A.YEA_INC_NUM017,0) + NVL(A.YEA_INC_NUM018,0) + NVL(A.YEA_INC_NUM019,0)
               + NVL(A.YEA_INC_NUM020,0) + NVL(A.YEA_INC_NUM021,0)
			   + NVL(A.YEA_INC_NUM077,0) + NVL(A.YEA_INC_NUM078,0) + NVL(A.YEA_INC_NUM079,0) + NVL(A.YEA_INC_NUM080,0) AS YEA_INC_SUM005 /* 장기주택저당차입금계 [2015귀속]_추가 장기주택임차차입금2015년이후*/	
             , NVL(H.DONA10,0) AS YEA_INC_SUM017 /*[2015귀속]_법정기부금(이월분)*/
             , NVL(H1.DONA41,0) AS YEA_INC_SUM018 /*[2015귀속]_지정기부금_종교단체외(이월분)*/
             , NVL(H2.DONA40,0) AS YEA_INC_SUM019 /*[2015귀속]_지정기부금_종교단체(이월분)*/
             , NVL(H.DONA10,0) + NVL(H1.DONA41,0) + NVL(H2.DONA40,0) AS YEA_INC_SUM020 /*[2015귀속]기부금이월분합계*/
             , A.YEA_INC_NUM022      /*개인연금저축*/
             , A.YEA_INC_NUM023      /*소기업·소상공인 공제부금*/
             , NVL(A.YEA_INC_NUM024,0) + NVL(A.YEA_INC_NUM081,0) AS YEA_INC_NUM024      /* 주택마련저축_청약저축 [2015귀속]_추가 청약저축2015.01.01이후가입분*/
             , A.YEA_INC_NUM025      /*주택마련저축_근로자주택마련*/
             , NVL(A.YEA_INC_NUM026,0) + NVL(A.YEA_INC_NUM082,0) AS YEA_INC_NUM026      /* 주택마련저축_주택청약종합 [2015귀속]_추가 주택청약종합2015.01.01이후가입분*/
             , NVL(A.YEA_INC_NUM024,0) + NVL(A.YEA_INC_NUM025,0) + NVL(A.YEA_INC_NUM026,0) + NVL(A.YEA_INC_NUM081,0) + NVL(A.YEA_INC_NUM082,0) AS YEA_INC_SUM006    /*주택마련저축소득공제계 [2015귀속]_추가 청약저축,주택청약종합(2015.01.01이후가입분)*/
             /*, NVL(A.YEA_INC_NUM027,0) + NVL(A.YEA_INC_NUM028,0) AS YEA_INC_SUM007    /*투자조합출자등_2012년 출자·투자분[2015귀속]_삭제*/
             , NVL(A.YEA_INC_NUM029,0) AS YEA_INC_NUM029     /*[2015귀속]_변경 2013년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM030,0) AS YEA_INC_NUM030     /*[2015귀속]_변경 2013년 출자·투자분 벤처등 */
             , NVL(A.YEA_INC_NUM031,0) AS YEA_INC_NUM031     /*[2015귀속]_변경 2014년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM032,0) + NVL(A.YEA_INC_NUM033,0) AS YEA_INC_SUM009 /*[2015귀속]_변경 2014년 출자·투자분 벤처등 */
             , NVL(A.YEA_INC_NUM027,0) AS YEA_INC_NUM027         /*[2015귀속]_변경 2015년 출자·투자분 조합등 */
             , NVL(A.YEA_INC_NUM028,0) + NVL(A.YEA_INC_NUM083,0) + NVL(A.YEA_INC_NUM084,0) AS YEA_INC_SUM007  /*[2015귀속]_추가 투자조합출자등_2015년 이후 출자·투자분 벤처등*/
             , NVL(A.YEA_INC_NUM027,0) + NVL(A.YEA_INC_NUM028,0) + NVL(A.YEA_INC_NUM029,0) + NVL(A.YEA_INC_NUM030,0) + NVL(A.YEA_INC_NUM031,0)
               + NVL(A.YEA_INC_NUM032,0) + NVL(A.YEA_INC_NUM033,0) + NVL(A.YEA_INC_NUM083,0) + NVL(A.YEA_INC_NUM084,0) AS YEA_INC_SUM010     /* 투자조합출자액 합계 [2015귀속]_추가 투자조합출자등_2015년 이후 출자·투자분*/
             , A.YEA_INC_NUM034      /*신용카드*/
             , A.YEA_INC_NUM035      /*직불카드등*/
             , A.YEA_INC_NUM036      /*현금영수증*/
             , A.YEA_INC_NUM037      /*전통시장사용금액 2012.12.26 추가*/
             , A.YEA_INC_NUM038      /*대중교통사용금액 [2013귀속] 추가*/
             , NVL(A.YEA_INC_NUM034,0) + NVL(A.YEA_INC_NUM035,0) + NVL(A.YEA_INC_NUM036,0) + NVL(A.YEA_INC_NUM037,0) + Nvl(A.YEA_INC_NUM038,0) AS YEA_INC_SUM011    /*[2013귀속] 신용카드등사용액소득공제계*/
             , A.YEA_INC_NUM039      /*본인 신용카드등 사용액(2013년)*/
             , A.YEA_INC_NUM040      /*본인 신용카드등 사용액(2014년)*/
             , A.YEA_INC_NUM041      /*본인 추가공제율 사용분(2013년)*/
             , A.YEA_INC_NUM042      /*[2015년귀속]_변경 본인 추가공제율 사용분(2015년상반기)*/
             , A.YEA_INC_NUM085      /*[2015년귀속]_추가 본인 신용카드등 사용액(2015년)*/
             , A.YEA_INC_NUM086      /*[2015년귀속]_추가 본인 추가공제율 사용분(2014년)*/
             , A.YEA_INC_NUM087      /*[2015년귀속]_추가 본인 추가공제율 사용분(2015년하반기)*/
             , A.YEA_INC_NUM043      /*우리사주조합 출연금*/
             /*, A.YEA_INC_NUM044      우리사주조합 기부금 [2015귀속]_이동 세액감면및공제항목으로이동*/
             , A.YEA_INC_NUM045      /*고용유지중소기업 근로자*/
             , A.YEA_INC_NUM046      /*목돈안드는전세이자상환액*/
             , A.YEA_INC_NUM047      /*장기집합투자증권저축*/
             , A.YEA_INC_NUM048      /*자녀수*/
             , A.YEA_INC_STR001      /*입국목적*/
             , A.YEA_INC_STR002      /*기술도입계약 또는 근로제공일*/
             , A.YEA_INC_STR003      /*외국인근로자_감면기간 만료일*/
             , A.YEA_INC_STR004      /*외국인 근로소득에 대한 감면 접수일*/
             , A.YEA_INC_STR005      /*외국인 근로소득에 대한 감면 제출일*/
             , A.YEA_INC_STR006      /*근로소득에 대한 조세조약 상 면제 접수일*/
             , A.YEA_INC_STR007      /*근로소득에 대한 조세조약 상 면제 제출일*/
             , A.YEA_INC_STR008      /*중소기업 취업자 감면_취업일*/
             , A.YEA_INC_STR009      /*중소기업 취업자 감면기간_종료일*/
             , A.YEA_INC_NUM049      /*과학기술인공제*/
             , A.YEA_INC_NUM050      /*「근로자퇴직급여 보장법」에 따른 퇴직연금*/
             , A.YEA_INC_NUM051      /*연금저축*/
             , NVL(A.YEA_INC_NUM049,0) + NVL(A.YEA_INC_NUM050,0) + NVL(A.YEA_INC_NUM051,0) AS YEA_INC_SUM012       /*연금계좌계*/
             , A.YEA_INC_NUM052      /*일반보장성보험*/
             , A.YEA_INC_NUM053      /*장애인보장성보험*/
             , NVL(A.YEA_INC_NUM052,0) + NVL(A.YEA_INC_NUM053,0) AS YEA_INC_SUM013   /*보험료 계*/
             , A.YEA_INC_NUM054      /*의료비_본인ㆍ65세 이상자ㆍ장애인*/
             , A.YEA_INC_NUM055      /*의료비_그 밖의 공제대상자*/
             , NVL(A.YEA_INC_NUM054,0) + NVL(A.YEA_INC_NUM055,0) AS YEA_INC_SUM014  /*의료비계*/
             , A.YEA_INC_NUM056      /*본인교육비*/
             , A.YEA_INC_NUM057      /*취학전아동수*/
             , A.YEA_INC_NUM058      /*취학전아동교육비*/
             , A.YEA_INC_NUM059      /*초중고학생수*/
             , A.YEA_INC_NUM060      /*초중고교육비*/
             , A.YEA_INC_NUM061      /*대학생수*/
             , A.YEA_INC_NUM062      /*대학생교육비*/
             , A.YEA_INC_NUM063      /*장애인수*/
             , A.YEA_INC_NUM064      /*장애인교육비*/
             , NVL(A.YEA_INC_NUM056,0) + NVL(A.YEA_INC_NUM058,0) + NVL(A.YEA_INC_NUM060,0) + NVL(A.YEA_INC_NUM062,0) + NVL(A.YEA_INC_NUM064,0) AS YEA_INC_SUM015  /*교육비계*/
             , A.YEA_INC_NUM065      /*정치자금기부금(10만원이하)*/
             , A.YEA_INC_NUM066      /*정치자금기부금(10만원초과)*/             
             , A.YEA_INC_NUM067      /*법정기부금(당해)*/
             , A.YEA_INC_NUM044      /*[2015귀속]_이동 우리사주조합기부금*/
             , NVL(H3.YEA_DOS_NUM002,0) AS YEA_INC_SUM021    /*[2015귀속]_변경 지정기부금(종교단체외)*/
             , NVL(A.YEA_INC_NUM068,0) - NVL(H3.YEA_DOS_NUM002,0) AS YEA_INC_NUM068     /*[2015귀속]_변경 지정기부금(종교단체)*/
             , NVL(A.YEA_INC_NUM065,0) + NVL(A.YEA_INC_NUM066,0) + NVL(A.YEA_INC_NUM067,0) + NVL(A.YEA_INC_NUM068,0) + NVL(A.YEA_INC_NUM044,0) AS YEA_INC_SUM016  /*[2015귀속]_추가 기부금 계 우리사주조합기부금*/
             , A.YEA_INC_NUM070      /*외국납부세액_국외원천소득*/
             , A.YEA_INC_NUM071      /*외국납부세액_납세액(외화)*/
             , A.YEA_INC_NUM072      /*외국납부세액_납세액(원화)*/
             , A.YEA_INC_STR010      /*외국납부세액_납세국명*/
             , A.YEA_INC_STR011      /*외국납부세액_납부일*/
             , A.YEA_INC_STR012      /*외국납부세액_신청서제출일*/
             , A.YEA_INC_STR013      /*외국납부세액_국외근무처*/
             , A.YEA_INC_STR014      /*외국납부세액_근무기간*/
             , A.YEA_INC_STR015      /*외국납부세액_직책*/
             , A.YEA_INC_NUM073      /*주택자금차입금이자세액공제*/
             , A.YEA_INC_NUM074      /*월세세액공제*/
             , B.YEA_RATE_YN         /*단일세율적용여부*/
             , A.YEA_INC_STR016      /*종근무지명*/
             , A.YEA_INC_STR017      /*종근무지사업자번호*/
             , A.YEA_INC_NUM075      /*종근무지급여총액*/
             , A.YEA_INC_NUM076      /*종근무지소득세*/
             , A.YEA_INC_STR018      /*종근무지영수증제출여부*/
             , A.YEA_INC_STR019      /*소득공제명세서제출여부*/
             , A.YEA_INC_STR020      /*연금저축명세서제출여부*/
             , A.YEA_INC_STR021      /*월세액명세서제출여부*/
             , A.YEA_INC_STR022      /*의료비명세서제출여부*/
             , A.YEA_INC_STR023      /*기부금명세서제출여부*/
             , A.YEA_INC_STR024      /* 세대주여부*/
             , B.YEA_HOME_ADDRESS1 || ' ' || B.YEA_HOME_ADDRESS2 AS YEA_HOME_ADDRESS /*사원주소*/
             , B.YEA_HOME_TEL_NO     /*전화번호*/
             /*, CASE WHEN NVL(LENGTH(TRIM(B.PHON_NUMB)),0)>0 THEN B.PHON_NUMB ELSE B.CELL_NUMB END AS HTEL_NUMB   /*전화번호*/
             , C.YEA_BRANCH_NM       /*회사명*/
             , C.YEA_BIZ_NO          /*사업자번호*/
             , C.YEA_CORP_NO         /*법인번호*/
             , C.YEA_ADDRESS1 || ' ' || C.YEA_ADDRESS2 AS YEA_ADDRESS /*회사주소*/
             , C.YEA_TEL_NO          /*회사전화번호*/
             , SF_YEA_COMMNAME('YEA_90002', C.YEA_TAXOFFIC_CD) AS YEA_TAXOFFIC_NM         /*세무서명*/
             , B.YEA_LIVE_CD         /*거주자구분*/
             , B.YEA_NATION_CD       /*거주지국코드*/
             , SF_YEA_COMMNAME('YEA_90003',B.YEA_NATION_CD) AS YEA_NATION_NM     /*거주지국명*/
             , D.YEA_FAM_STR005 AS YEA_FAM_CNT001   /*기본공제자 수*/
             , D.YEA_FAM_STR006 AS YEA_FAM_CNT002   /*경로우대자 수*/
             , D.YEA_FAM_STR007 AS YEA_FAM_CNT003   /*부녀자 수*/
             , D.YEA_FAM_STR008 AS YEA_FAM_CNT004   /*한부모 수*/
             , D.YEA_FAM_STR009 AS YEA_FAM_CNT005   /*장애인 수*/
             , D.YEA_FAM_STR011 AS YEA_FAM_CNT006	/*6세이하 수*/
             , D.YEA_FAM_STR012 AS YEA_FAM_CNT007	/*출산입양 수*/
             , D.YEA_FAM_NUM001 AS YEA_FAM_SUM001   /*보험료_건강고용_국세청*/
             , D.YEA_FAM_NUM002 AS YEA_FAM_SUM002   /*보험료_건강고용_기타*/
             , D.YEA_FAM_NUM003 AS YEA_FAM_SUM003   /*보험료_보장성_국세청*/
             , D.YEA_FAM_NUM004 AS YEA_FAM_SUM004   /*보험료_보장성_기타*/
             , D.YEA_FAM_NUM020 AS YEA_FAM_SUM020	/*보험료_장애인전용_국세청*/
             , D.YEA_FAM_NUM021 AS YEA_FAM_SUM021	/*보험료_장애인전용_국세청*/
             , D.YEA_FAM_NUM005 AS YEA_FAM_SUM005   /*의료비_국세청*/
             , D.YEA_FAM_NUM006 AS YEA_FAM_SUM006   /*의료비_기타*/
             , D.YEA_FAM_NUM007 AS YEA_FAM_SUM007   /*교육비_국세청*/
             , D.YEA_FAM_NUM008 AS YEA_FAM_SUM008   /*교육비_기타*/
             , D.YEA_FAM_NUM009 AS YEA_FAM_SUM009   /*신용카드_국세청*/
             , D.YEA_FAM_NUM010 AS YEA_FAM_SUM010   /*신용카드_기타*/
             , D.YEA_FAM_NUM011 AS YEA_FAM_SUM011   /*직불카드_국세청*/
             , D.YEA_FAM_NUM012 AS YEA_FAM_SUM012   /*직불카드_기타*/
             , D.YEA_FAM_NUM013 AS YEA_FAM_SUM013   /*현금영수증_국세청*/
             , D.YEA_FAM_NUM014 AS YEA_FAM_SUM014   /*전통시장_국세청*/
             , D.YEA_FAM_NUM015 AS YEA_FAM_SUM015   /*전통시장_기타*/
             , D.YEA_FAM_NUM016 AS YEA_FAM_SUM016   /*대중교통_국세청*/
             , D.YEA_FAM_NUM017 AS YEA_FAM_SUM017   /*대중교통_기타*/
             , D.YEA_FAM_NUM018 AS YEA_FAM_SUM018   /*기부금_국세청*/
             , D.YEA_FAM_NUM019 AS YEA_FAM_SUM019   /*기부금_기타*/
          FROM YEA_INCDEC A                          /*소득공제신고 테이블*/
     LEFT JOIN TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) B
            ON B.YEA_EMP_NO = A.YEA_EMP_NO
     LEFT JOIN (
                SELECT A.*
                     , ROW_NUMBER() OVER(
                             PARTITION BY A.YEA_BRANCH_CD
                                 ORDER BY A.YEA_BRANCH_YMD DESC
                       ) AS ROW_NUM
                  FROM VI_YEA_BRCHXM A
               ) C
            ON C.YEA_BRANCH_CD = #YEA_BRANCH_CD#            
           AND C.ROW_NUM = 1
            /*[2015귀속]_추가 법정기부금(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, NVL(Sum(YEA_DOA_NUM003),0) AS DONA10
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '10'            /*법정기부금*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) H
                       ON A.YEA_STD_YY = H.YEA_STD_YY
                      AND A.YEA_EMP_NO = H.YEA_EMP_NO
          /*[2015귀속]_추가 법정기부금(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금_종교단체외(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, NVL(Sum(YEA_DOA_NUM003),0) AS DONA41
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '41'            /*지정기부금(종교단체외)*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) H1
                       ON A.YEA_STD_YY = H1.YEA_STD_YY
                      AND A.YEA_EMP_NO = H1.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금_종교단체외(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금_종교단체(이월분) 조정명세서에서 가져오기*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, NVL(Sum(YEA_DOA_NUM003),0) AS DONA40
                             FROM YEA_DONAAD
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOA_STR002 <= '2013'         /*기부금이월금액이므로 소득공제대상금액 2013년이전금액 */
                              AND YEA_DOA_STR001 = '40'            /*지정기부금(종교단체)*/
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) H2
                       ON A.YEA_STD_YY = H2.YEA_STD_YY
                      AND A.YEA_EMP_NO = H2.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금_종교단체(이월분) 조정명세서에서 가져오기끝*/
          /*[2015귀속]_추가 지정기부금(종교단체외)분리*/
          LEFT OUTER JOIN (SELECT YEA_STD_YY, YEA_EMP_NO, NVL(Sum(YEA_DOS_NUM002),0) AS YEA_DOS_NUM002
                             FROM YEA_DONASP
                            WHERE YEA_STD_YY = #YEA_STD_YY#
                              AND YEA_EMP_NO = #YEA_EMP_NO#
                              AND YEA_DOS_STR006 = '40'
                            GROUP BY YEA_STD_YY, YEA_EMP_NO) H3
                       ON A.YEA_STD_YY = H3.YEA_STD_YY
                      AND A.YEA_EMP_NO = H3.YEA_EMP_NO
          /*[2015귀속]_추가 지정기부금(종교단체외)분리끝*/
     LEFT JOIN (                          /*소득공제신고의 인적공제 합계*/
                SELECT YEA_EMP_NO
                     , SUM(CASE WHEN YEA_FAM_STR005 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR005   /*기본공제자 수*/
                     , SUM(CASE WHEN YEA_FAM_STR006 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR006   /*경로우대자 수*/
                     , SUM(CASE WHEN YEA_FAM_STR007 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR007   /*부녀자 수*/
                     , SUM(CASE WHEN YEA_FAM_STR008 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR008   /*한부모 수*/
                     , SUM(CASE WHEN NVL(YEA_FAM_STR009,'0') <> '0' THEN 1 ELSE 0 END) AS YEA_FAM_STR009   /*장애인 수*/
                     , SUM(CASE WHEN YEA_FAM_STR011 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR011	 /*6세이하*/
                     , SUM(CASE WHEN YEA_FAM_STR012 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_STR012	 /*출생입양*/
                     , SUM(YEA_FAM_NUM001) AS YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
                     , SUM(YEA_FAM_NUM002) AS YEA_FAM_NUM002   /*보험료_건강고용_기타*/
                     , SUM(YEA_FAM_NUM003) AS YEA_FAM_NUM003   /*보험료_보장성_국세청*/
                     , SUM(YEA_FAM_NUM004) AS YEA_FAM_NUM004   /*보험료_보장성_기타*/
                     , SUM(YEA_FAM_NUM020) AS YEA_FAM_NUM020   /*장애인전용보험_국세청*/
                     , SUM(YEA_FAM_NUM021) AS YEA_FAM_NUM021   /*장애인전용보험_기타*/	
                     , SUM(YEA_FAM_NUM005)+SUM(YEA_FAM_NUM022) AS YEA_FAM_NUM005    /* 의료비_국세청 [2015귀속]_난임시술비 추가 */
                     , SUM(YEA_FAM_NUM006)+SUM(YEA_FAM_NUM023) AS YEA_FAM_NUM006    /* 의료비_기타   [2015귀속]_난임시술비 추가 */
                     , SUM(YEA_FAM_NUM007) AS YEA_FAM_NUM007   /*교육비_국세청*/
                     , SUM(YEA_FAM_NUM008) AS YEA_FAM_NUM008   /*교육비_기타*/
                     , SUM(YEA_FAM_NUM009) AS YEA_FAM_NUM009   /*신용카드_국세청*/
                     , SUM(YEA_FAM_NUM010) AS YEA_FAM_NUM010   /*신용카드_기타*/
                     , SUM(YEA_FAM_NUM011) AS YEA_FAM_NUM011   /*직불카드_국세청*/
                     , SUM(YEA_FAM_NUM012) AS YEA_FAM_NUM012   /*직불카드_기타*/
                     , SUM(YEA_FAM_NUM013) AS YEA_FAM_NUM013   /*현금영수증_국세청*/
                     , SUM(YEA_FAM_NUM014) AS YEA_FAM_NUM014   /*전통시장_국세청*/
                     , SUM(YEA_FAM_NUM015) AS YEA_FAM_NUM015   /*전통시장_기타*/
                     , SUM(YEA_FAM_NUM016) AS YEA_FAM_NUM016   /*대중교통_국세청*/
                     , SUM(YEA_FAM_NUM017) AS YEA_FAM_NUM017   /*대중교통_기타*/
                     , SUM(YEA_FAM_NUM018) AS YEA_FAM_NUM018   /*기부금_국세청*/
                     , SUM(YEA_FAM_NUM019) AS YEA_FAM_NUM019   /*기부금_기타*/
                  FROM YEA_YEFAMI                    /*연말정산가족사항 테이블*/
                 WHERE YEA_STD_YY =  #YEA_STD_YY#
                   AND YEA_EMP_NO = #YEA_EMP_NO#   
                 GROUP BY YEA_EMP_NO
               ) D
            ON A.YEA_EMP_NO = D.YEA_EMP_NO
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#    
    ]]>	
	</select>      
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 소득공제신고서2(가족사항) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT01" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT01.소득공제신고서2(가족사항) 출력 */
            SELECT A.YEA_FAM_STR001    /*가족관계 신고코드*/
		         , NVL(A.YEA_FAM_STR002,'1') AS YEA_FAM_STR002    /*내외국인구분*/
		         , A.YEA_FAM_STR003    /*가족성명*/
		         , CASE WHEN A.YEA_FAM_STR001 = '0' THEN '(근로자 본인)' ELSE SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004), 1, 6) || '-' || SUBSTR(SF_YEA_DECRYPT_SSN(A.YEA_FAM_STR004), -7) END AS YEA_FAM_STR004    /*주민등록번호*/
		         , CASE WHEN A.YEA_FAM_STR005 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR005    /*기본공제여부*/
		         , CASE WHEN A.YEA_FAM_STR006 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR006    /*경로우대여부*/
		         , CASE WHEN A.YEA_FAM_STR007 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR007    /*부녀자여부*/
		         , CASE WHEN A.YEA_FAM_STR008 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR008    /*한부모여부*/
		         , CASE WHEN NVL(A.YEA_FAM_STR009,'0') <> '0' THEN A.YEA_FAM_STR009 ELSE '' END AS YEA_FAM_STR009    /*장애인여부*/    /*장애인여부*/
		         , CASE WHEN A.YEA_FAM_STR011 = '1' THEN '0' ELSE '' END AS YEA_FAM_STR011	  /*6세이하*/
		         , CASE WHEN A.YEA_FAM_STR012 = '1' THEN '0' ELSE '' END AS YEA_FAM_STR012	  /*출산입양*/
                 , A.YEA_FAM_NUM001   /*보험료_건강고용_국세청*/ 
                 , A.YEA_FAM_NUM002   /*보험료_건강고용_기타*/ 
                 , A.YEA_FAM_NUM003   /*보험료_보장성_국세청*/ 
                 , A.YEA_FAM_NUM004   /*보험료_보장성_기타*/                  
                 , A.YEA_FAM_NUM020   /*장애인전용보험_국세청*/
                 , A.YEA_FAM_NUM021   /*장애인전용보험_기타*/	
                 , NVL(A.YEA_FAM_NUM005,0) + NVL(A.YEA_FAM_NUM022,0) AS YEA_FAM_NUM005  /*의료비_국세청   [2015귀속]_난임시술비 추가*/
        		 , NVL(A.YEA_FAM_NUM006,0) + NVL(A.YEA_FAM_NUM023,0) AS YEA_FAM_NUM006  /*의료비_기타     [2015귀속]_난임시술비 추가*/
                 , A.YEA_FAM_NUM007   /*교육비_국세청*/ 
                 , A.YEA_FAM_NUM008   /*교육비_기타*/ 
                 , A.YEA_FAM_NUM009   /*신용카드_국세청*/ 
                 , A.YEA_FAM_NUM010   /*신용카드_기타*/ 
                 , A.YEA_FAM_NUM011   /*직불카드_국세청*/ 
                 , A.YEA_FAM_NUM012   /*직불카드_기타*/ 
                 , A.YEA_FAM_NUM013   /*현금영수증_국세청*/ 
                 , A.YEA_FAM_NUM014   /*전통시장_국세청*/ 
                 , A.YEA_FAM_NUM015   /*전통시장_기타*/ 
                 , A.YEA_FAM_NUM016   /*대중교통_국세청*/ 
                 , A.YEA_FAM_NUM017   /*대중교통_기타*/ 
                 , A.YEA_FAM_NUM018   /*기부금_국세청*/ 
                 , A.YEA_FAM_NUM019   /*기부금_기타*/   
              FROM YEA_YEFAMI A                     
             WHERE A.YEA_STD_YY = #YEA_STD_YY#
               AND A.YEA_EMP_NO = #YEA_EMP_NO#    
          ORDER BY A.YEA_FAMI_SEQ 
    ]]>	
	</select>      
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 소득공제신고서3(연금저축소득공제) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT02" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT02.소득공제신고서3(연금저축소득공제) 출력 */
        SELECT A.YEA_PENS_SEQ  /*연금명세서순번*/
             , A.YEA_PEN_STR001  /*연금소득공제구분*/
             , A.YEA_PEN_STR002  /*금융기관코드*/
             , SF_YEA_DECRYPT_ACCT_NO(A.YEA_PEN_STR003) AS YEA_PEN_STR003  /*계좌번호*/
             , A.YEA_PEN_NUM001  /*불입금액*/
             , A.YEA_PEN_NUM002  /*연금및저축공제액*/
             , SF_YEA_COMMNAME('YEA_90001', A.YEA_PEN_STR002) AS YEA_PEN_FINA_NAME /*금융기관명*/
             , B.YEA_COMD_NM AS YEA_PEN_NAME /*연금소득공제구분명*/
             , B.YEA_RE2F_VALUE AS YEA_PEN_TYPE /*공제구분*/
          FROM YEA_PENSAV A
     LEFT JOIN VI_YEA_CODEXD B
            ON B.YEA_COMM_CD = 'YEA_90018'
           AND B.YEA_COMD_CD = A.YEA_PEN_STR001
         WHERE A.YEA_STD_YY = #YEA_STD_YY#
           AND A.YEA_EMP_NO = #YEA_EMP_NO#
           AND A.YEA_PEN_STR001 LIKE #YEA_PEN_STR001# || '%'
      ORDER BY A.YEA_PENS_SEQ
    ]]>	
	</select>     
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 소득공제신고서4(월세주택임차차입금1) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT03" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT03.소득공제신고서4(월세주택임차차입금1) 출력 */
    SELECT A.YEA_STD_YY       /*기준년월*/
         , A.YEA_EMP_NO       /*사원번호*/
         , A.YEA_RENT_SEQ1    /*월세주택임차차입금1_순번*/
         , A.YEA_RT1_STR001   /*임대인성명*/
         , SF_YEA_DECRYPT_SSN(A.YEA_RT1_STR002) AS YEA_RT1_STR002   /*임대인주민등록번호*/
         , A.YEA_RT1_STR003   /*주택유형구분코드*/
         , A.YEA_RT1_STR004   /*계약서상주소지*/
         , A.YEA_RT1_STR005   /*계약시작일*/
         , A.YEA_RT1_STR006   /*계약종료일*/
         , A.YEA_RT1_NUM001   /*월세액*/
         , A.YEA_RT1_NUM002   /*공제액*/
         , A.YEA_RT1_NUM003   /*주택계약면적*/
      FROM YEA_RENTA1 A
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#
  ORDER BY A.YEA_RENT_SEQ1
    ]]>	
	</select>       	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 소득공제신고서5(월세주택임차차입금2) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT04" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT04.소득공제신고서5(월세주택임차차입금2) 출력 */
    SELECT A.YEA_STD_YY       /*기준년월*/
         , A.YEA_EMP_NO       /*사원번호*/
         , A.YEA_RENT_SEQ2    /*월세주택임차차입금2_순번*/
         , A.YEA_RT2_STR001   /*대주성명*/
         , SF_YEA_DECRYPT_SSN(A.YEA_RT2_STR002) AS YEA_RT2_STR002   /*대주주민등록번호*/
         , A.YEA_RT2_STR003   /*금전소비대차계약시작일*/
         , A.YEA_RT2_STR004   /*금전소비대차계약종료일*/
         , A.YEA_RT2_STR005   /*임대인성명*/
         , SF_YEA_DECRYPT_SSN(A.YEA_RT2_STR006) AS YEA_RT2_STR006   /*임대인주민등록번호*/
         , A.YEA_RT2_STR007   /*주택유형구분코드*/
         , A.YEA_RT2_STR008   /*계약서상주소지*/
         , A.YEA_RT2_STR009   /*계약시작일*/
         , A.YEA_RT2_STR010   /*계약종료일*/
         , A.YEA_RT2_NUM001   /*차입금이자율*/
         , A.YEA_RT2_NUM002   /*주택차입이자상환액*/
         , A.YEA_RT2_NUM003   /*원리금상환액*/
         , A.YEA_RT2_NUM004   /*이자액*/
         , A.YEA_RT2_NUM005   /*공제액*/
         , A.YEA_RT2_NUM006   /*주택계약면적*/
         , A.YEA_RT2_NUM007   /*보증금액*/
      FROM YEA_RENTA2 A
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#
  ORDER BY A.YEA_RENT_SEQ2
    ]]>	
	</select>     	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 의료비명세서 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT10" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT10.의료비명세서 출력 */
    SELECT A.YEA_MES_STR005               /*본인등해당여부*/
         , A.YEA_MES_STR006               /*상호*/
         , SF_YEA_DECRYPT_SSN(A.YEA_MES_STR007) AS YEA_MES_STR007               /*사업자번호*/
         , A.YEA_MES_NUM001               /*지급건수*/
         , A.YEA_MES_NUM002               /*지급액*/
         , A.YEA_MES_STR001               /*의료증빙코드*/
         , A.YEA_MES_STR002               /*성명*/
         , SF_YEA_DECRYPT_SSN(A.YEA_MES_STR003) AS YEA_MES_STR003               /*주민등록번호*/
         , A.YEA_MES_STR004               /*내외국인구분코드*/
         , A.YEA_MES_STR008               /*[2015귀속]_추가 난임시술비*/
      FROM YEA_MEDISP A
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#
  ORDER BY A.YEA_FAMI_SEQ
         , A.YEA_MEDI_SEQ
    ]]>	
	</select>         	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 기부금명세서1(당해년도 기부금) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT20" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT20.기부금명세서1(당해년도 기부금) 출력 */
    SELECT B.YEA_COMD_NM AS YEA_DOS_NAME    /*기부유형명*/
         , A.YEA_DOS_STR006                 /*기부유형코드*/
         , A.YEA_DOS_STR009                 /*기부내용*/
         , A.YEA_DOS_STR007                 /*상호*/
         , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR008) AS YEA_DOS_STR008                 /*사업자번호*/
         , A.YEA_DOS_STR005                 /*기부자관계코드*/
         , A.YEA_DOS_STR002                 /*기부자명*/
         , SF_YEA_DECRYPT_SSN(A.YEA_DOS_STR003) AS YEA_DOS_STR003                 /*주민등록번호*/
         , A.YEA_DOS_NUM001                 /*기부건수*/
         , A.YEA_DOS_NUM002                 /*기부액*/
      FROM YEA_DONASP A
 LEFT JOIN VI_YEA_CODEXD B
        ON B.YEA_COMM_CD = 'YEA_90010'
       AND B.YEA_COMD_CD = A.YEA_DOS_STR006
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#      
  ORDER BY A.YEA_FAMI_SEQ
         , A.YEA_DONA_SEQ
    ]]>	
	</select>       	         	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 기부금명세서2(구분코드별 기부금의 합계) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT21" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT21.기부금명세서2(구분코드별 기부금의 합계) 출력 */
    SELECT A.YEA_DOS_STR005
         , SUM(YEA_DOS_NUM002) AS YEA_DOS_SUM
         , SUM(DECODE(A.YEA_DOS_STR006, '10', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_10
         , SUM(DECODE(A.YEA_DOS_STR006, '20', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_20
         , SUM(DECODE(A.YEA_DOS_STR006, '40', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_40
         , SUM(DECODE(A.YEA_DOS_STR006, '41', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_41
         , SUM(DECODE(A.YEA_DOS_STR006, '42', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_42
         , SUM(DECODE(A.YEA_DOS_STR006, '50', A.YEA_DOS_NUM002, 0)) AS YEA_DOS_SUM_50
      FROM YEA_DONASP A
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#
  GROUP BY A.YEA_DOS_STR005
  ORDER BY A.YEA_DOS_STR005    
    ]]>	
	</select>             	         	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 기부금명세서3(기부금 조정세액) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT22" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT22.기부금명세서3(기부금 조정세액) 출력 */
    SELECT A.YEA_STD_YY       /*기준년월*/
         , A.YEA_EMP_NO       /*사원번호*/
         , A.YEA_DONA_SEQ     /*기부금순번*/
         , A.YEA_DOA_STR001   /*기부유형코드*/
         , A.YEA_DOA_STR002   /*기부년도*/
         , A.YEA_DOA_NUM001   /*기부금*/
         , A.YEA_DOA_NUM002   /*기부금기공제액*/
         , A.YEA_DOA_NUM003   /*기부금공제대상액*/
         , A.YEA_DOA_NUM004   /*기부금공제액*/
         , A.YEA_DOA_NUM005   /*기부금소멸액*/
         , A.YEA_DOA_NUM006   /*기부금이월액*/
      FROM YEA_DONAAD A
     WHERE A.YEA_STD_YY = #YEA_STD_YY#
       AND A.YEA_EMP_NO = #YEA_EMP_NO#
  ORDER BY A.YEA_DOA_STR001
         , A.YEA_DOA_STR002
    ]]>	
	</select>       		        	         	    
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 근로소득원천징수영수증1(기본) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.REPORT30" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.REPORT30.근로소득원천징수영수증1(기본) 출력 */
            SELECT B.YEA_EMP_NO
                  ,NVL(B.YEA_LIVE_CD, '1') AS YEA_LIVE_CD  /*거주구분*/
                  ,B.YEA_LOFO_CD   /*내외국인*/
                  ,SF_YEA_COMMNAME('YEA_90003',B.YEA_LIVE_NATION_CD) AS YEA_LIVE_NATION_NM  /*거주지국명*/
                  ,B.YEA_LIVE_NATION_CD  /* 거주지국코드*/
                  ,DECODE(B.YEA_RATE_YN,'1','1','0','2','') AS YEA_RATE_YN  /*단일세율*/
                  ,SF_YEA_COMMNAME('YEA_90003',YEA_NATION_CD) AS YEA_NATION_NM  /*국적명*/
                  ,B.YEA_NATION_CD  /*국적코드*/
                  ,C.YEA_INC_STR024    /*세대주여부*/
                  ,A.YEA_PRC_STR002  /*정산구분*/
                  ,D.YEA_BRANCH_NM   /*YEA_사업장명*/
                  ,D.YEA_CORP_MASTER /*YEA_사업장대표*/
                  ,D.YEA_BIZ_NO   /*YEA_사업자번호*/
                  ,D.YEA_CORP_NO  /*YEA_법인번호*/
                  ,D.YEA_ADDRESS1 || ' ' || D.YEA_ADDRESS2 AS YEA_ADDRESS   /*YEA_주소*/
                  ,B.YEA_EMP_NM   /*사원명*/
                  ,B.YEA_EMP_SSN  /*주민번호*/
                  ,B.YEA_HOME_ADDRESS1 || ' ' || B.YEA_HOME_ADDRESS2 AS YEA_HOME_ADDRESS   /*집주소*/
                  ,SF_YEA_COMMNAME('YEA_90002', D.YEA_TAXOFFIC_CD) AS YEA_TAXOFFIC_NAME   /*관할세무서명*/
                  ,CASE WHEN B.YEA_HIRE_YMD < A.YEA_STD_YY || '0101' THEN A.YEA_STD_YY || '0101' ELSE YEA_HIRE_YMD END AS YEA_HIRE_YMD   /*입사일*/
                  ,CASE WHEN NVL(B.YEA_QUIT_YMD,'29991231') > A.YEA_STD_YY || '1231' THEN #YEA_STD_YY# || '1231' ELSE  B.YEA_QUIT_YMD END AS YEA_QUIT_YMD   /*퇴사일*/
                  ,C.YEA_INC_STR002    /*감면기간시작일*/
                  ,C.YEA_INC_STR003    /*감면기간종료일*/
                  ,E.YEA_PAY_SUM001    /*(현)지급액 합계*/
                  ,E.YEA_PAY_NUM003    /*(현)상여금*/
                  ,E.YEA_PAY_NUM004    /*(현)인정상여*/
                  ,E.YEA_PAY_NUM005    /*(현)주식매수선택권행사이익*/
                  ,E.YEA_PAY_NUM006    /*(현)우리사주조합인출금*/
                  ,E.YEA_PAY_NUM007    /*(현)임원 퇴직소득금액 한도초과액*/
                  ,E.YEA_PAY_SUM002    /*(현)총지급액합계*/
                  ,E.YEA_PAY_NUM009    /*(현)국외근로원화금*/
                  ,E.YEA_PAY_NUM010    /*(현)야간근로비과세*/
                  ,E.YEA_PAY_NUM011    /*(현)출산보육비과세*/
                  ,E.YEA_PAY_NUM012    /*(현)연구활동비과세*/
                  ,E.YEA_PAY_NUM026    /*(현)교육수당[교류재단]*/
                  ,E.YEA_PAY_NUM013    /*(현)기타비과세액*/
                  ,E.YEA_PAY_NUM014    /*(현)감면세액*/
                  ,E.YEA_PAY_SUM003    /*(현)비과세합계*/
                  ,F.YEA_BFW_STR002_1  /*(종)사업자상호_1*/
                  ,F.YEA_BIZ_NO_1      /*(종)사업자번호_1*/
                  ,F.YEA_BFW_STR003_1   /*(종)입사일_1*/
                  ,F.YEA_BFW_STR004_1   /*(종)퇴사일_1*/
                  ,F.YEA_BFW_STR005_1   /*(종)감면기간시작일_1*/
                  ,F.YEA_BFW_STR006_1   /*(종)감면기간종료일_1*/
                  ,F.YEA_BFW_NUM001_1   /*(종)지급금액_1*/
                  ,F.YEA_BFW_NUM002_1   /*(종)상여금액_1*/
                  ,F.YEA_BFW_NUM003_1   /*(종)인정상여_1*/
                  ,F.YEA_BFW_NUM004_1   /*(종)주식매수선택권행사이익_1*/
                  ,F.YEA_BFW_NUM005_1   /*(종)우리사주조합인출금_1*/
                  ,F.YEA_BFW_NUM006_1   /*(종)임원 퇴직소득금액 한도초과액_1*/
                  ,F.YEA_BFW_SUM001_1   /*(종)총지급액_1*/
                  ,F.YEA_FORE_AMT1      /*(종)국외근로1*/
                  ,F.YEA_NIGH_NTAX1     /*(종)야간근로수당1*/
                  ,F.YEA_REAR_NTAX1     /*(종)출산보육수당1*/
                  ,F.YEA_NTAX_18_41     /*(종)연구보조비1*/
                  ,F.YEA_NTAX_18_51     /*(종)학자금1*/
                  ,F.YEA_NTAX_18_61     /*(종)취재수당1*/
                  ,F.YEA_NTAX_18_71     /*(종)그외비과세1*/
                  ,F.YEA_NTAX_18_251    /*(종)조세조약교직자소득세감면1*/
                  ,F.YEA_NTAX_19_1      /*(종)수련보조수당1*/
                  ,F.YEA_REDU_TOT1  /*(종)감면소득계1*/
                  ,F.YEA_NTAX_TOT1  /*(종)비과세계1*/
                  ,F.YEA_BFW_STR002_2   /*(종)사업자상호_2*/
                  ,F.YEA_BIZ_NO_2   /*(종)사업자번호_2*/
                  ,F.YEA_BFW_STR003_2   /*(종)입사일_2*/
                  ,F.YEA_BFW_STR004_2   /*(종)퇴사일_2*/
                  ,F.YEA_BFW_STR005_2   /*(종)감면기간시작일_2*/
                  ,F.YEA_BFW_STR006_2   /*(종)감면기간종료일_2*/
                  ,F.YEA_BFW_NUM001_2   /*(종)지급금액_2*/
                  ,F.YEA_BFW_NUM002_2   /*(종)상여금액_2*/
                  ,F.YEA_BFW_NUM003_2   /*(종)인정상여_2*/
                  ,F.YEA_BFW_NUM004_2   /*(종)주식매수선택권행사이익_2*/
                  ,F.YEA_BFW_NUM005_2   /*(종)우리사주조합인출금_2*/
                  ,F.YEA_BFW_NUM006_2   /*(종)임원 퇴직소득금액 한도초과액_2*/
                  ,F.YEA_BFW_SUM001_2   /*(종)총지급액_2*/
                  ,F.YEA_FORE_AMT2      /*(종)국외근로2*/
                  ,F.YEA_NIGH_NTAX2     /*(종)야간근로수당2*/
                  ,F.YEA_REAR_NTAX2     /*(종)출산보육수당2*/
                  ,F.YEA_NTAX_18_42     /*(종)연구보조비2*/
                  ,F.YEA_NTAX_18_52     /*(종)학자금2*/
                  ,F.YEA_NTAX_18_62     /*(종)취재수당2*/
                  ,F.YEA_NTAX_18_72     /*(종)그외비과세2*/
                  ,F.YEA_NTAX_18_252    /*(종)조세조약교직자소득세감면2*/
                  ,F.YEA_NTAX_19_2      /*(종)수련보조수당2*/
                  ,F.YEA_REDU_TOT2      /*(종)감면소득계2*/
                  ,F.YEA_NTAX_TOT2      /*(종)비과세계2*/
                  ,F.YEA_BFW_STR002_3   /*(종)사업자상호_3*/
                  ,F.YEA_BIZ_NO_3   /*(종)사업자번호_3*/
                  ,F.YEA_BFW_STR003_3   /*(종)입사일_3*/
                  ,F.YEA_BFW_STR004_3   /*(종)퇴사일_3*/
                  ,F.YEA_BFW_STR005_3   /*(종)감면기간시작일_3*/
                  ,F.YEA_BFW_STR006_3   /*(종)감면기간종료일_3*/
                  ,F.YEA_BFW_NUM001_3   /*(종)지급금액_3*/
                  ,F.YEA_BFW_NUM002_3   /*(종)상여금액_3*/
                  ,F.YEA_BFW_NUM003_3   /*(종)인정상여_3*/
                  ,F.YEA_BFW_NUM004_3   /*(종)주식매수선택권행사이익_3*/
                  ,F.YEA_BFW_NUM005_3   /*(종)우리사주조합인출금_3*/
                  ,F.YEA_BFW_NUM006_3   /*(종)임원 퇴직소득금액 한도초과액_3*/
                  ,F.YEA_BFW_SUM001_3   /*(종)총지급액_3*/
                  ,F.YEA_FORE_AMT3      /*(종)국외근로3*/
                  ,F.YEA_NIGH_NTAX3     /*(종)야간근로수당3*/
                  ,F.YEA_REAR_NTAX3     /*(종)출산보육수당3*/
                  ,F.YEA_NTAX_18_43     /*(종)연구보조비3*/
                  ,F.YEA_NTAX_18_53     /*(종)학자금3*/
                  ,F.YEA_NTAX_18_63     /*(종)취재수당3*/
                  ,F.YEA_NTAX_18_73     /*(종)그외비과세3*/
                  ,F.YEA_NTAX_18_253    /*(종)조세조약교직자소득세감면3*/
                  ,F.YEA_NTAX_19_3      /*(종)수련보조수당3*/
                  ,F.YEA_REDU_TOT3      /*(종)감면소득계3*/
                  ,F.YEA_NTAX_TOT3      /*(종)비과세계3*/
                  ,A.YEA_PRC_NUM083     /*결정세액_소득세*/
                  ,A.YEA_PRC_NUM084     /*결정세액_주민세*/
                  ,A.YEA_PRC_NUM085     /*결정세액_농특세*/
                  ,F.YEA_INCO_AMT1      /*(종)기납부세액소득세1*/
                  ,F.YEA_JUMI_AMT1      /*(종)기납부세액주민세1*/
                  ,F.YEA_FARM_AMT1      /*(종)기납부세액농특세1*/
                  ,F.YEA_INCO_AMT2      /*(종)기납부세액소득세2*/
                  ,F.YEA_JUMI_AMT2      /*(종)기납부세액주민세2*/
                  ,F.YEA_FARM_AMT2      /*(종)기납부세액농특세2*/
                  ,F.YEA_INCO_AMT3      /*(종)기납부세액소득세3*/
                  ,F.YEA_JUMI_AMT3      /*(종)기납부세액주민세3*/
                  ,F.YEA_FARM_AMT3      /*(종)기납부세액농특세3*/
                  ,A.YEA_PRC_NUM089   /*주근무지소득세*/
                  ,A.YEA_PRC_NUM090   /*주근무지주민세*/
                  ,A.YEA_PRC_NUM091   /*주근무지농특세*/
                  ,A.YEA_PRC_NUM095   /*납부특례소득세*/
                  ,A.YEA_PRC_NUM096   /*납부특례주민세*/
                  ,A.YEA_PRC_NUM097   /*납부특례농특세*/
                  ,A.YEA_PRC_NUM092   /*차감징수소득세*/
                  ,A.YEA_PRC_NUM093   /*차감징수주민세*/
                  ,A.YEA_PRC_NUM094   /*차감징수농특세*/
                  ,A.YEA_PRC_NUM001   /*총급여*/
                  ,A.YEA_PRC_NUM002   /*근로소득공제*/
                  ,A.YEA_PRC_NUM003   /*근로소득금액*/
                  ,A.YEA_PRC_NUM004   /*기본공제_본인*/
                  ,A.YEA_PRC_NUM005   /*기본공제_배우자*/
                  ,A.YEA_PRC_NUM006   /*기본공제_부양가족 수*/
                  ,A.YEA_PRC_NUM007   /*기본공제_부양가족*/
                  ,A.YEA_PRC_NUM008   /*추가공제_경로우대 수*/
                  ,A.YEA_PRC_NUM009   /*추가공제_경로우대*/
                  ,A.YEA_PRC_NUM010   /*추가공제_장애인 수*/
                  ,A.YEA_PRC_NUM011   /*추가공제_장애인*/
                  ,A.YEA_PRC_NUM012   /*추가공제_부녀자*/
                  ,A.YEA_PRC_NUM013   /*추가공제_한부모*/
                  ,A.YEA_PRC_NUM014   /*국민연금보험료공제*/
                  ,A.YEA_PRC_NUM015   /*기타연금보험료공제(공무원연금)*/
                  ,A.YEA_PRC_NUM016   /*기타연금보험료공제(군인연금)*/
                  ,A.YEA_PRC_NUM017   /*기타연금보험료공제(사립학교)*/
                  ,A.YEA_PRC_NUM018   /*기타연금보험료공제(별정우체국)*/
                  ,A.YEA_PRC_NUM019   /*보험료(건강보험료)*/
                  ,A.YEA_PRC_NUM020   /*보험료(고용보험료)*/
                  ,A.YEA_PRC_NUM021   /*주택임차차입금상환(대출기관)*/
                  ,A.YEA_PRC_NUM022   /*주택임차차입금상환(거주자)*/
                  ,A.YEA_PRC_NUM023   /*장기주택저당차입금_2011년이전(15년미만)*/
                  ,A.YEA_PRC_NUM024   /*장기주택저당차입금 _2011년이전(15년~29년)*/
                  ,A.YEA_PRC_NUM025   /*장기주택저당차입금_2011년이전(30년이상)*/
                  ,A.YEA_PRC_NUM026   /*장기주택저당차입금_2012년이후(고정금리,비거치상환대출)*/
                  ,A.YEA_PRC_NUM027   /*장기주택저당차입금_2012년이후(기타대출)*/
                  ,A.YEA_PRC_NUM104   /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이면서,비거치)*/
                  ,A.YEA_PRC_NUM105   /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(고정금리이거나,비거치)*/
                  ,A.YEA_PRC_NUM106   /*[2015귀속]_추가 장기주택저당차입금_2015년이후_15년이상(기타대출)*/
                  ,A.YEA_PRC_NUM107   /*[2015귀속]_추가 장기주택저당차입금_2015년이후_10~15년 (고정금리이거나,비거치)*/                  
                  ,A.YEA_PRC_NUM028   /*기부금(이월분)*/
                  ,A.YEA_PRC_NUM029   /*특별공제계*/
                  ,A.YEA_PRC_NUM030   /*차감소득금액*/
                  ,A.YEA_PRC_NUM031   /*개인연금저축*/
                  ,A.YEA_PRC_NUM032   /*소기업·소상공인 공제부금*/
                  ,A.YEA_PRC_NUM033   /*청약저축*/
                  ,A.YEA_PRC_NUM034   /*주택청약종합저축*/
                  ,A.YEA_PRC_NUM035   /*근로자주택마련저축*/
                  ,A.YEA_PRC_NUM036   /*투자조합출자 등*/
                  ,A.YEA_PRC_NUM037   /*신용카드 등 사용액*/
                  ,A.YEA_PRC_NUM038   /*우리사주조합 출연금*/
                  /*,A.YEA_PRC_NUM039   우리사주조합 기부금[2015귀속]_이동*/
                  ,A.YEA_PRC_NUM040   /*고용유지 중소기업 근로자*/
                  ,A.YEA_PRC_NUM041   /*목돈 안 드는 전세 이자상환액*/
                  ,A.YEA_PRC_NUM042   /*장기집합투자증권저축*/
                  ,A.YEA_PRC_NUM043   /*그 박의 소득공제 계*/
                  ,A.YEA_PRC_NUM044   /*소득공제 종합한도 초과액*/
                  ,A.YEA_PRC_NUM045   /*종합소득 과세표준*/
                  ,A.YEA_PRC_NUM046   /*산출세액*/
                  ,A.YEA_PRC_NUM047   /*세액감면_소득세법*/
                  ,A.YEA_PRC_NUM048   /*세액감면_조세특례제한법*/
                  ,A.YEA_PRC_NUM049   /*세액감면_조세특례제한법 제30조*/
                  ,A.YEA_PRC_NUM050   /*조세조약*/
                  ,A.YEA_PRC_NUM051   /*세액감면 계*/
                  ,A.YEA_PRC_NUM052   /*세액공제_근로소득*/
                  ,A.YEA_PRC_NUM053   /*자녀수*/
                  ,A.YEA_PRC_NUM054   /*세액공제_자녀*/
                  ,A.YEA_PRC_NUM055   /*과학기술인공제_공제대상금액*/
                  ,A.YEA_PRC_NUM056   /*과학기술인공제_세액공제액*/
                  ,A.YEA_PRC_NUM057   /*근로자퇴직급여보장법_공제대상금액*/
                  ,A.YEA_PRC_NUM058   /*근로자퇴직급여보장법_세액공제액*/
                  ,A.YEA_PRC_NUM059   /*연금저축_공제대상금액*/
                  ,A.YEA_PRC_NUM060   /*연금저축_세액공제액*/
                  ,A.YEA_PRC_NUM061   /*보장성보험료_공제대상금액*/
                  ,A.YEA_PRC_NUM062   /*보장성보험료_세액공제액*/
                  ,A.YEA_PRC_NUM063   /*의료비_공제대상금액*/
                  ,A.YEA_PRC_NUM064   /*의료비_세액공제액*/
                  ,A.YEA_PRC_NUM065   /*교육비_공제대상금액*/
                  ,A.YEA_PRC_NUM066   /*교육비_세액공제액*/
                  ,A.YEA_PRC_NUM067   /*정치자금기부금_10만원이하_공제대상금액*/
                  ,A.YEA_PRC_NUM068   /*정치자금기부금_10만원이하_세액공제액*/
                  ,A.YEA_PRC_NUM069   /*정치자금기부금_10만원초과_공제대상금액*/
                  ,A.YEA_PRC_NUM070   /*정치자금기부금_10만원초과_세액공제액*/
                  ,A.YEA_PRC_NUM071   /*법정기부금_공제대상금액*/
                  ,A.YEA_PRC_NUM072   /*법정기부금_세액공제액*/
                  ,A.YEA_PRC_NUM039   /*[2015귀속]_이동 우리사주조합기부금_공제대상금액*/
                  ,A.YEA_PRC_NUM108   /*[2015귀속]_추가 우리사주조합기부금_세액공제액*/
                  ,A.YEA_PRC_NUM073   /*지정기부금_공제대상금액*/
                  ,A.YEA_PRC_NUM074   /*지정기부금_세액공제액*/
                  ,A.YEA_PRC_NUM075   /*특별세액공제 계*/
                  ,A.YEA_PRC_NUM076   /*표준세액공제*/
                  ,A.YEA_PRC_NUM077   /*납세조합공제*/
                  ,A.YEA_PRC_NUM078   /*주택차입금*/
                  ,A.YEA_PRC_NUM079   /*외국납부*/
                  ,A.YEA_PRC_NUM080   /*월세세액공제_공제대상금액*/
                  ,A.YEA_PRC_NUM081   /*월세세액공제_세액공제액*/
                  ,A.YEA_PRC_NUM082   /*세액공제 계*/
                  ,G.YEA_FAM_CNT001   /*기본공제여부*/
                  ,G.YEA_FAM_CNT002   /*부녀자여부*/
                  ,G.YEA_FAM_CNT003   /*한부모여부*/
                  ,G.YEA_FAM_CNT004   /*경로자여부*/
                  ,G.YEA_FAM_CNT005   /*장애자여부*/
                  ,G.YEA_FAM_SUM001   /*보험료_건강고용_국세청*/
                  ,G.YEA_FAM_SUM002   /*보험료_건강고용_기타*/
                  ,G.YEA_FAM_SUM003   /*보험료_보장성_국세청*/
                  ,G.YEA_FAM_SUM004   /*보험료_보장성_기타*/
                  ,G.YEA_FAM_SUM005   /*의료비_국세청*/
                  ,G.YEA_FAM_SUM006   /*의료비_기타*/
                  ,G.YEA_FAM_SUM007   /*교육비_국세청*/
                  ,G.YEA_FAM_SUM008   /*교육비_기타*/
                  ,G.YEA_FAM_SUM009   /*신용카드_국세청*/
                  ,G.YEA_FAM_SUM010   /*신용카드_기타*/
                  ,G.YEA_FAM_SUM011   /*직불카드_국세청*/
                  ,G.YEA_FAM_SUM012   /*직불카드_기타*/
                  ,G.YEA_FAM_SUM013   /*현금영수증_국세청*/
                  ,G.YEA_FAM_SUM014   /*전통시장_국세청*/
                  ,G.YEA_FAM_SUM015   /*전통시장_기타*/
                  ,G.YEA_FAM_SUM016   /*대중교통_국세청*/
                  ,G.YEA_FAM_SUM017   /*대중교통_기타*/
                  ,G.YEA_FAM_SUM018   /*기부금_국세청*/
                  ,G.YEA_FAM_SUM019   /*기부금_기타*/
                  ,A.YEA_PRC_NUM098   /*세액공제_6세이하 수 귀속년도2014년 연말정산 재정산(소급)*/
                  ,A.YEA_PRC_NUM099   /*세액공제_6세이하*/
                  ,A.YEA_PRC_NUM100   /*세액공제_출산 입양 수*/
                  ,A.YEA_PRC_NUM101   /*세액공제_출산 입양*/
                  ,A.YEA_PRC_NUM102   /*장애인전용보험료_공제대상금액*/
                  ,A.YEA_PRC_NUM103   /*장애인전용보험료_세액공제액*/
                  ,G.YEA_FAM_CNT011   /*6세이하여부*/
                  ,G.YEA_FAM_CNT012   /*출산입양여부*/
                  ,G.YEA_FAM_SUM020   /*장애인전용_국세청*/
                  ,G.YEA_FAM_SUM021   /*장애인전용_기타*/
                  ,E.YEA_PAY_NUM021   /*국민연금*/
                  ,E.YEA_PAY_NUM022   /*건강보험료*/
                  ,E.YEA_PAY_NUM023   /*고용보험료*/
                FROM YEA_YEPROC A
          INNER JOIN TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) B
                  ON A.YEA_EMP_NO = B.YEA_EMP_NO
          INNER JOIN YEA_INCDEC C
                  ON A.YEA_STD_YY = C.YEA_STD_YY
                 AND A.YEA_EMP_NO = C.YEA_EMP_NO
           LEFT JOIN (
                      SELECT A.*
                           , ROW_NUMBER() OVER(
                                   PARTITION BY A.YEA_BRANCH_CD
                                       ORDER BY A.YEA_BRANCH_YMD DESC
                             ) AS ROW_NUM
                        FROM VI_YEA_BRCHXM A
                     ) D
                  ON A.YEA_PRC_STR005 = D.YEA_BRANCH_CD   /*사업장코드*/
                 AND D.ROW_NUM = 1
           LEFT JOIN
                   (
                    SELECT YEA_EMP_NO
                          ,SUM(YEA_PAY_NUM001) + SUM(YEA_PAY_NUM002) AS YEA_PAY_SUM001   /*(현)지급액합계*/
                          ,SUM(YEA_PAY_NUM003) AS YEA_PAY_NUM003   /*(현)상여금액*/
                          ,SUM(YEA_PAY_NUM004) AS YEA_PAY_NUM004   /*(현)인정상여*/
                          ,SUM(YEA_PAY_NUM005) AS YEA_PAY_NUM005   /*(현)주식매수선택권행사이익*/
                          ,SUM(YEA_PAY_NUM006) AS YEA_PAY_NUM006   /*(현)우리사주조합인출금*/
                          ,SUM(YEA_PAY_NUM007) AS YEA_PAY_NUM007   /*(현)임원 퇴직소득금액 한도초과액*/
                          ,SUM(NVL(YEA_PAY_NUM001,0) + NVL(YEA_PAY_NUM002,0) + NVL(YEA_PAY_NUM003,0)
                           + NVL(YEA_PAY_NUM004,0) + NVL(YEA_PAY_NUM005,0) + NVL(YEA_PAY_NUM006,0)
                           + NVL(YEA_PAY_NUM007,0)) AS YEA_PAY_SUM002   /*(현)총지급액합계*/
                          ,SUM(YEA_PAY_NUM009) AS YEA_PAY_NUM009   /*(현)국외근로원화금*/
                          ,SUM(YEA_PAY_NUM010) AS YEA_PAY_NUM010   /*(현)야간근로비과세*/
                          ,SUM(YEA_PAY_NUM011) AS YEA_PAY_NUM011   /*(현)출산보육비과세*/
                          ,SUM(YEA_PAY_NUM012) AS YEA_PAY_NUM012   /*(현)연구활동비과세*/
                          ,SUM(YEA_PAY_NUM026) AS YEA_PAY_NUM026   /*(현)교육수당[교류재단]*/
                          ,0 AS YEA_PAY_NUM013   /*(현)기타비과세액*/
                          ,SUM(YEA_PAY_NUM014) AS YEA_PAY_NUM014   /*(현)감면세액*/
                          ,SUM(NVL(YEA_PAY_NUM009,0) + NVL(YEA_PAY_NUM010,0) + NVL(YEA_PAY_NUM011,0)
                           + NVL(YEA_PAY_NUM012,0) + NVL(YEA_PAY_NUM026,0) + NVL(YEA_PAY_NUM027,0)) AS YEA_PAY_SUM003   /*(현)비과세합계*/
                          ,SUM(YEA_PAY_NUM021) AS YEA_PAY_NUM021   /*국민연금*/
                          ,SUM(YEA_PAY_NUM022) AS YEA_PAY_NUM022   /*건강보험료*/
                          ,SUM(YEA_PAY_NUM023) AS YEA_PAY_NUM023   /*고용보험료*/
                      FROM YEA_PAYDTL
                     WHERE YEA_STD_YY = #YEA_STD_YY#
                  GROUP BY YEA_EMP_NO
                    ) E
                  ON A.YEA_EMP_NO = E.YEA_EMP_NO
           LEFT JOIN
                   (
                    SELECT A.YEA_EMP_NO
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_1   /*(종)사업자상호_1*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_1   /*(종)사업자번호_1*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_1   /*(종)입사일_1*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_1   /*(종)퇴사일_1*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_1   /*(종)감면기간시작일_1*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_1   /*(종)감면기간종료일_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_1   /*(종)지급금액_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_1   /*(종)상여금액_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_1   /*(종)인정상여_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_1   /*(종)주식매수선택권행사이익_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_1   /*(종)우리사주조합인출금_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_1   /*(종)임원 퇴직소득금액 한도초과액_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                          + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                          + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_1   /*(종)총지급액_1*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_41
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_51
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_61
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_71
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_251
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT1
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT1
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_2   /*(종)사업자상호_2*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_2   /*(종)사업자번호_2*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_2   /*(종)입사일_2*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_2   /*(종)퇴사일_2*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_2   /*(종)감면기간시작일_2*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_2   /*(종)감면기간종료일_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_2   /*(종)지급금액_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_2   /*(종)상여금액_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_2   /*(종)인정상여_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_2   /*(종)주식매수선택권행사이익_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_2   /*(종)우리사주조합인출금_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_2   /*(종)임원 퇴직소득금액 한도초과액_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                           + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                           + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_2   /*(종)총지급액_2*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_42
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_52
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_62
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_72
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_252  /*2012.12.26 추가*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_2  /*2012.12.26 추가*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT2
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '1' AND ROW_NUM = 2 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT2
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR002 END) AS YEA_BFW_STR002_3   /*(종)사업자상호_3*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BIZ_NO END) AS YEA_BIZ_NO_3   /*(종)사업자번호_3*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR003 END) AS YEA_BFW_STR003_3   /*(종)입사일_3*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR004 END) AS YEA_BFW_STR004_3   /*(종)퇴사일_3*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR005 END) AS YEA_BFW_STR005_3   /*(종)감면기간시작일_3*/
                          ,MAX(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN A.YEA_BFW_STR006 END) AS YEA_BFW_STR006_3   /*(종)감면기간종료일_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) ELSE 0 END) AS YEA_BFW_NUM001_3   /*(종)지급금액_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM002,0) ELSE 0 END) AS YEA_BFW_NUM002_3   /*(종)상여금액_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM003,0) ELSE 0 END) AS YEA_BFW_NUM003_3   /*(종)인정상여_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM004,0) ELSE 0 END) AS YEA_BFW_NUM004_3   /*(종)주식매수선택권행사이익_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM005,0) ELSE 0 END) AS YEA_BFW_NUM005_3   /*(종)우리사주조합인출금_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_NUM006_3   /*(종)임원 퇴직소득금액 한도초과액_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM001,0) + NVL(A.YEA_BFW_NUM002,0)
                           + NVL(A.YEA_BFW_NUM003,0) + NVL(A.YEA_BFW_NUM004,0) + NVL(A.YEA_BFW_NUM005,0)
                           + NVL(A.YEA_BFW_NUM006,0) ELSE 0 END) AS YEA_BFW_SUM001_3   /*(종)총지급액_3*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_FORE_AMT,0) ELSE 0 END) AS YEA_FORE_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NIGH_NTAX,0) ELSE 0 END) AS YEA_NIGH_NTAX3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_REAR_NTAX,0) ELSE 0 END) AS YEA_REAR_NTAX3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_4,0) ELSE 0 END) AS YEA_NTAX_18_43
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_5,0) ELSE 0 END) AS YEA_NTAX_18_53
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_6,0) ELSE 0 END) AS YEA_NTAX_18_63
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_7,0) ELSE 0 END) AS YEA_NTAX_18_73
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_18_25,0) ELSE 0 END) AS YEA_NTAX_18_253  /*2012.12.26 추가*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_19,0) ELSE 0 END) AS YEA_NTAX_19_3  /*2012.12.26 추가*/
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_REDU_TOT,0) ELSE 0 END) AS YEA_REDU_TOT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(B.YEA_NTAX_TOT,0) ELSE 0 END) AS YEA_NTAX_TOT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM010,0) ELSE 0 END) AS YEA_INCO_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM011,0) ELSE 0 END) AS YEA_JUMI_AMT3
                          ,SUM(CASE WHEN YEA_BFW_STR001 = '0' AND ROW_NUM = 1 THEN NVL(A.YEA_BFW_NUM012,0) ELSE 0 END) AS YEA_FARM_AMT3
                      FROM (
                            SELECT A.*
                                  ,ROW_NUMBER() OVER (PARTITION BY YEA_BFW_STR001 ORDER BY YEA_BIZ_NO) AS ROW_NUM
                              FROM YEA_BFWORK A
                             WHERE A.YEA_STD_YY = #YEA_STD_YY#
                               AND A.YEA_EMP_NO = #YEA_EMP_NO#
                           ) A
                 LEFT JOIN (
                            SELECT YEA_BIZ_NO
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('M01','M02','M03') THEN YEA_BFN_NUM001 END) AS YEA_FORE_AMT
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'O01' THEN YEA_BFN_NUM001 END) AS YEA_NIGH_NTAX
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'Q01' THEN YEA_BFN_NUM001 END) AS YEA_REAR_NTAX
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('H06','H07','H08','H09','H10') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_4
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'G01' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_5
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'H11' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_6
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('H01','H05','H14','H15','H12','H13','I01','K01','R10','S01','Y02','Y03','Y21','T01','Z01') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_7 /*2012.12.26 변경*/
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'T20' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_18_25  /*2012.12.26 추가*/
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD = 'Y22' THEN YEA_BFN_NUM001 END) AS YEA_NTAX_19 /*2012.12.26 변경*/
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('M01','M02','M03','O01','Q01','H06','H07','H08','H09','H10','G01','H11','H01','H05','H14','H15','H12','H13','I01','K01','R10','S01','Y02','Y03','Y21','Y22') THEN YEA_BFN_NUM001 END) AS YEA_NTAX_TOT /*2012.12.26 변경*/
                                  ,SUM(CASE WHEN YEA_NON_TAX_CD IN ('T01','T10','T20','Z01') THEN YEA_BFN_NUM001 END) AS YEA_REDU_TOT /*2012.12.26 추가*/
                              FROM YEA_BFNTAX
                             WHERE YEA_STD_YY = #YEA_STD_YY#
                               AND YEA_EMP_NO = #YEA_EMP_NO#
                          GROUP BY YEA_BIZ_NO
                            ) B
                        ON A.YEA_BIZ_NO = B.YEA_BIZ_NO
                  GROUP BY YEA_EMP_NO
                   ) F
                  ON A.YEA_EMP_NO = F.YEA_EMP_NO
           LEFT JOIN
                   (
                    SELECT YEA_EMP_NO
                          ,SUM(CASE WHEN YEA_FAM_STR005 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT001   /*기본공제여부*/
                          ,SUM(CASE WHEN YEA_FAM_STR007 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT002   /*부녀자여부*/
                          ,SUM(CASE WHEN YEA_FAM_STR008 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT003   /*한부모여부*/
                          ,SUM(CASE WHEN YEA_FAM_STR006 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT004   /*경로자여부*/
                          ,SUM(CASE WHEN NVL(YEA_FAM_STR009, '0') <> '0' THEN 1 ELSE 0 END) AS YEA_FAM_CNT005   /*장애자여부*/
                          ,SUM(CASE WHEN YEA_FAM_STR011 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT011   /*6세이하여부*/
                          ,SUM(CASE WHEN YEA_FAM_STR012 = '1' THEN 1 ELSE 0 END) AS YEA_FAM_CNT012   /*출산입양여부*/
                          ,SUM(YEA_FAM_NUM001) AS YEA_FAM_SUM001   /*보험료_건강고용_국세청*/
                          ,SUM(YEA_FAM_NUM002) AS YEA_FAM_SUM002   /*보험료_건강고용_기타*/
                          ,SUM(YEA_FAM_NUM003) AS YEA_FAM_SUM003   /*보험료_보장성_국세청*/
                          ,SUM(YEA_FAM_NUM004) AS YEA_FAM_SUM004   /*보험료_보장성_기타*/
                          ,SUM(YEA_FAM_NUM005) + SUM(YEA_FAM_NUM022) AS YEA_FAM_SUM005   /*의료비_국세청   [2015귀속] 난임시술비 추가*/
                          ,SUM(YEA_FAM_NUM006) + SUM(YEA_FAM_NUM023) AS YEA_FAM_SUM006   /*의료비_기타     [2015귀속] 난임시술비 추가*/
                          ,SUM(YEA_FAM_NUM007) AS YEA_FAM_SUM007   /*교육비_국세청*/
                          ,SUM(YEA_FAM_NUM008) AS YEA_FAM_SUM008   /*교육비_기타*/
                          ,SUM(YEA_FAM_NUM009) AS YEA_FAM_SUM009   /*신용카드_국세청*/
                          ,SUM(YEA_FAM_NUM010) AS YEA_FAM_SUM010   /*신용카드_기타*/
                          ,SUM(YEA_FAM_NUM011) AS YEA_FAM_SUM011   /*직불카드_국세청*/
                          ,SUM(YEA_FAM_NUM012) AS YEA_FAM_SUM012   /*직불카드_기타*/
                          ,SUM(YEA_FAM_NUM013) AS YEA_FAM_SUM013   /*현금영수증_국세청*/
                          ,SUM(YEA_FAM_NUM014) AS YEA_FAM_SUM014   /*전통시장_국세청*/
                          ,SUM(YEA_FAM_NUM015) AS YEA_FAM_SUM015   /*전통시장_기타*/
                          ,SUM(YEA_FAM_NUM016) AS YEA_FAM_SUM016   /*대중교통_국세청*/
                          ,SUM(YEA_FAM_NUM017) AS YEA_FAM_SUM017   /*대중교통_기타*/
                          ,SUM(YEA_FAM_NUM018) AS YEA_FAM_SUM018   /*기부금_국세청*/
                          ,SUM(YEA_FAM_NUM019) AS YEA_FAM_SUM019   /*기부금_기타*/
                          ,SUM(YEA_FAM_NUM020) AS YEA_FAM_SUM020   /*장애인전용_국세청*/
                          ,SUM(YEA_FAM_NUM021) AS YEA_FAM_SUM021   /*장애인전용_기타*/
                      FROM YEA_YEFAMI
                     WHERE YEA_STD_YY = #YEA_STD_YY#
                  GROUP BY YEA_EMP_NO
                    ) G
                  ON A.YEA_EMP_NO = G.YEA_EMP_NO
                WHERE A.YEA_STD_YY = #YEA_STD_YY#
                  AND A.YEA_EMP_NO = #YEA_EMP_NO#
    ]]>	
	</select>  
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 근로소득원천징수영수증2(가족사항) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.SEARCH31" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
    /* YEAA0070_2015.SEARCH31.근로소득원천징수영수증2(가족사항) 출력 */
    SELECT B.YEA_FAM_STR001   /*가족관계신고코드*/
          ,B.YEA_FAM_STR002   /*내외국인구분*/
          ,B.YEA_FAM_STR003   /*가족성명*/
          ,CASE WHEN B.YEA_FAM_STR001 = '0' THEN '(근로자 본인)' ELSE SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004), 1, 6) || '-' || SUBSTR(SF_YEA_DECRYPT_SSN(B.YEA_FAM_STR004), -7) END AS YEA_FAM_STR004    /*주민등록번호*/
          ,CASE WHEN B.YEA_FAM_STR005 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR005     /*기본공제여부*/
          ,CASE WHEN B.YEA_FAM_STR007 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR007     /*부녀자여부*/
          ,CASE WHEN B.YEA_FAM_STR008 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR008     /*한부모여부*/
          ,CASE WHEN B.YEA_FAM_STR006 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR006     /*경로자여부*/
          ,CASE WHEN NVL(B.YEA_FAM_STR009, '0') <> '0' THEN B.YEA_FAM_STR009 END AS YEA_FAM_STR009 /*장애인코드*/
          ,CASE WHEN B.YEA_FAM_STR011 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR011     /*6세이하여부*/
          ,CASE WHEN B.YEA_FAM_STR012 = '1' THEN 'O' ELSE '' END AS YEA_FAM_STR012     /*출산입양여부*/
          ,B.YEA_FAM_NUM001   /*보험료_건강고용_국세청*/
          ,B.YEA_FAM_NUM002   /*보험료_건강고용_기타*/
          ,B.YEA_FAM_NUM003   /*보험료_보장성_국세청*/
          ,B.YEA_FAM_NUM004   /*보험료_보장성_기타*/
          ,NVL(B.YEA_FAM_NUM005,0) + NVL(B.YEA_FAM_NUM022,0) AS YEA_FAM_NUM005    /*의료비_국세청 [2015귀속] 난임시술비 추가*/
          ,NVL(B.YEA_FAM_NUM006,0) + NVL(B.YEA_FAM_NUM023,0) AS YEA_FAM_NUM006    /*의료비_기타   [2015귀속] 난임시술비 추가*/
          ,B.YEA_FAM_NUM007   /*교육비_국세청*/
          ,B.YEA_FAM_NUM008   /*교육비_기타*/
          ,B.YEA_FAM_NUM009   /*신용카드_국세청*/
          ,B.YEA_FAM_NUM010   /*신용카드_기타*/
          ,B.YEA_FAM_NUM011   /*직불카드_국세청*/
          ,B.YEA_FAM_NUM012   /*직불카드_기타*/
          ,B.YEA_FAM_NUM013   /*현금영수증_국세청*/
          ,B.YEA_FAM_NUM014   /*전통시장_국세청*/
          ,B.YEA_FAM_NUM015   /*전통시장_기타*/
          ,B.YEA_FAM_NUM016   /*대중교통_국세청*/
          ,B.YEA_FAM_NUM017   /*대중교통_기타*/
          ,B.YEA_FAM_NUM018   /*기부금_국세청*/
          ,B.YEA_FAM_NUM019   /*기부금_기타*/
          ,B.YEA_FAM_NUM020   /*장애인전용_국세청*/
          ,B.YEA_FAM_NUM021   /*장애인전용_기타*/
        FROM YEA_INCDEC A
  INNER JOIN YEA_YEFAMI B
          ON A.YEA_STD_YY = B.YEA_STD_YY
         AND A.YEA_EMP_NO = B.YEA_EMP_NO
       WHERE A.YEA_STD_YY = #YEA_STD_YY#
         AND A.YEA_EMP_NO = #YEA_EMP_NO#
    ORDER BY B.YEA_FAMI_SEQ
    ]]>	
	</select>        
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 근로소득원천징수부1(일반사항) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.SEARCH40" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        /* YEAA0070_2015.SEARCH40.근로소득원천징수부1(일반사항) 출력 */    
        SELECT D.YEA_STD_YY    /*귀속년도*/
              ,A.YEA_EMP_NO                 /*사번*/
              ,B.YEA_BRANCH_NM              /*사업장명*/
              ,B.YEA_BIZ_NO                 /*사업자번호*/
              ,A.YEA_EMP_NM                 /*사원명*/
              ,SUBSTR(A.YEA_EMP_SSN,1,6) || '-' || SUBSTR(A.YEA_EMP_SSN,7,7) AS YEA_EMP_SSN    /*주민등혹번호*/
              ,TO_CHAR(C.YEA_FAMI_CNT) || ' 명' AS YEA_FAMI_CNT
              ,B.YEA_CORP_MASTER            /*대표자명*/
              ,B.YEA_ADDRESS1 || B.YEA_ADDRESS2 AS YEA_ADDRESS  /*근무처주소*/
              ,A.YEA_HIRE_YMD               /*입사일*/
              ,A.YEA_QUIT_YMD               /*퇴사일*/
              ,A.YEA_LOFO_CD /*내외국인구분*/
              ,SF_YEA_COMMNAME('YEA_90003', A.YEA_NATION_CD) AS YEA_NATION_NM  /*국적*/
              ,NVL(A.YEA_NATION_CD, 'KR') AS YEA_NATION_CD  /*국적코드*/
              ,D.YEA_PRC_NUM053 || ' 명' AS YEA_CHILD_CNT  /*20세이하 자녀의 수*/
              ,'2'  AS YEA_EXEMPT_CD    /*감면적용여부*/
              ,'' AS YEA_EXEMPT_RULE    /*감면규정*/
              ,'' AS YEA_EXEMPT_SDATE   /*감면시작일*/
              ,'' AS YEA_EXEMPT_EDATE   /*감면종료일*/
          FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) A
    INNER JOIN YEA_YEPROC D
            ON A.YEA_EMP_NO = D.YEA_EMP_NO
     LEFT JOIN (
                SELECT A.*
                     , ROW_NUMBER() OVER(
                             PARTITION BY A.YEA_BRANCH_CD
                                 ORDER BY A.YEA_BRANCH_YMD DESC
                       ) AS ROW_NUM
                  FROM VI_YEA_BRCHXM A
               ) B
            ON D.YEA_PRC_STR005 = B.YEA_BRANCH_CD   /*사업장코드*/
           AND B.ROW_NUM = 1
     LEFT JOIN (
               SELECT YEA_EMP_NO
                     ,COUNT(YEA_FAMI_SEQ) AS YEA_FAMI_CNT
                     ,COUNT(CASE WHEN YEA_FAM_STR005 ='1' AND YEA_FAM_STR001 IN ('4', '8') THEN 1 ELSE 0 END) AS YEA_CHILD_CNT
                 FROM YEA_YEFAMI
                WHERE YEA_STD_YY = #YEA_STD_YY#
             GROUP BY YEA_EMP_NO
              ) C
           ON A.YEA_EMP_NO = C.YEA_EMP_NO
        WHERE D.YEA_STD_YY = #YEA_STD_YY#
          AND D.YEA_EMP_NO = #YEA_EMP_NO#
    ]]>	
	</select>         
<!--
/*******************************************************************************
     작 성 자 : 김석영
     작 성 일 : 2016.10.31
     내    용 : 근로소득원천징수부2(소득정보) 출력
********************************************************************************/
-->	
    <select id="YEAA0070_2015.SEARCH41" parameterClass="hashmap" resultClass="hashmap">
	<![CDATA[
        /* YEAA0070_2015.SEARCH41.근로소득원천징수부2(소득정보) 출력 */    
         SELECT
                 A.YEA_EMP_NO
                ,B.YEA_PAY_YYMM   /*지급년월*/
                ,B.YEA_PAY_NUM001 + B.YEA_PAY_NUM002 AS YEA_PAY_SUM001    /*지급금액*/
                ,B.YEA_PAY_NUM003   /*상여금액*/
                ,B.YEA_PAY_NUM004   /*인정상*/
                ,B.YEA_PAY_NUM005   /*주식매수선택권행사이익*/
                ,B.YEA_PAY_NUM006   /*우리사주조합인출금*/
                ,B.YEA_PAY_NUM007   /*임원 퇴직소득금액 한도초과액*/
                ,NVL(B.YEA_PAY_NUM001,0) + NVL(B.YEA_PAY_NUM002,0) + NVL(B.YEA_PAY_NUM003,0)
                 + NVL(B.YEA_PAY_NUM004,0) + NVL(B.YEA_PAY_NUM005,0) + NVL(B.YEA_PAY_NUM006,0)
                 + NVL(B.YEA_PAY_NUM007,0) AS YEA_PAY_SUM002    /*총지급액*/
                ,B.YEA_PAY_NUM015   /*소득세*/
                ,NVL(B.YEA_PAY_STR001,'') AS YEA_PAY_STR001   /*국외근로지급연월*/
                ,B.YEA_PAY_NUM008   /*국외근로외화금액*/
                ,B.YEA_PAY_NUM009   /*국외근로원화금액*/
                ,B.YEA_PAY_NUM010   /*야간근로비과세*/
                ,B.YEA_PAY_NUM011   /*출산보육비과세*/
                ,B.YEA_PAY_NUM012   /*연구활동비과세*/
                ,B.YEA_PAY_NUM013   /*기타비과세액*/
                ,NVL(B.YEA_PAY_NUM009,0) + NVL(B.YEA_PAY_NUM010,0) + NVL(B.YEA_PAY_NUM011,0)
                 + NVL(B.YEA_PAY_NUM012,0) + NVL(B.YEA_PAY_NUM013,0) AS YEA_PAY_SUM003  /*비과세합계*/
                ,B.YEA_PAY_NUM014   /*감면세액*/
                ,B.YEA_PAY_NUM016   /*주민세*/
                ,B.YEA_PAY_NUM017   /*농특세*/
                ,B.YEA_PAY_NUM018   /*납부특례세액_소득세*/
                ,B.YEA_PAY_NUM019   /*납부특례세액_지방소득세*/
                ,B.YEA_PAY_NUM020   /*납부특례세액_농특세*/
                ,B.YEA_PAY_NUM021   /*국민연금*/
                ,B.YEA_PAY_NUM022   /*건강보험*/
                ,B.YEA_PAY_NUM023   /*고용보험*/
                ,NVL(B.YEA_PAY_NUM024,0) + NVL(B.YEA_PAY_NUM025,0) AS YEA_PAY_SUM004   /*기부금합*/
                ,B.YEA_PAY_STR002   /*비과세내용*/
            FROM TABLE(SF_YEA_MASTXM(#YEA_EMP_NO#,#YEA_STD_YY#||'1231')) A
      INNER JOIN YEA_PAYDTL B
              ON A.YEA_EMP_NO = B.YEA_EMP_NO
      INNER JOIN YEA_YEPROC D
              ON B.YEA_STD_YY = D.YEA_STD_YY
             AND B.YEA_EMP_NO = D.YEA_EMP_NO
           WHERE D.YEA_STD_YY = #YEA_STD_YY#
             AND D.YEA_EMP_NO = #YEA_EMP_NO#
        ORDER BY B.YEA_PAY_YYMM
    ]]>	
	</select>        	      		     
</sqlMap>
